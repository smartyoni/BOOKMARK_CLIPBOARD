<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Î∂ÅÎßàÌÅ¨ ÌÅ¥Î¶ΩÎ≥¥Îìú Í¥ÄÎ¶¨Ïûê</title>
    
    <!-- PWA Meta Tags -->
    <meta name="description" content="ÌîÑÎ°úÏ†ùÌä∏Î≥Ñ Î∂ÅÎßàÌÅ¨ÏôÄ ÌÅ¥Î¶ΩÎ≥¥ÎìúÎ•º Ìö®Ïú®Ï†ÅÏúºÎ°ú Í¥ÄÎ¶¨ÌïòÎäî PWA Ïï±">
    <meta name="theme-color" content="#37352f">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="Î∂ÅÎßàÌÅ¨Ïï±">
    <meta name="msapplication-TileColor" content="#37352f">
    <meta name="msapplication-config" content="browserconfig.xml">
    
    <!-- PWA Manifest -->
    <link rel="manifest" href="manifest.json">
    
    <!-- PWA Icons -->
    <link rel="apple-touch-icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 192 192'><rect width='192' height='192' fill='%2337352f'/><text x='96' y='120' font-size='80' text-anchor='middle' fill='white'>üìã</text></svg>">
    <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 192 192'><rect width='192' height='192' fill='%2337352f'/><text x='96' y='120' font-size='80' text-anchor='middle' fill='white'>üìã</text></svg>">
    
    <!-- Firebase SDK v9 (ÏµúÏã† ÏïàÏ†ï Î≤ÑÏ†Ñ) -->
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
    
    <style>
        /* Í∏∞Î≥∏ Ïä§ÌÉÄÏùº Î∞è Î†àÏù¥ÏïÑÏõÉ ÏÑ§Ï†ï */
        body, html {
            margin: 0;
            padding: 0;
            height: 100%;
            font-family: ui-sans-serif, -apple-system, BlinkMacSystemFont, "Segoe UI Variable Display", "Segoe UI", Helvetica, "Apple Color Emoji", Arial, sans-serif, "Segoe UI Emoji", "Segoe UI Symbol";
            background-color: #ffffff;
            color: #37352f;
            overflow: hidden;
            font-size: 14px;
            line-height: 1.5;
        }
        .app-container {
            display: flex;
            height: 100vh;
        }

        /* ÏôºÏ™Ω ÏÇ¨Ïù¥ÎìúÎ∞î Ïä§ÌÉÄÏùº */
        #project-sidebar {
            width: 240px;
            background-color: #f7f6f3;
            padding: 12px 0;
            border-right: 1px solid rgba(55, 53, 47, 0.09);
            overflow-y: auto;
            flex-shrink: 0;
        }
        .sidebar-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0 14px;
            margin-bottom: 8px;
        }
        
        #project-sidebar h3 {
            margin: 4px 0 0 0;
            color: rgba(55, 53, 47, 0.65);
            font-size: 12px;
            font-weight: 500;
            text-transform: uppercase;
            letter-spacing: 0.02em;
        }
        
        .add-project-btn {
            background-color: transparent;
            color: rgba(55, 53, 47, 0.45);
            border: none;
            border-radius: 3px;
            width: 20px;
            height: 20px;
            font-size: 14px;
            display: flex;
            justify-content: center;
            align-items: center;
            cursor: pointer;
            transition: background-color 0.1s ease-in-out, color 0.1s ease-in-out;
            padding: 0;
        }
        
        .add-project-btn:hover {
            background-color: rgba(55, 53, 47, 0.08);
            color: #37352f;
        }
        #project-list {
            list-style: none;
            padding: 0;
            margin: 0;
        }
        #project-list li {
            padding: 4px 14px;
            cursor: pointer;
            transition: background-color 0.1s ease-in-out;
            border-radius: 3px;
            margin: 1px 6px;
            font-size: 14px;
            color: #37352f;
            position: relative;
            min-height: 27px;
            display: flex;
            align-items: center;
        }
        #project-list li:hover {
            background-color: rgba(55, 53, 47, 0.08);
        }
        #project-list li.active {
            background-color: rgba(46, 170, 220, 0.15);
            color: #2ea2dc;
        }

        /* Î©îÏù∏ ÏòÅÏó≠ Ïä§ÌÉÄÏùº */
        .main-area {
            flex-grow: 1;
            display: flex;
            flex-direction: column;
            overflow-y: auto;
        }

        /* Î©îÏù∏ ÏΩòÌÖêÏ∏† ÏòÅÏó≠ Ïä§ÌÉÄÏùº */
        .main-content {
            flex-grow: 1;
            display: flex;
            flex-direction: column;
            padding: 24px 20px;
            width: 100%;
            height: calc(100vh - 60px);
            box-sizing: border-box;
        }
        .content-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 16px 32px;
            background: linear-gradient(135deg, #1e3a8a 0%, #1e40af 100%);
            border-radius: 0;
            box-shadow: 0 2px 8px rgba(30, 58, 138, 0.15);
            border-bottom: 3px solid #1d4ed8;
            width: 100%;
            box-sizing: border-box;
        }
        .content-header h1 {
            font-size: 28px;
            line-height: 1.2;
            font-weight: 700;
            color: #ffffff;
            margin: 0;
            letter-spacing: -0.01em;
            text-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
        }
        .content-header .icon-button {
            color: rgba(255, 255, 255, 0.8);
            background-color: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        .content-header .icon-button:hover {
            color: #ffffff;
            background-color: rgba(255, 255, 255, 0.2);
            border-color: rgba(255, 255, 255, 0.3);
        }
        .content-panels {
            display: flex;
            gap: 16px;
            flex-grow: 1;
            margin-top: 0;
            justify-content: flex-start;
            align-items: stretch;
            height: 100%;
        }
        .content-panel {
            flex: 0 0 400px;
            max-width: 400px;
            background-color: #ffffff;
            padding: 12px;
            border-radius: 6px;
            border: 2px solid #2c2c2c;
            overflow-y: auto;
            box-shadow: rgba(15, 15, 15, 0.1) 0px 2px 4px;
        }
        .content-panel h4 {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin: -12px -12px 12px -12px;
            padding: 12px;
            background-color: #f8f9fa;
            border-bottom: 1px solid #dee2e6;
            border-radius: 4px 4px 0 0;
            font-size: 16px;
            font-weight: 600;
            color: #37352f;
            line-height: 1.3;
        }

        .bookmark-header {
            background-color: #e8d5f2 !important;
            border-bottom: 1px solid #b19cd9 !important;
            color: #6a4c93 !important;
        }

        .clipboard-header {
            background-color: #d4edda !important;
            border-bottom: 1px solid #a3d5a3 !important;
            color: #28a745 !important;
        }
        .practice-header {
            background-color: #fff3cd !important;
            border-bottom: 1px solid #ffc107 !important;
            color: #ff8c00 !important;
            display: flex !important;
            justify-content: space-between !important;
            align-items: center !important;
            margin: -12px -12px 12px -12px !important;
            padding: 12px !important;
            border-radius: 4px 4px 0 0 !important;
            font-size: 16px !important;
            font-weight: 600 !important;
            line-height: 1.3 !important;
        }
        .header-spacer {
            width: 33px;
            height: 33px;
            display: inline-block;
        }
        .practice-container {
            display: flex;
            flex-direction: column;
            height: calc(100% - 60px);
        }
        .practice-text {
            width: 100%;
            flex: 1;
            border: 1px solid #ddd;
            border-radius: 4px;
            padding: 12px;
            font-family: inherit;
            font-size: 14px;
            resize: none;
            box-sizing: border-box;
            background-color: #ffffff;
            margin-bottom: 8px;
        }
        .practice-text:focus {
            outline: none;
            border-color: #ff8c00;
            box-shadow: 0 0 0 2px rgba(255, 140, 0, 0.1);
        }
        .practice-buttons {
            display: flex;
            justify-content: flex-end;
            gap: 8px;
        }
        .practice-btn {
            padding: 6px 12px;
            border: 1px solid #ff8c00;
            border-radius: 4px;
            background-color: #ffffff;
            color: #ff8c00;
            cursor: pointer;
            font-size: 12px;
            transition: all 0.2s;
        }
        .practice-btn:hover {
            background-color: #ff8c00;
            color: #ffffff;
        }
        .add-section-btn {
            background-color: transparent;
            color: rgba(55, 53, 47, 0.6);
            border: 2px solid rgba(55, 53, 47, 0.3);
            border-radius: 50%;
            width: 33px;
            height: 33px;
            font-size: 18px;
            display: flex;
            justify-content: center;
            align-items: center;
            cursor: pointer;
            flex-shrink: 0;
            margin-left: 6px;
            transition: all 0.2s ease;
        }
        .add-section-btn:hover {
            background-color: rgba(55, 53, 47, 0.1);
            color: #37352f;
            border-color: rgba(55, 53, 47, 0.5);
            transform: scale(1.05);
        }
        .icon-button {
            background: none;
            border: none;
            font-size: 16px;
            cursor: pointer;
            color: rgba(55, 53, 47, 0.45);
            padding: 4px;
            border-radius: 3px;
            transition: background-color 0.1s ease-in-out, color 0.1s ease-in-out;
            width: 28px;
            height: 28px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .icon-button:hover {
            background-color: rgba(55, 53, 47, 0.08);
            color: #37352f;
        }
        .item-list {
            display: flex;
            flex-wrap: wrap;
            gap: 6px;
            list-style: none;
            padding: 0;
            margin: 0;
            word-break: break-all; /* Í∏¥ URLÎèÑ Ï§ÑÎ∞îÍøà */
        }
        .item-button {
            flex-shrink: 0;
            min-width: 80px;
            max-width: 200px;
            height: 32px;
            background-color: rgba(242, 241, 238, 0.6);
            padding: 6px 8px;
            border-radius: 3px;
            border: 2px solid #000;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 14px;
            color: #37352f;
            cursor: pointer;
            overflow: hidden;
            white-space: nowrap;
            text-overflow: ellipsis;
            transition: background-color 0.1s ease-in-out;
            box-sizing: border-box;
            font-weight: 400;
        }
        .item-button:hover {
            background-color: rgba(55, 53, 47, 0.08);
        }
        .item-button.bookmark-button {
            color: #37352f;
            background-color: rgba(46, 170, 220, 0.1);
        }
        .item-button.bookmark-button:hover {
            background-color: rgba(46, 170, 220, 0.2);
        }
        .item-button.clipboard-button {
            color: #37352f;
            background-color: rgba(100, 71, 58, 0.1);
        }
        

        /* Context Menu Styles */
        .context-menu {
            display: none;
            position: fixed;
            background-color: #ffffff;
            border: 1px solid rgba(55, 53, 47, 0.16);
            box-shadow: rgba(15, 15, 15, 0.05) 0px 0px 0px 1px, rgba(15, 15, 15, 0.1) 0px 3px 6px, rgba(15, 15, 15, 0.2) 0px 9px 24px;
            z-index: 2000;
            border-radius: 6px;
            overflow: hidden;
            min-width: 180px;
        }

        .context-menu ul {
            list-style: none;
            padding: 6px 0;
            margin: 0;
        }

        .context-menu ul li {
            padding: 8px 14px;
            cursor: pointer;
            font-size: 14px;
            color: #37352f;
            border-bottom: none;
            transition: background-color 0.1s ease-in-out;
            line-height: 1.3;
        }

        .context-menu ul li:hover,
        .context-menu ul li:active {
            background-color: rgba(55, 53, 47, 0.08);
        }
        
        /* Î™®Î∞îÏùºÏóêÏÑú ÌÑ∞Ïπò Î∞òÏùëÏÑ± Í∞úÏÑ† */
        @media (hover: none) and (pointer: coarse) {
            .context-menu ul li {
                padding: 14px 16px;
                font-size: 16px;
            }
        }

        /* Modal Styles */
        .modal {
            display: none;
            position: fixed;
            z-index: 1001;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(15, 15, 15, 0.6);
            justify-content: center;
            align-items: center;
        }

        .modal-content {
            background-color: #ffffff;
            margin: auto;
            padding: 60px;
            border: none;
            width: 90%;
            max-width: 720px;
            border-radius: 8px;
            box-shadow: rgba(15, 15, 15, 0.05) 0px 0px 0px 1px, rgba(15, 15, 15, 0.1) 0px 3px 6px, rgba(15, 15, 15, 0.2) 0px 9px 24px;
            position: relative;
        }

        .close-button {
            color: rgba(55, 53, 47, 0.45);
            float: right;
            font-size: 20px;
            font-weight: 400;
            position: absolute;
            right: 20px;
            top: 20px;
            cursor: pointer;
            padding: 4px;
            border-radius: 3px;
            transition: background-color 0.1s ease-in-out, color 0.1s ease-in-out;
        }

        .close-button:hover,
        .close-button:focus {
            background-color: rgba(55, 53, 47, 0.08);
            color: #37352f;
            text-decoration: none;
        }

        .modal-content h2 {
            margin: 0 0 24px 0;
            color: #37352f;
            border-bottom: none;
            padding-bottom: 0;
            font-size: 20px;
            font-weight: 600;
            line-height: 1.3;
        }

        .settings-section {
            margin-bottom: 24px;
            padding-bottom: 20px;
            border-bottom: 1px solid rgba(55, 53, 47, 0.09);
        }

        .settings-section:last-child {
            border-bottom: none;
        }

        .settings-section h3 {
            color: #37352f;
            margin: 0 0 12px 0;
            font-size: 16px;
            font-weight: 600;
        }

        .action-button {
            background-color: #2ea2dc;
            color: white;
            padding: 8px 12px;
            border: none;
            border-radius: 3px;
            cursor: pointer;
            font-size: 14px;
            margin-right: 8px;
            margin-bottom: 8px;
            transition: background-color 0.1s ease-in-out;
            font-weight: 500;
        }

        .action-button:hover {
            background-color: #1e8bb8;
        }

        .settings-section label {
            margin-right: 8px;
            font-size: 14px;
            color: #37352f;
            font-weight: 400;
        }

        .settings-section select,
        .settings-section input[type="checkbox"] {
            margin-top: 4px;
        }

        .settings-section select {
            padding: 6px 8px;
            border: 1px solid rgba(55, 53, 47, 0.25);
            border-radius: 3px;
            background-color: #ffffff;
            color: #37352f;
            font-size: 14px;
        }

        /* Modal Form Specific Styles */
        .modal-form-group {
            margin-bottom: 16px;
        }

        .modal-form-group label {
            display: block;
            margin-bottom: 6px;
            font-weight: 500;
            color: #37352f;
            font-size: 14px;
        }

        .modal-form-group input[type="text"],
        .modal-form-group textarea {
            width: 100%;
            padding: 8px 12px;
            border: 1px solid rgba(55, 53, 47, 0.25);
            border-radius: 3px;
            font-size: 14px;
            box-sizing: border-box;
            color: #37352f;
            background-color: #ffffff;
            transition: border-color 0.1s ease-in-out, box-shadow 0.1s ease-in-out;
        }

        .modal-form-group input[type="text"]:focus,
        .modal-form-group textarea:focus {
            outline: none;
            border-color: #2ea2dc;
            box-shadow: rgba(46, 170, 220, 0.15) 0px 0px 0px 1px;
        }

        .modal-form-group textarea {
            resize: vertical;
            min-height: 360px;
            font-family: inherit;
            line-height: 1.5;
        }

        .modal-actions {
            text-align: right;
            margin-top: 24px;
        }

        .secondary-button {
            background-color: rgba(55, 53, 47, 0.09);
            color: #37352f;
        }

        .secondary-button:hover {
            background-color: rgba(55, 53, 47, 0.16);
        }

        /* Color Palette Styles */
        .color-palette-grid {
            display: grid;
            grid-template-columns: repeat(6, 1fr);
            gap: 8px;
            margin-top: 16px;
        }

        .color-option {
            width: 40px;
            height: 40px;
            border-radius: 6px;
            cursor: pointer;
            border: 2px solid transparent;
            transition: border-color 0.1s ease-in-out, transform 0.1s ease-in-out;
            position: relative;
        }

        .color-option:hover {
            border-color: rgba(55, 53, 47, 0.25);
            transform: scale(1.05);
        }

        .color-option.selected {
            border-color: #2ea2dc;
            box-shadow: 0 0 0 1px #2ea2dc;
        }

        .color-option::after {
            content: attr(title);
            position: absolute;
            bottom: -24px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 11px;
            color: rgba(55, 53, 47, 0.65);
            white-space: nowrap;
            opacity: 0;
            transition: opacity 0.1s ease-in-out;
        }

        .color-option:hover::after {
            opacity: 1;
        }

        /* Dashboard Styles */
        .dashboard-area {
            flex: 0 0 300px;
            padding: 0;
            display: flex;
            flex-direction: column;
            gap: 16px;
            max-width: 300px;
        }

        .dashboard-widget {
            background-color: #ffffff;
            border: 1px solid rgba(55, 53, 47, 0.16);
            border-radius: 6px;
            overflow: hidden;
        }

        .dashboard-header {
            background-color: #f1f3f4;
            color: #37352f;
            font-size: 14px;
            font-weight: 600;
            padding: 12px;
            margin: 0;
            border-bottom: 1px solid rgba(55, 53, 47, 0.1);
        }

        .dashboard-content {
            padding: 12px;
            max-height: 200px;
            overflow-y: auto;
        }

        .favorite-item {
            display: flex;
            align-items: center;
            padding: 6px 8px;
            margin-bottom: 4px;
            background-color: rgba(242, 241, 238, 0.6);
            border-radius: 3px;
            font-size: 12px;
            cursor: pointer;
            transition: background-color 0.1s ease-in-out;
        }

        .favorite-item:hover {
            background-color: rgba(55, 53, 47, 0.08);
        }

        .favorite-item.bookmark-fav {
            background-color: rgba(46, 170, 220, 0.1);
        }

        .favorite-item.clipboard-fav {
            background-color: rgba(100, 71, 58, 0.1);
        }

        .favorite-icon {
            margin-right: 6px;
            font-size: 12px;
        }

        .stat-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 4px 0;
            font-size: 13px;
        }

        .stat-label {
            color: rgba(55, 53, 47, 0.8);
        }

        .stat-value {
            font-weight: 600;
            color: #37352f;
        }

        .activity-placeholder {
            text-align: center;
            color: rgba(55, 53, 47, 0.5);
            font-size: 12px;
            padding: 20px 0;
        }

        /* Drag and Drop Styles */
        .draggable {
            cursor: move;
            transition: opacity 0.2s ease;
        }

        .dragging {
            opacity: 0.5;
            transform: rotate(2deg);
        }

        .drag-over {
            background-color: rgba(59, 130, 246, 0.1) !important;
            border: 2px dashed #3b82f6 !important;
        }

        .drop-zone {
            min-height: 50px;
            transition: background-color 0.2s ease, border 0.2s ease;
        }

        .project-item.drag-over {
            background-color: rgba(59, 130, 246, 0.1);
            border-left: 4px solid #3b82f6;
        }

        /* Custom Tooltip Styles */
        .custom-tooltip {
            position: absolute;
            background-color: #37352f;
            color: #ffffff;
            padding: 8px 12px;
            border-radius: 6px;
            font-size: 13px;
            white-space: nowrap;
            z-index: 1000;
            pointer-events: none;
            opacity: 0;
            transition: opacity 0.2s ease-in-out;
            box-shadow: rgba(15, 15, 15, 0.1) 0px 3px 6px, rgba(15, 15, 15, 0.2) 0px 9px 24px;
            max-width: 300px;
            white-space: normal;
            word-wrap: break-word;
            line-height: 1.4;
        }

        .custom-tooltip.show {
            opacity: 1;
        }

        .custom-tooltip::before {
            content: '';
            position: absolute;
            top: 100%;
            left: 50%;
            transform: translateX(-50%);
            border: 5px solid transparent;
            border-top-color: #37352f;
        }

        .custom-tooltip.bottom::before {
            top: -10px;
            border-top-color: transparent;
            border-bottom-color: #37352f;
        }

        /* Î™®Î∞îÏùº ÌÉ≠ ÎÑ§ÎπÑÍ≤åÏù¥ÏÖò */
        .mobile-tabs {
            display: none;
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background-color: #ffffff;
            border-top: 1px solid rgba(55, 53, 47, 0.16);
            z-index: 1000;
            height: 60px;
            box-shadow: 0 -2px 10px rgba(0, 0, 0, 0.1);
        }

        .mobile-tab {
            flex: 1;
            background: none;
            border: none;
            padding: 8px 4px;
            font-size: 11px;
            color: rgba(55, 53, 47, 0.6);
            cursor: pointer;
            transition: color 0.2s ease;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            gap: 2px;
        }

        .mobile-tab.active {
            color: #2ea2dc;
            font-weight: 600;
        }

        .mobile-tab:hover {
            color: #37352f;
        }

        /* Î™®Î∞îÏùº Î∞òÏùëÌòï ÎîîÏûêÏù∏ */
        @media (max-width: 768px) {
            .mobile-tabs {
                display: flex;
            }

            body {
                padding-bottom: 60px; /* ÌÉ≠ ÎÑ§ÎπÑÍ≤åÏù¥ÏÖò Í≥µÍ∞Ñ ÌôïÎ≥¥ */
            }

            .app-container {
                flex-direction: column;
                height: calc(100vh - 60px);
            }

            /* Îç∞Ïä§ÌÅ¨ÌÜ± ÏÇ¨Ïù¥ÎìúÎ∞î Ïà®ÍπÄ */
            #project-sidebar {
                display: none;
            }

            #project-sidebar.mobile-visible {
                display: block;
                width: 100%;
                height: 100%;
                border-right: none;
                border-bottom: 1px solid rgba(55, 53, 47, 0.09);
            }

            .main-area {
                width: 100%;
                height: 100%;
            }

            .main-content {
                height: calc(100% - 60px); /* Ìó§Îçî ÎÜíÏù¥ Ï†úÏô∏ */
                padding: 12px 8px; /* Ï¢åÏö∞ Ìå®Îî© Ï§ÑÏûÑ */
            }

            .content-panels {
                flex-direction: column;
                height: 100%;
                gap: 0;
            }

            .content-panel {
                flex: none;
                max-width: none;
                width: calc(100% - 8px); /* Ìå®Îî© Í≥†Î†§ */
                margin-bottom: 16px;
                min-height: 200px;
                padding: 12px 8px; /* ÎÇ¥Î∂Ä Ìå®Îî© Ï°∞Ï†ï */
                box-sizing: border-box;
            }

            /* Î™®Î∞îÏùºÏóêÏÑú Í∞Å Ìå®ÎÑêÎ≥Ñ ÌëúÏãú/Ïà®ÍπÄ */
            .content-panel.bookmark-panel {
                display: none;
            }

            .content-panel.bookmark-panel.mobile-visible {
                display: block;
                height: calc(100% - 32px);
                margin-bottom: 0;
            }

            .content-panel.clipboard-panel {
                display: none;
            }

            .content-panel.clipboard-panel.mobile-visible {
                display: block;
                height: calc(100% - 32px);
                margin-bottom: 0;
            }

            .content-panel.practice-panel {
                display: none;
            }

            .content-panel.practice-panel.mobile-visible {
                display: block;
                height: calc(100% - 32px);
                margin-bottom: 0;
            }

            .dashboard-area {
                display: none;
                flex: none;
                max-width: none;
                width: 100%;
                height: calc(100% - 32px);
                padding: 12px 8px; /* Ï¢åÏö∞ Ìå®Îî© Ï§ÑÏûÑ */
                overflow-y: auto;
                box-sizing: border-box;
            }

            .dashboard-area.mobile-visible {
                display: flex;
                flex-direction: column;
                align-items: center; /* Ï§ëÏïô Ï†ïÎ†¨ */
                gap: 16px;
            }
            
            /* Î™®Î∞îÏùºÏóêÏÑú ÎåÄÏãúÎ≥¥Îìú ÏúÑÏ†Ø Ïä§ÌÉÄÏùº Ï°∞Ï†ï */
            .dashboard-area.mobile-visible .dashboard-widget {
                width: 100%;
                max-width: calc(100vw - 32px); /* ÌôîÎ©¥ ÎÑàÎπÑÏóê ÎßûÏ∂§, Ï¢åÏö∞ Ïó¨Î∞± Í≥†Î†§ */
                margin: 0 auto;
                box-sizing: border-box;
            }
            
            .dashboard-area.mobile-visible .dashboard-content {
                padding: 12px;
                word-wrap: break-word;
            }
            
            .dashboard-area.mobile-visible .favorites-item {
                margin-bottom: 8px;
                padding: 8px;
                word-break: break-all; /* Í∏¥ URLÎèÑ Ï§ÑÎ∞îÍøà */
            }

            /* Î™®Î∞îÏùºÏóêÏÑú Î≤ÑÌäº ÌÅ¨Í∏∞ Ï°∞Ï†ï */
            .item-button {
                min-width: 100px;
                max-width: calc(100vw - 40px); /* ÌôîÎ©¥ ÎÑàÎπÑÏóê ÎßûÏ∂§ */
                height: auto; /* ÎÜíÏù¥ ÏûêÎèô Ï°∞Ï†ï */
                min-height: 36px;
                font-size: 13px;
                margin: 4px;
                word-wrap: break-word;
                white-space: normal; /* ÌÖçÏä§Ìä∏ Ï§ÑÎ∞îÍøà ÌóàÏö© */
                padding: 8px;
                line-height: 1.3;
                transition: transform 0.1s ease, background-color 0.3s ease;
            }
            
            /* Î™®Î∞îÏùºÏóêÏÑú Í∏∏Í≤å ÎàÑÎ•¥Í∏∞ ÌîºÎìúÎ∞± */
            .item-button.long-press-active,
            .project-item.long-press-active {
                transform: scale(0.95);
                background-color: rgba(55, 53, 47, 0.15) !important;
            }
            
            /* Î™®Î∞îÏùº ÌÑ∞Ïπò ÏµúÏ†ÅÌôî */
            .item-button, .project-item {
                -webkit-touch-callout: none;
                -webkit-user-select: none;
                user-select: none;
            }

            /* Î™®Î∞îÏùºÏóêÏÑú Ï∂îÍ∞Ä Î≤ÑÌäº ÌÅ¨Í∏∞ Ï°∞Ï†ï */
            .add-section-btn {
                width: 36px;
                height: 36px;
                font-size: 20px;
            }

            /* Î™®Î∞îÏùºÏóêÏÑú Ìó§Îçî ÌÅ¨Í∏∞ Ï°∞Ï†ï */
            .content-header {
                padding: 12px 16px;
                min-height: 48px;
            }

            .content-header h1 {
                font-size: 20px;
            }

            /* Î™®Î∞îÏùºÏóêÏÑú Î™®Îã¨ ÌÅ¨Í∏∞ Ï°∞Ï†ï */
            .modal-content {
                width: 95%;
                max-width: 600px;
                margin: 20px;
                padding: 40px;
            }

            /* Ìà¥ÌåÅ Î™®Î∞îÏùº ÏµúÏ†ÅÌôî */
            .custom-tooltip {
                max-width: 280px;
                font-size: 12px;
            }

            /* ÎåÄÏãúÎ≥¥Îìú ÏúÑÏ†Ø Î™®Î∞îÏùº ÏµúÏ†ÅÌôî */
            .dashboard-widget {
                margin-bottom: 16px;
            }

            .dashboard-content {
                max-height: 300px;
            }

            /* Ïª®ÌÖçÏä§Ìä∏ Î©îÎâ¥ Î™®Î∞îÏùº ÏµúÏ†ÅÌôî */
            .context-menu {
                min-width: 150px;
            }

            .context-menu ul li {
                padding: 12px 16px;
                font-size: 14px;
            }
        }

        /* ÌÉúÎ∏îÎ¶ø ÏÇ¨Ïù¥Ï¶à */
        @media (max-width: 1024px) and (min-width: 769px) {
            #project-sidebar {
                width: 200px;
            }

            .content-panel {
                flex: 0 0 300px;
                max-width: 300px;
            }

            .dashboard-area {
                max-width: 250px;
            }
        }
    </style>
</head>
<body>
    <!-- Î™®Î∞îÏùº ÌÉ≠ ÎÑ§ÎπÑÍ≤åÏù¥ÏÖò -->
    <div class="mobile-tabs">
        <button class="mobile-tab active" data-tab="projects">üìÅ ÌîÑÎ°úÏ†ùÌä∏</button>
        <button class="mobile-tab" data-tab="bookmarks">üìå Î∂ÅÎßàÌÅ¨</button>
        <button class="mobile-tab" data-tab="clipboard">üìã ÌÅ¥Î¶ΩÎ≥¥Îìú</button>
        <button class="mobile-tab" data-tab="practice">üìù Ïó∞ÏäµÏû•</button>
        <button class="mobile-tab" data-tab="dashboard">üìä ÎåÄÏãúÎ≥¥Îìú</button>
    </div>

    <div class="app-container">
        <div id="project-sidebar">
            <div class="sidebar-header">
                <h3>ÌîÑÎ°úÏ†ùÌä∏</h3>
                <button id="add-project-btn" class="add-project-btn">+</button>
            </div>
            <ul id="project-list">
            </ul>
        </div>

        <div class="main-area">
            <div class="content-header">
                <h1 id="current-project-title"></h1>
                <button id="settings-btn" class="icon-button">‚öôÔ∏è</button>
            </div>
            
            <div class="main-content">
                <div class="content-panels">
                <div class="content-panel bookmark-panel">
                    <h4 class="bookmark-header">Î∂ÅÎßàÌÅ¨ <button id="add-bookmark-btn" class="add-section-btn">+</button></h4>
                    <ul id="bookmark-list" class="item-list"></ul>
                </div>

                <div class="content-panel clipboard-panel">
                    <h4 class="clipboard-header">ÌÅ¥Î¶ΩÎ≥¥Îìú <button id="add-clipboard-btn" class="add-section-btn">+</button></h4>
                    <ul id="clipboard-list" class="item-list"></ul>
                </div>
                
                <div class="content-panel practice-panel">
                    <h4 class="practice-header">Ïó∞ÏäµÏû• <span class="header-spacer"></span></h4>
                    <div class="practice-container">
                        <textarea id="practice-textarea" class="practice-text" placeholder="ÏûêÏú†Î°≠Í≤å ÌÖçÏä§Ìä∏Î•º ÏûÖÎ†•ÌïòÏÑ∏Ïöî..."></textarea>
                        <div class="practice-buttons">
                            <button id="copy-practice-btn" class="practice-btn">Î≥µÏÇ¨</button>
                            <button id="clear-practice-btn" class="practice-btn">Ï¥àÍ∏∞Ìôî</button>
                        </div>
                    </div>
                </div>
                
                <div class="dashboard-area">
                <div class="dashboard-widget">
                    <h4 class="dashboard-header">‚≠ê Ï¶êÍ≤®Ï∞æÍ∏∞</h4>
                    <div id="favorites-list" class="dashboard-content"></div>
                </div>
                
                <div class="dashboard-widget">
                    <h4 class="dashboard-header">üìä ÌÜµÍ≥Ñ</h4>
                    <div id="stats-content" class="dashboard-content">
                        <div class="stat-item">
                            <span class="stat-label">Ï¥ù Î∂ÅÎßàÌÅ¨:</span>
                            <span id="total-bookmarks" class="stat-value">0</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-label">Ï¥ù ÌÅ¥Î¶ΩÎ≥¥Îìú:</span>
                            <span id="total-clipboard" class="stat-value">0</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-label">Ï¶êÍ≤®Ï∞æÍ∏∞:</span>
                            <span id="total-favorites" class="stat-value">0</span>
                        </div>
                    </div>
                </div>
                
                <div class="dashboard-widget">
                    <h4 class="dashboard-header">üïí ÏµúÍ∑º ÌôúÎèô</h4>
                    <div id="recent-activity" class="dashboard-content">
                        <div class="activity-placeholder">ÌôúÎèô Í∏∞Î°ùÏù¥ ÏóÜÏäµÎãàÎã§</div>
                    </div>
                </div>
                </div>
            </div>
        </div>
        </div>
    </div>

    <!-- Settings Modal -->
    <div id="settings-modal" class="modal">
        <div class="modal-content">
            <span class="close-button">&times;</span>
            <h2>ÏÑ§Ï†ï</h2>
            
            <div class="settings-section">
                <h3>Îç∞Ïù¥ÌÑ∞ Í¥ÄÎ¶¨</h3>
                <button id="export-data-btn" class="action-button">Îç∞Ïù¥ÌÑ∞ ÎÇ¥Î≥¥ÎÇ¥Í∏∞ (JSON)</button>
                <input type="file" id="import-data-input" accept=".json" style="display: none;">
                <button id="import-data-btn" class="action-button">Îç∞Ïù¥ÌÑ∞ Î∂àÎü¨Ïò§Í∏∞ (JSON)</button>
            </div>

            <div class="settings-section">
                <h3>Î∂ÅÎßàÌÅ¨ ÏÑ§Ï†ï</h3>
                <label for="link-target-select">ÎßÅÌÅ¨ Ïó¥Í∏∞ Î∞©Ïãù:</label>
                <select id="link-target-select">
                    <option value="_blank">ÏÉà ÌÉ≠</option>
                    <option value="_self">ÌòÑÏû¨ ÌÉ≠</option>
                </select>
            </div>

            <div class="settings-section">
                <h3>ÌÅ¥Î¶ΩÎ≥¥Îìú ÏÑ§Ï†ï</h3>
                <input type="checkbox" id="copy-alert-checkbox">
                <label for="copy-alert-checkbox">Î≥µÏÇ¨ ÏôÑÎ£å ÏïåÎ¶º ÌëúÏãú</label>
            </div>
        </div>
    </div>

    <!-- Add Bookmark Modal -->
    <div id="add-bookmark-modal" class="modal">
        <div class="modal-content">
            <span class="close-button add-bookmark-close">&times;</span>
            <h2>Î∂ÅÎßàÌÅ¨ Ï∂îÍ∞Ä</h2>
            <div class="modal-form-group">
                <label for="add-bookmark-name">Ïù¥Î¶Ñ (8Í∏ÄÏûê Ïù¥ÎÇ¥):</label>
                <input type="text" id="add-bookmark-name" maxlength="8">
            </div>
            <div class="modal-form-group">
                <label for="add-bookmark-url">URL:</label>
                <input type="text" id="add-bookmark-url">
            </div>
            <div class="modal-actions">
                <button id="add-bookmark-save" class="action-button">Ï†ÄÏû•</button>
                <button id="add-bookmark-cancel" class="action-button secondary-button">Ï∑®ÏÜå</button>
            </div>
        </div>
    </div>

    <!-- Add Clipboard Modal -->
    <div id="add-clipboard-modal" class="modal">
        <div class="modal-content">
            <span class="close-button add-clipboard-close">&times;</span>
            <h2>ÌÅ¥Î¶ΩÎ≥¥Îìú Ï∂îÍ∞Ä</h2>
            <div class="modal-form-group">
                <label for="add-clipboard-title">Ï†úÎ™© (10Í∏ÄÏûê Ïù¥ÎÇ¥):</label>
                <input type="text" id="add-clipboard-title" maxlength="10">
            </div>
            <div class="modal-form-group">
                <label for="add-clipboard-content">ÎÇ¥Ïö©:</label>
                <textarea id="add-clipboard-content"></textarea>
            </div>
            <div class="modal-actions">
                <button id="add-clipboard-save" class="action-button">Ï†ÄÏû•</button>
                <button id="add-clipboard-cancel" class="action-button secondary-button">Ï∑®ÏÜå</button>
            </div>
        </div>
    </div>

    <!-- Add Project Modal -->
    <div id="add-project-modal" class="modal">
        <div class="modal-content">
            <span class="close-button add-project-close">&times;</span>
            <h2>ÌîÑÎ°úÏ†ùÌä∏ Ï∂îÍ∞Ä</h2>
            <div class="modal-form-group">
                <label for="add-project-name">ÌîÑÎ°úÏ†ùÌä∏ Ïù¥Î¶Ñ:</label>
                <input type="text" id="add-project-name" placeholder="ÏÉà ÌîÑÎ°úÏ†ùÌä∏ Ïù¥Î¶ÑÏùÑ ÏûÖÎ†•ÌïòÏÑ∏Ïöî">
            </div>
            <div class="modal-actions">
                <button id="add-project-save" class="action-button">Ï†ÄÏû•</button>
                <button id="add-project-cancel" class="action-button secondary-button">Ï∑®ÏÜå</button>
            </div>
        </div>
    </div>

    <div id="context-menu" class="context-menu">
        <ul>
            <li id="context-edit">Ìé∏Ïßë</li>
            <li id="context-favorite">Ï¶êÍ≤®Ï∞æÍ∏∞</li>
            <li id="context-color">ÏÉâÏÉÅ Î≥ÄÍ≤Ω</li>
            <li id="context-delete">ÏÇ≠Ï†ú</li>
            <li id="context-cancel">Ï∑®ÏÜå</li>
        </ul>
    </div>

    <div id="project-context-menu" class="context-menu">
        <ul>
            <li id="project-context-rename">Ïù¥Î¶Ñ ÏàòÏ†ï</li>
            <li id="project-context-delete">ÏÇ≠Ï†ú</li>
            <li id="project-context-cancel">Ï∑®ÏÜå</li>
        </ul>
    </div>

    <!-- Custom Tooltip -->
    <div id="custom-tooltip" class="custom-tooltip"></div>

    <!-- Color Palette Modal -->
    <div id="color-palette-modal" class="modal">
        <div class="modal-content">
            <span class="close-button color-palette-close">&times;</span>
            <h2>ÏÉâÏÉÅ ÏÑ†ÌÉù</h2>
            <div class="color-palette-grid">
                <div class="color-option" data-color="rgba(242, 241, 238, 0.6)" style="background-color: rgba(242, 241, 238, 0.6);" title="Í∏∞Î≥∏"></div>
                <div class="color-option" data-color="rgba(255, 235, 235, 0.8)" style="background-color: rgba(255, 235, 235, 0.8);" title="Îπ®Í∞ï"></div>
                <div class="color-option" data-color="rgba(255, 244, 235, 0.8)" style="background-color: rgba(255, 244, 235, 0.8);" title="Ï£ºÌô©"></div>
                <div class="color-option" data-color="rgba(255, 251, 235, 0.8)" style="background-color: rgba(255, 251, 235, 0.8);" title="ÎÖ∏Îûë"></div>
                <div class="color-option" data-color="rgba(235, 251, 238, 0.8)" style="background-color: rgba(235, 251, 238, 0.8);" title="Ï¥àÎ°ù"></div>
                <div class="color-option" data-color="rgba(235, 251, 255, 0.8)" style="background-color: rgba(235, 251, 255, 0.8);" title="ÌïòÎäò"></div>
                <div class="color-option" data-color="rgba(235, 241, 255, 0.8)" style="background-color: rgba(235, 241, 255, 0.8);" title="ÌååÎûë"></div>
                <div class="color-option" data-color="rgba(245, 235, 255, 0.8)" style="background-color: rgba(245, 235, 255, 0.8);" title="Î≥¥Îùº"></div>
                <div class="color-option" data-color="rgba(255, 235, 245, 0.8)" style="background-color: rgba(255, 235, 245, 0.8);" title="ÌïëÌÅ¨"></div>
                <div class="color-option" data-color="rgba(245, 245, 245, 0.8)" style="background-color: rgba(245, 245, 245, 0.8);" title="ÌöåÏÉâ"></div>
                <div class="color-option" data-color="rgba(240, 228, 217, 0.8)" style="background-color: rgba(240, 228, 217, 0.8);" title="Í∞àÏÉâ"></div>
            </div>
        </div>
    </div>

    <!-- View Clipboard Modal -->
    <div id="view-clipboard-modal" class="modal">
        <div class="modal-content">
            <span class="close-button view-clipboard-close">&times;</span>
            <h2 id="view-clipboard-title"></h2>
            <div id="view-clipboard-content" style="white-space: pre-wrap; word-wrap: break-word; max-height: 600px; overflow-y: auto; margin-bottom: 20px;"></div>
            <div class="modal-actions">
                <button id="view-clipboard-copy-btn" class="action-button">Î≥µÏÇ¨</button>
                <button id="view-clipboard-edit-btn" class="action-button secondary-button">ÏàòÏ†ï</button>
            </div>
        </div>
    </div>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
        
        // Firebase ÏÑ§Ï†ï - Î≥∏Ïù∏Ïùò Firebase ÌîÑÎ°úÏ†ùÌä∏ ÏÑ§Ï†ïÏúºÎ°ú ÍµêÏ≤¥ÌïòÏÑ∏Ïöî
        const firebaseConfig = {
            apiKey: "AIzaSyDKjKvRCw-j4b-1W4MhRc-uZ21zbAnTFM8",
            authDomain: "bookmarkclipboard.firebaseapp.com",
            projectId: "bookmarkclipboard",
            storageBucket: "bookmarkclipboard.firebasestorage.app",
            messagingSenderId: "969969481293",
            appId: "1:969969481293:web:08ae0008ac1b590c43ce04"
        };
        
        // Firebase Ï¥àÍ∏∞Ìôî
        let db = null;
        let firebaseInitialized = false;
        
        try {
            firebase.initializeApp(firebaseConfig);
            db = firebase.firestore();
            firebaseInitialized = true;
            console.log('Firebase Ï¥àÍ∏∞Ìôî ÏÑ±Í≥µ');
        } catch (error) {
            console.warn('Firebase Ï¥àÍ∏∞Ìôî Ïã§Ìå®, Î°úÏª¨Ïä§ÌÜ†Î¶¨ÏßÄ ÏÇ¨Ïö©:', error);
            firebaseInitialized = false;
        }
        
        // Îç∞Ïù¥ÌÑ∞ Ï†ÄÏû• Ìï®ÏàòÎì§ (Firebase + Î°úÏª¨Ïä§ÌÜ†Î¶¨ÏßÄ Î∞±ÏóÖ)
        const STORAGE_KEY = 'bookmark-clipboard-app-data';
        
        // FirebaseÏóê Îç∞Ïù¥ÌÑ∞ Ï†ÄÏû• (Í∞úÏù∏Ïö© Îã®Ïùº Î¨∏ÏÑú)
        async function saveToFirebase() {
            if (!firebaseInitialized || !db) {
                console.log('Firebase ÎØ∏Ï¥àÍ∏∞Ìôî, Î°úÏª¨Ïä§ÌÜ†Î¶¨ÏßÄ ÏÇ¨Ïö©');
                return saveToLocalStorage();
            }
            
            try {
                const dataToSave = {
                    projects: allProjectsData,
                    currentProject: currentProject,
                    projectOrder: projectOrder || Object.keys(allProjectsData),
                    lastUpdated: new Date().toISOString()
                };
                
                await db.collection('userdata').doc('bookmark-app').set(dataToSave);
                console.log('Îç∞Ïù¥ÌÑ∞Î•º FirebaseÏóê Ï†ÄÏû•ÌñàÏäµÎãàÎã§.');
                
                // Î°úÏª¨Ïä§ÌÜ†Î¶¨ÏßÄÏóêÎèÑ Î∞±ÏóÖ Ï†ÄÏû•
                saveToLocalStorage();
                
            } catch (error) {
                console.error('Firebase Ï†ÄÏû• Ïã§Ìå®, Î°úÏª¨Ïä§ÌÜ†Î¶¨ÏßÄ ÏÇ¨Ïö©:', error);
                saveToLocalStorage();
            }
        }

        // FirebaseÏóê Ïó∞ÏäµÏû• ÎÇ¥Ïö© Ï†ÄÏû•
        async function savePracticeToFirebase(content) {
            if (!firebaseInitialized || !db) {
                console.log('Firebase ÎØ∏Ï¥àÍ∏∞Ìôî, Î°úÏª¨Ïä§ÌÜ†Î¶¨ÏßÄÏóê Ïó∞ÏäµÏû• Ï†ÄÏû•');
                localStorage.setItem('practice-content', content);
                return;
            }
            
            try {
                await db.collection('userdata').doc('practice').set({
                    content: content,
                    lastUpdated: new Date().toISOString()
                });
                console.log('Ïó∞ÏäµÏû• ÎÇ¥Ïö©ÏùÑ FirebaseÏóê Ï†ÄÏû•ÌñàÏäµÎãàÎã§.');
                
                // Î°úÏª¨Ïä§ÌÜ†Î¶¨ÏßÄÏóêÎèÑ Î∞±ÏóÖ Ï†ÄÏû•
                localStorage.setItem('practice-content', content);
                
            } catch (error) {
                console.error('Firebase Ïó∞ÏäµÏû• Ï†ÄÏû• Ïã§Ìå®, Î°úÏª¨Ïä§ÌÜ†Î¶¨ÏßÄ ÏÇ¨Ïö©:', error);
                localStorage.setItem('practice-content', content);
            }
        }

        // FirebaseÏóêÏÑú Ïó∞ÏäµÏû• ÎÇ¥Ïö© Î°úÎìú
        async function loadPracticeFromFirebase() {
            const practiceTextarea = document.getElementById('practice-textarea');
            
            if (!firebaseInitialized || !db) {
                console.log('Firebase ÎØ∏Ï¥àÍ∏∞Ìôî, Î°úÏª¨Ïä§ÌÜ†Î¶¨ÏßÄÏóêÏÑú Ïó∞ÏäµÏû• Î°úÎìú');
                const localContent = localStorage.getItem('practice-content') || '';
                practiceTextarea.value = localContent;
                return;
            }
            
            try {
                const doc = await db.collection('userdata').doc('practice').get();
                if (doc.exists) {
                    const data = doc.data();
                    practiceTextarea.value = data.content || '';
                    console.log('FirebaseÏóêÏÑú Ïó∞ÏäµÏû• ÎÇ¥Ïö©ÏùÑ Î°úÎìúÌñàÏäµÎãàÎã§.');
                } else {
                    // FirebaseÏóê Î¨∏ÏÑúÍ∞Ä ÏóÜÏúºÎ©¥ Î°úÏª¨Ïä§ÌÜ†Î¶¨ÏßÄÏóêÏÑú Î°úÎìú
                    const localContent = localStorage.getItem('practice-content') || '';
                    practiceTextarea.value = localContent;
                }
            } catch (error) {
                console.error('Firebase Ïó∞ÏäµÏû• Î°úÎìú Ïã§Ìå®, Î°úÏª¨Ïä§ÌÜ†Î¶¨ÏßÄ ÏÇ¨Ïö©:', error);
                const localContent = localStorage.getItem('practice-content') || '';
                practiceTextarea.value = localContent;
            }
        }
        
        function saveToLocalStorage() {
            try {
                const dataToSave = {
                    projects: allProjectsData,
                    currentProject: currentProject,
                    projectOrder: projectOrder || Object.keys(allProjectsData)
                };
                localStorage.setItem(STORAGE_KEY, JSON.stringify(dataToSave));
                console.log('Îç∞Ïù¥ÌÑ∞Î•º Î°úÏª¨Ïä§ÌÜ†Î¶¨ÏßÄÏóê Ï†ÄÏû•ÌñàÏäµÎãàÎã§.');
            } catch (error) {
                console.error('Î°úÏª¨Ïä§ÌÜ†Î¶¨ÏßÄ Ï†ÄÏû• Ïã§Ìå®:', error);
            }
        }
        
        // FirebaseÏóêÏÑú Îç∞Ïù¥ÌÑ∞ Î∂àÎü¨Ïò§Í∏∞
        async function loadFromFirebase() {
            if (!firebaseInitialized || !db) {
                console.log('Firebase ÎØ∏Ï¥àÍ∏∞Ìôî, Î°úÏª¨Ïä§ÌÜ†Î¶¨ÏßÄ ÏÇ¨Ïö©');
                return loadFromLocalStorage();
            }
            
            try {
                const doc = await db.collection('userdata').doc('bookmark-app').get();
                if (doc.exists) {
                    const data = doc.data();
                    console.log('FirebaseÏóêÏÑú Îç∞Ïù¥ÌÑ∞Î•º Î∂àÎü¨ÏôîÏäµÎãàÎã§.');
                    
                    // Î°úÏª¨Ïä§ÌÜ†Î¶¨ÏßÄÏóêÎèÑ ÎèôÍ∏∞Ìôî
                    if (data.projects && data.currentProject) {
                        const localData = { projects: data.projects, currentProject: data.currentProject };
                        localStorage.setItem(STORAGE_KEY, JSON.stringify(localData));
                    }
                    
                    return data;
                } else {
                    console.log('FirebaseÏóê Îç∞Ïù¥ÌÑ∞ ÏóÜÏùå, Î°úÏª¨Ïä§ÌÜ†Î¶¨ÏßÄ ÌôïÏù∏');
                    return loadFromLocalStorage();
                }
            } catch (error) {
                console.error('Firebase Î∂àÎü¨Ïò§Í∏∞ Ïã§Ìå®, Î°úÏª¨Ïä§ÌÜ†Î¶¨ÏßÄ ÏÇ¨Ïö©:', error);
                return loadFromLocalStorage();
            }
        }
        
        function loadFromLocalStorage() {
            try {
                const savedData = localStorage.getItem(STORAGE_KEY);
                if (savedData) {
                    const parsedData = JSON.parse(savedData);
                    if (parsedData.projects && Object.keys(parsedData.projects).length > 0) {
                        console.log('Î°úÏª¨Ïä§ÌÜ†Î¶¨ÏßÄÏóêÏÑú Îç∞Ïù¥ÌÑ∞Î•º Î∂àÎü¨ÏôîÏäµÎãàÎã§.');
                        return parsedData;
                    }
                }
            } catch (error) {
                console.error('Î°úÏª¨Ïä§ÌÜ†Î¶¨ÏßÄ Î∂àÎü¨Ïò§Í∏∞ Ïã§Ìå®:', error);
            }
            return null;
        }
        
        function getDefaultData() {
            return {
                "Í∞ÄÍ≥ÑÏïΩ": {
                    bookmarks: [
                        { name: "Í∞ÄÍ≥ÑÏïΩÍ∏à Î∞òÌôò Î≤ïÎ•†", url: "https://www.example.com/law-deposit", color: "#f8f9fa", favorite: true },
                        { name: "Ï£ºÌÉùÎèÑÏãúÍ∏∞Í∏à ÏïàÎÇ¥", url: "https://www.example.com/fund", color: "#f8f9fa", favorite: false }
                    ],
                    clipboard: [
                        { title: "Ïù∏Ï†ÅÏÇ¨Ìï≠ ÏöîÏ≤≠", text: "Ïù∏Ï†ÅÏÇ¨Ìï≠ ÏöîÏ≤≠: ÏÑ±Ìï®, Ïó∞ÎùΩÏ≤ò, Ï£ºÎØºÎ≤àÌò∏ ÏïûÏûêÎ¶¨", color: "#f8f9fa", favorite: true },
                        { title: "ÌäπÏïΩÏÇ¨Ìï≠", text: "Í≥ÑÏïΩÏÑúÏóê Ìè¨Ìï®Ìï† ÌäπÏïΩÏÇ¨Ìï≠", color: "#f8f9fa", favorite: false },
                    ]
                },
                "ÏûîÍ∏à": {
                    bookmarks: [
                        { name: "ÏûîÍ∏à Ï§ÄÎπÑÏÑúÎ•ò Î™©Î°ù", url: "https://www.example.com/final-docs", color: "#f8f9fa", favorite: false }
                    ],
                    clipboard: [
                        { title: "ÏûîÍ∏à Í≥ÑÏ¢åÎ≤àÌò∏", text: "ÏûîÍ∏à Í≥ÑÏ¢åÎ≤àÌò∏: 000-00000-000 (ÏòàÍ∏àÏ£º: „Öá„Öá„Öá)", color: "#f8f9fa", favorite: false },
                        { title: "ÏûîÍ∏à Ï≤òÎ¶¨ ÏôÑÎ£å", text: "Ïò§Îäò ÏûîÍ∏à Ï≤òÎ¶¨ ÏôÑÎ£å. Îì±Í∏∞ Ï†ëÏàò ÏòàÏ†ï.", color: "#f8f9fa", favorite: false }
                    ]
                },
                "ÏûÑÎåÄÏ∞®": {
                    bookmarks: [
                        { name: "ÏûÑÎåÄÏ∞® Í≥ÑÏïΩ Î≤ïÎ•†", url: "https://www.example.com/rental-law", color: "#f8f9fa", favorite: false }
                    ],
                    clipboard: [
                        { title: "Í≥ÑÏïΩ Ïó∞Ïû• ÏïàÎÇ¥", text: "Í≥ÑÏïΩ Ïó∞Ïû• Í¥ÄÎ†® ÏïàÎÇ¥ Î¨∏Íµ¨", color: "#f8f9fa", favorite: false },
                    ]
                },
                "Îß§Îß§": {
                    bookmarks: [
                        { name: "Îß§Îß§ Ï†àÏ∞® ÏïàÎÇ¥", url: "https://www.example.com/sale-process", color: "#f8f9fa", favorite: true }
                    ],
                    clipboard: [
                        { title: "Îß§Îß§ Í≥ÑÏïΩ Ïú†ÏùòÏÇ¨Ìï≠", text: "Îß§Îß§ Í≥ÑÏïΩ Ïãú Ïú†ÏùòÏÇ¨Ìï≠", color: "#f8f9fa", favorite: false },
                    ]
                }
            };
        }
        
        // Î°úÏª¨ Îç∞Ïù¥ÌÑ∞Î•º FirebaseÎ°ú ÎßàÏù¥Í∑∏Î†àÏù¥ÏÖò
        async function migrateLocalToFirebase() {
            const localData = loadFromLocalStorage();
            if (localData && localData.projects) {
                console.log('Î°úÏª¨ Îç∞Ïù¥ÌÑ∞Î•º FirebaseÎ°ú ÎßàÏù¥Í∑∏Î†àÏù¥ÏÖò Ï§ë...');
                allProjectsData = localData.projects;
                currentProject = localData.currentProject;
                projectOrder = localData.projectOrder || Object.keys(localData.projects);
                saveToFirebase();
                console.log('ÎßàÏù¥Í∑∏Î†àÏù¥ÏÖò ÏôÑÎ£å');
                return localData;
            }
            return null;
        }

        // Ïï± Ï¥àÍ∏∞Ìôî - Firebase Ïö∞ÏÑ†, Î°úÏª¨Ïä§ÌÜ†Î¶¨ÏßÄ Î∞±ÏóÖ
        let allProjectsData, currentProject, projectOrder;
        
        async function initializeApp() {
            try {
                const savedData = await loadFromFirebase();
                
                if (savedData && savedData.projects) {
                    allProjectsData = savedData.projects;
                    currentProject = savedData.currentProject || Object.keys(savedData.projects)[0];
                    projectOrder = savedData.projectOrder || Object.keys(savedData.projects);
                    console.log('Firebase Îç∞Ïù¥ÌÑ∞Î°ú Ïï± Ï¥àÍ∏∞Ìôî');
                } else {
                    // FirebaseÏóê Îç∞Ïù¥ÌÑ∞Í∞Ä ÏóÜÏúºÎ©¥ Î°úÏª¨ Îç∞Ïù¥ÌÑ∞ ÎßàÏù¥Í∑∏Î†àÏù¥ÏÖò ÏãúÎèÑ
                    const migratedData = await migrateLocalToFirebase();
                    if (!migratedData) {
                        allProjectsData = getDefaultData();
                        currentProject = 'Í∞ÄÍ≥ÑÏïΩ';
                        console.log('Í∏∞Î≥∏ Îç∞Ïù¥ÌÑ∞Î°ú Ïï± Ï¥àÍ∏∞Ìôî');
                        // Ï≤´ Ïã§ÌñâÏãú Firebase Î∞è Î°úÏª¨Ïä§ÌÜ†Î¶¨ÏßÄÏóê Ï†ÄÏû•
                        saveToFirebase();
                    }
                }
                
                // UI Î†åÎçîÎßÅ
                renderProjectList();
                renderProject(currentProject);
                
            } catch (error) {
                console.error('Ïï± Ï¥àÍ∏∞Ìôî Ïã§Ìå®:', error);
                // ÏóêÎü¨ Î∞úÏÉùÏãú Î°úÏª¨Ïä§ÌÜ†Î¶¨ÏßÄ Î∞±ÏóÖÏúºÎ°ú ÏãúÎèÑ
                const localData = loadFromLocalStorage();
                if (localData) {
                    allProjectsData = localData.projects;
                    currentProject = localData.currentProject || Object.keys(localData.projects)[0];
                    projectOrder = localData.projectOrder || Object.keys(localData.projects);
                } else {
                    allProjectsData = getDefaultData();
                    currentProject = 'Í∞ÄÍ≥ÑÏïΩ';
                    projectOrder = Object.keys(allProjectsData);
                }
                renderProjectList();
                renderProject(currentProject);
            }
        }

        // UI ÏöîÏÜå Í∞ÄÏ†∏Ïò§Í∏∞
        const projectList = document.getElementById('project-list');
        const bookmarkList = document.getElementById('bookmark-list');
        const clipboardList = document.getElementById('clipboard-list');
        const currentProjectTitle = document.getElementById('current-project-title');
        
        const addBookmarkBtn = document.getElementById('add-bookmark-btn');
        const addClipboardBtn = document.getElementById('add-clipboard-btn');

        const contextMenu = document.getElementById('context-menu');
        const contextEdit = document.getElementById('context-edit');
        const contextFavorite = document.getElementById('context-favorite');
        const contextColor = document.getElementById('context-color');
        const contextDelete = document.getElementById('context-delete');
        const contextCancel = document.getElementById('context-cancel');

        const projectContextMenu = document.getElementById('project-context-menu');
        const projectContextRename = document.getElementById('project-context-rename');
        const projectContextDelete = document.getElementById('project-context-delete');
        const projectContextCancel = document.getElementById('project-context-cancel');

        let activeItem = null;
        let activeProject = null;
        let colorChangeItem = null;

        async function renderProject(projectName) {
            currentProject = projectName;
            const projectData = allProjectsData[projectName];
            
            currentProjectTitle.textContent = projectName;
            bookmarkList.innerHTML = '';
            clipboardList.innerHTML = '';

            projectData.bookmarks.forEach((item, index) => {
                const button = document.createElement('button');
                button.className = 'item-button bookmark-button draggable';
                
                const favoriteIcon = item.favorite ? '‚≠ê ' : '';
                button.textContent = favoriteIcon + item.name.substring(0, 8 - favoriteIcon.length);
                
                button.style.backgroundColor = item.color || '#f8f9fa';
                button.dataset.index = index;
                button.dataset.type = 'bookmark';
                button.dataset.fullName = item.name;
                button.dataset.url = item.url;
                button.draggable = true;
                
                let isDragging = false;
                button.addEventListener('mousedown', () => { isDragging = false; });
                button.addEventListener('dragstart', () => { isDragging = true; });
                button.addEventListener('mouseup', (e) => {
                    setTimeout(() => {
                        if (!isDragging && e.button === 0) {
                            window.open(item.url, '_blank');
                        }
                    }, 50);
                });
                bookmarkList.appendChild(button);
            });

            projectData.clipboard.forEach((item, index) => {
                const button = document.createElement('button');
                button.className = 'item-button clipboard-button draggable';
                
                const favoriteIcon = item.favorite ? '‚≠ê ' : '';
                const buttonText = item.title || item.text || '';
                button.textContent = favoriteIcon + buttonText.substring(0, 10 - favoriteIcon.length);
                
                button.style.backgroundColor = item.color || '#f8f9fa';
                button.dataset.index = index;
                button.dataset.type = 'clipboard';
                button.dataset.fullText = item.text;
                button.dataset.title = item.title || '';
                button.draggable = true;
                
                let isDragging = false;
                button.addEventListener('mousedown', () => { isDragging = false; });
                button.addEventListener('dragstart', () => { isDragging = true; });
                button.addEventListener('mouseup', (e) => {
                    setTimeout(() => {
                        if (!isDragging && e.button === 0) {
                            const modal = document.getElementById('view-clipboard-modal');
                            const titleEl = document.getElementById('view-clipboard-title');
                            const contentEl = document.getElementById('view-clipboard-content');
                            const copyBtn = document.getElementById('view-clipboard-copy-btn');
                            const editBtn = document.getElementById('view-clipboard-edit-btn');

                            titleEl.textContent = item.title || '';
                            contentEl.textContent = item.text;
                            
                            copyBtn.dataset.clipboardText = item.text;
                            editBtn.dataset.clipboardIndex = index;

                            modal.style.display = 'flex';
                        }
                    }, 50);
                });
                clipboardList.appendChild(button);
            });

            addTooltipEvents();
            setupDropZones();

            document.querySelectorAll('#project-list li').forEach(li => {
                li.classList.remove('active');
            });
            document.getElementById(`project-${projectName}`).classList.add('active');
            
            renderFavorites();
            renderStatistics();
            
            saveToFirebase();
        }

        function addTooltipEvents() {
            const tooltip = document.getElementById('custom-tooltip');
            
            document.querySelectorAll('.item-button').forEach(button => {
                button.addEventListener('mouseenter', (e) => {
                    const target = e.target;
                    let tooltipText = '';
                    
                    if (target.classList.contains('bookmark-button')) {
                        tooltipText = `${target.dataset.fullName}\n${target.dataset.url}`;
                    }
                    
                    if (tooltipText) {
                        tooltip.innerHTML = tooltipText.replace(/\n/g, '<br>');
                        showTooltip(tooltip, target);
                    }
                });
                
                button.addEventListener('mouseleave', () => {
                    hideTooltip(tooltip);
                });
            });
        }

        function showTooltip(tooltip, target) {
            const rect = target.getBoundingClientRect();
            const tooltipRect = tooltip.getBoundingClientRect();
            
            let left = rect.left + (rect.width / 2) - (tooltipRect.width / 2);
            let top = rect.top - tooltipRect.height - 10;
            
            const padding = 10;
            if (left < padding) {
                left = padding;
            } else if (left + tooltipRect.width > window.innerWidth - padding) {
                left = window.innerWidth - tooltipRect.width - padding;
            }
            
            if (top < padding) {
                top = rect.bottom + 10;
                tooltip.classList.add('bottom');
            } else {
                tooltip.classList.remove('bottom');
            }
            
            tooltip.style.left = left + 'px';
            tooltip.style.top = top + 'px';
            tooltip.classList.add('show');
        }

        function hideTooltip(tooltip) {
            tooltip.classList.remove('show');
        }
        
        function addBookmark() {
            const modal = document.getElementById('add-bookmark-modal');
            document.querySelector('#add-bookmark-modal h2').textContent = 'Î∂ÅÎßàÌÅ¨ Ï∂îÍ∞Ä';
            modal.style.display = 'flex';
            
            document.getElementById('add-bookmark-name').value = '';
            document.getElementById('add-bookmark-url').value = '';
            
            delete modal.dataset.editMode;
            delete modal.dataset.editIndex;
        }

        function addClipboard() {
            const modal = document.getElementById('add-clipboard-modal');
            document.querySelector('#add-clipboard-modal h2').textContent = 'ÌÅ¥Î¶ΩÎ≥¥Îìú Ï∂îÍ∞Ä';
            modal.style.display = 'flex';
            
            document.getElementById('add-clipboard-title').value = '';
            document.getElementById('add-clipboard-content').value = '';
            
            delete modal.dataset.editMode;
            delete modal.dataset.editIndex;
        }

        function addProject() {
            const modal = document.getElementById('add-project-modal');
            modal.style.display = 'flex';
            
            document.getElementById('add-project-name').value = '';
        }

        function renderProjectList() {
            const projectList = document.getElementById('project-list');
            projectList.innerHTML = '';
            
            // projectOrder Î∞∞Ïó¥ÏùÑ ÏÇ¨Ïö©ÌïòÏó¨ ÏàúÏÑú Î≥¥Ïû•
            const orderedProjects = projectOrder || Object.keys(allProjectsData);
            orderedProjects.forEach((projectName, index) => {
                // Ï°¥Ïû¨ÌïòÏßÄ ÏïäÎäî ÌîÑÎ°úÏ†ùÌä∏Îäî Í±¥ÎÑàÎõ∞Í∏∞
                if (!allProjectsData[projectName]) return;
                const li = document.createElement('li');
                li.id = `project-${projectName}`;
                li.textContent = projectName;
                li.classList.add('draggable', 'project-item');
                li.draggable = true;
                li.dataset.projectName = projectName;
                li.dataset.index = index;
                
                if (projectName === currentProject) {
                    li.classList.add('active');
                }
                
                li.addEventListener('dragstart', handleProjectDragStart);
                li.addEventListener('dragover', handleProjectDragOver);
                li.addEventListener('drop', handleProjectDrop);
                li.addEventListener('dragend', handleProjectDragEnd);
                li.addEventListener('dragenter', handleProjectDragEnter);
                li.addEventListener('dragleave', handleProjectDragLeave);
                
                projectList.appendChild(li);
            });
        }

        function showContextMenu(e, itemType, itemIndex) {
            e.preventDefault();
            contextMenu.style.display = 'block';
            
            // ÌôîÎ©¥ Í≤ΩÍ≥ÑÎ•º Í≥†Î†§Ìïú ÏúÑÏπò Í≥ÑÏÇ∞
            const menuWidth = 180; // ÏµúÏÜå ÎÑàÎπÑ
            const menuHeight = 160; // ÏòàÏÉÅ ÎÜíÏù¥ (4Í∞ú Ìï≠Î™© Í∏∞Ï§Ä)
            const screenWidth = window.innerWidth;
            const screenHeight = window.innerHeight;
            
            let x = e.clientX;
            let y = e.clientY;
            
            // Ïö∞Ï∏° Í≤ΩÍ≥Ñ ÌôïÏù∏
            if (x + menuWidth > screenWidth) {
                x = screenWidth - menuWidth - 10;
            }
            
            // ÌïòÎã® Í≤ΩÍ≥Ñ ÌôïÏù∏
            if (y + menuHeight > screenHeight) {
                y = screenHeight - menuHeight - 10;
            }
            
            // ÏµúÏÜå Ïó¨Î∞± ÌôïÎ≥¥
            if (x < 10) x = 10;
            if (y < 10) y = 10;
            
            contextMenu.style.left = x + 'px';
            contextMenu.style.top = y + 'px';
            activeItem = { type: itemType, index: itemIndex };
        }

        function showProjectContextMenu(e, projectName) {
            e.preventDefault();
            projectContextMenu.style.display = 'block';
            
            // ÌôîÎ©¥ Í≤ΩÍ≥ÑÎ•º Í≥†Î†§Ìïú ÏúÑÏπò Í≥ÑÏÇ∞
            const menuWidth = 150; // ÌîÑÎ°úÏ†ùÌä∏ Î©îÎâ¥ ÎÑàÎπÑ
            const menuHeight = 120; // ÏòàÏÉÅ ÎÜíÏù¥ (3Í∞ú Ìï≠Î™© Í∏∞Ï§Ä)
            const screenWidth = window.innerWidth;
            const screenHeight = window.innerHeight;
            
            let x = e.clientX;
            let y = e.clientY;
            
            // Ïö∞Ï∏° Í≤ΩÍ≥Ñ ÌôïÏù∏
            if (x + menuWidth > screenWidth) {
                x = screenWidth - menuWidth - 10;
            }
            
            // ÌïòÎã® Í≤ΩÍ≥Ñ ÌôïÏù∏
            if (y + menuHeight > screenHeight) {
                y = screenHeight - menuHeight - 10;
            }
            
            // ÏµúÏÜå Ïó¨Î∞± ÌôïÎ≥¥
            if (x < 10) x = 10;
            if (y < 10) y = 10;
            
            projectContextMenu.style.left = x + 'px';
            projectContextMenu.style.top = y + 'px';
            activeProject = projectName;
        }

        let projectDragStarted = false;
        projectList.addEventListener('mousedown', (e) => {
            projectDragStarted = false;
        });
        projectList.addEventListener('dragstart', () => {
            projectDragStarted = true;
        });
        projectList.addEventListener('mouseup', (e) => {
            setTimeout(() => {
                if (!projectDragStarted && e.target.tagName === 'LI') {
                    const projectName = e.target.id.replace('project-', '');
                    renderProject(projectName);
                }
            }, 50);
        });

        // Î™®Î∞îÏùº/Îç∞Ïä§ÌÅ¨ÌÜ± Ìò∏Ìôò Ïª®ÌÖçÏä§Ìä∏ Î©îÎâ¥ ÏãúÏä§ÌÖú
        let touchTimer = null;
        let touchTarget = null;
        let touchStartTime = 0;
        
        // ÌîÑÎ°úÏ†ùÌä∏ Î¶¨Ïä§Ìä∏ Ïª®ÌÖçÏä§Ìä∏ Î©îÎâ¥
        function addContextMenuListeners(element, contextType) {
            // Îç∞Ïä§ÌÅ¨ÌÜ± Ïö∞ÌÅ¥Î¶≠
            element.addEventListener('contextmenu', (e) => {
                e.preventDefault();
                handleContextMenu(e, contextType);
            });
            
            // Î™®Î∞îÏùº Í∏∏Í≤å ÎàÑÎ•¥Í∏∞
            element.addEventListener('touchstart', (e) => {
                touchTarget = e.target;
                touchStartTime = Date.now();
                
                // Ï¶âÏãú ÎπÑÏ£ºÏñº ÌîºÎìúÎ∞± ÏãúÏûë
                const targetElement = e.target.closest('.item-button') || e.target.closest('li') || e.target;
                targetElement.classList.add('long-press-active');
                
                touchTimer = setTimeout(() => {
                    // 1.2Ï¥à ÌõÑ Ïª®ÌÖçÏä§Ìä∏ Î©îÎâ¥ ÌëúÏãú
                    if (touchTarget === e.target) {
                        // ÌñÖÌã± ÌîºÎìúÎ∞± (ÏßÄÏõêÌïòÎäî Í≤ΩÏö∞)
                        if (navigator.vibrate) {
                            navigator.vibrate(50);
                        }
                        targetElement.classList.remove('long-press-active');
                        
                        // ÌÑ∞Ïπò Ïù¥Î≤§Ìä∏Î•º ÏúÑÌïú Ï¢åÌëú Î≥ÄÌôò
                        const touch = e.touches[0] || e.changedTouches[0];
                        const touchEvent = {
                            clientX: touch ? touch.clientX : e.clientX,
                            clientY: touch ? touch.clientY : e.clientY,
                            target: e.target,
                            preventDefault: e.preventDefault.bind(e)
                        };
                        
                        handleContextMenu(touchEvent, contextType);
                    }
                }, 1200);
            });
            
            element.addEventListener('touchend', (e) => {
                // ÎπÑÏ£ºÏñº ÌîºÎìúÎ∞± Ï†úÍ±∞
                const targetElement = e.target.closest('.item-button') || e.target.closest('li') || e.target;
                targetElement.classList.remove('long-press-active');
                
                if (touchTimer) {
                    clearTimeout(touchTimer);
                    touchTimer = null;
                }
                
                // ÏßßÏùÄ ÌÑ∞ÏπòÎäî ÏùºÎ∞ò ÌÅ¥Î¶≠ÏúºÎ°ú Ï≤òÎ¶¨
                const touchDuration = Date.now() - touchStartTime;
                if (touchDuration < 1200 && touchTarget === e.target) {
                    // ÏùºÎ∞ò ÌÅ¥Î¶≠ ÎèôÏûë
                    if (contextType === 'project' && e.target.tagName === 'LI') {
                        const projectName = e.target.textContent;
                        renderProject(projectName);
                    }
                }
                
                touchTarget = null;
            });
            
            element.addEventListener('touchmove', (e) => {
                // ÌÑ∞ÏπòÍ∞Ä Ïù¥ÎèôÌïòÎ©¥ Í∏∏Í≤å ÎàÑÎ•¥Í∏∞ Ï∑®ÏÜå
                const targetElement = e.target.closest('.item-button') || e.target.closest('li') || e.target;
                targetElement.classList.remove('long-press-active');
                
                if (touchTimer) {
                    clearTimeout(touchTimer);
                    touchTimer = null;
                }
                touchTarget = null;
            });
        }
        
        function handleContextMenu(e, contextType) {
            e.preventDefault();
            
            if (contextType === 'project' && e.target.tagName === 'LI') {
                const projectName = e.target.id.replace('project-', '');
                showProjectContextMenu(e, projectName);
            } else if (contextType === 'bookmark') {
                const button = e.target.closest('.item-button.bookmark-button');
                if (button) {
                    const index = parseInt(button.dataset.index);
                    showContextMenu(e, 'bookmark', index);
                }
            } else if (contextType === 'clipboard') {
                const button = e.target.closest('.item-button.clipboard-button');
                if (button) {
                    const index = parseInt(button.dataset.index);
                    showContextMenu(e, 'clipboard', index);
                }
            }
        }
        
        // Ïª®ÌÖçÏä§Ìä∏ Î©îÎâ¥ Î¶¨Ïä§ÎÑà Îì±Î°ù
        addContextMenuListeners(projectList, 'project');
        addContextMenuListeners(bookmarkList, 'bookmark');
        addContextMenuListeners(clipboardList, 'clipboard');

        document.addEventListener('click', (e) => {
            if (!contextMenu.contains(e.target)) {
                contextMenu.style.display = 'none';
                activeItem = null;
            }
            if (!projectContextMenu.contains(e.target)) {
                projectContextMenu.style.display = 'none';
                activeProject = null;
            }
        });

        contextEdit.addEventListener('click', () => {
            if (activeItem) {
                const { type, index } = activeItem;
                const projectData = allProjectsData[currentProject];
                
                if (type === 'bookmark') {
                    const item = projectData.bookmarks[index];
                    const modal = document.getElementById('add-bookmark-modal');
                    document.querySelector('#add-bookmark-modal h2').textContent = 'Î∂ÅÎßàÌÅ¨ Ìé∏Ïßë';
                    document.getElementById('add-bookmark-name').value = item.name;
                    document.getElementById('add-bookmark-url').value = item.url;
                    modal.style.display = 'flex';
                    modal.dataset.editMode = 'true';
                    modal.dataset.editIndex = index;
                } else if (type === 'clipboard') {
                    const item = projectData.clipboard[index];
                    const modal = document.getElementById('add-clipboard-modal');
                    document.querySelector('#add-clipboard-modal h2').textContent = 'ÌÅ¥Î¶ΩÎ≥¥Îìú Ìé∏Ïßë';
                    document.getElementById('add-clipboard-title').value = item.title || '';
                    document.getElementById('add-clipboard-content').value = item.text;
                    modal.style.display = 'flex';
                    modal.dataset.editMode = 'true';
                    modal.dataset.editIndex = index;
                }
                contextMenu.style.display = 'none';
                activeItem = null;
            }
        });

        contextFavorite.addEventListener('click', () => {
            if (activeItem) {
                const { type, index } = activeItem;
                const projectData = allProjectsData[currentProject];
                
                if (type === 'bookmark') {
                    projectData.bookmarks[index].favorite = !projectData.bookmarks[index].favorite;
                } else if (type === 'clipboard') {
                    projectData.clipboard[index].favorite = !projectData.clipboard[index].favorite;
                }
                
                renderProject(currentProject);
                contextMenu.style.display = 'none';
                activeItem = null;
                saveToFirebase();
            }
        });

        contextColor.addEventListener('click', () => {
            if (activeItem) {
                colorChangeItem = activeItem;
                const colorPaletteModal = document.getElementById('color-palette-modal');
                colorPaletteModal.style.display = 'flex';
                
                const { type, index } = activeItem;
                const projectData = allProjectsData[currentProject];
                let currentColor = '';
                if (type === 'bookmark') {
                    currentColor = projectData.bookmarks[index].color || 'rgba(242, 241, 238, 0.6)';
                } else if (type === 'clipboard') {
                    currentColor = projectData.clipboard[index].color || 'rgba(242, 241, 238, 0.6)';
                }
                
                document.querySelectorAll('.color-option').forEach(option => {
                    option.classList.remove('selected');
                    if (option.dataset.color === currentColor) {
                        option.classList.add('selected');
                    }
                });
                
                contextMenu.style.display = 'none';
                activeItem = null;
            }
        });

        contextDelete.addEventListener('click', () => {
            if (activeItem) {
                const { type, index } = activeItem;
                if (type === 'bookmark') {
                    allProjectsData[currentProject].bookmarks.splice(index, 1);
                } else if (type === 'clipboard') {
                    allProjectsData[currentProject].clipboard.splice(index, 1);
                }
                renderProject(currentProject);
                contextMenu.style.display = 'none';
                activeItem = null;
                saveToFirebase();
            }
        });

        contextCancel.addEventListener('click', () => {
            contextMenu.style.display = 'none';
            activeItem = null;
        });
        
        addBookmarkBtn.addEventListener('click', addBookmark);
        addClipboardBtn.addEventListener('click', addClipboard);
        
        const addProjectBtn = document.getElementById('add-project-btn');
        addProjectBtn.addEventListener('click', addProject);

        const addBookmarkModal = document.getElementById('add-bookmark-modal');
        const addBookmarkSave = document.getElementById('add-bookmark-save');
        const addBookmarkCancel = document.getElementById('add-bookmark-cancel');
        const addBookmarkClose = document.querySelector('.add-bookmark-close');
        
        addBookmarkSave.addEventListener('click', () => {
            const name = document.getElementById('add-bookmark-name').value.trim();
            const url = document.getElementById('add-bookmark-url').value.trim();
            
            if (!name || !url) {
                alert('Ïù¥Î¶ÑÍ≥º URLÏùÑ Î™®Îëê ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî.');
                return;
            }
            
            if (addBookmarkModal.dataset.editMode === 'true') {
                const index = parseInt(addBookmarkModal.dataset.editIndex);
                allProjectsData[currentProject].bookmarks[index].name = name;
                allProjectsData[currentProject].bookmarks[index].url = url;
            } else {
                allProjectsData[currentProject].bookmarks.push({ 
                    name: name, 
                    url: url, 
                    color: '#f8f9fa',
                    favorite: false
                });
            }
            renderProject(currentProject);
            addBookmarkModal.style.display = 'none';
            saveToFirebase();
        });
        
        addBookmarkCancel.addEventListener('click', () => {
            addBookmarkModal.style.display = 'none';
        });
        
        addBookmarkClose.addEventListener('click', () => {
            addBookmarkModal.style.display = 'none';
        });

        const addClipboardModal = document.getElementById('add-clipboard-modal');
        const addClipboardSave = document.getElementById('add-clipboard-save');
        const addClipboardCancel = document.getElementById('add-clipboard-cancel');
        const addClipboardClose = document.querySelector('.add-clipboard-close');
        
        addClipboardSave.addEventListener('click', () => {
            const title = document.getElementById('add-clipboard-title').value.trim();
            const content = document.getElementById('add-clipboard-content').value.trim();
            
            if (!title || !content) {
                alert('Ï†úÎ™©Í≥º ÎÇ¥Ïö©ÏùÑ Î™®Îëê ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî.');
                return;
            }
            
            if (addClipboardModal.dataset.editMode === 'true') {
                const index = parseInt(addClipboardModal.dataset.editIndex);
                allProjectsData[currentProject].clipboard[index].title = title;
                allProjectsData[currentProject].clipboard[index].text = content;
            } else {
                allProjectsData[currentProject].clipboard.push({ 
                    title: title,
                    text: content, 
                    color: '#f8f9fa',
                    favorite: false
                });
            }
            renderProject(currentProject);
            addClipboardModal.style.display = 'none';
            saveToFirebase();
        });
        
        addClipboardCancel.addEventListener('click', () => {
            addClipboardModal.style.display = 'none';
        });
        
        addClipboardClose.addEventListener('click', () => {
            addClipboardModal.style.display = 'none';
        });

        // Ìé∏ÏßëÏö© Î™®Îã¨ÏùÄ ÏòÅÏó≠ Î∞îÍπ• ÌÅ¥Î¶≠ÏúºÎ°ú Îã´ÌûàÏßÄ ÏïäÎèÑÎ°ù Ïù¥Î≤§Ìä∏ Ï†úÍ±∞
        // addBookmarkModal.addEventListener('click', (e) => {
        //     if (e.target === addBookmarkModal) {
        //         addBookmarkModal.style.display = 'none';
        //     }
        // });
        
        // addClipboardModal.addEventListener('click', (e) => {
        //     if (e.target === addClipboardModal) {
        //         addClipboardModal.style.display = 'none';
        //     }
        // });

        const addProjectModal = document.getElementById('add-project-modal');
        const addProjectSave = document.getElementById('add-project-save');
        const addProjectCancel = document.getElementById('add-project-cancel');
        const addProjectClose = document.querySelector('.add-project-close');
        
        addProjectSave.addEventListener('click', () => {
            const name = document.getElementById('add-project-name').value.trim();
            
            if (!name) {
                alert('ÌîÑÎ°úÏ†ùÌä∏ Ïù¥Î¶ÑÏùÑ ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî.');
                return;
            }
            
            if (allProjectsData[name]) {
                alert('Ïù¥ÎØ∏ Ï°¥Ïû¨ÌïòÎäî ÌîÑÎ°úÏ†ùÌä∏ Ïù¥Î¶ÑÏûÖÎãàÎã§.');
                return;
            }
            
            allProjectsData[name] = {
                bookmarks: [],
                clipboard: []
            };
            
            // ÏÉà ÌîÑÎ°úÏ†ùÌä∏Î•º projectOrder Î∞∞Ïó¥Ïóê Ï∂îÍ∞Ä
            if (!projectOrder) {
                projectOrder = Object.keys(allProjectsData);
            } else {
                projectOrder.push(name);
            }
            
            renderProjectList();
            renderProject(name);
            
            addProjectModal.style.display = 'none';
            saveToFirebase();
        });
        
        addProjectCancel.addEventListener('click', () => {
            addProjectModal.style.display = 'none';
        });
        
        addProjectClose.addEventListener('click', () => {
            addProjectModal.style.display = 'none';
        });
        
        // ÌîÑÎ°úÏ†ùÌä∏ Ï∂îÍ∞Ä Î™®Îã¨ÎèÑ Ìé∏ÏßëÏö©Ïù¥ÎØÄÎ°ú ÏòÅÏó≠ Î∞îÍπ• ÌÅ¥Î¶≠ÏúºÎ°ú Îã´ÌûàÏßÄ ÏïäÎèÑÎ°ù Ïù¥Î≤§Ìä∏ Ï†úÍ±∞
        // addProjectModal.addEventListener('click', (e) => {
        //     if (e.target === addProjectModal) {
        //         addProjectModal.style.display = 'none';
        //     }
        // });

        const settingsBtn = document.getElementById('settings-btn');
        const settingsModal = document.getElementById('settings-modal');
        const settingsCloseBtn = settingsModal.querySelector('.close-button');
        const exportDataBtn = document.getElementById('export-data-btn');
        const importDataBtn = document.getElementById('import-data-btn');
        const importDataInput = document.getElementById('import-data-input');
        
        settingsBtn.addEventListener('click', () => {
            settingsModal.style.display = 'flex';
        });
        
        settingsCloseBtn.addEventListener('click', () => {
            settingsModal.style.display = 'none';
        });
        
        settingsModal.addEventListener('click', (e) => {
            if (e.target === settingsModal) {
                settingsModal.style.display = 'none';
            }
        });

        // Îç∞Ïù¥ÌÑ∞ ÎÇ¥Î≥¥ÎÇ¥Í∏∞ (Î∞±ÏóÖ)
        exportDataBtn.addEventListener('click', () => {
            try {
                const dataToExport = {
                    projects: allProjectsData,
                    currentProject: currentProject,
                    exportDate: new Date().toISOString(),
                    version: '1.0'
                };
                
                const jsonString = JSON.stringify(dataToExport, null, 2);
                const blob = new Blob([jsonString], { type: 'application/json' });
                
                // ÌååÏùºÎ™Ö ÏÉùÏÑ± (ÌòÑÏû¨ ÎÇ†ÏßúÏôÄ ÏãúÍ∞Ñ Ìè¨Ìï®)
                const now = new Date();
                const dateString = now.getFullYear() + 
                    String(now.getMonth() + 1).padStart(2, '0') + 
                    String(now.getDate()).padStart(2, '0') + '_' +
                    String(now.getHours()).padStart(2, '0') + 
                    String(now.getMinutes()).padStart(2, '0');
                const filename = `Î∂ÅÎßàÌÅ¨ÌÅ¥Î¶ΩÎ≥¥Îìú_Î∞±ÏóÖ_${dateString}.json`;
                
                // Îã§Ïö¥Î°úÎìú ÎßÅÌÅ¨ ÏÉùÏÑ± Î∞è Ïã§Ìñâ
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = filename;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
                
                alert(`Îç∞Ïù¥ÌÑ∞Í∞Ä ÏÑ±Í≥µÏ†ÅÏúºÎ°ú ÎÇ¥Î≥¥ÎÇ¥Ï°åÏäµÎãàÎã§.\nÌååÏùºÎ™Ö: ${filename}`);
            } catch (error) {
                console.error('Îç∞Ïù¥ÌÑ∞ ÎÇ¥Î≥¥ÎÇ¥Í∏∞ Ïã§Ìå®:', error);
                alert('Îç∞Ïù¥ÌÑ∞ ÎÇ¥Î≥¥ÎÇ¥Í∏∞Ïóê Ïã§Ìå®ÌñàÏäµÎãàÎã§.');
            }
        });

        // Îç∞Ïù¥ÌÑ∞ Î∂àÎü¨Ïò§Í∏∞ Î≤ÑÌäº ÌÅ¥Î¶≠ Ïãú ÌååÏùº ÏÑ†ÌÉù Ï∞Ω Ïó¥Í∏∞
        importDataBtn.addEventListener('click', () => {
            importDataInput.click();
        });

        // ÌååÏùº ÏÑ†ÌÉù Ïãú Îç∞Ïù¥ÌÑ∞ Î∂àÎü¨Ïò§Í∏∞
        importDataInput.addEventListener('change', (e) => {
            const file = e.target.files[0];
            if (!file) return;

            if (file.type !== 'application/json') {
                alert('JSON ÌååÏùºÎßå ÏßÄÏõêÎê©ÎãàÎã§.');
                return;
            }

            const reader = new FileReader();
            reader.onload = (event) => {
                try {
                    const importedData = JSON.parse(event.target.result);
                    
                    // Îç∞Ïù¥ÌÑ∞ Ïú†Ìö®ÏÑ± Í≤ÄÏÇ¨
                    if (!importedData.projects || typeof importedData.projects !== 'object') {
                        throw new Error('Ïò¨Î∞îÎ•¥ÏßÄ ÏïäÏùÄ Î∞±ÏóÖ ÌååÏùº ÌòïÏãùÏûÖÎãàÎã§.');
                    }

                    // Îç∞Ïù¥ÌÑ∞ Íµ¨Ï°∞ Í≤ÄÏ¶ù
                    for (const [projectName, projectData] of Object.entries(importedData.projects)) {
                        if (!projectData.bookmarks || !projectData.clipboard || 
                            !Array.isArray(projectData.bookmarks) || !Array.isArray(projectData.clipboard)) {
                            throw new Error(`ÌîÑÎ°úÏ†ùÌä∏ '${projectName}'Ïùò Îç∞Ïù¥ÌÑ∞ Íµ¨Ï°∞Í∞Ä Ïò¨Î∞îÎ•¥ÏßÄ ÏïäÏäµÎãàÎã§.`);
                        }
                    }

                    // Î≥µÏõê Î∞©Ïãù ÏÑ†ÌÉù
                    const choice = confirm('Îç∞Ïù¥ÌÑ∞ Î≥µÏõê Î∞©ÏãùÏùÑ ÏÑ†ÌÉùÌï¥Ï£ºÏÑ∏Ïöî.\n\n' +
                                         'ÌôïÏù∏: Î≥ëÌï© Î™®Îìú (Í∏∞Ï°¥ Îç∞Ïù¥ÌÑ∞ Î≥¥Ï°¥ + Î∞±ÏóÖ Îç∞Ïù¥ÌÑ∞ Ï∂îÍ∞Ä)\n' +
                                         'Ï∑®ÏÜå: ÏôÑÏ†Ñ ÍµêÏ≤¥ (Í∏∞Ï°¥ Îç∞Ïù¥ÌÑ∞ ÏÇ≠Ï†ú + Î∞±ÏóÖ Îç∞Ïù¥ÌÑ∞Î°ú ÍµêÏ≤¥)');
                    
                    if (choice) {
                        // Î≥ëÌï© Î™®Îìú
                        performDataMerge(importedData);
                    } else {
                        // ÏôÑÏ†Ñ ÍµêÏ≤¥ Î™®Îìú
                        if (confirm('‚ö†Ô∏è ÏôÑÏ†Ñ ÍµêÏ≤¥ Î™®ÎìúÏûÖÎãàÎã§.\nÌòÑÏû¨ Î™®Îì† Îç∞Ïù¥ÌÑ∞Í∞Ä ÏÇ≠Ï†úÎêòÍ≥† Î∞±ÏóÖ Îç∞Ïù¥ÌÑ∞Î°ú ÍµêÏ≤¥Îê©ÎãàÎã§.\nÏ†ïÎßê ÏßÑÌñâÌïòÏãúÍ≤†ÏäµÎãàÍπå?')) {
                            performDataReplace(importedData);
                        }
                    }
                } catch (error) {
                    console.error('Îç∞Ïù¥ÌÑ∞ Î∂àÎü¨Ïò§Í∏∞ Ïã§Ìå®:', error);
                    alert(`Îç∞Ïù¥ÌÑ∞ Î∂àÎü¨Ïò§Í∏∞Ïóê Ïã§Ìå®ÌñàÏäµÎãàÎã§.\nÏò§Î•ò: ${error.message}`);
                }
            };
            
            reader.onerror = () => {
                alert('ÌååÏùº ÏùΩÍ∏∞Ïóê Ïã§Ìå®ÌñàÏäµÎãàÎã§.');
            };
            
            reader.readAsText(file);
            
            // ÌååÏùº ÏûÖÎ†• Ï¥àÍ∏∞Ìôî (Í∞ôÏùÄ ÌååÏùº Ïû¨ÏÑ†ÌÉù Í∞ÄÎä•ÌïòÎèÑÎ°ù)
            e.target.value = '';
        });

        // Îç∞Ïù¥ÌÑ∞ Î≥ëÌï© Ï≤òÎ¶¨ Ìï®Ïàò
        function performDataMerge(importedData) {
            const conflictProjects = [];
            const newProjects = [];
            
            // Ï∂©Îèå ÌîÑÎ°úÏ†ùÌä∏ÏôÄ ÏÉà ÌîÑÎ°úÏ†ùÌä∏ Î∂ÑÎ•ò
            for (const [projectName, projectData] of Object.entries(importedData.projects)) {
                if (allProjectsData[projectName]) {
                    conflictProjects.push(projectName);
                } else {
                    newProjects.push(projectName);
                }
            }
            
            // Ï∂©ÎèåÏù¥ ÏûàÎäî Í≤ΩÏö∞ ÏùºÍ¥Ñ Ï≤òÎ¶¨ ÏòµÏÖò Ï†úÍ≥µ
            if (conflictProjects.length > 0) {
                const conflictMessage = `${conflictProjects.length}Í∞úÏùò Í∏∞Ï°¥ ÌîÑÎ°úÏ†ùÌä∏ÏôÄ Ïù¥Î¶ÑÏù¥ Ï§ëÎ≥µÎê©ÎãàÎã§:\n` +
                                      `${conflictProjects.map(name => `‚Ä¢ ${name}`).join('\n')}\n\n` +
                                      `Ïñ¥ÎñªÍ≤å Ï≤òÎ¶¨ÌïòÏãúÍ≤†ÏäµÎãàÍπå?`;
                
                const choice = confirm(conflictMessage + '\n\n' +
                                     'ÌôïÏù∏: Î™®Îì† Ï∂©Îèå ÌîÑÎ°úÏ†ùÌä∏Î•º Î≥ëÌï© (Í∏∞Ï°¥ + Î∞±ÏóÖ Îç∞Ïù¥ÌÑ∞)\n' +
                                     'Ï∑®ÏÜå: Í∞úÎ≥Ñ ÏÑ†ÌÉù (ÌîÑÎ°úÏ†ùÌä∏Î≥ÑÎ°ú ÌôïÏù∏)');
                
                if (choice) {
                    // ÏùºÍ¥Ñ Î≥ëÌï©
                    performBatchMerge(importedData, conflictProjects, newProjects);
                } else {
                    // Í∞úÎ≥Ñ ÏÑ†ÌÉù
                    performIndividualMerge(importedData, conflictProjects, newProjects);
                }
            } else {
                // Ï∂©ÎèåÏù¥ ÏóÜÏúºÎ©¥ Î∞îÎ°ú Î≥ëÌï©
                performBatchMerge(importedData, [], newProjects);
            }
        }

        // ÏùºÍ¥Ñ Î≥ëÌï© Ï≤òÎ¶¨
        function performBatchMerge(importedData, conflictProjects, newProjects) {
            const mergeResults = {
                newProjects: [],
                conflictProjects: [],
                addedBookmarks: 0,
                addedClipboard: 0
            };

            // ÏÉà ÌîÑÎ°úÏ†ùÌä∏ Ï∂îÍ∞Ä
            newProjects.forEach(projectName => {
                const projectData = importedData.projects[projectName];
                allProjectsData[projectName] = {
                    bookmarks: [...projectData.bookmarks],
                    clipboard: [...projectData.clipboard]
                };
                mergeResults.newProjects.push(projectName);
                mergeResults.addedBookmarks += projectData.bookmarks.length;
                mergeResults.addedClipboard += projectData.clipboard.length;
            });

            // Ï∂©Îèå ÌîÑÎ°úÏ†ùÌä∏ ÏùºÍ¥Ñ Î≥ëÌï©
            conflictProjects.forEach(projectName => {
                const projectData = importedData.projects[projectName];
                
                // Î∂ÅÎßàÌÅ¨ Î≥ëÌï© (Ï§ëÎ≥µ Ï†úÍ±∞)
                const existingBookmarks = allProjectsData[projectName].bookmarks;
                const newBookmarks = projectData.bookmarks.filter(newBookmark => {
                    return !existingBookmarks.some(existing => 
                        existing.name === newBookmark.name && existing.url === newBookmark.url
                    );
                });
                existingBookmarks.push(...newBookmarks);
                mergeResults.addedBookmarks += newBookmarks.length;

                // ÌÅ¥Î¶ΩÎ≥¥Îìú Î≥ëÌï© (Ï§ëÎ≥µ Ï†úÍ±∞)
                const existingClipboard = allProjectsData[projectName].clipboard;
                const newClipboard = projectData.clipboard.filter(newClip => {
                    return !existingClipboard.some(existing => 
                        existing.text === newClip.text
                    );
                });
                existingClipboard.push(...newClipboard);
                mergeResults.addedClipboard += newClipboard.length;

                mergeResults.conflictProjects.push(projectName);
            });

            // Î≥ëÌï© ÏôÑÎ£å Ï≤òÎ¶¨
            finalizeMerge(importedData, mergeResults);
        }

        // Í∞úÎ≥Ñ ÏÑ†ÌÉù Î≥ëÌï© Ï≤òÎ¶¨
        function performIndividualMerge(importedData, conflictProjects, newProjects) {
            const mergeResults = {
                newProjects: [],
                conflictProjects: [],
                addedBookmarks: 0,
                addedClipboard: 0
            };

            // ÏÉà ÌîÑÎ°úÏ†ùÌä∏ Î®ºÏ†Ä Ï∂îÍ∞Ä
            newProjects.forEach(projectName => {
                const projectData = importedData.projects[projectName];
                allProjectsData[projectName] = {
                    bookmarks: [...projectData.bookmarks],
                    clipboard: [...projectData.clipboard]
                };
                mergeResults.newProjects.push(projectName);
                mergeResults.addedBookmarks += projectData.bookmarks.length;
                mergeResults.addedClipboard += projectData.clipboard.length;
            });

            // Ï∂©Îèå ÌîÑÎ°úÏ†ùÌä∏ Í∞úÎ≥Ñ Ï≤òÎ¶¨
            for (const projectName of conflictProjects) {
                const projectData = importedData.projects[projectName];
                const bookmarkCount = projectData.bookmarks.length;
                const clipboardCount = projectData.clipboard.length;
                
                const userChoice = confirm(`ÌîÑÎ°úÏ†ùÌä∏: ${projectName}\n` +
                                         `Î∞±ÏóÖ Îç∞Ïù¥ÌÑ∞: Î∂ÅÎßàÌÅ¨ ${bookmarkCount}Í∞ú, ÌÅ¥Î¶ΩÎ≥¥Îìú ${clipboardCount}Í∞ú\n\n` +
                                         `ÌôïÏù∏: Ïù¥ ÌîÑÎ°úÏ†ùÌä∏Î•º Î≥ëÌï© (Í∏∞Ï°¥ Îç∞Ïù¥ÌÑ∞ Ïú†ÏßÄ + Î∞±ÏóÖ Îç∞Ïù¥ÌÑ∞ Ï∂îÍ∞Ä)\n` +
                                         `Ï∑®ÏÜå: Ïù¥ ÌîÑÎ°úÏ†ùÌä∏Îäî Í±¥ÎÑàÎõ∞Í∏∞`);
                
                if (userChoice) {
                    // Î∂ÅÎßàÌÅ¨ Î≥ëÌï©
                    const existingBookmarks = allProjectsData[projectName].bookmarks;
                    const newBookmarks = projectData.bookmarks.filter(newBookmark => {
                        return !existingBookmarks.some(existing => 
                            existing.name === newBookmark.name && existing.url === newBookmark.url
                        );
                    });
                    existingBookmarks.push(...newBookmarks);
                    mergeResults.addedBookmarks += newBookmarks.length;

                    // ÌÅ¥Î¶ΩÎ≥¥Îìú Î≥ëÌï©
                    const existingClipboard = allProjectsData[projectName].clipboard;
                    const newClipboard = projectData.clipboard.filter(newClip => {
                        return !existingClipboard.some(existing => 
                            existing.text === newClip.text
                        );
                    });
                    existingClipboard.push(...newClipboard);
                    mergeResults.addedClipboard += newClipboard.length;

                    mergeResults.conflictProjects.push(projectName);
                }
            }

            // Î≥ëÌï© ÏôÑÎ£å Ï≤òÎ¶¨
            finalizeMerge(importedData, mergeResults);
        }

        // Îç∞Ïù¥ÌÑ∞ ÏôÑÏ†Ñ ÍµêÏ≤¥ Ï≤òÎ¶¨ Ìï®Ïàò
        function performDataReplace(importedData) {
            // Í∏∞Ï°¥ Îç∞Ïù¥ÌÑ∞ ÏôÑÏ†Ñ ÏÇ≠Ï†ú
            Object.keys(allProjectsData).forEach(key => delete allProjectsData[key]);
            
            // Î∞±ÏóÖ Îç∞Ïù¥ÌÑ∞Î°ú ÍµêÏ≤¥
            Object.assign(allProjectsData, importedData.projects);
            
            const availableProjects = Object.keys(allProjectsData);
            if (availableProjects.length > 0) {
                currentProject = importedData.currentProject && 
                               allProjectsData[importedData.currentProject] ? 
                               importedData.currentProject : availableProjects[0];
            }

            // ÏôÑÎ£å Ï≤òÎ¶¨
            finalizeRestore(availableProjects.length, 'ÏôÑÏ†Ñ ÍµêÏ≤¥');
        }

        // Î≥ëÌï© ÏôÑÎ£å Ï≤òÎ¶¨
        function finalizeMerge(importedData, results) {
            // ÌòÑÏû¨ ÌîÑÎ°úÏ†ùÌä∏ ÏÑ§Ï†ï (Í∏∞Ï°¥ ÌîÑÎ°úÏ†ùÌä∏ Ïú†ÏßÄ ÎòêÎäî ÏÉà ÌîÑÎ°úÏ†ùÌä∏Î°ú ÏÑ§Ï†ï)
            if (importedData.currentProject && allProjectsData[importedData.currentProject]) {
                currentProject = importedData.currentProject;
            }

            // ÏôÑÎ£å Ï≤òÎ¶¨
            const totalProjects = Object.keys(allProjectsData).length;
            const message = `‚úÖ Î≥ëÌï©Ïù¥ ÏôÑÎ£åÎêòÏóàÏäµÎãàÎã§!\n\n` +
                          `üìä Î≥ëÌï© Í≤∞Í≥º:\n` +
                          `‚Ä¢ ÏÉà ÌîÑÎ°úÏ†ùÌä∏: ${results.newProjects.length}Í∞ú\n` +
                          `‚Ä¢ Î≥ëÌï©Îêú ÌîÑÎ°úÏ†ùÌä∏: ${results.conflictProjects.length}Í∞ú\n` +
                          `‚Ä¢ Ï∂îÍ∞ÄÎêú Î∂ÅÎßàÌÅ¨: ${results.addedBookmarks}Í∞ú\n` +
                          `‚Ä¢ Ï∂îÍ∞ÄÎêú ÌÅ¥Î¶ΩÎ≥¥Îìú: ${results.addedClipboard}Í∞ú\n` +
                          `‚Ä¢ Ï†ÑÏ≤¥ ÌîÑÎ°úÏ†ùÌä∏: ${totalProjects}Í∞ú`;
            
            finalizeRestore(totalProjects, 'Î≥ëÌï©', message);
        }

        // Î≥µÏõê ÏôÑÎ£å Í≥µÌÜµ Ï≤òÎ¶¨
        function finalizeRestore(projectCount, mode, customMessage = null) {
            // Î°úÏª¨Ïä§ÌÜ†Î¶¨ÏßÄÏóê Ï†ÄÏû•
            saveToFirebase();
            
            // ÌôîÎ©¥ ÏóÖÎç∞Ïù¥Ìä∏
            renderProjectList();
            renderProject(currentProject);
            
            // Î™®Îã¨ Îã´Í∏∞
            settingsModal.style.display = 'none';
            
            // ÏôÑÎ£å Î©îÏãúÏßÄ
            const defaultMessage = `Îç∞Ïù¥ÌÑ∞ ${mode}Ïù¥ ÏôÑÎ£åÎêòÏóàÏäµÎãàÎã§!\nÌîÑÎ°úÏ†ùÌä∏ ${projectCount}Í∞úÍ∞Ä Ï≤òÎ¶¨ÎêòÏóàÏäµÎãàÎã§.`;
            alert(customMessage || defaultMessage);
        }

        projectContextRename.addEventListener('click', () => {
            if (activeProject) {
                const newName = prompt('ÏÉà ÌîÑÎ°úÏ†ùÌä∏ Ïù¥Î¶ÑÏùÑ ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî:', activeProject);
                if (newName && newName.trim() !== '' && newName.trim() !== activeProject) {
                    const trimmedName = newName.trim();
                    
                    if (allProjectsData[trimmedName]) {
                        alert('Ïù¥ÎØ∏ Ï°¥Ïû¨ÌïòÎäî ÌîÑÎ°úÏ†ùÌä∏ Ïù¥Î¶ÑÏûÖÎãàÎã§.');
                        return;
                    }
                    
                    allProjectsData[trimmedName] = allProjectsData[activeProject];
                    delete allProjectsData[activeProject];
                    
                    // projectOrderÏóêÏÑú ÌîÑÎ°úÏ†ùÌä∏Î™Ö Î≥ÄÍ≤Ω
                    if (projectOrder) {
                        const index = projectOrder.indexOf(activeProject);
                        if (index !== -1) {
                            projectOrder[index] = trimmedName;
                        }
                    }
                    
                    if (currentProject === activeProject) {
                        currentProject = trimmedName;
                    }
                    
                    renderProjectList();
                    renderProject(trimmedName);
                    saveToFirebase();
                }
                projectContextMenu.style.display = 'none';
                activeProject = null;
            }
        });

        projectContextDelete.addEventListener('click', () => {
            if (activeProject) {
                if (Object.keys(allProjectsData).length <= 1) {
                    alert('ÏµúÏÜå ÌïòÎÇòÏùò ÌîÑÎ°úÏ†ùÌä∏Îäî ÌïÑÏöîÌï©ÎãàÎã§.');
                    return;
                }
                
                if (confirm(`'${activeProject}' ÌîÑÎ°úÏ†ùÌä∏Î•º ÏÇ≠Ï†úÌïòÏãúÍ≤†ÏäµÎãàÍπå?`)) {
                    delete allProjectsData[activeProject];
                    
                    // projectOrderÏóêÏÑú ÏÇ≠Ï†úÎêú ÌîÑÎ°úÏ†ùÌä∏ Ï†úÍ±∞
                    if (projectOrder) {
                        const index = projectOrder.indexOf(activeProject);
                        if (index !== -1) {
                            projectOrder.splice(index, 1);
                        }
                    }
                    
                    if (currentProject === activeProject) {
                        const remainingProjects = projectOrder && projectOrder.length > 0 
                            ? projectOrder 
                            : Object.keys(allProjectsData);
                        currentProject = remainingProjects[0];
                    }
                    
                    renderProjectList();
                    renderProject(currentProject);
                    saveToFirebase();
                }
                projectContextMenu.style.display = 'none';
                activeProject = null;
            }
        });

        projectContextCancel.addEventListener('click', () => {
            projectContextMenu.style.display = 'none';
            activeProject = null;
        });

        const colorPaletteModal = document.getElementById('color-palette-modal');
        const colorPaletteClose = document.querySelector('.color-palette-close');
        
        colorPaletteClose.addEventListener('click', () => {
            colorPaletteModal.style.display = 'none';
            colorChangeItem = null;
        });
        
        colorPaletteModal.addEventListener('click', (e) => {
            if (e.target === colorPaletteModal) {
                colorPaletteModal.style.display = 'none';
                colorChangeItem = null;
            }
        });
        
        document.querySelectorAll('.color-option').forEach(option => {
            option.addEventListener('click', () => {
                if (colorChangeItem) {
                    const selectedColor = option.dataset.color;
                    const { type, index } = colorChangeItem;
                    const projectData = allProjectsData[currentProject];
                    
                    if (type === 'bookmark') {
                        projectData.bookmarks[index].color = selectedColor;
                    } else if (type === 'clipboard') {
                        projectData.clipboard[index].color = selectedColor;
                    }
                    
                    renderProject(currentProject);
                    
                    colorPaletteModal.style.display = 'none';
                    colorChangeItem = null;
                }
            });
        });

        function renderFavorites() {
            const favoritesList = document.getElementById('favorites-list');
            favoritesList.innerHTML = '';
            
            let allFavorites = [];
            
            Object.keys(allProjectsData).forEach(projectName => {
                const projectData = allProjectsData[projectName];
                
                projectData.bookmarks.forEach((bookmark, index) => {
                    if (bookmark.favorite) {
                        allFavorites.push({
                            type: 'bookmark',
                            name: bookmark.name,
                            url: bookmark.url,
                            color: bookmark.color,
                            project: projectName,
                            index: index
                        });
                    }
                });
                
                projectData.clipboard.forEach((clip, index) => {
                    if (clip.favorite) {
                        allFavorites.push({
                            type: 'clipboard',
                            name: clip.title || clip.text.substring(0, 20) + (clip.text.length > 20 ? '...' : ''),
                            text: clip.text,
                            color: clip.color,
                            project: projectName,
                            index: index
                        });
                    }
                });
            });
            
            if (allFavorites.length === 0) {
                favoritesList.innerHTML = '<div class="activity-placeholder">Ï¶êÍ≤®Ï∞æÍ∏∞Í∞Ä ÏóÜÏäµÎãàÎã§</div>';
                return;
            }
            
            allFavorites.forEach(item => {
                const favoriteItem = document.createElement('div');
                favoriteItem.className = 'favorite-item';
                favoriteItem.style.backgroundColor = item.color || '#f8f9fa';
                
                const itemContent = document.createElement('div');
                itemContent.className = 'favorite-item-content';
                
                const itemName = document.createElement('div');
                itemName.className = 'favorite-item-name';
                itemName.textContent = item.name;
                
                const itemProject = document.createElement('div');
                itemProject.className = 'favorite-item-project';
                itemProject.textContent = item.project;
                
                itemContent.appendChild(itemName);
                itemContent.appendChild(itemProject);
                favoriteItem.appendChild(itemContent);
                
                favoriteItem.style.cursor = 'pointer';
                favoriteItem.addEventListener('click', () => {
                    if (item.type === 'bookmark') {
                        window.open(item.url, '_blank');
                    } else if (item.type === 'clipboard') {
                        copyToClipboard(item.text).then(success => {
                            if (success) {
                                alert('ÎÇ¥Ïö©Ïù¥ ÌÅ¥Î¶ΩÎ≥¥ÎìúÏóê Î≥µÏÇ¨ÎêòÏóàÏäµÎãàÎã§.');
                            } else {
                                alert('Î≥µÏÇ¨Ïóê Ïã§Ìå®ÌñàÏäµÎãàÎã§. ÏàòÎèôÏúºÎ°ú Î≥µÏÇ¨Ìï¥ Ï£ºÏÑ∏Ïöî.');
                            }
                        });
                    }
                });
                
                favoritesList.appendChild(favoriteItem);
            });
        }
        
        function renderStatistics() {
            const currentProjectData = allProjectsData[currentProject];
            
            document.getElementById('total-bookmarks').textContent = currentProjectData.bookmarks.length;
            document.getElementById('total-clipboard').textContent = currentProjectData.clipboard.length;
            
            let totalFavorites = 0;
            Object.values(allProjectsData).forEach(projectData => {
                totalFavorites += projectData.bookmarks.filter(b => b.favorite).length;
                totalFavorites += projectData.clipboard.filter(c => c.favorite).length;
            });
            
            document.getElementById('total-favorites').textContent = totalFavorites;
        }

        let draggedProject = null;

        function handleProjectDragStart(e) {
            draggedProject = e.target;
            e.target.classList.add('dragging');
            e.dataTransfer.effectAllowed = 'move';
            e.dataTransfer.setData('text/html', e.target.outerHTML);
        }

        function handleProjectDragOver(e) {
            e.preventDefault();
            e.dataTransfer.dropEffect = 'move';
        }

        function handleProjectDragEnter(e) {
            e.target.classList.add('drag-over');
        }

        function handleProjectDragLeave(e) {
            e.target.classList.remove('drag-over');
        }

        function handleProjectDrop(e) {
            e.preventDefault();
            e.target.classList.remove('drag-over');
            
            if (draggedProject && draggedProject !== e.target && e.target.tagName === 'LI') {
                const draggedProjectName = draggedProject.dataset.projectName;
                const targetProjectName = e.target.dataset.projectName;
                
                // projectOrder Î∞∞Ïó¥ÏùÑ ÏÇ¨Ïö©ÌïòÏó¨ ÏàúÏÑú Î≥ÄÍ≤Ω
                const currentOrder = projectOrder || Object.keys(allProjectsData);
                const draggedIndex = currentOrder.indexOf(draggedProjectName);
                const targetIndex = currentOrder.indexOf(targetProjectName);
                
                if (draggedIndex !== -1 && targetIndex !== -1 && draggedIndex !== targetIndex) {
                    // ÏàúÏÑú Î∞∞Ïó¥ÏóêÏÑú Ïù¥Îèô
                    currentOrder.splice(draggedIndex, 1);
                    currentOrder.splice(targetIndex, 0, draggedProjectName);
                    
                    // projectOrder ÏóÖÎç∞Ïù¥Ìä∏
                    projectOrder = [...currentOrder];
                    
                    renderProjectList();
                    saveToFirebase();
                }
            }
        }

        function handleProjectDragEnd(e) {
            e.target.classList.remove('dragging');
            document.querySelectorAll('.project-item').forEach(item => {
                item.classList.remove('drag-over');
            });
            draggedProject = null;
        }

        function setupDropZones() {
            const bookmarkList = document.getElementById('bookmark-list');
            const clipboardList = document.getElementById('clipboard-list');
            
            [bookmarkList, clipboardList].forEach(list => {
                list.classList.add('drop-zone');
                list.addEventListener('dragover', handleItemDragOver);
                list.addEventListener('drop', handleItemDrop);
                list.addEventListener('dragenter', handleItemDragEnter);
                list.addEventListener('dragleave', handleItemDragLeave);
            });
        }

        let draggedItem = null;
        let draggedItemType = null;
        let draggedItemIndex = null;

        function handleItemDragStart(e) {
            draggedItem = e.target;
            draggedItemType = e.target.dataset.type;
            draggedItemIndex = parseInt(e.target.dataset.index);
            e.target.classList.add('dragging');
            e.dataTransfer.effectAllowed = 'move';
            e.dataTransfer.setData('text/html', e.target.outerHTML);
        }

        function handleItemDragOver(e) {
            e.preventDefault();
            e.dataTransfer.dropEffect = 'move';
            
            if (e.target.classList.contains('item-button')) {
                const targetType = e.target.dataset.type;
                if (draggedItemType === targetType) {
                    const rect = e.target.getBoundingClientRect();
                    const midY = rect.top + rect.height / 2;
                    
                    document.querySelectorAll('.drop-indicator').forEach(el => el.remove());
                    
                    const indicator = document.createElement('div');
                    indicator.className = 'drop-indicator';
                    indicator.style.cssText = `
                        position: absolute;
                        left: ${rect.left - 5}px;
                        width: ${rect.width + 10}px;
                        height: 2px;
                        background-color: #3b82f6;
                        z-index: 1000;
                        pointer-events: none;
                    `;
                    
                    if (e.clientY < midY) {
                        indicator.style.top = `${rect.top - 1}px`;
                        e.target.dataset.insertBefore = 'true';
                    } else {
                        indicator.style.top = `${rect.bottom - 1}px`;
                        e.target.dataset.insertBefore = 'false';
                    }
                    
                    document.body.appendChild(indicator);
                }
            }
        }

        function handleItemDragEnter(e) {
            if (e.target.classList.contains('item-list')) {
                e.target.classList.add('drag-over');
            } else if (e.target.closest('.item-list')) {
                e.target.closest('.item-list').classList.add('drag-over');
            }
        }

        function handleItemDragLeave(e) {
            if (e.target.classList.contains('item-list')) {
                e.target.classList.remove('drag-over');
            } else if (e.target.closest('.item-list')) {
                e.target.closest('.item-list').classList.remove('drag-over');
            }
        }

        function handleItemDrop(e) {
            e.preventDefault();
            
            document.querySelectorAll('.drop-indicator').forEach(el => el.remove());
            
            document.querySelectorAll('.drag-over').forEach(el => {
                el.classList.remove('drag-over');
            });
            
            if (draggedItem && draggedItemType && draggedItemIndex !== null) {
                const targetButton = e.target.closest('.item-button');
                const targetList = e.target.closest('.item-list');
                
                if (targetButton && targetButton !== draggedItem) {
                    const targetType = targetButton.dataset.type;
                    const targetIndex = parseInt(targetButton.dataset.index);
                    
                    if (draggedItemType === targetType) {
                        const data = allProjectsData[currentProject][draggedItemType === 'bookmark' ? 'bookmarks' : 'clipboard'];
                        const itemToMove = data[draggedItemIndex];
                        
                        data.splice(draggedItemIndex, 1);
                        
                        let newIndex = targetIndex;
                        if (draggedItemIndex < targetIndex) {
                            newIndex = targetIndex - 1;
                        }
                        
                        const insertBefore = targetButton.dataset.insertBefore === 'true';
                        if (!insertBefore) {
                            newIndex += 1;
                        }
                        
                        data.splice(newIndex, 0, itemToMove);
                        
                        renderProject(currentProject);
                        saveToFirebase();
                        
                        delete targetButton.dataset.insertBefore;
                    }
                } else if (targetList && !targetButton) {
                    const targetType = targetList.id === 'bookmark-list' ? 'bookmark' : 'clipboard';
                    
                    if (draggedItemType === targetType) {
                        const data = allProjectsData[currentProject][draggedItemType === 'bookmark' ? 'bookmarks' : 'clipboard'];
                        const itemToMove = data[draggedItemIndex];
                        
                        data.splice(draggedItemIndex, 1);
                        data.push(itemToMove);
                        
                        renderProject(currentProject);
                        saveToFirebase();
                    }
                }
            }
        }

        function handleItemDragEnd(e) {
            e.target.classList.remove('dragging');
            
            document.querySelectorAll('.item-list, .content-panel').forEach(element => {
                element.classList.remove('drag-over');
            });
            document.querySelectorAll('.drop-indicator').forEach(el => el.remove());
            document.querySelectorAll('.item-button').forEach(button => {
                delete button.dataset.insertBefore;
            });
            
            draggedItem = null;
            draggedItemType = null;
            draggedItemIndex = null;
        }

        // View Clipboard Modal
        const viewClipboardModal = document.getElementById('view-clipboard-modal');
        const viewClipboardCloseBtn = viewClipboardModal.querySelector('.view-clipboard-close');
        const viewClipboardCopyBtn = document.getElementById('view-clipboard-copy-btn');
        const viewClipboardEditBtn = document.getElementById('view-clipboard-edit-btn');

        viewClipboardCloseBtn.addEventListener('click', () => {
            viewClipboardModal.style.display = 'none';
        });

        viewClipboardModal.addEventListener('click', (e) => {
            if (e.target === viewClipboardModal) {
                viewClipboardModal.style.display = 'none';
            }
        });

        // Î™®Î∞îÏùº Ìò∏Ìôò Î≥µÏÇ¨ Ìï®Ïàò
        function copyToClipboard(text) {
            // Î®ºÏ†Ä modern API ÏãúÎèÑ
            if (navigator.clipboard && navigator.clipboard.writeText) {
                return navigator.clipboard.writeText(text)
                    .then(() => true)
                    .catch(() => false);
            }
            
            // ÎåÄÏ≤¥ Î∞©Î≤ï: ÏûÑÏãú textarea ÏÉùÏÑ±
            return new Promise((resolve) => {
                const textArea = document.createElement('textarea');
                textArea.value = text;
                textArea.style.position = 'fixed';
                textArea.style.top = '-9999px';
                textArea.style.left = '-9999px';
                textArea.setAttribute('readonly', '');
                textArea.style.contain = 'strict';
                
                document.body.appendChild(textArea);
                
                // iOS Safari ÎåÄÏùë
                if (/ipad|iphone/i.test(navigator.userAgent)) {
                    textArea.contentEditable = 'true';
                    textArea.readOnly = false;
                    const range = document.createRange();
                    range.selectNodeContents(textArea);
                    const selection = window.getSelection();
                    selection.removeAllRanges();
                    selection.addRange(range);
                    textArea.setSelectionRange(0, 999999);
                } else {
                    textArea.select();
                }
                
                try {
                    const successful = document.execCommand('copy');
                    document.body.removeChild(textArea);
                    resolve(successful);
                } catch (err) {
                    document.body.removeChild(textArea);
                    resolve(false);
                }
            });
        }

        viewClipboardCopyBtn.addEventListener('click', (e) => {
            const textToCopy = e.target.dataset.clipboardText;
            copyToClipboard(textToCopy).then(success => {
                if (success) {
                    alert('ÎÇ¥Ïö©Ïù¥ ÌÅ¥Î¶ΩÎ≥¥ÎìúÏóê Î≥µÏÇ¨ÎêòÏóàÏäµÎãàÎã§.');
                    viewClipboardModal.style.display = 'none';
                } else {
                    alert('Î≥µÏÇ¨Ïóê Ïã§Ìå®ÌñàÏäµÎãàÎã§. ÏàòÎèôÏúºÎ°ú Î≥µÏÇ¨Ìï¥ Ï£ºÏÑ∏Ïöî.');
                }
            });
        });

        viewClipboardEditBtn.addEventListener('click', (e) => {
            const index = parseInt(e.target.dataset.clipboardIndex);
            const projectData = allProjectsData[currentProject];
            const item = projectData.clipboard[index];
            
            // Î≥¥Í∏∞ Î™®Îã¨ Îã´Í∏∞
            viewClipboardModal.style.display = 'none';
            
            // Ìé∏Ïßë Î™®Îã¨ Ïó¥Í∏∞
            const addClipboardModal = document.getElementById('add-clipboard-modal');
            document.querySelector('#add-clipboard-modal h2').textContent = 'ÌÅ¥Î¶ΩÎ≥¥Îìú Ìé∏Ïßë';
            document.getElementById('add-clipboard-title').value = item.title || '';
            document.getElementById('add-clipboard-content').value = item.text;
            
            // Ìé∏Ïßë Î™®Îìú ÏÑ§Ï†ï
            addClipboardModal.dataset.editMode = 'true';
            addClipboardModal.dataset.editIndex = index;
            
            addClipboardModal.style.display = 'flex';
        });

        // Î™®Î∞îÏùº ÌÉ≠ ÎÑ§ÎπÑÍ≤åÏù¥ÏÖò Ï≤òÎ¶¨
        function initMobileTabs() {
            const mobileTabs = document.querySelectorAll('.mobile-tab');
            const projectSidebar = document.getElementById('project-sidebar');
            const bookmarkPanel = document.querySelector('.bookmark-panel');
            const clipboardPanel = document.querySelector('.clipboard-panel');
            const practicePanel = document.querySelector('.practice-panel');
            const dashboardArea = document.querySelector('.dashboard-area');
            
            mobileTabs.forEach(tab => {
                tab.addEventListener('click', () => {
                    // Î™®Îì† ÌÉ≠ ÎπÑÌôúÏÑ±Ìôî
                    mobileTabs.forEach(t => t.classList.remove('active'));
                    
                    // ÌÅ¥Î¶≠Îêú ÌÉ≠ ÌôúÏÑ±Ìôî
                    tab.classList.add('active');
                    
                    // Î™®Îì† Ìå®ÎÑê Ïà®ÍπÄ
                    projectSidebar.classList.remove('mobile-visible');
                    bookmarkPanel.classList.remove('mobile-visible');
                    clipboardPanel.classList.remove('mobile-visible');
                    practicePanel.classList.remove('mobile-visible');
                    dashboardArea.classList.remove('mobile-visible');
                    
                    // ÏÑ†ÌÉùÎêú ÌÉ≠Ïóê Îî∞Îùº Ìå®ÎÑê ÌëúÏãú
                    const tabType = tab.dataset.tab;
                    switch(tabType) {
                        case 'projects':
                            projectSidebar.classList.add('mobile-visible');
                            break;
                        case 'bookmarks':
                            bookmarkPanel.classList.add('mobile-visible');
                            break;
                        case 'clipboard':
                            clipboardPanel.classList.add('mobile-visible');
                            break;
                        case 'practice':
                            practicePanel.classList.add('mobile-visible');
                            break;
                        case 'dashboard':
                            dashboardArea.classList.add('mobile-visible');
                            break;
                    }
                });
            });
            
            // Ï¥àÍ∏∞ ÏÉÅÌÉú: ÌîÑÎ°úÏ†ùÌä∏ ÌÉ≠ ÌôúÏÑ±Ìôî
            if (window.innerWidth <= 768) {
                projectSidebar.classList.add('mobile-visible');
            }
        }

        // Ïó∞ÏäµÏû• ÏòÅÏó≠ Ï¥àÍ∏∞Ìôî
        function initPracticeArea() {
            const practiceTextarea = document.getElementById('practice-textarea');
            const copyBtn = document.getElementById('copy-practice-btn');
            const clearBtn = document.getElementById('clear-practice-btn');
            
            // Î≥µÏÇ¨ Î≤ÑÌäº Ïù¥Î≤§Ìä∏
            copyBtn.addEventListener('click', async () => {
                const text = practiceTextarea.value;
                if (!text.trim()) {
                    alert('Î≥µÏÇ¨Ìï† ÎÇ¥Ïö©Ïù¥ ÏóÜÏäµÎãàÎã§.');
                    return;
                }
                
                try {
                    if (navigator.clipboard && navigator.clipboard.writeText) {
                        await navigator.clipboard.writeText(text);
                        alert('ÎÇ¥Ïö©Ïù¥ ÌÅ¥Î¶ΩÎ≥¥ÎìúÏóê Î≥µÏÇ¨ÎêòÏóàÏäµÎãàÎã§.');
                    } else {
                        // Ìè¥Î∞± Î∞©Ïãù
                        practiceTextarea.select();
                        document.execCommand('copy');
                        alert('ÎÇ¥Ïö©Ïù¥ ÌÅ¥Î¶ΩÎ≥¥ÎìúÏóê Î≥µÏÇ¨ÎêòÏóàÏäµÎãàÎã§.');
                    }
                } catch (err) {
                    console.error('Î≥µÏÇ¨ Ïã§Ìå®:', err);
                    alert('Î≥µÏÇ¨Ïóê Ïã§Ìå®ÌñàÏäµÎãàÎã§.');
                }
            });
            
            // Ï¥àÍ∏∞Ìôî Î≤ÑÌäº Ïù¥Î≤§Ìä∏
            clearBtn.addEventListener('click', () => {
                if (practiceTextarea.value.trim() && confirm('Ïó∞ÏäµÏû•Ïùò Î™®Îì† ÎÇ¥Ïö©ÏùÑ Ï¥àÍ∏∞ÌôîÌïòÏãúÍ≤†ÏäµÎãàÍπå?')) {
                    practiceTextarea.value = '';
                    savePracticeToFirebase('');
                    practiceTextarea.focus();
                }
            });
            
            // Ïã§ÏãúÍ∞Ñ Ï†ÄÏû• (ÎîîÎ∞îÏö¥Ïã± Ï†ÅÏö©)
            let saveTimeout;
            practiceTextarea.addEventListener('input', () => {
                clearTimeout(saveTimeout);
                saveTimeout = setTimeout(() => {
                    savePracticeToFirebase(practiceTextarea.value);
                }, 1000); // 1Ï¥à ÏßÄÏó∞
            });
            
            // FirebaseÏóêÏÑú Ïó∞ÏäµÏû• ÎÇ¥Ïö© Î°úÎìú
            loadPracticeFromFirebase();
            
            // Ïã§ÏãúÍ∞Ñ ÎèôÍ∏∞Ìôî Î¶¨Ïä§ÎÑà ÏÑ§Ï†ï (Firebase Ï¥àÍ∏∞Ìôî ÌõÑ)
            setTimeout(() => {
                if (firebaseInitialized && db) {
                    db.collection('userdata').doc('practice').onSnapshot((doc) => {
                        if (doc.exists && document.activeElement !== practiceTextarea) {
                            // ÏÇ¨Ïö©ÏûêÍ∞Ä ÌòÑÏû¨ ÌÖçÏä§Ìä∏ÏÉÅÏûêÎ•º Ìé∏Ïßë Ï§ëÏù¥ ÏïÑÎãê ÎïåÎßå ÏóÖÎç∞Ïù¥Ìä∏
                            const data = doc.data();
                            if (data.content !== practiceTextarea.value) {
                                practiceTextarea.value = data.content || '';
                                console.log('Îã§Î•∏ Í∏∞Í∏∞ÏóêÏÑú Ïó∞ÏäµÏû• ÎÇ¥Ïö©Ïù¥ ÏóÖÎç∞Ïù¥Ìä∏ÎêòÏóàÏäµÎãàÎã§.');
                            }
                        }
                    });
                }
            }, 2000); // Firebase Ï¥àÍ∏∞Ìôî ÏôÑÎ£å ÌõÑ 2Ï¥à Îí§Ïóê Î¶¨Ïä§ÎÑà ÏÑ§Ï†ï
        }

        // ÌôîÎ©¥ ÌÅ¨Í∏∞ Î≥ÄÍ≤Ω Í∞êÏßÄ
        function handleResize() {
            if (window.innerWidth <= 768) {
                // Î™®Î∞îÏùº Î™®Îìú
                const activeTab = document.querySelector('.mobile-tab.active');
                if (activeTab) {
                    const event = new Event('click');
                    activeTab.dispatchEvent(event);
                }
            } else {
                // Îç∞Ïä§ÌÅ¨ÌÜ± Î™®Îìú: Î™®Îì† mobile-visible ÌÅ¥ÎûòÏä§ Ï†úÍ±∞
                document.getElementById('project-sidebar').classList.remove('mobile-visible');
                document.querySelector('.bookmark-panel').classList.remove('mobile-visible');
                document.querySelector('.clipboard-panel').classList.remove('mobile-visible');
                document.querySelector('.practice-panel').classList.remove('mobile-visible');
                document.querySelector('.dashboard-area').classList.remove('mobile-visible');
            }
        }

        // ÌÑ∞Ïπò Ïä§ÏôÄÏù¥ÌîÑ ÏßÄÏõê (ÏòµÏÖò)
        let touchStartX = 0;
        let touchEndX = 0;
        
        function handleSwipe() {
            if (window.innerWidth > 768) return; // Î™®Î∞îÏùºÏóêÏÑúÎßå ÏûëÎèô
            
            const swipeThreshold = 100;
            const difference = touchStartX - touchEndX;
            
            if (Math.abs(difference) > swipeThreshold) {
                const currentActiveTab = document.querySelector('.mobile-tab.active');
                const allTabs = Array.from(document.querySelectorAll('.mobile-tab'));
                const currentIndex = allTabs.indexOf(currentActiveTab);
                
                let nextIndex;
                if (difference > 0) {
                    // ÏôºÏ™ΩÏúºÎ°ú Ïä§ÏôÄÏù¥ÌîÑ (Îã§Ïùå ÌÉ≠)
                    nextIndex = currentIndex + 1 < allTabs.length ? currentIndex + 1 : 0;
                } else {
                    // Ïò§Î•∏Ï™ΩÏúºÎ°ú Ïä§ÏôÄÏù¥ÌîÑ (Ïù¥Ï†Ñ ÌÉ≠)
                    nextIndex = currentIndex - 1 >= 0 ? currentIndex - 1 : allTabs.length - 1;
                }
                
                allTabs[nextIndex].click();
            }
        }

        // ÌÑ∞Ïπò Ïù¥Î≤§Ìä∏ Î¶¨Ïä§ÎÑà
        document.addEventListener('touchstart', e => {
            touchStartX = e.changedTouches[0].screenX;
        });

        document.addEventListener('touchend', e => {
            touchEndX = e.changedTouches[0].screenX;
            handleSwipe();
        });

        // Î¶¨ÏÇ¨Ïù¥Ï¶à Ïù¥Î≤§Ìä∏ Î¶¨Ïä§ÎÑà
        window.addEventListener('resize', handleResize);

        // PWA Service Worker Îì±Î°ù
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('sw.js')
                    .then(registration => {
                        console.log('PWA: Service Worker Îì±Î°ù ÏÑ±Í≥µ', registration.scope);
                        
                        // Service Worker ÏóÖÎç∞Ïù¥Ìä∏ ÌôïÏù∏
                        registration.addEventListener('updatefound', () => {
                            const newWorker = registration.installing;
                            newWorker.addEventListener('statechange', () => {
                                if (newWorker.state === 'installed' && navigator.serviceWorker.controller) {
                                    // ÏÉà Î≤ÑÏ†Ñ ÏÇ¨Ïö© Í∞ÄÎä• ÏïåÎ¶º
                                    if (confirm('ÏÉàÎ°úÏö¥ Î≤ÑÏ†ÑÏù¥ ÏÇ¨Ïö© Í∞ÄÎä•Ìï©ÎãàÎã§. ÏßÄÍ∏à ÏÉàÎ°úÍ≥†Ïπ®ÌïòÏãúÍ≤†ÏäµÎãàÍπå?')) {
                                        window.location.reload();
                                    }
                                }
                            });
                        });
                    })
                    .catch(error => {
                        console.log('PWA: Service Worker Îì±Î°ù Ïã§Ìå®', error);
                    });
            });
        }

        // PWA ÏÑ§Ïπò Í¥ÄÎ¶¨
        let deferredPrompt;
        let installButton = null;

        // PWA ÏÑ§Ïπò Í∞ÄÎä• Ïó¨Î∂Ä ÌôïÏù∏ Î∞è Î≤ÑÌäº ÌëúÏãú
        function checkPWAInstallability() {
            console.log('PWA: ÏÑ§Ïπò Í∞ÄÎä•ÏÑ± ÌôïÏù∏ Ï§ë...');
            
            // Ïù¥ÎØ∏ ÏÑ§ÏπòÎêú Ïï±Ïù∏ÏßÄ ÌôïÏù∏
            if (window.matchMedia('(display-mode: standalone)').matches) {
                console.log('PWA: Ïù¥ÎØ∏ ÏÑ§ÏπòÎêú Ïï±ÏóêÏÑú Ïã§Ìñâ Ï§ë');
                return false;
            }
            
            // iOS Safari ÌôïÏù∏
            const isIOS = /iPad|iPhone|iPod/.test(navigator.userAgent);
            const isInStandaloneMode = ('standalone' in window.navigator) && window.navigator.standalone;
            
            if (isIOS && !isInStandaloneMode) {
                console.log('PWA: iOS SafariÏóêÏÑú Ïã§Ìñâ Ï§ë - ÏàòÎèô ÏÑ§Ïπò Í∞ÄÏù¥Îìú ÌëúÏãú');
                showIOSInstallGuide();
                return false;
            }
            
            // ÏùºÎ∞òÏ†ÅÏù∏ Í≤ΩÏö∞ - beforeinstallprompt Ïù¥Î≤§Ìä∏ ÎåÄÍ∏∞ Ï§ë
            // 5Ï¥à ÌõÑÏóêÎèÑ Ïù¥Î≤§Ìä∏Í∞Ä ÏóÜÏúºÎ©¥ ÏàòÎèôÏúºÎ°ú Î≤ÑÌäº ÌëúÏãú
            setTimeout(() => {
                if (!deferredPrompt && !installButton) {
                    console.log('PWA: beforeinstallprompt Ïù¥Î≤§Ìä∏ ÏóÜÏùå - ÏàòÎèô Î≤ÑÌäº ÌëúÏãú');
                    showManualInstallButton();
                }
            }, 5000);
            
            return true;
        }

        // beforeinstallprompt Ïù¥Î≤§Ìä∏ Ï≤òÎ¶¨
        window.addEventListener('beforeinstallprompt', (e) => {
            console.log('PWA: beforeinstallprompt Ïù¥Î≤§Ìä∏ Î∞úÏÉù');
            e.preventDefault();
            deferredPrompt = e;
            showInstallButton();
        });

        // iOS SafariÏö© ÏÑ§Ïπò Í∞ÄÏù¥Îìú
        function showIOSInstallGuide() {
            const iosGuide = document.createElement('div');
            iosGuide.id = 'ios-install-guide';
            iosGuide.innerHTML = `
                <div style="
                    position: fixed;
                    top: 0;
                    left: 0;
                    right: 0;
                    background: #007acc;
                    color: white;
                    padding: 12px;
                    text-align: center;
                    font-size: 14px;
                    z-index: 9999;
                ">
                    üì± iOS ÏÑ§Ïπò: Safari Î©îÎâ¥ ‚Üí "Ìôà ÌôîÎ©¥Ïóê Ï∂îÍ∞Ä" 
                    <button onclick="this.parentElement.parentElement.remove()" style="
                        background: none;
                        border: none;
                        color: white;
                        font-size: 16px;
                        float: right;
                        cursor: pointer;
                    ">√ó</button>
                </div>
            `;
            document.body.appendChild(iosGuide);
        }

        // ÏûêÎèô ÏÑ§Ïπò Î≤ÑÌäº (beforeinstallprompt Ïù¥Î≤§Ìä∏ ÏûàÏùÑ Îïå)
        function showInstallButton() {
            createInstallButton('üì± Ïï± ÏÑ§Ïπò', async () => {
                if (deferredPrompt) {
                    try {
                        deferredPrompt.prompt();
                        const result = await deferredPrompt.userChoice;
                        
                        if (result.outcome === 'accepted') {
                            console.log('PWA: ÏÇ¨Ïö©ÏûêÍ∞Ä Ïï±ÏùÑ ÏÑ§ÏπòÌñàÏäµÎãàÎã§');
                        } else {
                            console.log('PWA: ÏÇ¨Ïö©ÏûêÍ∞Ä Ïï± ÏÑ§ÏπòÎ•º Í±∞Î∂ÄÌñàÏäµÎãàÎã§');
                        }
                        
                        deferredPrompt = null;
                        if (installButton) {
                            installButton.remove();
                            installButton = null;
                        }
                    } catch (error) {
                        console.error('PWA: ÏÑ§Ïπò Ï§ë Ïò§Î•ò:', error);
                    }
                }
            });
        }

        // ÏàòÎèô ÏÑ§Ïπò Î≤ÑÌäº (beforeinstallprompt Ïù¥Î≤§Ìä∏ ÏóÜÏùÑ Îïå)
        function showManualInstallButton() {
            createInstallButton('üì± ÏÑ§Ïπò Î∞©Î≤ï', () => {
                const isChrome = /Chrome/.test(navigator.userAgent);
                const isEdge = /Edge/.test(navigator.userAgent);
                
                let message = 'Ïù¥ Ïï±ÏùÑ ÏÑ§ÏπòÌïòÎ†§Î©¥:\\n\\n';
                
                if (isChrome) {
                    message += 'Chrome: Ï£ºÏÜåÏ∞Ω Ïò§Î•∏Ï™Ω "Ïï± ÏÑ§Ïπò" ÏïÑÏù¥ÏΩò ÌÅ¥Î¶≠';
                } else if (isEdge) {
                    message += 'Edge: Ï£ºÏÜåÏ∞Ω Ïò§Î•∏Ï™Ω "Ïï± ÏÑ§Ïπò" ÏïÑÏù¥ÏΩò ÌÅ¥Î¶≠';
                } else {
                    message += '1. Chrome ÎòêÎäî Edge Î∏åÎùºÏö∞Ï†Ä ÏÇ¨Ïö©\\n2. Ï£ºÏÜåÏ∞ΩÏóêÏÑú ÏÑ§Ïπò ÏòµÏÖò Ï∞æÍ∏∞\\n3. ÎòêÎäî Î∏åÎùºÏö∞Ï†Ä Î©îÎâ¥ÏóêÏÑú "Ïï± ÏÑ§Ïπò" ÏÑ†ÌÉù';
                }
                
                alert(message);
            });
        }

        // ÏÑ§Ïπò Î≤ÑÌäº ÏÉùÏÑ± Í≥µÌÜµ Ìï®Ïàò
        function createInstallButton(text, clickHandler) {
            if (installButton) return; // Ïù¥ÎØ∏ Ï°¥Ïû¨ÌïòÎ©¥ Ï§ëÎã®
            
            // Îç∞Ïä§ÌÅ¨ÌÜ±: Ìó§ÎçîÏóê Ï∂îÍ∞Ä
            const header = document.querySelector('.main-header') || document.querySelector('.sidebar-header');
            // Î™®Î∞îÏùº: ÌÉ≠ ÏòÅÏó≠Ïóê Ï∂îÍ∞Ä  
            const mobileTabs = document.querySelector('.mobile-tabs');
            const targetContainer = window.innerWidth <= 768 ? mobileTabs : header;
            
            if (targetContainer) {
                installButton = document.createElement('button');
                installButton.id = 'install-btn';
                installButton.innerHTML = text;
                installButton.style.cssText = `
                    background: #007acc;
                    color: white;
                    border: none;
                    padding: 8px 12px;
                    border-radius: 4px;
                    font-size: 12px;
                    cursor: pointer;
                    margin: 4px;
                    z-index: 1000;
                `;
                
                installButton.addEventListener('click', clickHandler);
                targetContainer.appendChild(installButton);
                
                console.log('PWA: ÏÑ§Ïπò Î≤ÑÌäº ÏÉùÏÑ±Îê®');
            }
        }

        // Ïï±Ïù¥ ÏÑ§ÏπòÎêòÎ©¥ ÏÑ§Ïπò Î≤ÑÌäº Ï†úÍ±∞
        window.addEventListener('appinstalled', () => {
            console.log('PWA: Ïï±Ïù¥ ÏÑ±Í≥µÏ†ÅÏúºÎ°ú ÏÑ§ÏπòÎêòÏóàÏäµÎãàÎã§');
            const installBtn = document.getElementById('install-btn');
            if (installBtn) {
                installBtn.remove();
            }
            deferredPrompt = null;
        });

        // Ï¥àÍ∏∞ ÌôîÎ©¥ Î†åÎçîÎßÅ - Firebase Ï¥àÍ∏∞Ìôî ÌõÑ Ïã§Ìñâ
        initializeApp().then(() => {
            initMobileTabs();
            initPracticeArea();
            handleResize(); // Ï¥àÍ∏∞ ÌôîÎ©¥ ÌÅ¨Í∏∞Ïóê Îî∞Î•∏ ÏÑ§Ï†ï
            
            // PWA ÏÑ§Ïπò Í∞ÄÎä•ÏÑ± ÌôïÏù∏
            setTimeout(() => {
                checkPWAInstallability();
            }, 2000); // 2Ï¥à ÌõÑ ÌôïÏù∏ (UI Î°úÎî© ÏôÑÎ£å ÌõÑ)
        });
    });
    </script>
</body>
</html>