<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ë¶ë§ˆí¬ í´ë¦½ë³´ë“œ ê´€ë¦¬ì</title>
    
    <!-- PWA Meta Tags -->
    <meta name="description" content="í”„ë¡œì íŠ¸ë³„ ë¶ë§ˆí¬ì™€ í´ë¦½ë³´ë“œë¥¼ íš¨ìœ¨ì ìœ¼ë¡œ ê´€ë¦¬í•˜ëŠ” PWA ì•±">
    <meta name="theme-color" content="#64b5f6">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="ë¶ë§ˆí¬ì•±">
    <meta name="msapplication-TileColor" content="#64b5f6">
    <meta name="msapplication-config" content="browserconfig.xml">
    
    <!-- PWA Manifest -->
    <link rel="manifest" href="manifest.json">
    
    <!-- PWA Icons -->
    <link rel="apple-touch-icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 192 192'><rect width='192' height='192' fill='%2337352f'/><text x='96' y='120' font-size='80' text-anchor='middle' fill='white'>ğŸ“‹</text></svg>">
    <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 192 192'><rect width='192' height='192' fill='%2337352f'/><text x='96' y='120' font-size='80' text-anchor='middle' fill='white'>ğŸ“‹</text></svg>">
    
    <!-- Firebase SDK v9 (ìµœì‹  ì•ˆì • ë²„ì „) -->
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
    
    <style>
        /* ê¸°ë³¸ ìŠ¤íƒ€ì¼ ë° ë ˆì´ì•„ì›ƒ ì„¤ì • */
        body, html {
            margin: 0;
            padding: 0;
            height: 100%;
            font-family: ui-sans-serif, -apple-system, BlinkMacSystemFont, "Segoe UI Variable Display", "Segoe UI", Helvetica, "Apple Color Emoji", Arial, sans-serif, "Segoe UI Emoji", "Segoe UI Symbol";
            background-color: #ffffff;
            color: #37352f;
            overflow: hidden;
            font-size: 14px;
            line-height: 1.5;
        }
        .app-container {
            display: flex;
            height: 100vh;
        }

        /* ì™¼ìª½ ì‚¬ì´ë“œë°” ìŠ¤íƒ€ì¼ */
        #project-sidebar {
            width: 240px;
            background-color: #f7f6f3;
            padding: 12px 0;
            border-right: 1px solid rgba(55, 53, 47, 0.09);
            overflow-y: auto;
            flex-shrink: 0;
        }
        .sidebar-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0 14px;
            margin-bottom: 8px;
        }
        
        #project-sidebar h3 {
            margin: 4px 0 0 0;
            color: rgba(55, 53, 47, 0.65);
            font-size: 12px;
            font-weight: 500;
            text-transform: uppercase;
            letter-spacing: 0.02em;
        }
        
        .add-project-btn {
            background-color: transparent;
            color: rgba(55, 53, 47, 0.45);
            border: none;
            border-radius: 3px;
            width: 20px;
            height: 20px;
            font-size: 14px;
            display: flex;
            justify-content: center;
            align-items: center;
            cursor: pointer;
            transition: background-color 0.1s ease-in-out, color 0.1s ease-in-out;
            padding: 0;
        }
        
        .add-project-btn:hover {
            background-color: rgba(55, 53, 47, 0.08);
            color: #37352f;
        }
        #project-list {
            list-style: none;
            padding: 0;
            margin: 0;
        }
        #project-list li {
            padding: 4px 14px;
            cursor: pointer;
            transition: background-color 0.1s ease-in-out;
            border-radius: 3px;
            margin: 1px 6px;
            font-size: 14px;
            color: #37352f;
            position: relative;
            min-height: 27px;
            display: flex;
            align-items: center;
        }
        #project-list li:hover {
            background-color: rgba(55, 53, 47, 0.08);
        }
        #project-list li.active {
            background-color: rgba(46, 170, 220, 0.15);
            color: #2ea2dc;
        }

        /* ë©”ì¸ ì˜ì—­ ìŠ¤íƒ€ì¼ */
        .main-area {
            flex-grow: 1;
            display: flex;
            flex-direction: column;
            overflow-y: auto;
        }

        /* ë©”ì¸ ì½˜í…ì¸  ì˜ì—­ ìŠ¤íƒ€ì¼ */
        .main-content {
            flex-grow: 1;
            display: flex;
            flex-direction: column;
            padding: 24px 20px;
            width: 100%;
            height: calc(100vh - 60px);
            box-sizing: border-box;
        }
        .content-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 16px 32px;
            background: linear-gradient(135deg, #64b5f6 0%, #81c784 100%);
            border-radius: 0;
            box-shadow: 0 2px 8px rgba(100, 181, 246, 0.15);
            border-bottom: 3px solid #42a5f5;
            width: 100%;
            box-sizing: border-box;
        }
        .content-header h1 {
            font-size: 28px;
            line-height: 1.2;
            font-weight: 700;
            color: #ffffff;
            margin: 0;
            letter-spacing: -0.01em;
            text-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
        }
        .content-header .icon-button {
            color: rgba(255, 255, 255, 0.8);
            background-color: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        .content-header .icon-button:hover {
            color: #ffffff;
            background-color: rgba(255, 255, 255, 0.2);
            border-color: rgba(255, 255, 255, 0.3);
        }
        .content-panels {
            display: flex;
            gap: 16px;
            flex-grow: 1;
            margin-top: 0;
            justify-content: flex-start;
            align-items: stretch;
            height: 100%;
        }
        .content-panel {
            flex: 0 0 400px;
            max-width: 400px;
            background-color: #ffffff;
            padding: 12px;
            border-radius: 6px;
            border: 2px solid #2c2c2c;
            overflow-y: auto;
            box-shadow: rgba(15, 15, 15, 0.1) 0px 2px 4px;
        }
        .content-panel h4 {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin: -12px -12px 12px -12px;
            padding: 12px;
            background-color: #f8f9fa;
            border-bottom: 1px solid #dee2e6;
            border-radius: 4px 4px 0 0;
            font-size: 16px;
            font-weight: 600;
            color: #37352f;
            line-height: 1.3;
        }

        .bookmark-header {
            background-color: #e8d5f2 !important;
            border-bottom: 1px solid #b19cd9 !important;
            color: #6a4c93 !important;
            display: flex !important;
            align-items: center !important;
            margin: -12px -12px 12px -12px !important;
            padding: 12px !important;
            border-radius: 4px 4px 0 0 !important;
            font-size: 16px !important;
            font-weight: 600 !important;
            line-height: 1.3 !important;
        }
        .bookmark-header #add-bookmark-btn {
            margin-left: auto !important;
            margin-right: 4px !important;
        }
        
        .bookmark-header #add-bookmark-divider-btn {
            margin-left: 0 !important;
        }

        .clipboard-header {
            background-color: #d4edda !important;
            border-bottom: 1px solid #a3d5a3 !important;
            color: #28a745 !important;
            display: flex !important;
            align-items: center !important;
            margin: -12px -12px 12px -12px !important;
            padding: 12px !important;
            border-radius: 4px 4px 0 0 !important;
            font-size: 16px !important;
            font-weight: 600 !important;
            line-height: 1.3 !important;
        }
        .clipboard-header #add-clipboard-btn {
            margin-left: auto !important;
            margin-right: 4px !important;
        }
        
        .clipboard-header #add-divider-btn {
            margin-left: 0 !important;
        }
        .practice-header {
            background-color: #fff3cd !important;
            border-bottom: 1px solid #ffc107 !important;
            color: #ff8c00 !important;
            display: flex !important;
            justify-content: space-between !important;
            align-items: center !important;
            margin: -12px -12px 12px -12px !important;
            padding: 12px !important;
            border-radius: 4px 4px 0 0 !important;
            font-size: 16px !important;
            font-weight: 600 !important;
            line-height: 1.3 !important;
        }
        
        /* ì—°ìŠµì¥ íƒ­ ìŠ¤íƒ€ì¼ */
        .practice-tabs {
            display: flex;
            gap: 4px;
        }
        
        .practice-tab {
            min-width: 40px;
            height: 36px;
            border: 2px solid #ffc107;
            background-color: #fff3cd;
            color: #ff8c00;
            border-radius: 6px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            /* í„°ì¹˜ ì¹œí™”ì  ì„¤ì • */
            touch-action: manipulation;
            user-select: none;
            -webkit-tap-highlight-color: transparent;
        }
        
        .practice-tab:hover {
            background-color: #ffe69c;
            transform: translateY(-1px);
            box-shadow: 0 2px 4px rgba(255, 140, 0, 0.2);
        }
        
        .practice-tab:active {
            transform: translateY(0);
            box-shadow: 0 1px 2px rgba(255, 140, 0, 0.3);
        }
        
        .practice-tab.active {
            background-color: #ff8c00;
            color: white;
            border-color: #e07b00;
            box-shadow: 0 2px 6px rgba(255, 140, 0, 0.3);
        }
        
        .practice-tab.active:hover {
            background-color: #e07b00;
        }
        
        /* ëª¨ë°”ì¼ í„°ì¹˜ ìµœì í™” */
        @media (hover: none) and (pointer: coarse) {
            .practice-tab {
                min-width: 44px;
                height: 44px;
                font-size: 18px;
            }
            
            .practice-tab:hover {
                transform: none;
                background-color: #fff3cd;
            }
            
            .practice-tab:active {
                background-color: #ffe69c;
                transform: scale(0.95);
            }
        }
        
        .header-spacer {
            width: 33px;
            height: 33px;
            display: inline-block;
        }
        .practice-container {
            display: flex;
            flex-direction: column;
            height: calc(100% - 60px);
        }
        .practice-text {
            width: 100%;
            flex: 1;
            border: 1px solid #ddd;
            border-radius: 4px;
            padding: 12px;
            font-family: inherit;
            font-size: 14px;
            resize: none;
            box-sizing: border-box;
            background-color: #ffffff;
            margin-bottom: 8px;
        }
        .practice-text:focus {
            outline: none;
            border-color: #ff8c00;
            box-shadow: 0 0 0 2px rgba(255, 140, 0, 0.1);
        }
        .practice-buttons {
            display: flex;
            justify-content: flex-end;
            gap: 8px;
        }
        .practice-btn {
            padding: 6px 12px;
            border: 1px solid #ff8c00;
            border-radius: 4px;
            background-color: #ffffff;
            color: #ff8c00;
            cursor: pointer; /* ê¸°ë³¸ í¬ì¸í„° ìœ ì§€ */
            font-size: 12px;
            transition: all 0.2s;
        }
        .practice-btn:hover {
            background-color: #ff8c00;
            color: #ffffff;
        }
        .add-section-btn {
            background-color: transparent;
            color: rgba(55, 53, 47, 0.8);
            border: 2px solid #000000;
            border-radius: 50%;
            width: 33px;
            height: 33px;
            font-size: 18px;
            display: flex;
            justify-content: center;
            align-items: center;
            cursor: crosshair; /* ìƒì„±/ì¶”ê°€ ëŠë‚Œ */
            flex-shrink: 0;
            margin-left: 6px;
            transition: all 0.2s ease;
        }
        .add-section-btn:hover {
            background-color: rgba(0, 0, 0, 0.1);
            color: #000000;
            border-color: #000000;
            transform: scale(1.05);
        }
        .icon-button {
            background: none;
            border: none;
            font-size: 16px;
            cursor: pointer;
            color: rgba(55, 53, 47, 0.45);
            padding: 4px;
            border-radius: 3px;
            transition: background-color 0.1s ease-in-out, color 0.1s ease-in-out;
            width: 28px;
            height: 28px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .icon-button:hover {
            background-color: rgba(55, 53, 47, 0.08);
            color: #37352f;
        }
        .item-list {
            display: flex;
            flex-wrap: wrap;
            gap: 6px;
            list-style: none;
            padding: 0;
            margin: 0;
            word-break: break-all; /* ê¸´ URLë„ ì¤„ë°”ê¿ˆ */
        }
        .item-button {
            flex-shrink: 0;
            min-width: 80px;
            max-width: 200px;
            height: 32px;
            background-color: #f8f9fa;
            padding: 6px 8px;
            border-radius: 3px;
            border: 2px solid #000;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 14px;
            color: #37352f;
            cursor: pointer;
            overflow: hidden;
            white-space: nowrap;
            text-overflow: ellipsis;
            transition: background-color 0.1s ease-in-out;
            box-sizing: border-box;
            font-weight: bold;
            color: #000000;
        }
        .item-button:hover {
            background-color: rgba(55, 53, 47, 0.08);
        }
        .item-button.bookmark-button {
            color: #000000;
            background-color: rgba(46, 170, 220, 0.1);
            cursor: alias; /* ë§í¬/ë°”ë¡œê°€ê¸° ëŠë‚Œ */
        }
        .item-button.bookmark-button:hover {
            background-color: rgba(46, 170, 220, 0.2);
        }
        .item-button.clipboard-button {
            color: #000000;
            background-color: rgba(100, 71, 58, 0.1);
            cursor: copy; /* ë³µì‚¬ ê¸°ëŠ¥ ê°•ì¡° */
        }
        
        /* êµ¬ë¶„ì„  ìŠ¤íƒ€ì¼ */
        .divider {
            width: 100%;
            height: 6px;
            background-color: rgba(55, 53, 47, 0.3);
            margin: 8px 0;
            border-radius: 3px;
            cursor: move; /* ì´ë™ ê°€ëŠ¥ ëŠë‚Œ */
            position: relative;
        }
        
        .divider[data-type="bookmark"] {
            background: linear-gradient(90deg, #b19cd9, #6a4c93);
        }
        
        .divider[data-type="clipboard"] {
            background: linear-gradient(90deg, #a3d5a3, #28a745);
        }
        
        .divider:hover {
            opacity: 0.8;
        }
        
        .divider[data-type="bookmark"]:hover {
            background: linear-gradient(90deg, #9b7bb8, #5a3d7a);
        }
        
        .divider[data-type="clipboard"]:hover {
            background: linear-gradient(90deg, #8cc48c, #1e7e34);
        }
        
        .divider.dragging {
            opacity: 0.5;
        }
        

        /* Context Menu Styles */
        .context-menu {
            display: none;
            position: fixed;
            background-color: #ffffff;
            border: 1px solid rgba(55, 53, 47, 0.16);
            box-shadow: rgba(15, 15, 15, 0.05) 0px 0px 0px 1px, rgba(15, 15, 15, 0.1) 0px 3px 6px, rgba(15, 15, 15, 0.2) 0px 9px 24px;
            z-index: 2000;
            border-radius: 6px;
            overflow: hidden;
            min-width: 180px;
        }

        .context-menu ul {
            list-style: none;
            padding: 6px 0;
            margin: 0;
        }

        .context-menu ul li {
            padding: 8px 14px;
            cursor: pointer;
            font-size: 14px;
            color: #37352f;
            border-bottom: none;
            transition: background-color 0.1s ease-in-out;
            line-height: 1.3;
        }

        .context-menu ul li:hover,
        .context-menu ul li:active {
            background-color: rgba(55, 53, 47, 0.08);
        }
        
        /* ëª¨ë°”ì¼ì—ì„œ í„°ì¹˜ ë°˜ì‘ì„± ê°œì„  */
        @media (hover: none) and (pointer: coarse) {
            .context-menu ul li {
                padding: 14px 16px;
                font-size: 16px;
            }
        }

        /* Modal Styles */
        .modal {
            display: none;
            position: fixed;
            z-index: 1001;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(15, 15, 15, 0.6);
            justify-content: center;
            align-items: center;
        }

        .modal-content {
            background-color: #ffffff;
            margin: auto;
            padding: 60px;
            border: none;
            width: 90%;
            max-width: 720px;
            border-radius: 8px;
            box-shadow: rgba(15, 15, 15, 0.05) 0px 0px 0px 1px, rgba(15, 15, 15, 0.1) 0px 3px 6px, rgba(15, 15, 15, 0.2) 0px 9px 24px;
            position: relative;
        }

        .close-button {
            color: rgba(55, 53, 47, 0.45);
            float: right;
            font-size: 20px;
            font-weight: 400;
            position: absolute;
            right: 20px;
            top: 20px;
            cursor: pointer;
            padding: 4px;
            border-radius: 3px;
            transition: background-color 0.1s ease-in-out, color 0.1s ease-in-out;
        }

        .close-button:hover,
        .close-button:focus {
            background-color: rgba(55, 53, 47, 0.08);
            color: #37352f;
            text-decoration: none;
        }

        .modal-content h2 {
            margin: 0 0 24px 0;
            color: #37352f;
            border-bottom: none;
            padding-bottom: 0;
            font-size: 20px;
            font-weight: 600;
            line-height: 1.3;
        }

        .settings-section {
            margin-bottom: 24px;
            padding-bottom: 20px;
            border-bottom: 1px solid rgba(55, 53, 47, 0.09);
        }

        .settings-section:last-child {
            border-bottom: none;
        }

        .settings-section h3 {
            color: #37352f;
            margin: 0 0 12px 0;
            font-size: 16px;
            font-weight: 600;
        }

        .action-button {
            background-color: #2ea2dc;
            color: white;
            padding: 8px 12px;
            border: none;
            border-radius: 3px;
            cursor: pointer;
            font-size: 14px;
            margin-right: 8px;
            margin-bottom: 8px;
            transition: background-color 0.1s ease-in-out;
            font-weight: 500;
        }

        .action-button:hover {
            background-color: #1e8bb8;
        }

        .settings-section label {
            margin-right: 8px;
            font-size: 14px;
            color: #37352f;
            font-weight: 400;
        }

        .settings-section select,
        .settings-section input[type="checkbox"] {
            margin-top: 4px;
        }

        .settings-section select {
            padding: 6px 8px;
            border: 1px solid rgba(55, 53, 47, 0.25);
            border-radius: 3px;
            background-color: #ffffff;
            color: #37352f;
            font-size: 14px;
        }

        /* Modal Form Specific Styles */
        .modal-form-group {
            margin-bottom: 16px;
        }

        .modal-form-group label {
            display: block;
            margin-bottom: 6px;
            font-weight: 500;
            color: #37352f;
            font-size: 14px;
        }

        .modal-form-group input[type="text"],
        .modal-form-group textarea {
            width: 100%;
            padding: 8px 12px;
            border: 1px solid rgba(55, 53, 47, 0.25);
            border-radius: 3px;
            font-size: 14px;
            box-sizing: border-box;
            color: #37352f;
            background-color: #ffffff;
            transition: border-color 0.1s ease-in-out, box-shadow 0.1s ease-in-out;
        }

        .modal-form-group input[type="text"]:focus,
        .modal-form-group textarea:focus {
            outline: none;
            border-color: #2ea2dc;
            box-shadow: rgba(46, 170, 220, 0.15) 0px 0px 0px 1px;
        }

        .modal-form-group textarea {
            resize: vertical;
            min-height: 360px;
            font-family: inherit;
            line-height: 1.5;
        }

        .modal-actions {
            text-align: right;
            margin-top: 24px;
        }

        .secondary-button {
            background-color: rgba(55, 53, 47, 0.09);
            color: #37352f;
        }

        .secondary-button:hover {
            background-color: rgba(55, 53, 47, 0.16);
        }

        /* Template Popup Modal Styles */
        #template-popup-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 24px;
        }

        #template-popup-title {
            margin: 0;
            flex: 1;
        }


        #template-popup-content {
            background-color: rgba(55, 53, 47, 0.04);
            border-radius: 6px;
            padding: 16px;
            margin-bottom: 24px;
            font-family: ui-monospace, SFMono-Regular, "SF Mono", Menlo, Consolas, "Liberation Mono", monospace;
            font-size: 14px;
            line-height: 1.6;
            color: #37352f;
            white-space: pre-wrap;
            word-wrap: break-word;
            max-height: 400px;
            overflow-y: auto;
            border: 1px solid rgba(55, 53, 47, 0.09);
        }

        /* Color Palette Styles */
        .color-palette-grid {
            display: grid;
            grid-template-columns: repeat(6, 1fr);
            gap: 8px;
            margin-top: 16px;
        }

        .color-option {
            width: 40px;
            height: 40px;
            border-radius: 6px;
            cursor: pointer;
            border: 2px solid transparent;
            transition: border-color 0.1s ease-in-out, transform 0.1s ease-in-out;
            position: relative;
        }

        .color-option:hover {
            border-color: rgba(55, 53, 47, 0.25);
            transform: scale(1.05);
        }

        .color-option.selected {
            border-color: #2ea2dc;
            box-shadow: 0 0 0 1px #2ea2dc;
        }

        .color-option::after {
            content: attr(title);
            position: absolute;
            bottom: -24px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 11px;
            color: rgba(55, 53, 47, 0.65);
            white-space: nowrap;
            opacity: 0;
            transition: opacity 0.1s ease-in-out;
        }

        .color-option:hover::after {
            opacity: 1;
        }

        /* Dashboard Styles */
        .dashboard-area {
            flex: 0 0 300px;
            padding: 0;
            display: flex;
            flex-direction: column;
            gap: 16px;
            max-width: 300px;
        }

        .dashboard-widget {
            background-color: #ffffff;
            border: 1px solid rgba(55, 53, 47, 0.16);
            border-radius: 6px;
            overflow: hidden;
        }

        .dashboard-header {
            background-color: #f1f3f4;
            color: #37352f;
            font-size: 14px;
            font-weight: 600;
            padding: 12px;
            margin: 0;
            border-bottom: 1px solid rgba(55, 53, 47, 0.1);
        }

        .dashboard-content {
            padding: 12px;
            max-height: 200px;
            overflow-y: auto;
        }

        /* í…œí”Œë¦¿ ê´€ë¦¬ ìŠ¤íƒ€ì¼ */
        .template-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            background-color: #f1f3f4;
            border-bottom: 1px solid rgba(55, 53, 47, 0.1);
            padding: 12px;
        }

        .template-header h4 {
            margin: 0;
            padding: 0;
            border: none;
            background: none;
            color: #37352f;
            font-size: 14px;
            font-weight: 600;
        }

        .template-toolbar {
            display: flex;
            gap: 8px;
            align-items: center;
        }

        .template-btn {
            background-color: #64b5f6;
            color: white;
            border: none;
            border-radius: 4px;
            padding: 6px 12px;
            font-size: 12px;
            font-weight: 500;
            cursor: pointer;
            transition: background-color 0.2s;
        }

        .template-btn:hover {
            background-color: #42a5f5;
        }

        .template-select {
            background-color: white;
            border: 1px solid rgba(55, 53, 47, 0.2);
            border-radius: 4px;
            padding: 6px 8px;
            font-size: 12px;
            color: #37352f;
            cursor: pointer;
        }

        .template-card {
            border: 1px solid rgba(55, 53, 47, 0.1);
            border-radius: 6px;
            background-color: #ffffff;
            margin-bottom: 8px;
            transition: box-shadow 0.2s;
            cursor: pointer;
        }

        .template-card:hover {
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }

        .template-card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px;
            border-bottom: 1px solid rgba(55, 53, 47, 0.1);
        }

        .template-title {
            font-size: 13px;
            font-weight: 500;
            color: #37352f;
            margin: 0;
        }

        .template-actions {
            display: flex;
            gap: 6px;
        }

        .template-action-btn {
            background-color: transparent;
            border: 1px solid rgba(55, 53, 47, 0.2);
            border-radius: 3px;
            padding: 4px 8px;
            font-size: 11px;
            color: #37352f;
            cursor: pointer;
            transition: all 0.2s;
        }

        .template-action-btn:hover {
            background-color: #f1f3f4;
        }

        .template-action-btn.copy-btn:hover {
            background-color: #e3f2fd;
            border-color: #64b5f6;
            color: #1976d2;
        }

        .template-action-btn.delete-btn:hover {
            background-color: #ffebee;
            border-color: #f44336;
            color: #d32f2f;
        }



        .template-usage {
            text-align: right;
            font-size: 10px;
            color: rgba(55, 53, 47, 0.5);
            padding: 4px 12px;
        }

        /* ë³€ìˆ˜ ì…ë ¥ ë²„íŠ¼ë“¤ */
        .variable-buttons {
            display: flex;
            flex-wrap: wrap;
            gap: 6px;
            margin-bottom: 8px;
            padding: 8px;
            background-color: #f8f9fa;
            border-radius: 4px;
        }

        .variable-btn {
            background-color: #e3f2fd;
            color: #1976d2;
            border: 1px solid #bbdefb;
            border-radius: 3px;
            padding: 4px 8px;
            font-size: 11px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
        }

        .variable-btn:hover {
            background-color: #bbdefb;
            border-color: #90caf9;
        }

        .variable-btn:active {
            background-color: #90caf9;
            transform: translateY(1px);
        }

        .empty-var-btn {
            background-color: #f0f0f0 !important;
            color: #666 !important;
            border-color: #ccc !important;
        }

        .empty-var-btn:hover {
            background-color: #e0e0e0 !important;
            border-color: #999 !important;
        }

        .favorite-item {
            padding: 8px 12px;
            margin-bottom: 6px;
            background-color: #f8f9fa;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.2s ease-in-out;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
            font-size: 13px;
            font-weight: 500;
            text-align: center;
        }

        .favorite-item:hover {
            background-color: rgba(55, 53, 47, 0.08);
            transform: translateY(-1px);
        }

        .favorite-item.bookmark-fav {
            background-color: rgba(46, 170, 220, 0.15);
        }

        .favorite-item.clipboard-fav {
            background-color: rgba(100, 71, 58, 0.15);
        }
        
        /* ë¶ë§ˆí¬ ì¦ê²¨ì°¾ê¸° - 2ì—´ ê·¸ë¦¬ë“œ */
        #bookmark-favorites-list {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 6px;
        }
        
        /* í´ë¦½ë³´ë“œ ì¦ê²¨ì°¾ê¸° - ë™ì  í”Œë ‰ìŠ¤ë°•ìŠ¤ */
        #clipboard-favorites-list {
            display: flex;
            flex-wrap: wrap;
            gap: 6px;
        }
        
        #clipboard-favorites-list .favorite-item {
            flex: 0 0 auto;
            min-width: 60px;
            max-width: 180px;
        }

        .favorite-icon {
            margin-right: 6px;
            font-size: 12px;
        }

        .stat-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 4px 0;
            font-size: 13px;
        }

        .stat-label {
            color: rgba(55, 53, 47, 0.8);
        }

        .stat-value {
            font-weight: 600;
            color: #37352f;
        }

        .activity-placeholder {
            text-align: center;
            color: rgba(55, 53, 47, 0.5);
            font-size: 12px;
            padding: 20px 0;
        }

        /* Drag and Drop Styles */
        .draggable {
            cursor: move;
            transition: opacity 0.2s ease;
        }

        .dragging {
            opacity: 0.5;
            transform: rotate(2deg);
        }

        .drag-over {
            background-color: rgba(59, 130, 246, 0.1) !important;
            border: 2px dashed #3b82f6 !important;
        }

        .drop-zone {
            min-height: 50px;
            transition: background-color 0.2s ease, border 0.2s ease;
        }

        .project-item.drag-over {
            background-color: rgba(59, 130, 246, 0.1);
            border-left: 4px solid #3b82f6;
        }

        /* Custom Tooltip Styles */
        .custom-tooltip {
            position: absolute;
            background-color: #37352f;
            color: #ffffff;
            padding: 8px 12px;
            border-radius: 6px;
            font-size: 13px;
            white-space: nowrap;
            z-index: 1000;
            pointer-events: none;
            opacity: 0;
            transition: opacity 0.2s ease-in-out;
            box-shadow: rgba(15, 15, 15, 0.1) 0px 3px 6px, rgba(15, 15, 15, 0.2) 0px 9px 24px;
            max-width: 300px;
            white-space: normal;
            word-wrap: break-word;
            line-height: 1.4;
        }

        .custom-tooltip.show {
            opacity: 1;
        }

        .custom-tooltip::before {
            content: '';
            position: absolute;
            top: 100%;
            left: 50%;
            transform: translateX(-50%);
            border: 5px solid transparent;
            border-top-color: #37352f;
        }

        .custom-tooltip.bottom::before {
            top: -10px;
            border-top-color: transparent;
            border-bottom-color: #37352f;
        }

        /* ëª¨ë°”ì¼ íƒ­ ë„¤ë¹„ê²Œì´ì…˜ */
        .mobile-tabs {
            display: none;
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background-color: #ffffff;
            border-top: 1px solid rgba(55, 53, 47, 0.16);
            z-index: 1000;
            height: 60px;
            box-shadow: 0 -2px 10px rgba(0, 0, 0, 0.1);
        }

        .mobile-tab {
            flex: 1;
            background: none;
            border: none;
            padding: 8px 4px;
            font-size: 11px;
            color: rgba(55, 53, 47, 0.6);
            cursor: pointer;
            transition: color 0.2s ease;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            gap: 2px;
        }

        .mobile-tab.active {
            color: #2ea2dc;
            font-weight: 600;
        }

        .mobile-tab:hover {
            color: #37352f;
        }

        /* ëª¨ë°”ì¼ ë°˜ì‘í˜• ë””ìì¸ */
        @media (max-width: 768px) {
            .mobile-tabs {
                display: flex;
            }

            body {
                padding-bottom: 60px; /* íƒ­ ë„¤ë¹„ê²Œì´ì…˜ ê³µê°„ í™•ë³´ */
            }

            .app-container {
                flex-direction: column;
                height: calc(100vh - 60px);
            }

            /* ë°ìŠ¤í¬í†± ì‚¬ì´ë“œë°” ìˆ¨ê¹€ */
            #project-sidebar {
                display: none;
            }

            #project-sidebar.mobile-visible {
                display: block;
                width: 100%;
                height: 100%;
                border-right: none;
                border-bottom: 1px solid rgba(55, 53, 47, 0.09);
            }

            .main-area {
                width: 100%;
                height: 100%;
            }

            .main-content {
                height: calc(100% - 60px); /* í—¤ë” ë†’ì´ ì œì™¸ */
                padding: 12px 8px; /* ì¢Œìš° íŒ¨ë”© ì¤„ì„ */
            }

            .content-panels {
                flex-direction: column;
                height: 100%;
                gap: 0;
            }

            .content-panel {
                flex: none;
                max-width: none;
                width: calc(100% - 8px); /* íŒ¨ë”© ê³ ë ¤ */
                margin-bottom: 16px;
                min-height: 200px;
                padding: 12px 8px; /* ë‚´ë¶€ íŒ¨ë”© ì¡°ì • */
                box-sizing: border-box;
            }

            /* ëª¨ë°”ì¼ì—ì„œ ê° íŒ¨ë„ë³„ í‘œì‹œ/ìˆ¨ê¹€ */
            .content-panel.bookmark-panel {
                display: none;
            }

            .content-panel.bookmark-panel.mobile-visible {
                display: block;
                height: calc(100% - 32px);
                margin-bottom: 0;
            }

            .content-panel.clipboard-panel {
                display: none;
            }

            .content-panel.clipboard-panel.mobile-visible {
                display: block;
                height: calc(100% - 32px);
                margin-bottom: 0;
            }

            .content-panel.practice-panel {
                display: none;
            }

            .content-panel.practice-panel.mobile-visible {
                display: block;
                height: calc(100% - 32px);
                margin-bottom: 0;
            }

            .dashboard-area {
                display: none;
                flex: none;
                max-width: none;
                width: 100%;
                height: calc(100% - 32px);
                padding: 12px 8px; /* ì¢Œìš° íŒ¨ë”© ì¤„ì„ */
                overflow-y: auto;
                box-sizing: border-box;
            }

            .dashboard-area.mobile-visible {
                display: flex;
                flex-direction: column;
                align-items: center; /* ì¤‘ì•™ ì •ë ¬ */
                gap: 16px;
            }
            
            /* ëª¨ë°”ì¼ì—ì„œ ëŒ€ì‹œë³´ë“œ ìœ„ì ¯ ìŠ¤íƒ€ì¼ ì¡°ì • */
            .dashboard-area.mobile-visible .dashboard-widget {
                width: 100%;
                max-width: calc(100vw - 32px); /* í™”ë©´ ë„ˆë¹„ì— ë§ì¶¤, ì¢Œìš° ì—¬ë°± ê³ ë ¤ */
                margin: 0 auto;
                box-sizing: border-box;
            }
            
            .dashboard-area.mobile-visible .dashboard-content {
                padding: 12px;
                word-wrap: break-word;
            }
            
            .dashboard-area.mobile-visible .favorites-item {
                margin-bottom: 8px;
                padding: 8px;
                word-break: break-all; /* ê¸´ URLë„ ì¤„ë°”ê¿ˆ */
            }

            /* ëª¨ë°”ì¼ì—ì„œ ë²„íŠ¼ í¬ê¸° ì¡°ì • */
            .item-button {
                min-width: 100px;
                max-width: calc(100vw - 40px); /* í™”ë©´ ë„ˆë¹„ì— ë§ì¶¤ */
                height: auto; /* ë†’ì´ ìë™ ì¡°ì • */
                min-height: 36px;
                font-size: 13px;
                margin: 4px;
                word-wrap: break-word;
                white-space: normal; /* í…ìŠ¤íŠ¸ ì¤„ë°”ê¿ˆ í—ˆìš© */
                padding: 8px;
                line-height: 1.3;
                transition: transform 0.1s ease, background-color 0.3s ease;
            }
            
            /* ëª¨ë°”ì¼ì—ì„œ ê¸¸ê²Œ ëˆ„ë¥´ê¸° í”¼ë“œë°± */
            .item-button.long-press-active,
            .project-item.long-press-active {
                transform: scale(0.95);
                background-color: rgba(55, 53, 47, 0.15) !important;
            }
            
            /* ëª¨ë°”ì¼ í„°ì¹˜ ìµœì í™” */
            .item-button, .project-item {
                -webkit-touch-callout: none;
                -webkit-user-select: none;
                user-select: none;
            }

            /* ëª¨ë°”ì¼ì—ì„œ ì¶”ê°€ ë²„íŠ¼ í¬ê¸° ì¡°ì • */
            .add-section-btn {
                width: 36px;
                height: 36px;
                font-size: 20px;
            }

            /* ëª¨ë°”ì¼ì—ì„œ í—¤ë” í¬ê¸° ì¡°ì • */
            .content-header {
                padding: 12px 16px;
                min-height: 48px;
            }

            .content-header h1 {
                font-size: 20px;
            }

            /* ëª¨ë°”ì¼ì—ì„œ ëª¨ë‹¬ í¬ê¸° ì¡°ì • */
            .modal-content {
                width: 95%;
                max-width: 600px;
                margin: 20px;
                padding: 40px;
            }

            /* íˆ´íŒ ëª¨ë°”ì¼ ìµœì í™” */
            .custom-tooltip {
                max-width: 280px;
                font-size: 12px;
            }

            /* ëŒ€ì‹œë³´ë“œ ìœ„ì ¯ ëª¨ë°”ì¼ ìµœì í™” */
            .dashboard-widget {
                margin-bottom: 16px;
            }

            .dashboard-content {
                max-height: 300px;
            }

            /* ì»¨í…ìŠ¤íŠ¸ ë©”ë‰´ ëª¨ë°”ì¼ ìµœì í™” */
            .context-menu {
                min-width: 150px;
            }

            .context-menu ul li {
                padding: 12px 16px;
                font-size: 14px;
            }
        }

        /* íƒœë¸”ë¦¿ ì‚¬ì´ì¦ˆ */
        @media (max-width: 1024px) and (min-width: 769px) {
            #project-sidebar {
                width: 200px;
            }

            .content-panel {
                flex: 0 0 300px;
                max-width: 300px;
            }

            .dashboard-area {
                max-width: 250px;
            }
        }
    </style>
</head>
<body>
    <!-- ëª¨ë°”ì¼ íƒ­ ë„¤ë¹„ê²Œì´ì…˜ -->
    <div class="mobile-tabs">
        <button class="mobile-tab active" data-tab="projects">ğŸ“ í”„ë¡œì íŠ¸</button>
        <button class="mobile-tab" data-tab="clipboard">ğŸ“‹ í´ë¦½ë³´ë“œ</button>
        <button class="mobile-tab" data-tab="practice">ğŸ“ ì—°ìŠµì¥</button>
        <button class="mobile-tab" data-tab="bookmarks">ğŸ“Œ ë¶ë§ˆí¬</button>
        <button class="mobile-tab" data-tab="dashboard">ğŸ“Š ëŒ€ì‹œë³´ë“œ</button>
    </div>

    <div class="app-container">
        <div id="project-sidebar">
            <div class="sidebar-header">
                <h3>í”„ë¡œì íŠ¸</h3>
                <button id="add-project-btn" class="add-project-btn">+</button>
            </div>
            <ul id="project-list">
            </ul>
        </div>

        <div class="main-area">
            <div class="content-header">
                <h1 id="current-project-title"></h1>
                <button id="settings-btn" class="icon-button">âš™ï¸</button>
            </div>
            
            <div class="main-content">
                <div class="content-panels">
                <div class="content-panel bookmark-panel">
                    <h4 class="bookmark-header">ë¶ë§ˆí¬ <button id="add-bookmark-btn" class="add-section-btn">+</button> <button id="add-bookmark-divider-btn" class="add-section-btn">|</button></h4>
                    <ul id="bookmark-list" class="item-list"></ul>
                </div>

                <div class="content-panel clipboard-panel">
                    <h4 class="clipboard-header">í´ë¦½ë³´ë“œ <button id="add-clipboard-btn" class="add-section-btn">+</button> <button id="add-divider-btn" class="add-section-btn">|</button></h4>
                    <ul id="clipboard-list" class="item-list"></ul>
                </div>
                
                <div class="content-panel practice-panel">
                    <h4 class="practice-header">ì—°ìŠµì¥ <div class="practice-tabs">
                        <button class="practice-tab active" data-tab="1">1</button>
                        <button class="practice-tab" data-tab="2">2</button>
                        <button class="practice-tab" data-tab="3">3</button>
                        <button class="practice-tab" data-tab="4">4</button>
                        <button class="practice-tab" data-tab="5">5</button>
                    </div></h4>
                    <div class="practice-container">
                        <textarea id="practice-textarea" class="practice-text" placeholder="ììœ ë¡­ê²Œ í…ìŠ¤íŠ¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”..."></textarea>
                        <div class="practice-buttons">
                            <button id="copy-practice-btn" class="practice-btn">ë³µì‚¬</button>
                            <button id="clear-practice-btn" class="practice-btn">ì´ˆê¸°í™”</button>
                        </div>
                    </div>
                </div>
                
                <div class="dashboard-area">
                <div class="dashboard-widget">
                    <div class="template-header">
                        <h4 class="dashboard-header">ğŸ“ í…œí”Œë¦¿ ê´€ë¦¬</h4>
                        <div class="template-toolbar">
                            <button id="add-template-btn" class="template-btn">+ ìƒˆ í…œí”Œë¦¿</button>
                        </div>
                    </div>
                    <div id="template-list" class="dashboard-content"></div>
                </div>
                </div>
            </div>
        </div>
        </div>
    </div>

    <!-- Settings Modal -->
    <div id="settings-modal" class="modal">
        <div class="modal-content">
            <span class="close-button">&times;</span>
            <h2>ì„¤ì •</h2>
            
            <div class="settings-section">
                <h3>ë°ì´í„° ê´€ë¦¬</h3>
                <button id="export-data-btn" class="action-button">ë°ì´í„° ë‚´ë³´ë‚´ê¸° (JSON)</button>
                <input type="file" id="import-data-input" accept=".json" style="display: none;">
                <button id="import-data-btn" class="action-button">ë°ì´í„° ë¶ˆëŸ¬ì˜¤ê¸° (JSON)</button>
            </div>

            <div class="settings-section">
                <h3>ë¶ë§ˆí¬ ì„¤ì •</h3>
                <label for="link-target-select">ë§í¬ ì—´ê¸° ë°©ì‹:</label>
                <select id="link-target-select">
                    <option value="_blank">ìƒˆ íƒ­</option>
                    <option value="_self">í˜„ì¬ íƒ­</option>
                </select>
            </div>

            <div class="settings-section">
                <h3>í´ë¦½ë³´ë“œ ì„¤ì •</h3>
                <input type="checkbox" id="copy-alert-checkbox">
                <label for="copy-alert-checkbox">ë³µì‚¬ ì™„ë£Œ ì•Œë¦¼ í‘œì‹œ</label>
            </div>
        </div>
    </div>

    <!-- Add Bookmark Modal -->
    <div id="add-bookmark-modal" class="modal">
        <div class="modal-content">
            <span class="close-button add-bookmark-close">&times;</span>
            <h2>ë¶ë§ˆí¬ ì¶”ê°€</h2>
            <div class="modal-form-group">
                <label for="add-bookmark-name">ì´ë¦„ (8ê¸€ì ì´ë‚´):</label>
                <input type="text" id="add-bookmark-name" maxlength="8">
            </div>
            <div class="modal-form-group">
                <label for="add-bookmark-url">URL:</label>
                <input type="text" id="add-bookmark-url">
            </div>
            <div class="modal-actions">
                <button id="add-bookmark-save" class="action-button">ì €ì¥</button>
                <button id="add-bookmark-cancel" class="action-button secondary-button">ì·¨ì†Œ</button>
            </div>
        </div>
    </div>

    <!-- Add Clipboard Modal -->
    <div id="add-clipboard-modal" class="modal">
        <div class="modal-content">
            <span class="close-button add-clipboard-close">&times;</span>
            <h2>í´ë¦½ë³´ë“œ ì¶”ê°€</h2>
            <div class="modal-form-group">
                <label for="add-clipboard-title">ì œëª© (10ê¸€ì ì´ë‚´):</label>
                <input type="text" id="add-clipboard-title" maxlength="10">
            </div>
            <div class="modal-form-group">
                <label for="add-clipboard-content">ë‚´ìš©:</label>
                <textarea id="add-clipboard-content"></textarea>
            </div>
            <div class="modal-actions">
                <button id="add-clipboard-save" class="action-button">ì €ì¥</button>
                <button id="add-clipboard-cancel" class="action-button secondary-button">ì·¨ì†Œ</button>
            </div>
        </div>
    </div>

    <!-- Add Project Modal -->
    <div id="add-project-modal" class="modal">
        <div class="modal-content">
            <span class="close-button add-project-close">&times;</span>
            <h2>í”„ë¡œì íŠ¸ ì¶”ê°€</h2>
            <div class="modal-form-group">
                <label for="add-project-name">í”„ë¡œì íŠ¸ ì´ë¦„:</label>
                <input type="text" id="add-project-name" placeholder="ìƒˆ í”„ë¡œì íŠ¸ ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”">
            </div>
            <div class="modal-actions">
                <button id="add-project-save" class="action-button">ì €ì¥</button>
                <button id="add-project-cancel" class="action-button secondary-button">ì·¨ì†Œ</button>
            </div>
        </div>
    </div>

    <div id="context-menu" class="context-menu">
        <ul>
            <li id="context-edit">í¸ì§‘</li>
            <li id="context-favorite">ì¦ê²¨ì°¾ê¸°</li>
            <li id="context-color">ìƒ‰ìƒ ë³€ê²½</li>
            <li id="context-delete">ì‚­ì œ</li>
            <li id="context-cancel">ì·¨ì†Œ</li>
        </ul>
    </div>

    <div id="project-context-menu" class="context-menu">
        <ul>
            <li id="project-context-rename">ì´ë¦„ ìˆ˜ì •</li>
            <li id="project-context-delete">ì‚­ì œ</li>
            <li id="project-context-cancel">ì·¨ì†Œ</li>
        </ul>
    </div>

    <!-- Custom Tooltip -->
    <div id="custom-tooltip" class="custom-tooltip"></div>

    <!-- Color Palette Modal -->
    <div id="color-palette-modal" class="modal">
        <div class="modal-content">
            <span class="close-button color-palette-close">&times;</span>
            <h2>ìƒ‰ìƒ ì„ íƒ</h2>
            <div class="color-palette-grid">
                <!-- ì²« ë²ˆì§¸ ì¤„: ê¸°ë³¸ + ë¹¨ê°„ ê³„ì—´ -->
                <div class="color-option" data-color="#f8f9fa" style="background-color: #f8f9fa;" title="ê¸°ë³¸"></div>
                <div class="color-option" data-color="#ffebee" style="background-color: #ffebee;" title="ì—°í•œ ë¹¨ê°•"></div>
                <div class="color-option" data-color="#ffcdd2" style="background-color: #ffcdd2;" title="ë¹¨ê°•"></div>
                <div class="color-option" data-color="#ef9a9a" style="background-color: #ef9a9a;" title="ì§„í•œ ë¹¨ê°•"></div>
                <div class="color-option" data-color="#e57373" style="background-color: #e57373;" title="ë”ì§„í•œ ë¹¨ê°•"></div>
                <div class="color-option" data-color="#f44336" style="background-color: #f44336;" title="ê°•í•œ ë¹¨ê°•"></div>
                
                <!-- ë‘ ë²ˆì§¸ ì¤„: ì£¼í™© ê³„ì—´ -->
                <div class="color-option" data-color="#fff3e0" style="background-color: #fff3e0;" title="ì—°í•œ ì£¼í™©"></div>
                <div class="color-option" data-color="#ffe0b2" style="background-color: #ffe0b2;" title="ì£¼í™©"></div>
                <div class="color-option" data-color="#ffcc80" style="background-color: #ffcc80;" title="ì§„í•œ ì£¼í™©"></div>
                <div class="color-option" data-color="#ffb74d" style="background-color: #ffb74d;" title="ë”ì§„í•œ ì£¼í™©"></div>
                <div class="color-option" data-color="#ff9800" style="background-color: #ff9800;" title="ê°•í•œ ì£¼í™©"></div>
                <div class="color-option" data-color="#e65100" style="background-color: #e65100;" title="ê¹Šì€ ì£¼í™©"></div>
                
                <!-- ì„¸ ë²ˆì§¸ ì¤„: ë…¸ë‘ + ì´ˆë¡ ê³„ì—´ -->
                <div class="color-option" data-color="#fffde7" style="background-color: #fffde7;" title="ì—°í•œ ë…¸ë‘"></div>
                <div class="color-option" data-color="#fff176" style="background-color: #fff176;" title="ë…¸ë‘"></div>
                <div class="color-option" data-color="#e8f5e8" style="background-color: #e8f5e8;" title="ì—°í•œ ì´ˆë¡"></div>
                <div class="color-option" data-color="#a5d6a7" style="background-color: #a5d6a7;" title="ì´ˆë¡"></div>
                <div class="color-option" data-color="#66bb6a" style="background-color: #66bb6a;" title="ì§„í•œ ì´ˆë¡"></div>
                <div class="color-option" data-color="#4caf50" style="background-color: #4caf50;" title="ê°•í•œ ì´ˆë¡"></div>
                
                <!-- ë„¤ ë²ˆì§¸ ì¤„: íŒŒë‘ ê³„ì—´ -->
                <div class="color-option" data-color="#e3f2fd" style="background-color: #e3f2fd;" title="ì—°í•œ íŒŒë‘"></div>
                <div class="color-option" data-color="#90caf9" style="background-color: #90caf9;" title="íŒŒë‘"></div>
                <div class="color-option" data-color="#64b5f6" style="background-color: #64b5f6;" title="ì§„í•œ íŒŒë‘"></div>
                <div class="color-option" data-color="#42a5f5" style="background-color: #42a5f5;" title="ë”ì§„í•œ íŒŒë‘"></div>
                <div class="color-option" data-color="#2196f3" style="background-color: #2196f3;" title="ê°•í•œ íŒŒë‘"></div>
                <div class="color-option" data-color="#1976d2" style="background-color: #1976d2;" title="ê¹Šì€ íŒŒë‘"></div>
            </div>
        </div>
    </div>

    <!-- View Clipboard Modal -->
    <div id="view-clipboard-modal" class="modal">
        <div class="modal-content">
            <span class="close-button view-clipboard-close">&times;</span>
            <h2 id="view-clipboard-title"></h2>
            <div id="view-clipboard-content" style="white-space: pre-wrap; word-wrap: break-word; max-height: 600px; overflow-y: auto; margin-bottom: 20px;"></div>
            <div class="modal-actions">
                <button id="view-clipboard-copy-btn" class="action-button">ë³µì‚¬</button>
                <button id="view-clipboard-edit-btn" class="action-button secondary-button">ìˆ˜ì •</button>
            </div>
        </div>
    </div>

    <!-- Copy Confirmation Modal -->
    <div id="copy-confirmation-modal" class="modal">
        <div class="modal-content" style="max-width: 300px; text-align: center;">
            <h2 style="margin-bottom: 20px; font-size: 18px;">âœ… ë³µì‚¬ ì™„ë£Œ</h2>
            <p style="margin-bottom: 20px; color: #37352f;">ë‚´ìš©ì´ í´ë¦½ë³´ë“œì— ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤.</p>
            <button id="copy-confirmation-ok" class="action-button">í™•ì¸</button>
        </div>
    </div>
    
    <script>
        // ì „ì—­ í…œí”Œë¦¿ ê´€ë ¨ ë³€ìˆ˜ë“¤
        let templates = [];
        let editingTemplateId = null;

        // ëª¨ë‹¬ ë‹«ê¸°
        function closeTemplateModal() {
            document.getElementById('template-edit-modal').style.display = 'none';
        }

        // í…œí”Œë¦¿ íŒì—… í•¨ìˆ˜ë“¤
        let currentPopupTemplate = null;

        // í´ë¦½ë³´ë“œ ë³µì‚¬ í•¨ìˆ˜
        function copyToClipboard(text) {
            // ë¨¼ì € modern API ì‹œë„
            if (navigator.clipboard && navigator.clipboard.writeText) {
                return navigator.clipboard.writeText(text)
                    .then(() => true)
                    .catch(() => false);
            }
            
            // ëŒ€ì²´ ë°©ë²•: ì„ì‹œ textarea ìƒì„±
            return new Promise((resolve) => {
                const textArea = document.createElement('textarea');
                textArea.value = text;
                textArea.style.position = 'fixed';
                textArea.style.top = '-9999px';
                textArea.style.left = '-9999px';
                textArea.setAttribute('readonly', '');
                textArea.style.contain = 'strict';
                
                document.body.appendChild(textArea);
                
                // iOS Safari ëŒ€ì‘
                if (/ipad|iphone/i.test(navigator.userAgent)) {
                    textArea.contentEditable = 'true';
                    textArea.readOnly = false;
                    const range = document.createRange();
                    range.selectNodeContents(textArea);
                    const selection = window.getSelection();
                    selection.removeAllRanges();
                    selection.addRange(range);
                    textArea.setSelectionRange(0, 999999);
                } else {
                    textArea.select();
                }
                
                try {
                    const successful = document.execCommand('copy');
                    document.body.removeChild(textArea);
                    resolve(successful);
                } catch (err) {
                    document.body.removeChild(textArea);
                    resolve(false);
                }
            });
        }

        // ë³µì‚¬ í™•ì¸ ëª¨ë‹¬ í•¨ìˆ˜ë“¤
        function showCopyConfirmation() {
            const copyConfirmationModal = document.getElementById('copy-confirmation-modal');
            if (copyConfirmationModal) {
                copyConfirmationModal.style.display = 'flex';
                setTimeout(() => {
                    copyConfirmationModal.style.display = 'none';
                }, 1500);
            }
        }

        // ë‚´ìš©ë³´ê¸° í•¨ìˆ˜
        function showTemplateContent() {
            if (!currentPopupTemplate) return;
            
            // ì €ì¥ëœ ë³€ìˆ˜ê°’ ë¡œë“œ
            const savedValues = loadVariableHistory(currentPopupTemplate.id);
            
            // ë³€ìˆ˜ ì¹˜í™˜í•˜ì—¬ ë‚´ìš© í‘œì‹œ (ë¹ˆ ë³€ìˆ˜ëŠ” ê´„í˜¸ë¡œ í‘œì‹œ)
            const processedContent = replaceVariables(currentPopupTemplate.content, savedValues, true);
            document.getElementById('template-popup-content').innerHTML = `
                <div style="background-color: #f8f9fa; border: 1px solid #e9ecef; border-radius: 6px; padding: 16px; white-space: pre-wrap; font-family: monospace; font-size: 14px; line-height: 1.5;">
                    ${processedContent}
                </div>
            `;
            
            // ë³€ìˆ˜ ì…ë ¥ ì„¹ì…˜ ìˆ¨ê¸°ê¸°
            document.getElementById('template-variables-section').style.display = 'none';
        }

        function showTemplatePopup(template) {
            if (!template) {
                console.error('showTemplatePopup: template is null or undefined');
                return;
            }
            
            console.log('showTemplatePopup: Setting currentPopupTemplate to:', template);
            currentPopupTemplate = template;
            
            document.getElementById('template-popup-title').textContent = template.title || 'ì œëª© ì—†ìŒ';
            
            // ì´ˆê¸°ì—ëŠ” ì›ë³¸ ë‚´ìš© í‘œì‹œ
            document.getElementById('template-popup-content').textContent = template.content || 'ë‚´ìš© ì—†ìŒ';
            
            // ë³€ìˆ˜ ì…ë ¥ UI ì´ˆê¸°í™”
            document.getElementById('template-variables-section').style.display = 'none';
            
            // í…œí”Œë¦¿ì— ë³€ìˆ˜ê°€ ìˆëŠ”ì§€ í™•ì¸í•˜ì—¬ ë²„íŠ¼ ìƒíƒœ ì„¤ì •
            const variables = extractVariables(template.content);
            const variablesToggleBtn = document.getElementById('template-variables-toggle-btn');
            if (variables.length > 0) {
                variablesToggleBtn.style.display = 'block';
            } else {
                variablesToggleBtn.style.display = 'none';
            }
            
            document.getElementById('template-popup-modal').style.display = 'flex';
        }

        function closeTemplatePopup() {
            document.getElementById('template-popup-modal').style.display = 'none';
            document.getElementById('template-variables-section').style.display = 'none';
            currentPopupTemplate = null;
        }

        async function copyTemplateFromPopup() {
            if (!currentPopupTemplate) {
                console.error('currentPopupTemplate is null');
                return;
            }
            
            const processedContent = replaceVariables(currentPopupTemplate.content);
            
            try {
                const success = await copyToClipboard(processedContent);
                if (success) {
                    currentPopupTemplate.usageCount = (currentPopupTemplate.usageCount || 0) + 1;
                    await saveTemplates();
                    renderTemplates();
                    showCopyConfirmation();
                    closeTemplatePopup();
                } else {
                    alert('í´ë¦½ë³´ë“œ ë³µì‚¬ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
                }
            } catch (error) {
                console.error('í…œí”Œë¦¿ ë³µì‚¬ ì‹¤íŒ¨:', error);
                alert('í…œí”Œë¦¿ ë³µì‚¬ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
            }
        }

        function editTemplateFromPopup() {
            if (!currentPopupTemplate) {
                console.error('currentPopupTemplate is null');
                return;
            }
            console.log('Editing template:', currentPopupTemplate);
            
            // í…œí”Œë¦¿ ê°ì²´ë¥¼ ì„ì‹œ ì €ì¥
            const templateToEdit = currentPopupTemplate;
            closeTemplatePopup();
            editTemplate(templateToEdit);
        }

        async function deleteTemplateFromPopup() {
            if (!currentPopupTemplate) return;
            const confirmDelete = confirm(`"${currentPopupTemplate.title}" í…œí”Œë¦¿ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?\n\nì´ ì‘ì—…ì€ ë˜ëŒë¦´ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.`);
            
            if (confirmDelete) {
                const templateIndex = templates.findIndex(t => t.id === currentPopupTemplate.id);
                if (templateIndex !== -1) {
                    templates.splice(templateIndex, 1);
                    await saveTemplates();
                    renderTemplates();
                    closeTemplatePopup();
                }
            }
        }

        // ë³€ìˆ˜ ì…ë ¥ UI í‘œì‹œ í•¨ìˆ˜ (ê°œì„ )
        function showVariableInputs() {
            if (!currentPopupTemplate) return;
            
            const variables = extractVariables(currentPopupTemplate.content);
            const variablesSection = document.getElementById('template-variables-section');
            const variablesContainer = document.getElementById('template-variables-inputs');
            
            if (variables.length === 0) {
                alert('ì´ í…œí”Œë¦¿ì—ëŠ” ì…ë ¥í•  ë³€ìˆ˜ê°€ ì—†ìŠµë‹ˆë‹¤.');
                return;
            }
            
            // ì €ì¥ëœ ë³€ìˆ˜ê°’ ë¡œë“œ
            const savedValues = loadVariableHistory(currentPopupTemplate.id);
            
            // ë³€ìˆ˜ ì…ë ¥ í•„ë“œ ìƒì„± (ì´ì „ ê°’ ìë™ ì…ë ¥)
            variablesContainer.innerHTML = '';
            variables.forEach(variable => {
                const div = document.createElement('div');
                div.style.marginBottom = '8px';
                div.innerHTML = `
                    <label style="display: block; margin-bottom: 4px; font-size: 12px; color: #37352f;">${variable}:</label>
                    <input type="text" id="var-${variable}" placeholder="${variable} ê°’ì„ ì…ë ¥í•˜ì„¸ìš”" 
                           value="${savedValues[variable] || ''}"
                           style="width: 100%; padding: 6px 8px; border: 1px solid #ccc; border-radius: 3px; font-size: 12px;">
                `;
                variablesContainer.appendChild(div);
            });
            
            variablesSection.style.display = 'block';
            
            // ì›ë³¸ ë‚´ìš© í‘œì‹œë¡œ ë˜ëŒë¦¬ê¸°
            document.getElementById('template-popup-content').textContent = currentPopupTemplate.content;
        }

        // ë³€ìˆ˜ ì´ˆê¸°í™”
        function resetVariables() {
            const variablesContainer = document.getElementById('template-variables-inputs');
            const inputs = variablesContainer.querySelectorAll('input');
            inputs.forEach(input => input.value = '');
            
            // ì›ë˜ ë‚´ìš©ìœ¼ë¡œ ë³µì›
            if (currentPopupTemplate) {
                document.getElementById('template-popup-content').textContent = currentPopupTemplate.content;
            }
        }

        // ì–‘ì‹ ì €ì¥ (ë³€ìˆ˜ê°’ì´ ì ìš©ëœ í…œí”Œë¦¿ì„ ìƒˆë¡œìš´ í…œí”Œë¦¿ìœ¼ë¡œ ì €ì¥)
        async function saveFormTemplate() {
            if (!currentPopupTemplate) return;
            
            const variables = extractVariables(currentPopupTemplate.content);
            const customValues = {};
            
            // ì…ë ¥ëœ ë³€ìˆ˜ê°’ ìˆ˜ì§‘
            variables.forEach(variable => {
                const input = document.getElementById(`var-${variable}`);
                if (input) {
                    customValues[variable] = input.value.trim();
                }
            });
            
            // ë³€ìˆ˜ê°’ íˆìŠ¤í† ë¦¬ ì €ì¥
            saveVariableHistory(currentPopupTemplate.id, customValues);
            
            // ë³€ìˆ˜ê°€ ì¹˜í™˜ëœ ë‚´ìš© ìƒì„±
            const processedContent = replaceVariables(currentPopupTemplate.content, customValues);
            
            // ìƒˆ í…œí”Œë¦¿ëª… ìƒì„± (ì›ë³¸ + ë‚ ì§œì‹œê°„)
            const now = new Date();
            const timestamp = now.toLocaleString('ko-KR', { 
                month: '2-digit', 
                day: '2-digit', 
                hour: '2-digit', 
                minute: '2-digit'
            }).replace(/\./g, '').replace(/\s/g, '_');
            
            const newTemplateTitle = `${currentPopupTemplate.title}_${timestamp}`;
            
            // ìƒˆ í…œí”Œë¦¿ ê°ì²´ ìƒì„±
            const newTemplate = {
                id: Date.now().toString(),
                title: newTemplateTitle,
                content: processedContent,
                createdAt: new Date().toISOString(),
                usageCount: 0
            };
            
            // í…œí”Œë¦¿ ë°°ì—´ì— ì¶”ê°€
            templates.push(newTemplate);
            await saveTemplates();
            renderTemplates();
            
            // UI ì—…ë°ì´íŠ¸ - ì²˜ë¦¬ëœ ë‚´ìš©ì„ ìŠ¤íƒ€ì¼ê³¼ í•¨ê»˜ í‘œì‹œ
            document.getElementById('template-popup-content').innerHTML = `
                <div style="background-color: #f8f9fa; border: 1px solid #e9ecef; border-radius: 6px; padding: 16px; white-space: pre-wrap; font-family: monospace; font-size: 14px; line-height: 1.5;">
                    ${processedContent}
                </div>
            `;
            document.getElementById('template-variables-section').style.display = 'none';
            
            alert(`"${newTemplateTitle}" ì–‘ì‹ì´ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤.`);
        }

        // ë³€ìˆ˜ ì‚½ì… ê¸°ëŠ¥
        function insertVariable(variable) {
            const textarea = document.getElementById('template-content-input');
            const startPos = textarea.selectionStart;
            const endPos = textarea.selectionEnd;
            const textBefore = textarea.value.substring(0, startPos);
            const textAfter = textarea.value.substring(endPos);
            
            textarea.value = textBefore + variable + textAfter;
            
            // ì»¤ì„œ ìœ„ì¹˜ë¥¼ ì‚½ì…ëœ ë³€ìˆ˜ ë’¤ë¡œ ì´ë™
            const newPos = startPos + variable.length;
            textarea.setSelectionRange(newPos, newPos);
            textarea.focus();
            
        }

        // ë¹ˆ ë³€ìˆ˜ ì‚½ì… ê¸°ëŠ¥
        function insertEmptyVariable() {
            const textarea = document.getElementById('template-content-input');
            const startPos = textarea.selectionStart;
            const endPos = textarea.selectionEnd;
            const textBefore = textarea.value.substring(0, startPos);
            const textAfter = textarea.value.substring(endPos);
            
            textarea.value = textBefore + '{}' + textAfter;
            
            // ì»¤ì„œë¥¼ ì¤‘ê´„í˜¸ ì‚¬ì´ë¡œ ì´ë™
            const newPos = startPos + 1;
            textarea.setSelectionRange(newPos, newPos);
            textarea.focus();
            
        }

        // ë³€ìˆ˜ê°’ íˆìŠ¤í† ë¦¬ ê´€ë¦¬
        function saveVariableHistory(templateId, variables) {
            const historyKey = `template_variables_${templateId}`;
            localStorage.setItem(historyKey, JSON.stringify(variables));
        }

        function loadVariableHistory(templateId) {
            const historyKey = `template_variables_${templateId}`;
            const saved = localStorage.getItem(historyKey);
            return saved ? JSON.parse(saved) : {};
        }

        // ë³€ìˆ˜ ì¹˜í™˜ í•¨ìˆ˜ (ë¹ˆ ë³€ìˆ˜ ì²˜ë¦¬ í¬í•¨)
        function replaceVariables(content, customValues = {}, showEmptyAsPlaceholder = false) {
            const now = new Date();
            const today = now.toLocaleDateString('ko-KR');
            const currentTime = now.toLocaleTimeString('ko-KR', { hour: '2-digit', minute: '2-digit' });
            const projectName = window.currentProject || 'ì„ íƒëœ í”„ë¡œì íŠ¸ ì—†ìŒ';
            
            let result = content
                .replace(/\{ì˜¤ëŠ˜ë‚ ì§œ\}/g, today)
                .replace(/\{í˜„ì¬ì‹œê°„\}/g, currentTime)
                .replace(/\{í”„ë¡œì íŠ¸ëª…\}/g, projectName);
            
            // ì‚¬ìš©ì ì •ì˜ ë³€ìˆ˜ ì¹˜í™˜
            for (const [key, value] of Object.entries(customValues)) {
                if (value && value.trim()) {
                    const regex = new RegExp(`\\{${key}\\}`, 'g');
                    result = result.replace(regex, value);
                }
            }
            
            // ë¹ˆ ë³€ìˆ˜ ì²˜ë¦¬
            if (showEmptyAsPlaceholder) {
                result = result.replace(/\{([^}]+)\}/g, '($1)');
            }
                
            return result;
        }

        // í…œí”Œë¦¿ì—ì„œ ë³€ìˆ˜ ì¶”ì¶œ í•¨ìˆ˜
        function extractVariables(content) {
            const variableRegex = /\{([^}]+)\}/g;
            const variables = new Set();
            let match;
            
            while ((match = variableRegex.exec(content)) !== null) {
                const varName = match[1];
                // ì‹œìŠ¤í…œ ë³€ìˆ˜ëŠ” ì œì™¸
                if (!['ì˜¤ëŠ˜ë‚ ì§œ', 'í˜„ì¬ì‹œê°„', 'í”„ë¡œì íŠ¸ëª…'].includes(varName)) {
                    variables.add(varName);
                }
            }
            
            return Array.from(variables);
        }


        // ìƒˆ í…œí”Œë¦¿ ì¶”ê°€
        function addNewTemplate() {
            editingTemplateId = null;
            document.getElementById('template-title-input').value = '';
            document.getElementById('template-content-input').value = '';
            document.getElementById('template-edit-modal').style.display = 'flex';
        }

        // í…œí”Œë¦¿ í¸ì§‘
        function editTemplate(template) {
            if (!template || !template.id) {
                console.error('Invalid template object:', template);
                alert('í…œí”Œë¦¿ ë°ì´í„°ì— ì˜¤ë¥˜ê°€ ìˆìŠµë‹ˆë‹¤.');
                return;
            }
            
            console.log('Editing template with ID:', template.id);
            editingTemplateId = template.id;
            document.getElementById('template-title-input').value = template.title || '';
            document.getElementById('template-content-input').value = template.content || '';
            document.getElementById('template-edit-modal').style.display = 'flex';
        }

        // í…œí”Œë¦¿ ì‚­ì œ
        async function deleteTemplate(template) {
            const confirmDelete = confirm(`"${template.title}" í…œí”Œë¦¿ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?\n\nì´ ì‘ì—…ì€ ë˜ëŒë¦´ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.`);
            
            if (confirmDelete) {
                try {
                    const templateIndex = templates.findIndex(t => t.id === template.id);
                    if (templateIndex !== -1) {
                        templates.splice(templateIndex, 1);
                        await saveTemplates();
                        renderTemplates();
                        console.log(`í…œí”Œë¦¿ "${template.title}" ì‚­ì œ ì™„ë£Œ`);
                    }
                } catch (error) {
                    console.error('í…œí”Œë¦¿ ì‚­ì œ ì‹¤íŒ¨:', error);
                    alert('í…œí”Œë¦¿ ì‚­ì œì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
                }
            }
        }

        // ì „ì—­ Firebase ë³€ìˆ˜ë“¤ (ì „ì—­ìœ¼ë¡œ ì ‘ê·¼ ê°€ëŠ¥í•˜ë„ë¡)
        let globalDb = null;
        let globalFirebaseInitialized = false;

        // í…œí”Œë¦¿ ë°ì´í„° ì €ì¥
        async function saveTemplates() {
            try {
                // ë¡œì»¬ìŠ¤í† ë¦¬ì§€ì— ì €ì¥ (í•­ìƒ)
                localStorage.setItem('templates', JSON.stringify(templates));
                
                // Firebaseì—ë„ ì €ì¥ (ê°€ëŠ¥í•œ ê²½ìš°)
                if (globalFirebaseInitialized && globalDb) {
                    await globalDb.collection('templates').doc('userTemplates').set({
                        templates: templates,
                        lastModified: new Date()
                    });
                }
                console.log('í…œí”Œë¦¿ ì €ì¥ ì™„ë£Œ');
            } catch (error) {
                console.error('í…œí”Œë¦¿ ì €ì¥ ì‹¤íŒ¨:', error);
                // ë¡œì»¬ìŠ¤í† ë¦¬ì§€ë¼ë„ ì €ì¥ë˜ì—ˆìœ¼ë©´ ì„±ê³µìœ¼ë¡œ ê°„ì£¼
                if (localStorage.getItem('templates')) {
                    console.log('ë¡œì»¬ìŠ¤í† ë¦¬ì§€ì— í…œí”Œë¦¿ ì €ì¥ ì™„ë£Œ');
                } else {
                    alert('í…œí”Œë¦¿ ì €ì¥ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
                }
            }
        }

        // í…œí”Œë¦¿ ë°ì´í„° ë¡œë“œ
        async function loadTemplates() {
            try {
                if (globalFirebaseInitialized && globalDb) {
                    const doc = await globalDb.collection('templates').doc('userTemplates').get();
                    if (doc.exists) {
                        templates = doc.data().templates || [];
                    } else {
                        templates = [];
                    }
                } else {
                    // ë¡œì»¬ìŠ¤í† ë¦¬ì§€ì—ì„œ ë¡œë“œ
                    const savedTemplates = localStorage.getItem('templates');
                    if (savedTemplates) {
                        templates = JSON.parse(savedTemplates);
                    } else {
                        templates = [];
                    }
                }
                renderTemplates();
            } catch (error) {
                console.error('í…œí”Œë¦¿ ë¡œë“œ ì‹¤íŒ¨:', error);
                // ë¡œì»¬ìŠ¤í† ë¦¬ì§€ fallback
                const savedTemplates = localStorage.getItem('templates');
                if (savedTemplates) {
                    templates = JSON.parse(savedTemplates);
                } else {
                    templates = [];
                }
                renderTemplates();
            }
        }

        // í…œí”Œë¦¿ ëª©ë¡ ë Œë”ë§
        function renderTemplates() {
            const templateList = document.getElementById('template-list');
            
            if (!templateList) return; // ìš”ì†Œê°€ ì—†ìœ¼ë©´ ì¢…ë£Œ
            
            let filteredTemplates = templates;
            
            if (filteredTemplates.length === 0) {
                templateList.innerHTML = '<div class="activity-placeholder">í…œí”Œë¦¿ì´ ì—†ìŠµë‹ˆë‹¤. ìƒˆ í…œí”Œë¦¿ì„ ì¶”ê°€í•´ë³´ì„¸ìš”.</div>';
                return;
            }
            
            templateList.innerHTML = '';
            filteredTemplates.forEach(template => {
                const templateCard = createTemplateCard(template);
                templateList.appendChild(templateCard);
            });
        }

        // í…œí”Œë¦¿ ì¹´ë“œ ìƒì„±
        // í…œí”Œë¦¿ ì¹´ë“œ ìƒì„± (ë³µì‚¬ ë²„íŠ¼ ì œê±°ë¨)
        function createTemplateCard(template) {
            const card = document.createElement('div');
            card.className = 'template-card';
            
            // ì¹´ë“œ í´ë¦­ ì‹œ íŒì—… í‘œì‹œ
            card.onclick = () => showTemplatePopup(template);
            
            const header = document.createElement('div');
            header.className = 'template-card-header';
            
            const title = document.createElement('h5');
            title.className = 'template-title';
            title.textContent = `ğŸ“ ${template.title}`;
            
            const rightArea = document.createElement('div');
            rightArea.style.display = 'flex';
            rightArea.style.alignItems = 'center';
            rightArea.style.gap = '8px';
            
            
            header.appendChild(title);
            header.appendChild(rightArea);
            
            card.appendChild(header);
            
            return card;
        }

        // í…œí”Œë¦¿ ë³µì‚¬
        async function copyTemplate(template) {
            const processedContent = replaceVariables(template.content);
            
            try {
                await copyToClipboard(processedContent);
                template.usageCount = (template.usageCount || 0) + 1;
                await saveTemplates();
                renderTemplates();
                // showCopyConfirmation(); // í•¨ìˆ˜ê°€ ìˆë‹¤ë©´ í˜¸ì¶œ
            } catch (error) {
                console.error('í…œí”Œë¦¿ ë³µì‚¬ ì‹¤íŒ¨:', error);
                alert('í…œí”Œë¦¿ ë³µì‚¬ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
            }
        }

        // í…œí”Œë¦¿ ì €ì¥
        async function saveTemplate(formData) {
            const title = formData.get('title') || document.getElementById('template-title-input').value;
            const content = formData.get('content') || document.getElementById('template-content-input').value;
            
            if (!title.trim() || !content.trim()) {
                alert('ì œëª©ê³¼ ë‚´ìš©ì€ í•„ìˆ˜ì…ë‹ˆë‹¤.');
                return;
            }
            
            const templateData = {
                id: editingTemplateId || Date.now().toString(),
                title: title.trim(),
                content: content.trim(),
                usageCount: 0,
                createdAt: editingTemplateId ? templates.find(t => t.id === editingTemplateId)?.createdAt || new Date() : new Date(),
                updatedAt: new Date()
            };
            
            if (editingTemplateId) {
                const index = templates.findIndex(t => t.id === editingTemplateId);
                if (index !== -1) {
                    templateData.usageCount = templates[index].usageCount || 0;
                    templates[index] = templateData;
                }
            } else {
                templates.push(templateData);
            }
            
            await saveTemplates();
            renderTemplates();
            closeTemplateModal();
        }

        document.addEventListener('DOMContentLoaded', function() {
        
        // Firebase ì„¤ì • - ë³¸ì¸ì˜ Firebase í”„ë¡œì íŠ¸ ì„¤ì •ìœ¼ë¡œ êµì²´í•˜ì„¸ìš”
        const firebaseConfig = {
            apiKey: "AIzaSyDKjKvRCw-j4b-1W4MhRc-uZ21zbAnTFM8",
            authDomain: "bookmarkclipboard.firebaseapp.com",
            projectId: "bookmarkclipboard",
            storageBucket: "bookmarkclipboard.firebasestorage.app",
            messagingSenderId: "969969481293",
            appId: "1:969969481293:web:08ae0008ac1b590c43ce04"
        };
        
        // Firebase ì´ˆê¸°í™”
        let db = null;
        let firebaseInitialized = false;
        
        try {
            firebase.initializeApp(firebaseConfig);
            db = firebase.firestore();
            firebaseInitialized = true;
            console.log('Firebase ì´ˆê¸°í™” ì„±ê³µ');
            
            // ì „ì—­ ë³€ìˆ˜ì— í• ë‹¹
            globalDb = db;
            globalFirebaseInitialized = firebaseInitialized;
        } catch (error) {
            console.warn('Firebase ì´ˆê¸°í™” ì‹¤íŒ¨, ë¡œì»¬ìŠ¤í† ë¦¬ì§€ ì‚¬ìš©:', error);
            firebaseInitialized = false;
            globalFirebaseInitialized = false;
        }

        // í…œí”Œë¦¿ ì´ˆê¸°í™”
        loadTemplates();
        
        // ë°ì´í„° ì €ì¥ í•¨ìˆ˜ë“¤ (Firebase + ë¡œì»¬ìŠ¤í† ë¦¬ì§€ ë°±ì—…)
        const STORAGE_KEY = 'bookmark-clipboard-app-data';
        
        // Firebaseì— ë°ì´í„° ì €ì¥ (ê°œì¸ìš© ë‹¨ì¼ ë¬¸ì„œ)
        async function saveToFirebase(retryCount = 0) {
            if (!firebaseInitialized || !db) {
                console.log('Firebase ë¯¸ì´ˆê¸°í™”, ë¡œì»¬ìŠ¤í† ë¦¬ì§€ ì‚¬ìš©');
                return saveToLocalStorage();
            }
            
            try {
                const dataToSave = {
                    projects: allProjectsData,
                    currentProject: currentProject,
                    projectOrder: projectOrder || Object.keys(allProjectsData),
                    lastUpdated: new Date().toISOString()
                };
                
                await db.collection('userdata').doc('bookmark-app').set(dataToSave);
                console.log('âœ… ë°ì´í„°ë¥¼ Firebaseì— ì €ì¥í–ˆìŠµë‹ˆë‹¤.');
                
                // ë¡œì»¬ìŠ¤í† ë¦¬ì§€ì—ë„ ë°±ì—… ì €ì¥
                saveToLocalStorage();
                
                // ì €ì¥ ì„±ê³µ ì‹œ ì‹œê°ì  í”¼ë“œë°±
                showSaveStatus('success');
                
            } catch (error) {
                console.error('âŒ Firebase ì €ì¥ ì‹¤íŒ¨:', error);
                
                // ì¬ì‹œë„ ë¡œì§ (ìµœëŒ€ 3íšŒ)
                if (retryCount < 3) {
                    console.log(`Firebase ì €ì¥ ì¬ì‹œë„ ${retryCount + 1}/3...`);
                    setTimeout(() => saveToFirebase(retryCount + 1), 1000 * (retryCount + 1));
                    return;
                }
                
                // ìµœì¢… ì‹¤íŒ¨ì‹œ ë¡œì»¬ìŠ¤í† ë¦¬ì§€ì—ë§Œ ì €ì¥
                saveToLocalStorage();
                showSaveStatus('error');
                
                // ì‚¬ìš©ìì—ê²Œ ê²½ê³  í‘œì‹œ
                console.warn('âš ï¸ í´ë¼ìš°ë“œ ë™ê¸°í™” ì‹¤íŒ¨ - ë¡œì»¬ ì €ì¥ë§Œ ì™„ë£Œë¨');
            }
        }
        
        // ì €ì¥ ìƒíƒœ í‘œì‹œ í•¨ìˆ˜
        function showSaveStatus(status) {
            const existingStatus = document.getElementById('save-status');
            if (existingStatus) existingStatus.remove();
            
            const statusDiv = document.createElement('div');
            statusDiv.id = 'save-status';
            statusDiv.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                padding: 10px 15px;
                border-radius: 6px;
                font-size: 14px;
                font-weight: 600;
                z-index: 3000;
                opacity: 0;
                transition: opacity 0.3s ease;
            `;
            
            if (status === 'success') {
                statusDiv.textContent = 'âœ… ì €ì¥ ì™„ë£Œ';
                statusDiv.style.backgroundColor = '#d4edda';
                statusDiv.style.color = '#155724';
                statusDiv.style.border = '1px solid #c3e6cb';
            } else {
                statusDiv.textContent = 'âš ï¸ ë™ê¸°í™” ì‹¤íŒ¨';
                statusDiv.style.backgroundColor = '#f8d7da';
                statusDiv.style.color = '#721c24';
                statusDiv.style.border = '1px solid #f5c6cb';
            }
            
            document.body.appendChild(statusDiv);
            
            // ì• ë‹ˆë©”ì´ì…˜ìœ¼ë¡œ í‘œì‹œ
            setTimeout(() => statusDiv.style.opacity = '1', 100);
            
            // 3ì´ˆ í›„ ìë™ ì‚¬ë¼ì§
            setTimeout(() => {
                statusDiv.style.opacity = '0';
                setTimeout(() => statusDiv.remove(), 300);
            }, 3000);
        }

        // Firebaseì— ì—°ìŠµì¥ ë‚´ìš© ì €ì¥ (ë””ë°”ìš´ì‹± ì ìš©) - ì „ì—­ ë…ë¦½
        let practicesSaveTimeout;
        let isSaving = false;
        function savePracticeContent(content, immediate = false) {
            if (isSaving) {
                return;
            }
            
            // ë‚´ìš©ì´ ì‹¤ì œë¡œ ë³€ê²½ëœ ê²½ìš°ì—ë§Œ ì €ì¥
            const currentContent = globalPractices[currentPracticeTab] || '';
            if (currentContent === content) {
                return;
            }
            
            globalPractices[currentPracticeTab] = content;
            
            // ì¦‰ì‹œ ì €ì¥ì´ ì•„ë‹Œ ê²½ìš° ë””ë°”ìš´ì‹± ì ìš©
            if (immediate) {
                clearTimeout(practicesSaveTimeout);
                isSaving = true;
                savePracticeToFirebase().finally(() => {
                    isSaving = false;
                });
            } else {
                clearTimeout(practicesSaveTimeout);
                practicesSaveTimeout = setTimeout(() => {
                    isSaving = true;
                    savePracticeToFirebase().finally(() => {
                        isSaving = false;
                    });
                }, 500); // 500ms ì§€ì—°
            }
        }
        
        // ì „ì—­ ì—°ìŠµì¥ Firebase ì €ì¥
        async function savePracticeToFirebase() {
            if (!firebaseInitialized || !db) {
                console.log('Firebase ë¯¸ì´ˆê¸°í™”, ë¡œì»¬ìŠ¤í† ë¦¬ì§€ì— ì—°ìŠµì¥ ì €ì¥');
                localStorage.setItem('global-practices', JSON.stringify(globalPractices));
                return;
            }
            
            try {
                await db.collection('userdata').doc('global-practices').set({
                    practices: globalPractices,
                    lastUpdated: new Date().toISOString()
                });
                console.log('ì „ì—­ ì—°ìŠµì¥ì„ Firebaseì— ì €ì¥í–ˆìŠµë‹ˆë‹¤.');
                
                // ë¡œì»¬ìŠ¤í† ë¦¬ì§€ì—ë„ ë°±ì—… ì €ì¥
                localStorage.setItem('global-practices', JSON.stringify(globalPractices));
                
            } catch (error) {
                console.error('Firebase ì—°ìŠµì¥ ì €ì¥ ì‹¤íŒ¨, ë¡œì»¬ìŠ¤í† ë¦¬ì§€ ì‚¬ìš©:', error);
                localStorage.setItem('global-practices', JSON.stringify(globalPractices));
            }
        }

        // ì „ì—­ ì—°ìŠµì¥ ë‚´ìš© ë¡œë“œ
        function loadPracticeContent() {
            const practiceTextarea = document.getElementById('practice-textarea');
            
            // DOMì´ ì¤€ë¹„ë˜ì§€ ì•Šì€ ê²½ìš° ëŒ€ê¸°
            if (!practiceTextarea) {
                setTimeout(loadPracticeContent, 100);
                return;
            }
            
            const content = globalPractices[currentPracticeTab] || '';
            practiceTextarea.value = content;
        }
        
        // Firebaseì—ì„œ ì „ì—­ ì—°ìŠµì¥ ë°ì´í„° ë¡œë“œ
        async function loadPracticeFromFirebase() {
            if (!firebaseInitialized || !db) {
                console.log('Firebase ë¯¸ì´ˆê¸°í™”, ë¡œì»¬ìŠ¤í† ë¦¬ì§€ì—ì„œ ì—°ìŠµì¥ ë¡œë“œ');
                const localPractices = localStorage.getItem('global-practices');
                if (localPractices) {
                    globalPractices = JSON.parse(localPractices);
                }
                return;
            }
            
            try {
                const doc = await db.collection('userdata').doc('global-practices').get();
                if (doc.exists) {
                    const data = doc.data();
                    if (data.practices) {
                        globalPractices = data.practices;
                    }
                    console.log('Firebaseì—ì„œ ì „ì—­ ì—°ìŠµì¥ì„ ë¡œë“œí–ˆìŠµë‹ˆë‹¤.');
                } else {
                    // Firebaseì— ë¬¸ì„œê°€ ì—†ìœ¼ë©´ ë¡œì»¬ìŠ¤í† ë¦¬ì§€ì—ì„œ ë¡œë“œ
                    const localPractices = localStorage.getItem('global-practices');
                    if (localPractices) {
                        globalPractices = JSON.parse(localPractices);
                    }
                }
            } catch (error) {
                console.error('Firebase ì—°ìŠµì¥ ë¡œë“œ ì‹¤íŒ¨, ë¡œì»¬ìŠ¤í† ë¦¬ì§€ ì‚¬ìš©:', error);
                const localPractices = localStorage.getItem('global-practices');
                if (localPractices) {
                    globalPractices = JSON.parse(localPractices);
                }
            }
        }
        
        // íƒ­ ì „í™˜ í•¨ìˆ˜
        function switchPracticeTab(tabNumber) {
            // í˜„ì¬ íƒ­ì˜ ë‚´ìš©ì„ ì¦‰ì‹œ ì €ì¥
            const practiceTextarea = document.getElementById('practice-textarea');
            savePracticeContent(practiceTextarea.value, true); // ì¦‰ì‹œ ì €ì¥
            
            // íƒ­ ë³€ê²½
            currentPracticeTab = tabNumber;
            
            // ìƒˆ íƒ­ì˜ ë‚´ìš© ë¡œë“œ
            loadPracticeContent();
            
            // UI ì—…ë°ì´íŠ¸
            updatePracticeTabUI();
        }
        
        // íƒ­ UI ì—…ë°ì´íŠ¸
        function updatePracticeTabUI() {
            const tabs = document.querySelectorAll('.practice-tab');
            
            // DOMì´ ì¤€ë¹„ë˜ì§€ ì•Šì€ ê²½ìš° ëŒ€ê¸°
            if (tabs.length === 0) {
                setTimeout(updatePracticeTabUI, 100);
                return;
            }
            
            tabs.forEach(tab => {
                const tabNumber = parseInt(tab.dataset.tab);
                if (tabNumber === currentPracticeTab) {
                    tab.classList.add('active');
                } else {
                    tab.classList.remove('active');
                }
            });
        }
        
        function saveToLocalStorage() {
            try {
                const dataToSave = {
                    projects: allProjectsData,
                    currentProject: currentProject,
                    projectOrder: projectOrder || Object.keys(allProjectsData)
                };
                localStorage.setItem(STORAGE_KEY, JSON.stringify(dataToSave));
                console.log('ë°ì´í„°ë¥¼ ë¡œì»¬ìŠ¤í† ë¦¬ì§€ì— ì €ì¥í–ˆìŠµë‹ˆë‹¤.');
            } catch (error) {
                console.error('ë¡œì»¬ìŠ¤í† ë¦¬ì§€ ì €ì¥ ì‹¤íŒ¨:', error);
            }
        }
        
        // Firebaseì—ì„œ ë°ì´í„° ë¶ˆëŸ¬ì˜¤ê¸°
        async function loadFromFirebase() {
            if (!firebaseInitialized || !db) {
                console.log('Firebase ë¯¸ì´ˆê¸°í™”, ë¡œì»¬ìŠ¤í† ë¦¬ì§€ ì‚¬ìš©');
                return loadFromLocalStorage();
            }
            
            try {
                const doc = await db.collection('userdata').doc('bookmark-app').get();
                if (doc.exists) {
                    const data = doc.data();
                    console.log('Firebaseì—ì„œ ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì™”ìŠµë‹ˆë‹¤.');
                    
                    // ë¡œì»¬ìŠ¤í† ë¦¬ì§€ì—ë„ ë™ê¸°í™”
                    if (data.projects && data.currentProject) {
                        const localData = { projects: data.projects, currentProject: data.currentProject };
                        localStorage.setItem(STORAGE_KEY, JSON.stringify(localData));
                    }
                    
                    return data;
                } else {
                    console.log('Firebaseì— ë°ì´í„° ì—†ìŒ, ë¡œì»¬ìŠ¤í† ë¦¬ì§€ í™•ì¸');
                    return loadFromLocalStorage();
                }
            } catch (error) {
                console.error('Firebase ë¶ˆëŸ¬ì˜¤ê¸° ì‹¤íŒ¨, ë¡œì»¬ìŠ¤í† ë¦¬ì§€ ì‚¬ìš©:', error);
                return loadFromLocalStorage();
            }
        }
        
        function loadFromLocalStorage() {
            try {
                const savedData = localStorage.getItem(STORAGE_KEY);
                if (savedData) {
                    const parsedData = JSON.parse(savedData);
                    if (parsedData.projects && Object.keys(parsedData.projects).length > 0) {
                        console.log('ë¡œì»¬ìŠ¤í† ë¦¬ì§€ì—ì„œ ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì™”ìŠµë‹ˆë‹¤.');
                        return parsedData;
                    }
                }
            } catch (error) {
                console.error('ë¡œì»¬ìŠ¤í† ë¦¬ì§€ ë¶ˆëŸ¬ì˜¤ê¸° ì‹¤íŒ¨:', error);
            }
            return null;
        }
        
        function getDefaultData() {
            return {
                "ê°€ê³„ì•½": {
                    bookmarks: [
                        { name: "ê°€ê³„ì•½ê¸ˆ ë°˜í™˜ ë²•ë¥ ", url: "https://www.example.com/law-deposit", color: "#f8f9fa", favorite: true },
                        { name: "ì£¼íƒë„ì‹œê¸°ê¸ˆ ì•ˆë‚´", url: "https://www.example.com/fund", color: "#f8f9fa", favorite: false }
                    ],
                    clipboard: [
                        { title: "ì¸ì ì‚¬í•­ ìš”ì²­", text: "ì¸ì ì‚¬í•­ ìš”ì²­: ì„±í•¨, ì—°ë½ì²˜, ì£¼ë¯¼ë²ˆí˜¸ ì•ìë¦¬", color: "#f8f9fa", favorite: true },
                        { title: "íŠ¹ì•½ì‚¬í•­", text: "ê³„ì•½ì„œì— í¬í•¨í•  íŠ¹ì•½ì‚¬í•­", color: "#f8f9fa", favorite: false },
                    ]
                },
                "ì”ê¸ˆ": {
                    bookmarks: [
                        { name: "ì”ê¸ˆ ì¤€ë¹„ì„œë¥˜ ëª©ë¡", url: "https://www.example.com/final-docs", color: "#f8f9fa", favorite: false }
                    ],
                    clipboard: [
                        { title: "ì”ê¸ˆ ê³„ì¢Œë²ˆí˜¸", text: "ì”ê¸ˆ ê³„ì¢Œë²ˆí˜¸: 000-00000-000 (ì˜ˆê¸ˆì£¼: ã…‡ã…‡ã…‡)", color: "#f8f9fa", favorite: false },
                        { title: "ì”ê¸ˆ ì²˜ë¦¬ ì™„ë£Œ", text: "ì˜¤ëŠ˜ ì”ê¸ˆ ì²˜ë¦¬ ì™„ë£Œ. ë“±ê¸° ì ‘ìˆ˜ ì˜ˆì •.", color: "#f8f9fa", favorite: false }
                    ]
                },
                "ì„ëŒ€ì°¨": {
                    bookmarks: [
                        { name: "ì„ëŒ€ì°¨ ê³„ì•½ ë²•ë¥ ", url: "https://www.example.com/rental-law", color: "#f8f9fa", favorite: false }
                    ],
                    clipboard: [
                        { title: "ê³„ì•½ ì—°ì¥ ì•ˆë‚´", text: "ê³„ì•½ ì—°ì¥ ê´€ë ¨ ì•ˆë‚´ ë¬¸êµ¬", color: "#f8f9fa", favorite: false },
                    ]
                },
                "ë§¤ë§¤": {
                    bookmarks: [
                        { name: "ë§¤ë§¤ ì ˆì°¨ ì•ˆë‚´", url: "https://www.example.com/sale-process", color: "#f8f9fa", favorite: true }
                    ],
                    clipboard: [
                        { title: "ë§¤ë§¤ ê³„ì•½ ìœ ì˜ì‚¬í•­", text: "ë§¤ë§¤ ê³„ì•½ ì‹œ ìœ ì˜ì‚¬í•­", color: "#f8f9fa", favorite: false },
                    ]
                }
            };
        }
        
        // ë¡œì»¬ ë°ì´í„°ë¥¼ Firebaseë¡œ ë§ˆì´ê·¸ë ˆì´ì…˜
        async function migrateLocalToFirebase() {
            const localData = loadFromLocalStorage();
            if (localData && localData.projects) {
                console.log('ë¡œì»¬ ë°ì´í„°ë¥¼ Firebaseë¡œ ë§ˆì´ê·¸ë ˆì´ì…˜ ì¤‘...');
                allProjectsData = localData.projects;
                currentProject = localData.currentProject;
                projectOrder = localData.projectOrder || Object.keys(localData.projects);
                saveToFirebase();
                console.log('ë§ˆì´ê·¸ë ˆì´ì…˜ ì™„ë£Œ');
                return localData;
            }
            return null;
        }

        // ì•± ì´ˆê¸°í™” - Firebase ìš°ì„ , ë¡œì»¬ìŠ¤í† ë¦¬ì§€ ë°±ì—…
        let allProjectsData, currentProject, projectOrder;
        let currentPracticeTab = 1; // í˜„ì¬ í™œì„± ì—°ìŠµì¥ íƒ­
        let globalPractices = { // ì „ì—­ ë…ë¦½ ì—°ìŠµì¥
            1: '',
            2: '',
            3: '',
            4: '',
            5: ''
        };
        
        
        async function initializeApp() {
            try {
                const savedData = await loadFromFirebase();
                
                if (savedData && savedData.projects) {
                    allProjectsData = savedData.projects;
                    currentProject = savedData.currentProject || Object.keys(savedData.projects)[0];
                    projectOrder = savedData.projectOrder || Object.keys(savedData.projects);
                    console.log('Firebase ë°ì´í„°ë¡œ ì•± ì´ˆê¸°í™”');
                } else {
                    // Firebaseì— ë°ì´í„°ê°€ ì—†ìœ¼ë©´ ë¡œì»¬ ë°ì´í„° ë§ˆì´ê·¸ë ˆì´ì…˜ ì‹œë„
                    const migratedData = await migrateLocalToFirebase();
                    if (!migratedData) {
                        allProjectsData = getDefaultData();
                        currentProject = 'ê°€ê³„ì•½';
                        console.log('ê¸°ë³¸ ë°ì´í„°ë¡œ ì•± ì´ˆê¸°í™”');
                        // ì²« ì‹¤í–‰ì‹œ Firebase ë° ë¡œì»¬ìŠ¤í† ë¦¬ì§€ì— ì €ì¥
                        saveToFirebase();
                    }
                }
                
                // TODAY í”„ë¡œì íŠ¸ê°€ ì—†ìœ¼ë©´ ìë™ ì¶”ê°€
                if (!allProjectsData['TODAY']) {
                    allProjectsData['TODAY'] = {
                        bookmarks: [],
                        clipboard: []
                    };
                } else {
                    // TODAYê°€ ì¡´ì¬í•˜ì§€ë§Œ clipboardê°€ ì—†ëŠ” ê²½ìš°
                    if (!allProjectsData['TODAY'].clipboard) {
                        allProjectsData['TODAY'].clipboard = [];
                    }
                }
                
                // ì „ì—­ ì—°ìŠµì¥ ë°ì´í„° ë¡œë“œ
                await loadPracticeFromFirebase();
                
                // UI ë Œë”ë§
                renderProjectList();
                renderProject(currentProject);
                
            } catch (error) {
                console.error('ì•± ì´ˆê¸°í™” ì‹¤íŒ¨:', error);
                // ì—ëŸ¬ ë°œìƒì‹œ ë¡œì»¬ìŠ¤í† ë¦¬ì§€ ë°±ì—…ìœ¼ë¡œ ì‹œë„
                const localData = loadFromLocalStorage();
                if (localData) {
                    allProjectsData = localData.projects;
                    currentProject = localData.currentProject || Object.keys(localData.projects)[0];
                    projectOrder = localData.projectOrder || Object.keys(localData.projects);
                } else {
                    allProjectsData = getDefaultData();
                    currentProject = 'ê°€ê³„ì•½';
                    projectOrder = Object.keys(allProjectsData);
                }
                
                // TODAY í”„ë¡œì íŠ¸ê°€ ì—†ìœ¼ë©´ ìë™ ì¶”ê°€ (ì—ëŸ¬ ì¼€ì´ìŠ¤ì—ì„œë„)
                if (!allProjectsData['TODAY']) {
                    allProjectsData['TODAY'] = {
                        bookmarks: [],
                        clipboard: []
                    };
                } else {
                    // TODAYê°€ ì¡´ì¬í•˜ì§€ë§Œ clipboardê°€ ì—†ëŠ” ê²½ìš°
                    if (!allProjectsData['TODAY'].clipboard) {
                        allProjectsData['TODAY'].clipboard = [];
                    }
                }
                
                renderProjectList();
                renderProject(currentProject);
            }
        }

        // UI ìš”ì†Œ ê°€ì ¸ì˜¤ê¸°
        const projectList = document.getElementById('project-list');
        const bookmarkList = document.getElementById('bookmark-list');
        const clipboardList = document.getElementById('clipboard-list');
        const currentProjectTitle = document.getElementById('current-project-title');
        
        const addBookmarkBtn = document.getElementById('add-bookmark-btn');
        const addClipboardBtn = document.getElementById('add-clipboard-btn');
        const addDividerBtn = document.getElementById('add-divider-btn');
        const addBookmarkDividerBtn = document.getElementById('add-bookmark-divider-btn');

        const contextMenu = document.getElementById('context-menu');
        const contextEdit = document.getElementById('context-edit');
        const contextFavorite = document.getElementById('context-favorite');
        const contextColor = document.getElementById('context-color');
        const contextDelete = document.getElementById('context-delete');
        const contextCancel = document.getElementById('context-cancel');

        const projectContextMenu = document.getElementById('project-context-menu');
        const projectContextRename = document.getElementById('project-context-rename');
        const projectContextDelete = document.getElementById('project-context-delete');
        const projectContextCancel = document.getElementById('project-context-cancel');

        let activeItem = null;
        let activeProject = null;
        let colorChangeItem = null;

        // URLì„ í•˜ì´í¼ë§í¬ë¡œ ë³€í™˜í•˜ëŠ” í•¨ìˆ˜
        function convertUrlsToLinks(text) {
            if (!text) return '';
            
            const urlRegex = /(https?:\/\/[^\s]+)/g;
            return text.replace(urlRegex, '<a href="$1" target="_blank" rel="noopener noreferrer" style="color: #0066cc; text-decoration: underline;">$1</a>');
        }

        // TODAY í”„ë¡œì íŠ¸ìš© ì¦ê²¨ì°¾ê¸° ë¶ë§ˆí¬ ìˆ˜ì§‘ í•¨ìˆ˜
        function getTodayBookmarks() {
            const favoriteBookmarks = [];
            
            // ëª¨ë“  í”„ë¡œì íŠ¸ì—ì„œ ì¦ê²¨ì°¾ê¸° ë¶ë§ˆí¬ ìˆ˜ì§‘ (TODAY ì œì™¸)
            Object.keys(allProjectsData).forEach(projectName => {
                if (projectName !== 'TODAY') {
                    const project = allProjectsData[projectName];
                    if (project.bookmarks) {
                        project.bookmarks.forEach((bookmark, index) => {
                            if (bookmark.favorite && bookmark.type !== 'divider') {
                                favoriteBookmarks.push({
                                    ...bookmark,
                                    sourceProject: projectName,
                                    originalIndex: index
                                });
                            }
                        });
                    }
                }
            });
            
            return favoriteBookmarks;
        }

        async function renderProject(projectName) {
            currentProject = projectName;
            
            // TODAY í”„ë¡œì íŠ¸ íŠ¹ë³„ ì²˜ë¦¬
            if (projectName === 'TODAY') {
                currentProjectTitle.textContent = 'ğŸ“… TODAY - ì¦ê²¨ì°¾ê¸° ëª¨ìŒ';
                bookmarkList.innerHTML = '';
                clipboardList.innerHTML = '';
                
                // TODAY í”„ë¡œì íŠ¸ì— ì „ìš© í´ë¦½ë³´ë“œ ë°ì´í„° ì´ˆê¸°í™”
                if (!allProjectsData['TODAY']) {
                    allProjectsData['TODAY'] = {
                        bookmarks: [],
                        clipboard: []
                    };
                } else {
                    // TODAYê°€ ì¡´ì¬í•˜ì§€ë§Œ clipboardê°€ ì—†ëŠ” ê²½ìš°
                    if (!allProjectsData['TODAY'].clipboard) {
                        allProjectsData['TODAY'].clipboard = [];
                    }
                }
                
                // ì¦ê²¨ì°¾ê¸° ë¶ë§ˆí¬ë“¤ì„ ê°€ì ¸ì™€ì„œ ë Œë”ë§
                const favoriteBookmarks = getTodayBookmarks();
                favoriteBookmarks.forEach((item, index) => {
                    const button = document.createElement('button');
                    button.className = 'item-button bookmark-button';
                    
                    const favoriteIcon = 'â­ ';
                    const maxLength = 8 - favoriteIcon.length;
                    const truncatedName = item.name.length > maxLength ? 
                        item.name.substring(0, maxLength) : item.name;
                    
                    button.textContent = favoriteIcon + truncatedName;
                    button.style.backgroundColor = item.color || '#f8f9fa';
                    button.dataset.fullName = item.name;
                    button.dataset.url = item.url;
                    button.dataset.sourceProject = item.sourceProject;
                    
                    button.addEventListener('click', (e) => {
                        if (e.button === 0) {
                            window.open(item.url, '_blank');
                        }
                    });
                    
                    bookmarkList.appendChild(button);
                });
                
                // TODAY ì „ìš© í´ë¦½ë³´ë“œ ë Œë”ë§
                const todayData = allProjectsData['TODAY'];
                todayData.clipboard.forEach((item, index) => {
                    if (item.type === 'divider') {
                        const divider = document.createElement('div');
                        divider.className = 'divider draggable';
                        divider.dataset.index = index;
                        divider.dataset.type = 'clipboard';
                        divider.draggable = true;
                        divider.addEventListener('dragstart', handleItemDragStart);
                        clipboardList.appendChild(divider);
                    } else {
                        const button = document.createElement('button');
                        button.className = 'item-button clipboard-button draggable';
                        
                        const favoriteIcon = item.favorite ? 'â­ ' : '';
                        button.textContent = favoriteIcon + item.title.substring(0, 8 - favoriteIcon.length);
                        
                        button.style.backgroundColor = item.color || '#f8f9fa';
                        button.dataset.index = index;
                        button.dataset.type = 'clipboard';
                        button.dataset.fullName = item.title;
                        button.dataset.content = item.text;
                        button.draggable = true;
                        
                        let isDragging = false;
                        button.addEventListener('mousedown', () => { isDragging = false; });
                        button.addEventListener('dragstart', (e) => { 
                            isDragging = true; 
                            handleItemDragStart(e);
                        });
                        button.addEventListener('mouseup', async (e) => {
                            setTimeout(async () => {
                                if (!isDragging && e.button === 0) {
                                    // í´ë¦½ë³´ë“œ ìƒì„¸ ë³´ê¸° ëª¨ë‹¬ í‘œì‹œ
                                    const modal = document.getElementById('view-clipboard-modal');
                                    const titleEl = document.getElementById('view-clipboard-title');
                                    const contentEl = document.getElementById('view-clipboard-content');
                                    const copyBtn = document.getElementById('view-clipboard-copy-btn');
                                    const editBtn = document.getElementById('view-clipboard-edit-btn');

                                    titleEl.textContent = item.title || '';
                                    contentEl.innerHTML = convertUrlsToLinks(item.text);
                                    
                                    copyBtn.dataset.clipboardText = item.text;
                                    editBtn.dataset.clipboardIndex = index;

                                    modal.style.display = 'flex';
                                }
                            }, 50);
                        });
                        clipboardList.appendChild(button);
                    }
                });
                
                // í”„ë¡œì íŠ¸ ëª©ë¡ì—ì„œ í™œì„± ìƒíƒœ ì—…ë°ì´íŠ¸
                document.querySelectorAll('#project-list li').forEach(li => {
                    li.classList.remove('active');
                });
                document.getElementById('project-TODAY')?.classList.add('active');
                
                return;
            }
            
            const projectData = allProjectsData[projectName];
            
            currentProjectTitle.textContent = projectName;
            bookmarkList.innerHTML = '';
            clipboardList.innerHTML = '';

            projectData.bookmarks.forEach((item, index) => {
                if (item.type === 'divider') {
                    // êµ¬ë¶„ì„  ìƒì„±
                    const divider = document.createElement('div');
                    divider.className = 'divider draggable';
                    divider.dataset.index = index;
                    divider.dataset.type = 'bookmark';
                    divider.draggable = true;
                    
                    divider.addEventListener('dragstart', handleItemDragStart);
                    
                    bookmarkList.appendChild(divider);
                } else {
                    const button = document.createElement('button');
                    button.className = 'item-button bookmark-button draggable';
                    
                    const favoriteIcon = item.favorite ? 'â­ ' : '';
                    button.textContent = favoriteIcon + item.name.substring(0, 8 - favoriteIcon.length);
                    
                    button.style.backgroundColor = item.color || '#f8f9fa';
                    button.dataset.index = index;
                    button.dataset.type = 'bookmark';
                    button.dataset.fullName = item.name;
                    button.dataset.url = item.url;
                    button.draggable = true;
                    
                    let isDragging = false;
                    button.addEventListener('mousedown', () => { isDragging = false; });
                    button.addEventListener('dragstart', (e) => { 
                        isDragging = true; 
                                        handleItemDragStart(e);
                    });
                    button.addEventListener('mouseup', (e) => {
                        setTimeout(() => {
                            if (!isDragging && e.button === 0) {
                                window.open(item.url, '_blank');
                            }
                        }, 50);
                    });
                    bookmarkList.appendChild(button);
                }
            });

            projectData.clipboard.forEach((item, index) => {
                if (item.type === 'divider') {
                    // êµ¬ë¶„ì„  ìƒì„±
                    const divider = document.createElement('div');
                    divider.className = 'divider draggable';
                    divider.dataset.index = index;
                    divider.dataset.type = 'clipboard';
                    divider.draggable = true;
                    
                    divider.addEventListener('dragstart', handleItemDragStart);
                    
                    clipboardList.appendChild(divider);
                } else {
                    // ì¼ë°˜ í´ë¦½ë³´ë“œ ë²„íŠ¼ ìƒì„±
                    const button = document.createElement('button');
                    button.className = 'item-button clipboard-button draggable';
                    
                    const favoriteIcon = item.favorite ? 'â­ ' : '';
                    const buttonText = item.title || item.text || '';
                    button.textContent = favoriteIcon + buttonText.substring(0, 10 - favoriteIcon.length);
                    
                    button.style.backgroundColor = item.color || '#f8f9fa';
                    button.dataset.index = index;
                    button.dataset.type = 'clipboard';
                    button.dataset.fullText = item.text;
                    button.dataset.title = item.title || '';
                    button.draggable = true;
                    
                    let isDragging = false;
                    button.addEventListener('mousedown', () => { isDragging = false; });
                    button.addEventListener('dragstart', (e) => { 
                        isDragging = true; 
                        handleItemDragStart(e);
                    });
                    button.addEventListener('mouseup', (e) => {
                        setTimeout(() => {
                            if (!isDragging && e.button === 0) {
                                const modal = document.getElementById('view-clipboard-modal');
                                const titleEl = document.getElementById('view-clipboard-title');
                                const contentEl = document.getElementById('view-clipboard-content');
                                const copyBtn = document.getElementById('view-clipboard-copy-btn');
                                const editBtn = document.getElementById('view-clipboard-edit-btn');

                                titleEl.textContent = item.title || '';
                                contentEl.innerHTML = convertUrlsToLinks(item.text);
                                
                                copyBtn.dataset.clipboardText = item.text;
                                editBtn.dataset.clipboardIndex = index;

                                modal.style.display = 'flex';
                            }
                        }, 50);
                    });
                    clipboardList.appendChild(button);
                }
            });

            addTooltipEvents();
            setupDropZones();

            document.querySelectorAll('#project-list li').forEach(li => {
                li.classList.remove('active');
            });
            document.getElementById(`project-${projectName}`).classList.add('active');
            
            renderTemplates();
            
            // ì—°ìŠµì¥ ë‚´ìš© ë¡œë“œ ë° íƒ­ UI ì—…ë°ì´íŠ¸
            loadPracticeContent();
            updatePracticeTabUI();
            
            saveToFirebase();
        }

        function addTooltipEvents() {
            const tooltip = document.getElementById('custom-tooltip');
            
            document.querySelectorAll('.item-button').forEach(button => {
                button.addEventListener('mouseenter', (e) => {
                    const target = e.target;
                    let tooltipText = '';
                    
                    // ë¶ë§ˆí¬ ë²„íŠ¼ í˜¸ë²„ë§ ê¸°ëŠ¥ ì œê±°
                    // if (target.classList.contains('bookmark-button')) {
                    //     tooltipText = `${target.dataset.fullName}\n${target.dataset.url}`;
                    // }
                    
                    if (tooltipText) {
                        tooltip.innerHTML = tooltipText.replace(/\n/g, '<br>');
                        showTooltip(tooltip, target);
                    }
                });
                
                button.addEventListener('mouseleave', () => {
                    hideTooltip(tooltip);
                });
            });
        }

        function showTooltip(tooltip, target) {
            const rect = target.getBoundingClientRect();
            const tooltipRect = tooltip.getBoundingClientRect();
            
            let left = rect.left + (rect.width / 2) - (tooltipRect.width / 2);
            let top = rect.top - tooltipRect.height - 10;
            
            const padding = 10;
            if (left < padding) {
                left = padding;
            } else if (left + tooltipRect.width > window.innerWidth - padding) {
                left = window.innerWidth - tooltipRect.width - padding;
            }
            
            if (top < padding) {
                top = rect.bottom + 10;
                tooltip.classList.add('bottom');
            } else {
                tooltip.classList.remove('bottom');
            }
            
            tooltip.style.left = left + 'px';
            tooltip.style.top = top + 'px';
            tooltip.classList.add('show');
        }

        function hideTooltip(tooltip) {
            tooltip.classList.remove('show');
        }
        
        function addBookmark() {
            const modal = document.getElementById('add-bookmark-modal');
            document.querySelector('#add-bookmark-modal h2').textContent = 'ë¶ë§ˆí¬ ì¶”ê°€';
            modal.style.display = 'flex';
            
            document.getElementById('add-bookmark-name').value = '';
            document.getElementById('add-bookmark-url').value = '';
            
            delete modal.dataset.editMode;
            delete modal.dataset.editIndex;
        }

        function addClipboard() {
            const modal = document.getElementById('add-clipboard-modal');
            document.querySelector('#add-clipboard-modal h2').textContent = 'í´ë¦½ë³´ë“œ ì¶”ê°€';
            modal.style.display = 'flex';
            
            document.getElementById('add-clipboard-title').value = '';
            document.getElementById('add-clipboard-content').value = '';
            
            delete modal.dataset.editMode;
            delete modal.dataset.editIndex;
        }

        function addDivider() {
            if (!currentProject) {
                alert('í”„ë¡œì íŠ¸ë¥¼ ë¨¼ì € ì„ íƒí•´ì£¼ì„¸ìš”.');
                return;
            }
            
            const projectData = allProjectsData[currentProject];
            const divider = {
                type: 'divider',
                id: 'divider_' + Date.now()
            };
            
            projectData.clipboard.push(divider);
            saveToFirebase();
            renderProject(currentProject);
        }

        function addBookmarkDivider() {
            if (!currentProject) {
                alert('í”„ë¡œì íŠ¸ë¥¼ ë¨¼ì € ì„ íƒí•´ì£¼ì„¸ìš”.');
                return;
            }
            
            const projectData = allProjectsData[currentProject];
            const divider = {
                type: 'divider',
                id: 'bookmark_divider_' + Date.now()
            };
            
            projectData.bookmarks.push(divider);
            saveToFirebase();
            renderProject(currentProject);
        }

        function addProject() {
            const modal = document.getElementById('add-project-modal');
            modal.style.display = 'flex';
            
            document.getElementById('add-project-name').value = '';
        }

        function renderProjectList() {
            const projectList = document.getElementById('project-list');
            projectList.innerHTML = '';
            
            // TODAY í”„ë¡œì íŠ¸ë¥¼ ìµœìƒë‹¨ì— ê³ ì •
            const todayLi = document.createElement('li');
            todayLi.id = 'project-TODAY';
            todayLi.textContent = 'ğŸ“… TODAY';
            todayLi.classList.add('project-item', 'today-project');
            todayLi.dataset.projectName = 'TODAY';
            todayLi.style.fontWeight = 'bold';
            todayLi.style.color = '#2563eb';
            todayLi.style.borderBottom = '1px solid rgba(55, 53, 47, 0.09)';
            todayLi.style.marginBottom = '4px';
            todayLi.style.paddingBottom = '8px';
            
            if (currentProject === 'TODAY') {
                todayLi.classList.add('active');
            }
            
            projectList.appendChild(todayLi);
            
            // ë‚˜ë¨¸ì§€ í”„ë¡œì íŠ¸ë“¤ (TODAY ì œì™¸)
            const orderedProjects = (projectOrder || Object.keys(allProjectsData)).filter(name => name !== 'TODAY');
            orderedProjects.forEach((projectName, index) => {
                // ì¡´ì¬í•˜ì§€ ì•ŠëŠ” í”„ë¡œì íŠ¸ëŠ” ê±´ë„ˆë›°ê¸°
                if (!allProjectsData[projectName]) return;
                const li = document.createElement('li');
                li.id = `project-${projectName}`;
                li.textContent = projectName;
                li.classList.add('draggable', 'project-item');
                li.draggable = true;
                li.dataset.projectName = projectName;
                li.dataset.index = index;
                
                if (projectName === currentProject) {
                    li.classList.add('active');
                }
                
                li.addEventListener('dragstart', handleProjectDragStart);
                li.addEventListener('dragover', handleProjectDragOver);
                li.addEventListener('drop', handleProjectDrop);
                li.addEventListener('dragend', handleProjectDragEnd);
                li.addEventListener('dragenter', handleProjectDragEnter);
                li.addEventListener('dragleave', handleProjectDragLeave);
                
                projectList.appendChild(li);
            });
        }

        function showContextMenu(e, itemType, itemIndex) {
            e.preventDefault();
            contextMenu.style.display = 'block';
            
            // í™”ë©´ ê²½ê³„ë¥¼ ê³ ë ¤í•œ ìœ„ì¹˜ ê³„ì‚°
            const menuWidth = 180; // ìµœì†Œ ë„ˆë¹„
            const menuHeight = 160; // ì˜ˆìƒ ë†’ì´ (4ê°œ í•­ëª© ê¸°ì¤€)
            const screenWidth = window.innerWidth;
            const screenHeight = window.innerHeight;
            
            let x = e.clientX;
            let y = e.clientY;
            
            // ìš°ì¸¡ ê²½ê³„ í™•ì¸
            if (x + menuWidth > screenWidth) {
                x = screenWidth - menuWidth - 10;
            }
            
            // í•˜ë‹¨ ê²½ê³„ í™•ì¸
            if (y + menuHeight > screenHeight) {
                y = screenHeight - menuHeight - 10;
            }
            
            // ìµœì†Œ ì—¬ë°± í™•ë³´
            if (x < 10) x = 10;
            if (y < 10) y = 10;
            
            contextMenu.style.left = x + 'px';
            contextMenu.style.top = y + 'px';
            activeItem = { type: itemType, index: itemIndex };
            
            // êµ¬ë¶„ì„ ì¸ ê²½ìš° í¸ì§‘/ì¦ê²¨ì°¾ê¸°/ìƒ‰ìƒ ì˜µì…˜ ìˆ¨ê¸°ê¸°
            if (itemType === 'divider') {
                contextEdit.style.display = 'none';
                contextFavorite.style.display = 'none';
                contextColor.style.display = 'none';
            } else {
                contextEdit.style.display = 'block';
                contextFavorite.style.display = 'block';
                contextColor.style.display = 'block';
            }
        }

        function showProjectContextMenu(e, projectName) {
            e.preventDefault();
            projectContextMenu.style.display = 'block';
            
            // í™”ë©´ ê²½ê³„ë¥¼ ê³ ë ¤í•œ ìœ„ì¹˜ ê³„ì‚°
            const menuWidth = 150; // í”„ë¡œì íŠ¸ ë©”ë‰´ ë„ˆë¹„
            const menuHeight = 120; // ì˜ˆìƒ ë†’ì´ (3ê°œ í•­ëª© ê¸°ì¤€)
            const screenWidth = window.innerWidth;
            const screenHeight = window.innerHeight;
            
            let x = e.clientX;
            let y = e.clientY;
            
            // ìš°ì¸¡ ê²½ê³„ í™•ì¸
            if (x + menuWidth > screenWidth) {
                x = screenWidth - menuWidth - 10;
            }
            
            // í•˜ë‹¨ ê²½ê³„ í™•ì¸
            if (y + menuHeight > screenHeight) {
                y = screenHeight - menuHeight - 10;
            }
            
            // ìµœì†Œ ì—¬ë°± í™•ë³´
            if (x < 10) x = 10;
            if (y < 10) y = 10;
            
            projectContextMenu.style.left = x + 'px';
            projectContextMenu.style.top = y + 'px';
            activeProject = projectName;
        }

        let projectDragStarted = false;
        projectList.addEventListener('mousedown', (e) => {
            projectDragStarted = false;
        });
        projectList.addEventListener('dragstart', () => {
            projectDragStarted = true;
        });
        projectList.addEventListener('mouseup', (e) => {
            setTimeout(() => {
                if (!projectDragStarted && e.target.tagName === 'LI') {
                    const projectName = e.target.id.replace('project-', '');
                    renderProject(projectName);
                }
            }, 50);
        });

        // ëª¨ë°”ì¼/ë°ìŠ¤í¬í†± í˜¸í™˜ ì»¨í…ìŠ¤íŠ¸ ë©”ë‰´ ì‹œìŠ¤í…œ
        let touchTimer = null;
        let touchTarget = null;
        let touchStartTime = 0;
        
        // í”„ë¡œì íŠ¸ ë¦¬ìŠ¤íŠ¸ ì»¨í…ìŠ¤íŠ¸ ë©”ë‰´
        function addContextMenuListeners(element, contextType) {
            // ë°ìŠ¤í¬í†± ìš°í´ë¦­
            element.addEventListener('contextmenu', (e) => {
                e.preventDefault();
                handleContextMenu(e, contextType);
            });
            
            // ëª¨ë°”ì¼ ê¸¸ê²Œ ëˆ„ë¥´ê¸°
            element.addEventListener('touchstart', (e) => {
                touchTarget = e.target;
                touchStartTime = Date.now();
                
                // ì¦‰ì‹œ ë¹„ì£¼ì–¼ í”¼ë“œë°± ì‹œì‘
                const targetElement = e.target.closest('.item-button') || e.target.closest('li') || e.target;
                targetElement.classList.add('long-press-active');
                
                touchTimer = setTimeout(() => {
                    // 1.2ì´ˆ í›„ ì»¨í…ìŠ¤íŠ¸ ë©”ë‰´ í‘œì‹œ
                    if (touchTarget === e.target) {
                        // í–…í‹± í”¼ë“œë°± (ì§€ì›í•˜ëŠ” ê²½ìš°)
                        if (navigator.vibrate) {
                            navigator.vibrate(50);
                        }
                        targetElement.classList.remove('long-press-active');
                        
                        // í„°ì¹˜ ì´ë²¤íŠ¸ë¥¼ ìœ„í•œ ì¢Œí‘œ ë³€í™˜
                        const touch = e.touches[0] || e.changedTouches[0];
                        const touchEvent = {
                            clientX: touch ? touch.clientX : e.clientX,
                            clientY: touch ? touch.clientY : e.clientY,
                            target: e.target,
                            preventDefault: e.preventDefault.bind(e)
                        };
                        
                        handleContextMenu(touchEvent, contextType);
                    }
                }, 1200);
            });
            
            element.addEventListener('touchend', (e) => {
                // ë¹„ì£¼ì–¼ í”¼ë“œë°± ì œê±°
                const targetElement = e.target.closest('.item-button') || e.target.closest('li') || e.target;
                targetElement.classList.remove('long-press-active');
                
                if (touchTimer) {
                    clearTimeout(touchTimer);
                    touchTimer = null;
                }
                
                // ì§§ì€ í„°ì¹˜ëŠ” ì¼ë°˜ í´ë¦­ìœ¼ë¡œ ì²˜ë¦¬
                const touchDuration = Date.now() - touchStartTime;
                if (touchDuration < 1200 && touchTarget === e.target) {
                    // ì¼ë°˜ í´ë¦­ ë™ì‘
                    if (contextType === 'project' && e.target.tagName === 'LI') {
                        const projectName = e.target.textContent;
                        renderProject(projectName);
                    }
                }
                
                touchTarget = null;
            });
            
            element.addEventListener('touchmove', (e) => {
                // í„°ì¹˜ê°€ ì´ë™í•˜ë©´ ê¸¸ê²Œ ëˆ„ë¥´ê¸° ì·¨ì†Œ
                const targetElement = e.target.closest('.item-button') || e.target.closest('li') || e.target;
                targetElement.classList.remove('long-press-active');
                
                if (touchTimer) {
                    clearTimeout(touchTimer);
                    touchTimer = null;
                }
                touchTarget = null;
            });
        }
        
        function handleContextMenu(e, contextType) {
            e.preventDefault();
            
            if (contextType === 'project' && e.target.tagName === 'LI') {
                const projectName = e.target.id.replace('project-', '');
                showProjectContextMenu(e, projectName);
            } else if (contextType === 'bookmark') {
                const button = e.target.closest('.item-button.bookmark-button');
                if (button) {
                    const index = parseInt(button.dataset.index);
                    showContextMenu(e, 'bookmark', index);
                }
            } else if (contextType === 'clipboard') {
                const button = e.target.closest('.item-button.clipboard-button');
                const divider = e.target.closest('.divider');
                if (button) {
                    const index = parseInt(button.dataset.index);
                    showContextMenu(e, 'clipboard', index);
                } else if (divider) {
                    const index = parseInt(divider.dataset.index);
                    showContextMenu(e, 'divider', index);
                }
            }
        }
        
        // ì»¨í…ìŠ¤íŠ¸ ë©”ë‰´ ë¦¬ìŠ¤ë„ˆ ë“±ë¡
        addContextMenuListeners(projectList, 'project');
        addContextMenuListeners(bookmarkList, 'bookmark');
        addContextMenuListeners(clipboardList, 'clipboard');

        document.addEventListener('click', (e) => {
            if (!contextMenu.contains(e.target)) {
                contextMenu.style.display = 'none';
                activeItem = null;
            }
            if (!projectContextMenu.contains(e.target)) {
                projectContextMenu.style.display = 'none';
                activeProject = null;
            }
        });

        contextEdit.addEventListener('click', () => {
            if (activeItem) {
                const { type, index } = activeItem;
                const projectData = allProjectsData[currentProject];
                
                if (type === 'bookmark') {
                    const item = projectData.bookmarks[index];
                    const modal = document.getElementById('add-bookmark-modal');
                    document.querySelector('#add-bookmark-modal h2').textContent = 'ë¶ë§ˆí¬ í¸ì§‘';
                    document.getElementById('add-bookmark-name').value = item.name;
                    document.getElementById('add-bookmark-url').value = item.url;
                    modal.style.display = 'flex';
                    modal.dataset.editMode = 'true';
                    modal.dataset.editIndex = index;
                } else if (type === 'clipboard') {
                    const item = projectData.clipboard[index];
                    const modal = document.getElementById('add-clipboard-modal');
                    document.querySelector('#add-clipboard-modal h2').textContent = 'í´ë¦½ë³´ë“œ í¸ì§‘';
                    document.getElementById('add-clipboard-title').value = item.title || '';
                    document.getElementById('add-clipboard-content').value = item.text;
                    modal.style.display = 'flex';
                    modal.dataset.editMode = 'true';
                    modal.dataset.editIndex = index;
                }
                contextMenu.style.display = 'none';
                activeItem = null;
            }
        });

        contextFavorite.addEventListener('click', () => {
            if (activeItem) {
                const { type, index } = activeItem;
                const projectData = allProjectsData[currentProject];
                
                if (type === 'bookmark') {
                    projectData.bookmarks[index].favorite = !projectData.bookmarks[index].favorite;
                } else if (type === 'clipboard') {
                    projectData.clipboard[index].favorite = !projectData.clipboard[index].favorite;
                }
                
                renderProject(currentProject);
                
                // TODAY í”„ë¡œì íŠ¸ê°€ í˜„ì¬ í™œì„±í™”ë˜ì–´ ìˆë‹¤ë©´ ìë™ ì—…ë°ì´íŠ¸
                // ë˜ëŠ” ë‹¤ë¥¸ í”„ë¡œì íŠ¸ì—ì„œ ì¦ê²¨ì°¾ê¸°ë¥¼ ë³€ê²½í–ˆë‹¤ë©´ TODAYë„ ì—…ë°ì´íŠ¸ í•„ìš”ì‹œ ë°˜ì˜
                if (currentProject !== 'TODAY') {
                    // í˜„ì¬ í”„ë¡œì íŠ¸ê°€ TODAYê°€ ì•„ë‹ˆë¼ë©´, ë‚˜ì¤‘ì— TODAY ì ‘ì†ì‹œ ìµœì‹  ì¦ê²¨ì°¾ê¸°ê°€ ë°˜ì˜ë¨
                } else {
                    // í˜„ì¬ TODAYë¼ë©´ ì¦‰ì‹œ ì—…ë°ì´íŠ¸ (ì´ë¯¸ renderProjectì—ì„œ ì²˜ë¦¬ë¨)
                }
                
                contextMenu.style.display = 'none';
                activeItem = null;
                saveToFirebase();
            }
        });

        contextColor.addEventListener('click', () => {
            if (activeItem) {
                colorChangeItem = activeItem;
                const colorPaletteModal = document.getElementById('color-palette-modal');
                colorPaletteModal.style.display = 'flex';
                
                const { type, index } = activeItem;
                const projectData = allProjectsData[currentProject];
                let currentColor = '';
                if (type === 'bookmark') {
                    currentColor = projectData.bookmarks[index].color || '#f8f9fa';
                } else if (type === 'clipboard') {
                    currentColor = projectData.clipboard[index].color || '#f8f9fa';
                }
                
                document.querySelectorAll('.color-option').forEach(option => {
                    option.classList.remove('selected');
                    if (option.dataset.color === currentColor) {
                        option.classList.add('selected');
                    }
                });
                
                contextMenu.style.display = 'none';
                activeItem = null;
            }
        });

        contextDelete.addEventListener('click', () => {
            if (activeItem) {
                const { type, index } = activeItem;
                if (type === 'bookmark') {
                    allProjectsData[currentProject].bookmarks.splice(index, 1);
                } else if (type === 'clipboard') {
                    allProjectsData[currentProject].clipboard.splice(index, 1);
                } else if (type === 'divider') {
                    // êµ¬ë¶„ì„ ì˜ ê²½ìš° ì–´ëŠ ëª©ë¡ì—ì„œ ì˜¨ ê²ƒì¸ì§€ í™•ì¸
                    const dividerElement = document.querySelector(`[data-index="${index}"][data-type="clipboard"], [data-index="${index}"][data-type="bookmark"]`);
                    if (dividerElement) {
                        const dividerType = dividerElement.dataset.type;
                        if (dividerType === 'bookmark') {
                            allProjectsData[currentProject].bookmarks.splice(index, 1);
                        } else {
                            allProjectsData[currentProject].clipboard.splice(index, 1);
                        }
                    }
                }
                renderProject(currentProject);
                contextMenu.style.display = 'none';
                activeItem = null;
                saveToFirebase();
            }
        });

        contextCancel.addEventListener('click', () => {
            contextMenu.style.display = 'none';
            activeItem = null;
        });
        
        addBookmarkBtn.addEventListener('click', addBookmark);
        addClipboardBtn.addEventListener('click', addClipboard);
        addDividerBtn.addEventListener('click', addDivider);
        addBookmarkDividerBtn.addEventListener('click', addBookmarkDivider);
        
        // ì—°ìŠµì¥ íƒ­ í´ë¦­ ì´ë²¤íŠ¸
        document.querySelectorAll('.practice-tab').forEach(tab => {
            tab.addEventListener('click', (e) => {
                e.preventDefault();
                const tabNumber = parseInt(e.target.dataset.tab);
                if (tabNumber !== currentPracticeTab) {
                    switchPracticeTab(tabNumber);
                }
            });
        });
        
        const addProjectBtn = document.getElementById('add-project-btn');
        addProjectBtn.addEventListener('click', addProject);

        const addBookmarkModal = document.getElementById('add-bookmark-modal');
        const addBookmarkSave = document.getElementById('add-bookmark-save');
        const addBookmarkCancel = document.getElementById('add-bookmark-cancel');
        const addBookmarkClose = document.querySelector('.add-bookmark-close');
        
        addBookmarkSave.addEventListener('click', () => {
            const name = document.getElementById('add-bookmark-name').value.trim();
            const url = document.getElementById('add-bookmark-url').value.trim();
            
            if (!name || !url) {
                alert('ì´ë¦„ê³¼ URLì„ ëª¨ë‘ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                return;
            }
            
            if (addBookmarkModal.dataset.editMode === 'true') {
                const index = parseInt(addBookmarkModal.dataset.editIndex);
                allProjectsData[currentProject].bookmarks[index].name = name;
                allProjectsData[currentProject].bookmarks[index].url = url;
            } else {
                allProjectsData[currentProject].bookmarks.push({ 
                    name: name, 
                    url: url, 
                    color: '#f8f9fa',
                    favorite: false
                });
            }
            renderProject(currentProject);
            addBookmarkModal.style.display = 'none';
            saveToFirebase();
        });
        
        addBookmarkCancel.addEventListener('click', () => {
            addBookmarkModal.style.display = 'none';
        });
        
        addBookmarkClose.addEventListener('click', () => {
            addBookmarkModal.style.display = 'none';
        });

        const addClipboardModal = document.getElementById('add-clipboard-modal');
        const addClipboardSave = document.getElementById('add-clipboard-save');
        const addClipboardCancel = document.getElementById('add-clipboard-cancel');
        const addClipboardClose = document.querySelector('.add-clipboard-close');
        
        addClipboardSave.addEventListener('click', () => {
            const title = document.getElementById('add-clipboard-title').value.trim();
            const content = document.getElementById('add-clipboard-content').value.trim();
            
            if (!title || !content) {
                alert('ì œëª©ê³¼ ë‚´ìš©ì„ ëª¨ë‘ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                return;
            }
            
            // clipboard ë°°ì—´ì´ ì¡´ì¬í•˜ëŠ”ì§€ í™•ì¸
            if (!allProjectsData[currentProject].clipboard) {
                allProjectsData[currentProject].clipboard = [];
            }
            
            if (addClipboardModal.dataset.editMode === 'true') {
                const index = parseInt(addClipboardModal.dataset.editIndex);
                allProjectsData[currentProject].clipboard[index].title = title;
                allProjectsData[currentProject].clipboard[index].text = content;
            } else {
                allProjectsData[currentProject].clipboard.push({ 
                    title: title,
                    text: content, 
                    color: '#f8f9fa',
                    favorite: false
                });
            }
            renderProject(currentProject);
            addClipboardModal.style.display = 'none';
            saveToFirebase();
        });
        
        addClipboardCancel.addEventListener('click', () => {
            addClipboardModal.style.display = 'none';
        });
        
        addClipboardClose.addEventListener('click', () => {
            addClipboardModal.style.display = 'none';
        });

        // í¸ì§‘ìš© ëª¨ë‹¬ì€ ì˜ì—­ ë°”ê¹¥ í´ë¦­ìœ¼ë¡œ ë‹«íˆì§€ ì•Šë„ë¡ ì´ë²¤íŠ¸ ì œê±°
        // addBookmarkModal.addEventListener('click', (e) => {
        //     if (e.target === addBookmarkModal) {
        //         addBookmarkModal.style.display = 'none';
        //     }
        // });
        
        // addClipboardModal.addEventListener('click', (e) => {
        //     if (e.target === addClipboardModal) {
        //         addClipboardModal.style.display = 'none';
        //     }
        // });

        const addProjectModal = document.getElementById('add-project-modal');
        const addProjectSave = document.getElementById('add-project-save');
        const addProjectCancel = document.getElementById('add-project-cancel');
        const addProjectClose = document.querySelector('.add-project-close');
        
        addProjectSave.addEventListener('click', () => {
            const name = document.getElementById('add-project-name').value.trim();
            
            if (!name) {
                alert('í”„ë¡œì íŠ¸ ì´ë¦„ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                return;
            }
            
            if (allProjectsData[name]) {
                alert('ì´ë¯¸ ì¡´ì¬í•˜ëŠ” í”„ë¡œì íŠ¸ ì´ë¦„ì…ë‹ˆë‹¤.');
                return;
            }
            
            allProjectsData[name] = {
                bookmarks: [],
                clipboard: []
            };
            
            // ìƒˆ í”„ë¡œì íŠ¸ë¥¼ projectOrder ë°°ì—´ì— ì¶”ê°€
            if (!projectOrder) {
                projectOrder = Object.keys(allProjectsData);
            } else {
                projectOrder.push(name);
            }
            
            renderProjectList();
            renderProject(name);
            
            addProjectModal.style.display = 'none';
            saveToFirebase();
        });
        
        addProjectCancel.addEventListener('click', () => {
            addProjectModal.style.display = 'none';
        });
        
        addProjectClose.addEventListener('click', () => {
            addProjectModal.style.display = 'none';
        });
        
        // í”„ë¡œì íŠ¸ ì¶”ê°€ ëª¨ë‹¬ë„ í¸ì§‘ìš©ì´ë¯€ë¡œ ì˜ì—­ ë°”ê¹¥ í´ë¦­ìœ¼ë¡œ ë‹«íˆì§€ ì•Šë„ë¡ ì´ë²¤íŠ¸ ì œê±°
        // addProjectModal.addEventListener('click', (e) => {
        //     if (e.target === addProjectModal) {
        //         addProjectModal.style.display = 'none';
        //     }
        // });

        const settingsBtn = document.getElementById('settings-btn');
        const settingsModal = document.getElementById('settings-modal');
        const settingsCloseBtn = settingsModal.querySelector('.close-button');
        const exportDataBtn = document.getElementById('export-data-btn');
        const importDataBtn = document.getElementById('import-data-btn');
        const importDataInput = document.getElementById('import-data-input');
        
        settingsBtn.addEventListener('click', () => {
            settingsModal.style.display = 'flex';
        });
        
        settingsCloseBtn.addEventListener('click', () => {
            settingsModal.style.display = 'none';
        });
        
        settingsModal.addEventListener('click', (e) => {
            if (e.target === settingsModal) {
                settingsModal.style.display = 'none';
            }
        });

        // ë°ì´í„° ë‚´ë³´ë‚´ê¸° (ë°±ì—…)
        exportDataBtn.addEventListener('click', () => {
            try {
                const dataToExport = {
                    projects: allProjectsData,
                    currentProject: currentProject,
                    exportDate: new Date().toISOString(),
                    version: '1.0'
                };
                
                const jsonString = JSON.stringify(dataToExport, null, 2);
                const blob = new Blob([jsonString], { type: 'application/json' });
                
                // íŒŒì¼ëª… ìƒì„± (í˜„ì¬ ë‚ ì§œì™€ ì‹œê°„ í¬í•¨)
                const now = new Date();
                const dateString = now.getFullYear() + 
                    String(now.getMonth() + 1).padStart(2, '0') + 
                    String(now.getDate()).padStart(2, '0') + '_' +
                    String(now.getHours()).padStart(2, '0') + 
                    String(now.getMinutes()).padStart(2, '0');
                const filename = `ë¶ë§ˆí¬í´ë¦½ë³´ë“œ_ë°±ì—…_${dateString}.json`;
                
                // ë‹¤ìš´ë¡œë“œ ë§í¬ ìƒì„± ë° ì‹¤í–‰
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = filename;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
                
                alert(`ë°ì´í„°ê°€ ì„±ê³µì ìœ¼ë¡œ ë‚´ë³´ë‚´ì¡ŒìŠµë‹ˆë‹¤.\níŒŒì¼ëª…: ${filename}`);
            } catch (error) {
                console.error('ë°ì´í„° ë‚´ë³´ë‚´ê¸° ì‹¤íŒ¨:', error);
                alert('ë°ì´í„° ë‚´ë³´ë‚´ê¸°ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
            }
        });

        // ë°ì´í„° ë¶ˆëŸ¬ì˜¤ê¸° ë²„íŠ¼ í´ë¦­ ì‹œ íŒŒì¼ ì„ íƒ ì°½ ì—´ê¸°
        importDataBtn.addEventListener('click', () => {
            importDataInput.click();
        });

        // íŒŒì¼ ì„ íƒ ì‹œ ë°ì´í„° ë¶ˆëŸ¬ì˜¤ê¸°
        importDataInput.addEventListener('change', (e) => {
            const file = e.target.files[0];
            if (!file) return;

            if (file.type !== 'application/json') {
                alert('JSON íŒŒì¼ë§Œ ì§€ì›ë©ë‹ˆë‹¤.');
                return;
            }

            const reader = new FileReader();
            reader.onload = (event) => {
                try {
                    const importedData = JSON.parse(event.target.result);
                    
                    // ë°ì´í„° ìœ íš¨ì„± ê²€ì‚¬
                    if (!importedData.projects || typeof importedData.projects !== 'object') {
                        throw new Error('ì˜¬ë°”ë¥´ì§€ ì•Šì€ ë°±ì—… íŒŒì¼ í˜•ì‹ì…ë‹ˆë‹¤.');
                    }

                    // ë°ì´í„° êµ¬ì¡° ê²€ì¦
                    for (const [projectName, projectData] of Object.entries(importedData.projects)) {
                        if (!projectData.bookmarks || !projectData.clipboard || 
                            !Array.isArray(projectData.bookmarks) || !Array.isArray(projectData.clipboard)) {
                            throw new Error(`í”„ë¡œì íŠ¸ '${projectName}'ì˜ ë°ì´í„° êµ¬ì¡°ê°€ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤.`);
                        }
                    }

                    // ë³µì› ë°©ì‹ ì„ íƒ
                    const choice = confirm('ë°ì´í„° ë³µì› ë°©ì‹ì„ ì„ íƒí•´ì£¼ì„¸ìš”.\n\n' +
                                         'í™•ì¸: ë³‘í•© ëª¨ë“œ (ê¸°ì¡´ ë°ì´í„° ë³´ì¡´ + ë°±ì—… ë°ì´í„° ì¶”ê°€)\n' +
                                         'ì·¨ì†Œ: ì™„ì „ êµì²´ (ê¸°ì¡´ ë°ì´í„° ì‚­ì œ + ë°±ì—… ë°ì´í„°ë¡œ êµì²´)');
                    
                    if (choice) {
                        // ë³‘í•© ëª¨ë“œ
                        performDataMerge(importedData);
                    } else {
                        // ì™„ì „ êµì²´ ëª¨ë“œ
                        if (confirm('âš ï¸ ì™„ì „ êµì²´ ëª¨ë“œì…ë‹ˆë‹¤.\ní˜„ì¬ ëª¨ë“  ë°ì´í„°ê°€ ì‚­ì œë˜ê³  ë°±ì—… ë°ì´í„°ë¡œ êµì²´ë©ë‹ˆë‹¤.\nì •ë§ ì§„í–‰í•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                            performDataReplace(importedData);
                        }
                    }
                } catch (error) {
                    console.error('ë°ì´í„° ë¶ˆëŸ¬ì˜¤ê¸° ì‹¤íŒ¨:', error);
                    alert(`ë°ì´í„° ë¶ˆëŸ¬ì˜¤ê¸°ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.\nì˜¤ë¥˜: ${error.message}`);
                }
            };
            
            reader.onerror = () => {
                alert('íŒŒì¼ ì½ê¸°ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
            };
            
            reader.readAsText(file);
            
            // íŒŒì¼ ì…ë ¥ ì´ˆê¸°í™” (ê°™ì€ íŒŒì¼ ì¬ì„ íƒ ê°€ëŠ¥í•˜ë„ë¡)
            e.target.value = '';
        });

        // ë°ì´í„° ë³‘í•© ì²˜ë¦¬ í•¨ìˆ˜
        function performDataMerge(importedData) {
            const conflictProjects = [];
            const newProjects = [];
            
            // ì¶©ëŒ í”„ë¡œì íŠ¸ì™€ ìƒˆ í”„ë¡œì íŠ¸ ë¶„ë¥˜
            for (const [projectName, projectData] of Object.entries(importedData.projects)) {
                if (allProjectsData[projectName]) {
                    conflictProjects.push(projectName);
                } else {
                    newProjects.push(projectName);
                }
            }
            
            // ì¶©ëŒì´ ìˆëŠ” ê²½ìš° ì¼ê´„ ì²˜ë¦¬ ì˜µì…˜ ì œê³µ
            if (conflictProjects.length > 0) {
                const conflictMessage = `${conflictProjects.length}ê°œì˜ ê¸°ì¡´ í”„ë¡œì íŠ¸ì™€ ì´ë¦„ì´ ì¤‘ë³µë©ë‹ˆë‹¤:\n` +
                                      `${conflictProjects.map(name => `â€¢ ${name}`).join('\n')}\n\n` +
                                      `ì–´ë–»ê²Œ ì²˜ë¦¬í•˜ì‹œê² ìŠµë‹ˆê¹Œ?`;
                
                const choice = confirm(conflictMessage + '\n\n' +
                                     'í™•ì¸: ëª¨ë“  ì¶©ëŒ í”„ë¡œì íŠ¸ë¥¼ ë³‘í•© (ê¸°ì¡´ + ë°±ì—… ë°ì´í„°)\n' +
                                     'ì·¨ì†Œ: ê°œë³„ ì„ íƒ (í”„ë¡œì íŠ¸ë³„ë¡œ í™•ì¸)');
                
                if (choice) {
                    // ì¼ê´„ ë³‘í•©
                    performBatchMerge(importedData, conflictProjects, newProjects);
                } else {
                    // ê°œë³„ ì„ íƒ
                    performIndividualMerge(importedData, conflictProjects, newProjects);
                }
            } else {
                // ì¶©ëŒì´ ì—†ìœ¼ë©´ ë°”ë¡œ ë³‘í•©
                performBatchMerge(importedData, [], newProjects);
            }
        }

        // ì¼ê´„ ë³‘í•© ì²˜ë¦¬
        function performBatchMerge(importedData, conflictProjects, newProjects) {
            const mergeResults = {
                newProjects: [],
                conflictProjects: [],
                addedBookmarks: 0,
                addedClipboard: 0
            };

            // ìƒˆ í”„ë¡œì íŠ¸ ì¶”ê°€
            newProjects.forEach(projectName => {
                const projectData = importedData.projects[projectName];
                allProjectsData[projectName] = {
                    bookmarks: [...projectData.bookmarks],
                    clipboard: [...projectData.clipboard]
                };
                mergeResults.newProjects.push(projectName);
                mergeResults.addedBookmarks += projectData.bookmarks.length;
                mergeResults.addedClipboard += projectData.clipboard.length;
            });

            // ì¶©ëŒ í”„ë¡œì íŠ¸ ì¼ê´„ ë³‘í•©
            conflictProjects.forEach(projectName => {
                const projectData = importedData.projects[projectName];
                
                // ë¶ë§ˆí¬ ë³‘í•© (ì¤‘ë³µ ì œê±°)
                const existingBookmarks = allProjectsData[projectName].bookmarks;
                const newBookmarks = projectData.bookmarks.filter(newBookmark => {
                    return !existingBookmarks.some(existing => 
                        existing.name === newBookmark.name && existing.url === newBookmark.url
                    );
                });
                existingBookmarks.push(...newBookmarks);
                mergeResults.addedBookmarks += newBookmarks.length;

                // í´ë¦½ë³´ë“œ ë³‘í•© (ì¤‘ë³µ ì œê±°)
                const existingClipboard = allProjectsData[projectName].clipboard;
                const newClipboard = projectData.clipboard.filter(newClip => {
                    return !existingClipboard.some(existing => 
                        existing.text === newClip.text
                    );
                });
                existingClipboard.push(...newClipboard);
                mergeResults.addedClipboard += newClipboard.length;

                mergeResults.conflictProjects.push(projectName);
            });

            // ë³‘í•© ì™„ë£Œ ì²˜ë¦¬
            finalizeMerge(importedData, mergeResults);
        }

        // ê°œë³„ ì„ íƒ ë³‘í•© ì²˜ë¦¬
        function performIndividualMerge(importedData, conflictProjects, newProjects) {
            const mergeResults = {
                newProjects: [],
                conflictProjects: [],
                addedBookmarks: 0,
                addedClipboard: 0
            };

            // ìƒˆ í”„ë¡œì íŠ¸ ë¨¼ì € ì¶”ê°€
            newProjects.forEach(projectName => {
                const projectData = importedData.projects[projectName];
                allProjectsData[projectName] = {
                    bookmarks: [...projectData.bookmarks],
                    clipboard: [...projectData.clipboard]
                };
                mergeResults.newProjects.push(projectName);
                mergeResults.addedBookmarks += projectData.bookmarks.length;
                mergeResults.addedClipboard += projectData.clipboard.length;
            });

            // ì¶©ëŒ í”„ë¡œì íŠ¸ ê°œë³„ ì²˜ë¦¬
            for (const projectName of conflictProjects) {
                const projectData = importedData.projects[projectName];
                const bookmarkCount = projectData.bookmarks.length;
                const clipboardCount = projectData.clipboard.length;
                
                const userChoice = confirm(`í”„ë¡œì íŠ¸: ${projectName}\n` +
                                         `ë°±ì—… ë°ì´í„°: ë¶ë§ˆí¬ ${bookmarkCount}ê°œ, í´ë¦½ë³´ë“œ ${clipboardCount}ê°œ\n\n` +
                                         `í™•ì¸: ì´ í”„ë¡œì íŠ¸ë¥¼ ë³‘í•© (ê¸°ì¡´ ë°ì´í„° ìœ ì§€ + ë°±ì—… ë°ì´í„° ì¶”ê°€)\n` +
                                         `ì·¨ì†Œ: ì´ í”„ë¡œì íŠ¸ëŠ” ê±´ë„ˆë›°ê¸°`);
                
                if (userChoice) {
                    // ë¶ë§ˆí¬ ë³‘í•©
                    const existingBookmarks = allProjectsData[projectName].bookmarks;
                    const newBookmarks = projectData.bookmarks.filter(newBookmark => {
                        return !existingBookmarks.some(existing => 
                            existing.name === newBookmark.name && existing.url === newBookmark.url
                        );
                    });
                    existingBookmarks.push(...newBookmarks);
                    mergeResults.addedBookmarks += newBookmarks.length;

                    // í´ë¦½ë³´ë“œ ë³‘í•©
                    const existingClipboard = allProjectsData[projectName].clipboard;
                    const newClipboard = projectData.clipboard.filter(newClip => {
                        return !existingClipboard.some(existing => 
                            existing.text === newClip.text
                        );
                    });
                    existingClipboard.push(...newClipboard);
                    mergeResults.addedClipboard += newClipboard.length;

                    mergeResults.conflictProjects.push(projectName);
                }
            }

            // ë³‘í•© ì™„ë£Œ ì²˜ë¦¬
            finalizeMerge(importedData, mergeResults);
        }

        // ë°ì´í„° ì™„ì „ êµì²´ ì²˜ë¦¬ í•¨ìˆ˜
        function performDataReplace(importedData) {
            // ê¸°ì¡´ ë°ì´í„° ì™„ì „ ì‚­ì œ
            Object.keys(allProjectsData).forEach(key => delete allProjectsData[key]);
            
            // ë°±ì—… ë°ì´í„°ë¡œ êµì²´
            Object.assign(allProjectsData, importedData.projects);
            
            const availableProjects = Object.keys(allProjectsData);
            if (availableProjects.length > 0) {
                currentProject = importedData.currentProject && 
                               allProjectsData[importedData.currentProject] ? 
                               importedData.currentProject : availableProjects[0];
            }

            // ì™„ë£Œ ì²˜ë¦¬
            finalizeRestore(availableProjects.length, 'ì™„ì „ êµì²´');
        }

        // ë³‘í•© ì™„ë£Œ ì²˜ë¦¬
        function finalizeMerge(importedData, results) {
            // í˜„ì¬ í”„ë¡œì íŠ¸ ì„¤ì • (ê¸°ì¡´ í”„ë¡œì íŠ¸ ìœ ì§€ ë˜ëŠ” ìƒˆ í”„ë¡œì íŠ¸ë¡œ ì„¤ì •)
            if (importedData.currentProject && allProjectsData[importedData.currentProject]) {
                currentProject = importedData.currentProject;
            }

            // ì™„ë£Œ ì²˜ë¦¬
            const totalProjects = Object.keys(allProjectsData).length;
            const message = `âœ… ë³‘í•©ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤!\n\n` +
                          `ğŸ“Š ë³‘í•© ê²°ê³¼:\n` +
                          `â€¢ ìƒˆ í”„ë¡œì íŠ¸: ${results.newProjects.length}ê°œ\n` +
                          `â€¢ ë³‘í•©ëœ í”„ë¡œì íŠ¸: ${results.conflictProjects.length}ê°œ\n` +
                          `â€¢ ì¶”ê°€ëœ ë¶ë§ˆí¬: ${results.addedBookmarks}ê°œ\n` +
                          `â€¢ ì¶”ê°€ëœ í´ë¦½ë³´ë“œ: ${results.addedClipboard}ê°œ\n` +
                          `â€¢ ì „ì²´ í”„ë¡œì íŠ¸: ${totalProjects}ê°œ`;
            
            finalizeRestore(totalProjects, 'ë³‘í•©', message);
        }

        // ë³µì› ì™„ë£Œ ê³µí†µ ì²˜ë¦¬
        function finalizeRestore(projectCount, mode, customMessage = null) {
            // ë¡œì»¬ìŠ¤í† ë¦¬ì§€ì— ì €ì¥
            saveToFirebase();
            
            // í™”ë©´ ì—…ë°ì´íŠ¸
            renderProjectList();
            renderProject(currentProject);
            
            // ëª¨ë‹¬ ë‹«ê¸°
            settingsModal.style.display = 'none';
            
            // ì™„ë£Œ ë©”ì‹œì§€
            const defaultMessage = `ë°ì´í„° ${mode}ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤!\ní”„ë¡œì íŠ¸ ${projectCount}ê°œê°€ ì²˜ë¦¬ë˜ì—ˆìŠµë‹ˆë‹¤.`;
            alert(customMessage || defaultMessage);
        }

        projectContextRename.addEventListener('click', () => {
            if (activeProject) {
                const newName = prompt('ìƒˆ í”„ë¡œì íŠ¸ ì´ë¦„ì„ ì…ë ¥í•´ì£¼ì„¸ìš”:', activeProject);
                if (newName && newName.trim() !== '' && newName.trim() !== activeProject) {
                    const trimmedName = newName.trim();
                    
                    if (allProjectsData[trimmedName]) {
                        alert('ì´ë¯¸ ì¡´ì¬í•˜ëŠ” í”„ë¡œì íŠ¸ ì´ë¦„ì…ë‹ˆë‹¤.');
                        return;
                    }
                    
                    allProjectsData[trimmedName] = allProjectsData[activeProject];
                    delete allProjectsData[activeProject];
                    
                    // projectOrderì—ì„œ í”„ë¡œì íŠ¸ëª… ë³€ê²½
                    if (projectOrder) {
                        const index = projectOrder.indexOf(activeProject);
                        if (index !== -1) {
                            projectOrder[index] = trimmedName;
                        }
                    }
                    
                    if (currentProject === activeProject) {
                        currentProject = trimmedName;
                    }
                    
                    renderProjectList();
                    renderProject(trimmedName);
                    saveToFirebase();
                }
                projectContextMenu.style.display = 'none';
                activeProject = null;
            }
        });

        projectContextDelete.addEventListener('click', () => {
            if (activeProject) {
                if (Object.keys(allProjectsData).length <= 1) {
                    alert('ìµœì†Œ í•˜ë‚˜ì˜ í”„ë¡œì íŠ¸ëŠ” í•„ìš”í•©ë‹ˆë‹¤.');
                    return;
                }
                
                if (confirm(`'${activeProject}' í”„ë¡œì íŠ¸ë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?`)) {
                    delete allProjectsData[activeProject];
                    
                    // projectOrderì—ì„œ ì‚­ì œëœ í”„ë¡œì íŠ¸ ì œê±°
                    if (projectOrder) {
                        const index = projectOrder.indexOf(activeProject);
                        if (index !== -1) {
                            projectOrder.splice(index, 1);
                        }
                    }
                    
                    if (currentProject === activeProject) {
                        const remainingProjects = projectOrder && projectOrder.length > 0 
                            ? projectOrder 
                            : Object.keys(allProjectsData);
                        currentProject = remainingProjects[0];
                    }
                    
                    renderProjectList();
                    renderProject(currentProject);
                    saveToFirebase();
                }
                projectContextMenu.style.display = 'none';
                activeProject = null;
            }
        });

        projectContextCancel.addEventListener('click', () => {
            projectContextMenu.style.display = 'none';
            activeProject = null;
        });

        const colorPaletteModal = document.getElementById('color-palette-modal');
        const colorPaletteClose = document.querySelector('.color-palette-close');
        
        colorPaletteClose.addEventListener('click', () => {
            colorPaletteModal.style.display = 'none';
            colorChangeItem = null;
        });
        
        colorPaletteModal.addEventListener('click', (e) => {
            if (e.target === colorPaletteModal) {
                colorPaletteModal.style.display = 'none';
                colorChangeItem = null;
            }
        });
        
        document.querySelectorAll('.color-option').forEach(option => {
            option.addEventListener('click', () => {
                if (colorChangeItem) {
                    const selectedColor = option.dataset.color;
                    const { type, index } = colorChangeItem;
                    const projectData = allProjectsData[currentProject];
                    
                    if (type === 'bookmark') {
                        projectData.bookmarks[index].color = selectedColor;
                    } else if (type === 'clipboard') {
                        projectData.clipboard[index].color = selectedColor;
                    }
                    
                    renderProject(currentProject);
                    
                    colorPaletteModal.style.display = 'none';
                    colorChangeItem = null;
                }
            });
        });

        // í…œí”Œë¦¿ ë°ì´í„° ë¡œë“œ
        async function loadTemplates() {
            try {
                if (firebaseInitialized && db) {
                    const doc = await db.collection('templates').doc('userTemplates').get();
                    if (doc.exists) {
                        templates = doc.data().templates || [];
                    } else {
                        templates = [];
                    }
                } else {
                    // ë¡œì»¬ìŠ¤í† ë¦¬ì§€ì—ì„œ ë¡œë“œ
                    const savedTemplates = localStorage.getItem('templates');
                    if (savedTemplates) {
                        templates = JSON.parse(savedTemplates);
                    } else {
                        templates = [];
                    }
                }
                renderTemplates();
            } catch (error) {
                console.error('í…œí”Œë¦¿ ë¡œë“œ ì‹¤íŒ¨:', error);
                // ë¡œì»¬ìŠ¤í† ë¦¬ì§€ fallback
                const savedTemplates = localStorage.getItem('templates');
                if (savedTemplates) {
                    templates = JSON.parse(savedTemplates);
                } else {
                    templates = [];
                }
                renderTemplates();
            }
        }

        // í…œí”Œë¦¿ ë°ì´í„° ì €ì¥
        

        let draggedProject = null;

        function handleProjectDragStart(e) {
            draggedProject = e.target;
            e.target.classList.add('dragging');
            e.dataTransfer.effectAllowed = 'move';
            e.dataTransfer.setData('text/html', e.target.outerHTML);
        }

        function handleProjectDragOver(e) {
            e.preventDefault();
            e.dataTransfer.dropEffect = 'move';
        }

        function handleProjectDragEnter(e) {
            e.target.classList.add('drag-over');
        }

        function handleProjectDragLeave(e) {
            e.target.classList.remove('drag-over');
        }

        function handleProjectDrop(e) {
            e.preventDefault();
            e.target.classList.remove('drag-over');
            
            if (draggedProject && draggedProject !== e.target && e.target.tagName === 'LI') {
                const draggedProjectName = draggedProject.dataset.projectName;
                const targetProjectName = e.target.dataset.projectName;
                
                // projectOrder ë°°ì—´ì„ ì‚¬ìš©í•˜ì—¬ ìˆœì„œ ë³€ê²½
                const currentOrder = projectOrder || Object.keys(allProjectsData);
                const draggedIndex = currentOrder.indexOf(draggedProjectName);
                const targetIndex = currentOrder.indexOf(targetProjectName);
                
                if (draggedIndex !== -1 && targetIndex !== -1 && draggedIndex !== targetIndex) {
                    // ìˆœì„œ ë°°ì—´ì—ì„œ ì´ë™
                    currentOrder.splice(draggedIndex, 1);
                    currentOrder.splice(targetIndex, 0, draggedProjectName);
                    
                    // projectOrder ì—…ë°ì´íŠ¸
                    projectOrder = [...currentOrder];
                    
                    renderProjectList();
                    saveToFirebase();
                }
            }
        }

        function handleProjectDragEnd(e) {
            e.target.classList.remove('dragging');
            document.querySelectorAll('.project-item').forEach(item => {
                item.classList.remove('drag-over');
            });
            draggedProject = null;
        }

        function setupDropZones() {
            const bookmarkList = document.getElementById('bookmark-list');
            const clipboardList = document.getElementById('clipboard-list');
            
            [bookmarkList, clipboardList].forEach(list => {
                list.classList.add('drop-zone');
                list.addEventListener('dragover', handleItemDragOver);
                list.addEventListener('drop', handleItemDrop);
                list.addEventListener('dragenter', handleItemDragEnter);
                list.addEventListener('dragleave', handleItemDragLeave);
            });
        }

        let draggedItem = null;
        let draggedItemType = null;
        let draggedItemIndex = null;

        function handleItemDragStart(e) {
            draggedItem = e.target;
            draggedItemType = e.target.dataset.type;
            draggedItemIndex = parseInt(e.target.dataset.index);
            e.target.classList.add('dragging');
            e.dataTransfer.effectAllowed = 'move';
            e.dataTransfer.setData('text/html', e.target.outerHTML);
        }

        function handleItemDragOver(e) {
            e.preventDefault();
            e.dataTransfer.dropEffect = 'move';
            
            if (e.target.classList.contains('item-button')) {
                const targetType = e.target.dataset.type;
                if (draggedItemType === targetType) {
                    const rect = e.target.getBoundingClientRect();
                    const midY = rect.top + rect.height / 2;
                    
                    document.querySelectorAll('.drop-indicator').forEach(el => el.remove());
                    
                    const indicator = document.createElement('div');
                    indicator.className = 'drop-indicator';
                    indicator.style.cssText = `
                        position: absolute;
                        left: ${rect.left - 5}px;
                        width: ${rect.width + 10}px;
                        height: 2px;
                        background-color: #3b82f6;
                        z-index: 1000;
                        pointer-events: none;
                    `;
                    
                    if (e.clientY < midY) {
                        indicator.style.top = `${rect.top - 1}px`;
                        e.target.dataset.insertBefore = 'true';
                    } else {
                        indicator.style.top = `${rect.bottom - 1}px`;
                        e.target.dataset.insertBefore = 'false';
                    }
                    
                    document.body.appendChild(indicator);
                }
            }
        }

        function handleItemDragEnter(e) {
            if (e.target.classList.contains('item-list')) {
                e.target.classList.add('drag-over');
            } else if (e.target.closest('.item-list')) {
                e.target.closest('.item-list').classList.add('drag-over');
            }
        }

        function handleItemDragLeave(e) {
            if (e.target.classList.contains('item-list')) {
                e.target.classList.remove('drag-over');
            } else if (e.target.closest('.item-list')) {
                e.target.closest('.item-list').classList.remove('drag-over');
            }
        }

        function handleItemDrop(e) {
            e.preventDefault();
            
            document.querySelectorAll('.drop-indicator').forEach(el => el.remove());
            
            document.querySelectorAll('.drag-over').forEach(el => {
                el.classList.remove('drag-over');
            });
            
            if (draggedItem && draggedItemType && draggedItemIndex !== null) {
                const targetButton = e.target.closest('.item-button');
                const targetList = e.target.closest('.item-list');
                
                if (targetButton && targetButton !== draggedItem) {
                    const targetType = targetButton.dataset.type;
                    const targetIndex = parseInt(targetButton.dataset.index);
                    
                    if (draggedItemType === targetType) {
                        const data = allProjectsData[currentProject][draggedItemType === 'bookmark' ? 'bookmarks' : 'clipboard'];
                        const itemToMove = data[draggedItemIndex];
                        
                        data.splice(draggedItemIndex, 1);
                        
                        let newIndex = targetIndex;
                        if (draggedItemIndex < targetIndex) {
                            newIndex = targetIndex - 1;
                        }
                        
                        const insertBefore = targetButton.dataset.insertBefore === 'true';
                        if (!insertBefore) {
                            newIndex += 1;
                        }
                        
                        data.splice(newIndex, 0, itemToMove);
                        
                        renderProject(currentProject);
                        saveToFirebase();
                        
                        delete targetButton.dataset.insertBefore;
                    }
                } else if (targetList && !targetButton) {
                    const targetType = targetList.id === 'bookmark-list' ? 'bookmark' : 'clipboard';
                    
                    if (draggedItemType === targetType) {
                        const data = allProjectsData[currentProject][draggedItemType === 'bookmark' ? 'bookmarks' : 'clipboard'];
                        const itemToMove = data[draggedItemIndex];
                        
                        data.splice(draggedItemIndex, 1);
                        data.push(itemToMove);
                        
                        renderProject(currentProject);
                        saveToFirebase();
                    }
                }
            }
        }

        function handleItemDragEnd(e) {
            e.target.classList.remove('dragging');
            
            document.querySelectorAll('.item-list, .content-panel').forEach(element => {
                element.classList.remove('drag-over');
            });
            document.querySelectorAll('.drop-indicator').forEach(el => el.remove());
            document.querySelectorAll('.item-button').forEach(button => {
                delete button.dataset.insertBefore;
            });
            
            draggedItem = null;
            draggedItemType = null;
            draggedItemIndex = null;
        }

        // View Clipboard Modal
        const viewClipboardModal = document.getElementById('view-clipboard-modal');
        const viewClipboardCloseBtn = viewClipboardModal.querySelector('.view-clipboard-close');
        const viewClipboardCopyBtn = document.getElementById('view-clipboard-copy-btn');
        const viewClipboardEditBtn = document.getElementById('view-clipboard-edit-btn');

        // Copy Confirmation Modal
        const copyConfirmationModal = document.getElementById('copy-confirmation-modal');
        const copyConfirmationOkBtn = document.getElementById('copy-confirmation-ok');
        
        // ë³µì‚¬ í™•ì¸ ëª¨ë‹¬ í‘œì‹œ í•¨ìˆ˜
        function showCopyConfirmation() {
            copyConfirmationModal.style.display = 'flex';
        }
        
        // ë³µì‚¬ í™•ì¸ ëª¨ë‹¬ ìˆ¨ê¹€ í•¨ìˆ˜
        function hideCopyConfirmation() {
            copyConfirmationModal.style.display = 'none';
        }

        viewClipboardCloseBtn.addEventListener('click', () => {
            viewClipboardModal.style.display = 'none';
        });

        // Copy Confirmation Modal ì´ë²¤íŠ¸
        copyConfirmationOkBtn.addEventListener('click', hideCopyConfirmation);
        
        // ëª¨ë‹¬ ì™¸ë¶€ í´ë¦­ ì‹œ ë‹«ê¸°
        copyConfirmationModal.addEventListener('click', (e) => {
            if (e.target === copyConfirmationModal) {
                hideCopyConfirmation();
            }
        });

        viewClipboardModal.addEventListener('click', (e) => {
            if (e.target === viewClipboardModal) {
                viewClipboardModal.style.display = 'none';
            }
        });

        // ëª¨ë°”ì¼ í˜¸í™˜ ë³µì‚¬ í•¨ìˆ˜
        function copyToClipboard(text) {
            // ë¨¼ì € modern API ì‹œë„
            if (navigator.clipboard && navigator.clipboard.writeText) {
                return navigator.clipboard.writeText(text)
                    .then(() => true)
                    .catch(() => false);
            }
            
            // ëŒ€ì²´ ë°©ë²•: ì„ì‹œ textarea ìƒì„±
            return new Promise((resolve) => {
                const textArea = document.createElement('textarea');
                textArea.value = text;
                textArea.style.position = 'fixed';
                textArea.style.top = '-9999px';
                textArea.style.left = '-9999px';
                textArea.setAttribute('readonly', '');
                textArea.style.contain = 'strict';
                
                document.body.appendChild(textArea);
                
                // iOS Safari ëŒ€ì‘
                if (/ipad|iphone/i.test(navigator.userAgent)) {
                    textArea.contentEditable = 'true';
                    textArea.readOnly = false;
                    const range = document.createRange();
                    range.selectNodeContents(textArea);
                    const selection = window.getSelection();
                    selection.removeAllRanges();
                    selection.addRange(range);
                    textArea.setSelectionRange(0, 999999);
                } else {
                    textArea.select();
                }
                
                try {
                    const successful = document.execCommand('copy');
                    document.body.removeChild(textArea);
                    resolve(successful);
                } catch (err) {
                    document.body.removeChild(textArea);
                    resolve(false);
                }
            });
        }

        viewClipboardCopyBtn.addEventListener('click', (e) => {
            const textToCopy = e.target.dataset.clipboardText;
            copyToClipboard(textToCopy).then(success => {
                if (success) {
                    showCopyConfirmation();
                    viewClipboardModal.style.display = 'none';
                } else {
                    alert('ë³µì‚¬ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. ìˆ˜ë™ìœ¼ë¡œ ë³µì‚¬í•´ ì£¼ì„¸ìš”.');
                }
            });
        });

        viewClipboardEditBtn.addEventListener('click', (e) => {
            const index = parseInt(e.target.dataset.clipboardIndex);
            const projectData = allProjectsData[currentProject];
            const item = projectData.clipboard[index];
            
            // ë³´ê¸° ëª¨ë‹¬ ë‹«ê¸°
            viewClipboardModal.style.display = 'none';
            
            // í¸ì§‘ ëª¨ë‹¬ ì—´ê¸°
            const addClipboardModal = document.getElementById('add-clipboard-modal');
            document.querySelector('#add-clipboard-modal h2').textContent = 'í´ë¦½ë³´ë“œ í¸ì§‘';
            document.getElementById('add-clipboard-title').value = item.title || '';
            document.getElementById('add-clipboard-content').value = item.text;
            
            // í¸ì§‘ ëª¨ë“œ ì„¤ì •
            addClipboardModal.dataset.editMode = 'true';
            addClipboardModal.dataset.editIndex = index;
            
            addClipboardModal.style.display = 'flex';
        });

        // ëª¨ë°”ì¼ íƒ­ ë„¤ë¹„ê²Œì´ì…˜ ì²˜ë¦¬
        function initMobileTabs() {
            const mobileTabs = document.querySelectorAll('.mobile-tab');
            const projectSidebar = document.getElementById('project-sidebar');
            const bookmarkPanel = document.querySelector('.bookmark-panel');
            const clipboardPanel = document.querySelector('.clipboard-panel');
            const practicePanel = document.querySelector('.practice-panel');
            const dashboardArea = document.querySelector('.dashboard-area');
            
            mobileTabs.forEach(tab => {
                tab.addEventListener('click', () => {
                    // ëª¨ë“  íƒ­ ë¹„í™œì„±í™”
                    mobileTabs.forEach(t => t.classList.remove('active'));
                    
                    // í´ë¦­ëœ íƒ­ í™œì„±í™”
                    tab.classList.add('active');
                    
                    // ëª¨ë“  íŒ¨ë„ ìˆ¨ê¹€
                    projectSidebar.classList.remove('mobile-visible');
                    bookmarkPanel.classList.remove('mobile-visible');
                    clipboardPanel.classList.remove('mobile-visible');
                    practicePanel.classList.remove('mobile-visible');
                    dashboardArea.classList.remove('mobile-visible');
                    
                    // ì„ íƒëœ íƒ­ì— ë”°ë¼ íŒ¨ë„ í‘œì‹œ
                    const tabType = tab.dataset.tab;
                    switch(tabType) {
                        case 'projects':
                            projectSidebar.classList.add('mobile-visible');
                            break;
                        case 'bookmarks':
                            bookmarkPanel.classList.add('mobile-visible');
                            break;
                        case 'clipboard':
                            clipboardPanel.classList.add('mobile-visible');
                            break;
                        case 'practice':
                            practicePanel.classList.add('mobile-visible');
                            break;
                        case 'dashboard':
                            dashboardArea.classList.add('mobile-visible');
                            break;
                    }
                });
            });
            
            // ì´ˆê¸° ìƒíƒœ: í”„ë¡œì íŠ¸ íƒ­ í™œì„±í™”
            if (window.innerWidth <= 768) {
                projectSidebar.classList.add('mobile-visible');
            }
        }

        // ì—°ìŠµì¥ ì˜ì—­ ì´ˆê¸°í™”
        function initPracticeArea() {
            const practiceTextarea = document.getElementById('practice-textarea');
            const copyBtn = document.getElementById('copy-practice-btn');
            const clearBtn = document.getElementById('clear-practice-btn');
            
            // ë³µì‚¬ ë²„íŠ¼ ì´ë²¤íŠ¸
            copyBtn.addEventListener('click', async () => {
                const text = practiceTextarea.value;
                if (!text.trim()) {
                    alert('ë³µì‚¬í•  ë‚´ìš©ì´ ì—†ìŠµë‹ˆë‹¤.');
                    return;
                }
                
                try {
                    if (navigator.clipboard && navigator.clipboard.writeText) {
                        await navigator.clipboard.writeText(text);
                        showCopyConfirmation();
                    } else {
                        // í´ë°± ë°©ì‹
                        practiceTextarea.select();
                        document.execCommand('copy');
                        showCopyConfirmation();
                    }
                } catch (err) {
                    console.error('ë³µì‚¬ ì‹¤íŒ¨:', err);
                    alert('ë³µì‚¬ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
                }
            });
            
            // ì´ˆê¸°í™” ë²„íŠ¼ ì´ë²¤íŠ¸
            clearBtn.addEventListener('click', () => {
                if (practiceTextarea.value.trim() && confirm('ì—°ìŠµì¥ì˜ ëª¨ë“  ë‚´ìš©ì„ ì´ˆê¸°í™”í•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                    practiceTextarea.value = '';
                    savePracticeContent('', true); // ì¦‰ì‹œ ì €ì¥
                    practiceTextarea.focus();
                }
            });
            
            // ì‹¤ì‹œê°„ ì €ì¥ (ë””ë°”ìš´ì‹± ì ìš©)
            let saveTimeout;
            practiceTextarea.addEventListener('input', () => {
                clearTimeout(saveTimeout);
                saveTimeout = setTimeout(() => {
                    savePracticeContent(practiceTextarea.value);
                }, 1000); // 1ì´ˆ ì§€ì—°
            });
            
            // ì—°ìŠµì¥ ë‚´ìš© ë¡œë“œ
            loadPracticeContent();
            
            // ì‹¤ì‹œê°„ ë™ê¸°í™” ë¦¬ìŠ¤ë„ˆ ì„¤ì • (Firebase ì´ˆê¸°í™” í›„)
            setTimeout(() => {
                if (firebaseInitialized && db) {
                    db.collection('userdata').doc('global-practices').onSnapshot((doc) => {
                        if (doc.exists && document.activeElement !== practiceTextarea) {
                            // ì‚¬ìš©ìê°€ í˜„ì¬ í…ìŠ¤íŠ¸ìƒìë¥¼ í¸ì§‘ ì¤‘ì´ ì•„ë‹ ë•Œë§Œ ì—…ë°ì´íŠ¸
                            const data = doc.data();
                            if (data.practices) {
                                const remoteContent = data.practices[currentPracticeTab] || '';
                                if (remoteContent !== practiceTextarea.value) {
                                    // ì›ê²© ë°ì´í„°ë¡œ ë¡œì»¬ ë°ì´í„° ì—…ë°ì´íŠ¸
                                    globalPractices = data.practices;
                                    practiceTextarea.value = remoteContent;
                                    console.log('ë‹¤ë¥¸ ê¸°ê¸°ì—ì„œ ì—°ìŠµì¥ ë‚´ìš©ì´ ì—…ë°ì´íŠ¸ë˜ì—ˆìŠµë‹ˆë‹¤.');
                                }
                            }
                        }
                    });
                }
            }, 2000); // Firebase ì´ˆê¸°í™” ì™„ë£Œ í›„ 2ì´ˆ ë’¤ì— ë¦¬ìŠ¤ë„ˆ ì„¤ì •
        }

        // í™”ë©´ í¬ê¸° ë³€ê²½ ê°ì§€
        function handleResize() {
            if (window.innerWidth <= 768) {
                // ëª¨ë°”ì¼ ëª¨ë“œ
                const activeTab = document.querySelector('.mobile-tab.active');
                if (activeTab) {
                    const event = new Event('click');
                    activeTab.dispatchEvent(event);
                }
            } else {
                // ë°ìŠ¤í¬í†± ëª¨ë“œ: ëª¨ë“  mobile-visible í´ë˜ìŠ¤ ì œê±°
                document.getElementById('project-sidebar').classList.remove('mobile-visible');
                document.querySelector('.bookmark-panel').classList.remove('mobile-visible');
                document.querySelector('.clipboard-panel').classList.remove('mobile-visible');
                document.querySelector('.practice-panel').classList.remove('mobile-visible');
                document.querySelector('.dashboard-area').classList.remove('mobile-visible');
            }
        }

        // í„°ì¹˜ ìŠ¤ì™€ì´í”„ ì§€ì› (ì˜µì…˜)
        let touchStartX = 0;
        let touchEndX = 0;
        
        function handleSwipe() {
            if (window.innerWidth > 768) return; // ëª¨ë°”ì¼ì—ì„œë§Œ ì‘ë™
            
            const swipeThreshold = 100;
            const difference = touchStartX - touchEndX;
            
            if (Math.abs(difference) > swipeThreshold) {
                const currentActiveTab = document.querySelector('.mobile-tab.active');
                const allTabs = Array.from(document.querySelectorAll('.mobile-tab'));
                const currentIndex = allTabs.indexOf(currentActiveTab);
                
                let nextIndex;
                if (difference > 0) {
                    // ì™¼ìª½ìœ¼ë¡œ ìŠ¤ì™€ì´í”„ (ë‹¤ìŒ íƒ­)
                    nextIndex = currentIndex + 1 < allTabs.length ? currentIndex + 1 : 0;
                } else {
                    // ì˜¤ë¥¸ìª½ìœ¼ë¡œ ìŠ¤ì™€ì´í”„ (ì´ì „ íƒ­)
                    nextIndex = currentIndex - 1 >= 0 ? currentIndex - 1 : allTabs.length - 1;
                }
                
                allTabs[nextIndex].click();
            }
        }

        // í„°ì¹˜ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ
        document.addEventListener('touchstart', e => {
            touchStartX = e.changedTouches[0].screenX;
        });

        document.addEventListener('touchend', e => {
            touchEndX = e.changedTouches[0].screenX;
            handleSwipe();
        });

        // ë¦¬ì‚¬ì´ì¦ˆ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ
        window.addEventListener('resize', handleResize);

        // PWA Service Worker ë“±ë¡
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('sw.js')
                    .then(registration => {
                        console.log('PWA: Service Worker ë“±ë¡ ì„±ê³µ', registration.scope);
                        
                        // Service Worker ì—…ë°ì´íŠ¸ í™•ì¸
                        registration.addEventListener('updatefound', () => {
                            const newWorker = registration.installing;
                            newWorker.addEventListener('statechange', () => {
                                if (newWorker.state === 'installed' && navigator.serviceWorker.controller) {
                                    // ìƒˆ ë²„ì „ ì‚¬ìš© ê°€ëŠ¥ ì•Œë¦¼
                                    if (confirm('ìƒˆë¡œìš´ ë²„ì „ì´ ì‚¬ìš© ê°€ëŠ¥í•©ë‹ˆë‹¤. ì§€ê¸ˆ ìƒˆë¡œê³ ì¹¨í•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                                        window.location.reload();
                                    }
                                }
                            });
                        });
                    })
                    .catch(error => {
                        console.log('PWA: Service Worker ë“±ë¡ ì‹¤íŒ¨', error);
                    });
            });
        }

        // PWA ì„¤ì¹˜ ê´€ë¦¬
        let deferredPrompt;
        let installButton = null;

        // PWA ì„¤ì¹˜ ê°€ëŠ¥ ì—¬ë¶€ í™•ì¸ ë° ë²„íŠ¼ í‘œì‹œ
        function checkPWAInstallability() {
            console.log('PWA: ì„¤ì¹˜ ê°€ëŠ¥ì„± í™•ì¸ ì¤‘...');
            
            // ì´ë¯¸ ì„¤ì¹˜ëœ ì•±ì¸ì§€ í™•ì¸
            if (window.matchMedia('(display-mode: standalone)').matches) {
                console.log('PWA: ì´ë¯¸ ì„¤ì¹˜ëœ ì•±ì—ì„œ ì‹¤í–‰ ì¤‘');
                return false;
            }
            
            // iOS Safari í™•ì¸
            const isIOS = /iPad|iPhone|iPod/.test(navigator.userAgent);
            const isInStandaloneMode = ('standalone' in window.navigator) && window.navigator.standalone;
            
            if (isIOS && !isInStandaloneMode) {
                console.log('PWA: iOS Safariì—ì„œ ì‹¤í–‰ ì¤‘ - ìˆ˜ë™ ì„¤ì¹˜ ê°€ì´ë“œ í‘œì‹œ');
                showIOSInstallGuide();
                return false;
            }
            
            // ì¼ë°˜ì ì¸ ê²½ìš° - beforeinstallprompt ì´ë²¤íŠ¸ ëŒ€ê¸° ì¤‘
            // 5ì´ˆ í›„ì—ë„ ì´ë²¤íŠ¸ê°€ ì—†ìœ¼ë©´ ìˆ˜ë™ìœ¼ë¡œ ë²„íŠ¼ í‘œì‹œ
            setTimeout(() => {
                if (!deferredPrompt && !installButton) {
                    console.log('PWA: beforeinstallprompt ì´ë²¤íŠ¸ ì—†ìŒ - ìˆ˜ë™ ë²„íŠ¼ í‘œì‹œ');
                    showManualInstallButton();
                }
            }, 5000);
            
            return true;
        }

        // beforeinstallprompt ì´ë²¤íŠ¸ ì²˜ë¦¬
        window.addEventListener('beforeinstallprompt', (e) => {
            console.log('PWA: beforeinstallprompt ì´ë²¤íŠ¸ ë°œìƒ');
            e.preventDefault();
            deferredPrompt = e;
            showInstallButton();
        });

        // iOS Safariìš© ì„¤ì¹˜ ê°€ì´ë“œ
        function showIOSInstallGuide() {
            const iosGuide = document.createElement('div');
            iosGuide.id = 'ios-install-guide';
            iosGuide.innerHTML = `
                <div style="
                    position: fixed;
                    top: 0;
                    left: 0;
                    right: 0;
                    background: #007acc;
                    color: white;
                    padding: 12px;
                    text-align: center;
                    font-size: 14px;
                    z-index: 9999;
                ">
                    ğŸ“± iOS ì„¤ì¹˜: Safari ë©”ë‰´ â†’ "í™ˆ í™”ë©´ì— ì¶”ê°€" 
                    <button onclick="this.parentElement.parentElement.remove()" style="
                        background: none;
                        border: none;
                        color: white;
                        font-size: 16px;
                        float: right;
                        cursor: pointer;
                    ">Ã—</button>
                </div>
            `;
            document.body.appendChild(iosGuide);
        }

        // ìë™ ì„¤ì¹˜ ë²„íŠ¼ (beforeinstallprompt ì´ë²¤íŠ¸ ìˆì„ ë•Œ)
        function showInstallButton() {
            createInstallButton('ğŸ“± ì•± ì„¤ì¹˜', async () => {
                if (deferredPrompt) {
                    try {
                        deferredPrompt.prompt();
                        const result = await deferredPrompt.userChoice;
                        
                        if (result.outcome === 'accepted') {
                            console.log('PWA: ì‚¬ìš©ìê°€ ì•±ì„ ì„¤ì¹˜í–ˆìŠµë‹ˆë‹¤');
                        } else {
                            console.log('PWA: ì‚¬ìš©ìê°€ ì•± ì„¤ì¹˜ë¥¼ ê±°ë¶€í–ˆìŠµë‹ˆë‹¤');
                        }
                        
                        deferredPrompt = null;
                        if (installButton) {
                            installButton.remove();
                            installButton = null;
                        }
                    } catch (error) {
                        console.error('PWA: ì„¤ì¹˜ ì¤‘ ì˜¤ë¥˜:', error);
                    }
                }
            });
        }

        // ìˆ˜ë™ ì„¤ì¹˜ ë²„íŠ¼ (beforeinstallprompt ì´ë²¤íŠ¸ ì—†ì„ ë•Œ)
        function showManualInstallButton() {
            createInstallButton('ğŸ“± ì„¤ì¹˜ ë°©ë²•', () => {
                const isChrome = /Chrome/.test(navigator.userAgent);
                const isEdge = /Edge/.test(navigator.userAgent);
                
                let message = 'ì´ ì•±ì„ ì„¤ì¹˜í•˜ë ¤ë©´:\\n\\n';
                
                if (isChrome) {
                    message += 'Chrome: ì£¼ì†Œì°½ ì˜¤ë¥¸ìª½ "ì•± ì„¤ì¹˜" ì•„ì´ì½˜ í´ë¦­';
                } else if (isEdge) {
                    message += 'Edge: ì£¼ì†Œì°½ ì˜¤ë¥¸ìª½ "ì•± ì„¤ì¹˜" ì•„ì´ì½˜ í´ë¦­';
                } else {
                    message += '1. Chrome ë˜ëŠ” Edge ë¸Œë¼ìš°ì € ì‚¬ìš©\\n2. ì£¼ì†Œì°½ì—ì„œ ì„¤ì¹˜ ì˜µì…˜ ì°¾ê¸°\\n3. ë˜ëŠ” ë¸Œë¼ìš°ì € ë©”ë‰´ì—ì„œ "ì•± ì„¤ì¹˜" ì„ íƒ';
                }
                
                alert(message);
            });
        }

        // ì„¤ì¹˜ ë²„íŠ¼ ìƒì„± ê³µí†µ í•¨ìˆ˜
        function createInstallButton(text, clickHandler) {
            if (installButton) return; // ì´ë¯¸ ì¡´ì¬í•˜ë©´ ì¤‘ë‹¨
            
            // ë°ìŠ¤í¬í†±: í—¤ë”ì— ì¶”ê°€
            const header = document.querySelector('.main-header') || document.querySelector('.sidebar-header');
            // ëª¨ë°”ì¼: íƒ­ ì˜ì—­ì— ì¶”ê°€  
            const mobileTabs = document.querySelector('.mobile-tabs');
            const targetContainer = window.innerWidth <= 768 ? mobileTabs : header;
            
            if (targetContainer) {
                installButton = document.createElement('button');
                installButton.id = 'install-btn';
                installButton.innerHTML = text;
                installButton.style.cssText = `
                    background: #007acc;
                    color: white;
                    border: none;
                    padding: 8px 12px;
                    border-radius: 4px;
                    font-size: 12px;
                    cursor: pointer;
                    margin: 4px;
                    z-index: 1000;
                `;
                
                installButton.addEventListener('click', clickHandler);
                targetContainer.appendChild(installButton);
                
                console.log('PWA: ì„¤ì¹˜ ë²„íŠ¼ ìƒì„±ë¨');
            }
        }

        // ì•±ì´ ì„¤ì¹˜ë˜ë©´ ì„¤ì¹˜ ë²„íŠ¼ ì œê±°
        window.addEventListener('appinstalled', () => {
            console.log('PWA: ì•±ì´ ì„±ê³µì ìœ¼ë¡œ ì„¤ì¹˜ë˜ì—ˆìŠµë‹ˆë‹¤');
            const installBtn = document.getElementById('install-btn');
            if (installBtn) {
                installBtn.remove();
            }
            deferredPrompt = null;
        });

        // ì´ˆê¸° í™”ë©´ ë Œë”ë§ - Firebase ì´ˆê¸°í™” í›„ ì‹¤í–‰
        initializeApp().then(() => {
            initMobileTabs();
            initPracticeArea();
            handleResize(); // ì´ˆê¸° í™”ë©´ í¬ê¸°ì— ë”°ë¥¸ ì„¤ì •
            
            // PWA ì„¤ì¹˜ ê°€ëŠ¥ì„± í™•ì¸
            setTimeout(() => {
                checkPWAInstallability();
            }, 2000); // 2ì´ˆ í›„ í™•ì¸ (UI ë¡œë”© ì™„ë£Œ í›„)

            // í…œí”Œë¦¿ ê´€ë ¨ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆë“¤
            document.getElementById('add-template-btn').addEventListener('click', addNewTemplate);
            
            // í…œí”Œë¦¿ í¼ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ
            document.getElementById('template-form').addEventListener('submit', function(e) {
                e.preventDefault();
                saveTemplate(new FormData(e.target));
            });
            
            // í…œí”Œë¦¿ ë‚´ìš© ë³€ê²½ ì‹œ ë¯¸ë¦¬ë³´ê¸° ì—…ë°ì´íŠ¸
            
        });
    });
    </script>

    <!-- í…œí”Œë¦¿ í¸ì§‘ ëª¨ë‹¬ -->
    <div id="template-edit-modal" class="modal">
        <div class="modal-content">
            <span class="close-button" onclick="closeTemplateModal()">&times;</span>
            <h2>í…œí”Œë¦¿ í¸ì§‘</h2>
            
            <form id="template-form">
                <div class="modal-form-group">
                    <label for="template-title-input">ì œëª©:</label>
                    <input type="text" id="template-title-input" name="title" placeholder="í…œí”Œë¦¿ ì œëª©ì„ ì…ë ¥í•˜ì„¸ìš”" required>
                </div>
                
                
                
                <div class="modal-form-group">
                    <label for="template-content-input">ë‚´ìš©:</label>
                    <div class="variable-buttons">
                        <button type="button" class="variable-btn" onclick="insertVariable('{ì˜¤ëŠ˜ë‚ ì§œ}')">{ì˜¤ëŠ˜ë‚ ì§œ}</button>
                        <button type="button" class="variable-btn" onclick="insertVariable('{í˜„ì¬ì‹œê°„}')">{í˜„ì¬ì‹œê°„}</button>
                        <button type="button" class="variable-btn" onclick="insertVariable('{í”„ë¡œì íŠ¸ëª…}')">{í”„ë¡œì íŠ¸ëª…}</button>
                        <button type="button" class="variable-btn" onclick="insertVariable('{ê³ ê°ëª…}')">{ê³ ê°ëª…}</button>
                        <button type="button" class="variable-btn" onclick="insertVariable('{ê³„ì•½ì¼}')">{ê³„ì•½ì¼}</button>
                        <button type="button" class="variable-btn" onclick="insertVariable('{ê¸ˆì•¡}')">{ê¸ˆì•¡}</button>
                        <button type="button" class="variable-btn empty-var-btn" onclick="insertEmptyVariable()">{ë¹ˆ ë³€ìˆ˜}</button>
                    </div>
                    <textarea id="template-content-input" name="content" placeholder="í…œí”Œë¦¿ ë‚´ìš©ì„ ì…ë ¥í•˜ì„¸ìš”. ìœ„ ë²„íŠ¼ì„ í´ë¦­í•˜ì—¬ ë³€ìˆ˜ë¥¼ ì‚½ì…í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤."></textarea>
                </div>
                
                
                <div class="modal-actions">
                    <button type="button" class="secondary-button" onclick="closeTemplateModal()">ì·¨ì†Œ</button>
                    <button type="submit" class="primary-button">ì €ì¥</button>
                </div>
            </form>
        </div>
    </div>

    <!-- í…œí”Œë¦¿ ë‚´ìš© íŒì—… ëª¨ë‹¬ -->
    <div id="template-popup-modal" class="modal">
        <div class="modal-content">
            <span class="close-button" onclick="closeTemplatePopup()">&times;</span>
            <div id="template-popup-header">
                <h2 id="template-popup-title"></h2>
            </div>
            <div id="template-popup-content">
            </div>
            <!-- ë‚´ìš©ë³´ê¸°/ë³€ìˆ˜ì…ë ¥ ë²„íŠ¼ ì˜ì—­ -->
            <div id="template-action-buttons" style="margin: 20px 0; display: flex; gap: 12px; justify-content: center;">
                <button type="button" class="primary-button" onclick="showTemplateContent()" style="flex: 1;">ë‚´ìš©ë³´ê¸°</button>
                <button type="button" class="secondary-button" onclick="showVariableInputs()" style="flex: 1;" id="template-variables-toggle-btn">ë³€ìˆ˜ì…ë ¥</button>
            </div>
            <!-- ë³€ìˆ˜ ì…ë ¥ ì˜ì—­ -->
            <div id="template-variables-section" style="display: none; margin: 20px 0; border: 1px solid #e0e0e0; border-radius: 6px; padding: 16px; background-color: #fafafa;">
                <h4 style="margin: 0 0 12px 0; color: #37352f; font-size: 14px;">ë³€ìˆ˜ ì…ë ¥</h4>
                <div id="template-variables-inputs"></div>
                <div style="margin-top: 12px; display: flex; gap: 8px;">
                    <button type="button" class="secondary-button" onclick="resetVariables()">ì´ˆê¸°í™”</button>
                    <button type="button" class="primary-button" onclick="saveFormTemplate()">ì–‘ì‹ ì €ì¥</button>
                </div>
            </div>
            <div class="modal-actions">
                <button type="button" class="primary-button" onclick="copyTemplateFromPopup()">ë³µì‚¬</button>
                <button type="button" class="secondary-button" onclick="editTemplateFromPopup()">í¸ì§‘</button>
                <button type="button" class="secondary-button delete-btn" onclick="deleteTemplateFromPopup()">ì‚­ì œ</button>
                <button type="button" class="secondary-button" onclick="closeTemplatePopup()">ë‹«ê¸°</button>
            </div>
        </div>
    </div>
</body>
</html>