<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Î∂ÅÌÅ¥Î¶ΩÎ∞î</title>
    
    <!-- PWA Meta Tags -->
    <meta name="description" content="ÌîÑÎ°úÏ†ùÌä∏Î≥Ñ Î∂ÅÎßàÌÅ¨ÏôÄ ÌÅ¥Î¶ΩÎ≥¥ÎìúÎ•º Ìö®Ïú®Ï†ÅÏúºÎ°ú Í¥ÄÎ¶¨ÌïòÎäî PWA Ïï±">
    <meta name="theme-color" content="#D2691E">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="Î∂ÅÎßàÌÅ¨Ïï±">
    <meta name="msapplication-TileColor" content="#64b5f6">
    <meta name="msapplication-config" content="browserconfig.xml">
    
    <!-- PWA Manifest -->
    <link rel="manifest" href="manifest.json">
    
    <!-- PWA Icons -->
    <link rel="apple-touch-icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 192 192'><rect width='192' height='192' fill='%2337352f'/><text x='96' y='120' font-size='80' text-anchor='middle' fill='white'>üìã</text></svg>">
    <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 192 192'><rect width='192' height='192' fill='%2337352f'/><text x='96' y='120' font-size='80' text-anchor='middle' fill='white'>üìã</text></svg>">
    
    <!-- Firebase SDK v9 (ÏµúÏã† ÏïàÏ†ï Î≤ÑÏ†Ñ) -->
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
    
    <style>
        /* Í∏∞Î≥∏ Ïä§ÌÉÄÏùº Î∞è Î†àÏù¥ÏïÑÏõÉ ÏÑ§Ï†ï */
        body, html {
            margin: 0;
            padding: 0;
            height: 100%;
            font-family: ui-sans-serif, -apple-system, BlinkMacSystemFont, "Segoe UI Variable Display", "Segoe UI", Helvetica, "Apple Color Emoji", Arial, sans-serif, "Segoe UI Emoji", "Segoe UI Symbol";
            background-color: #ffffff;
            color: #37352f;
            overflow: hidden;
            font-size: 14px;
            line-height: 1.5;
        }
        .app-container {
            display: flex;
            height: 100vh;
        }

        /* ÏôºÏ™Ω ÏÇ¨Ïù¥ÎìúÎ∞î Ïä§ÌÉÄÏùº */
        #project-sidebar {
            width: 240px;
            background-color: #FDF5E6;
            padding: 12px 0;
            border-right: 1px solid rgba(55, 53, 47, 0.09);
            overflow-y: auto;
            flex-shrink: 0;
        }
        .sidebar-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0 14px;
            margin-bottom: 8px;
        }
        
        #project-sidebar h3 {
            margin: 4px 0 0 0;
            color: rgba(55, 53, 47, 0.65);
            font-size: 12px;
            font-weight: 500;
            text-transform: uppercase;
            letter-spacing: 0.02em;
        }
        
        .add-project-btn {
            background-color: transparent;
            color: rgba(55, 53, 47, 0.45);
            border: none;
            border-radius: 3px;
            width: 20px;
            height: 20px;
            font-size: 14px;
            display: flex;
            justify-content: center;
            align-items: center;
            cursor: pointer;
            transition: background-color 0.1s ease-in-out, color 0.1s ease-in-out;
            padding: 0;
        }
        
        .add-project-btn:hover {
            background-color: rgba(55, 53, 47, 0.08);
            color: #37352f;
        }
        #project-list {
            list-style: none;
            padding: 0;
            margin: 0;
        }
        #project-list li {
            padding: 6px 10.8px;
            cursor: pointer;
            transition: all 0.1s ease-in-out;
            border-radius: 8px;
            margin: 2.4px 7.2px;
            font-size: 18px;
            font-weight: 600;
            color: #37352f;
            position: relative;
            min-height: 25.2px;
            display: flex;
            align-items: center;
            border: 2px solid #2a2a2a;
            background-color: #FFEBEE;
        }
        #project-list li:hover {
            background-color: #F8BBD0;
            border-color: #1a1a1a;
        }
        #project-list li.active {
            background-color: rgba(46, 170, 220, 0.15);
            color: #B8860B;
            border-color: #B8860B;
            font-weight: 500;
        }

        /* Î©îÏù∏ ÏòÅÏó≠ Ïä§ÌÉÄÏùº */
        .main-area {
            flex-grow: 1;
            display: flex;
            flex-direction: column;
            overflow-y: auto;
        }

        /* Î©îÏù∏ ÏΩòÌÖêÏ∏† ÏòÅÏó≠ Ïä§ÌÉÄÏùº */
        .main-content {
            flex-grow: 1;
            display: flex;
            flex-direction: column;
            padding: 24px 20px;
            gap: 24px;
            width: 100%;
            height: calc(100vh - 60px);
            box-sizing: border-box;
        }
        .content-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 16px 32px;
            background: linear-gradient(135deg, #D2691E 0%, #F4A460 50%, #DEB887 100%);
            border-radius: 0;
            box-shadow: 0 2px 8px rgba(100, 181, 246, 0.15);
            border-bottom: 3px solid #8B4513;
            width: 100%;
            box-sizing: border-box;
        }
        .content-header h1 {
            font-size: 28px;
            line-height: 1.2;
            font-weight: 700;
            color: #ffffff;
            margin: 0;
            letter-spacing: -0.01em;
            text-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
        }
        .content-header .icon-button {
            color: rgba(255, 255, 255, 0.8);
            background-color: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        .content-header .icon-button:hover {
            color: #ffffff;
            background-color: rgba(255, 255, 255, 0.2);
            border-color: rgba(255, 255, 255, 0.3);
        }
        
        /* Í≤ÄÏÉâÎ∞î Ïä§ÌÉÄÏùº */
        .search-container {
            position: relative;
            flex-grow: 1;
            max-width: 400px;
            margin: 0 20px;
        }
        
        #global-search {
            width: 100%;
            padding: 8px 16px 8px 40px;
            border: 1px solid rgba(255, 255, 255, 0.3);
            border-radius: 20px;
            background-color: rgba(255, 255, 255, 0.15);
            color: white;
            font-size: 14px;
            outline: none;
            transition: all 0.2s ease;
            backdrop-filter: blur(10px);
        }
        
        #global-search::placeholder {
            color: rgba(255, 255, 255, 0.7);
        }
        
        #global-search:focus {
            background-color: rgba(255, 255, 255, 0.25);
            border-color: rgba(255, 255, 255, 0.5);
            box-shadow: 0 0 0 2px rgba(255, 255, 255, 0.1);
        }
        
        .search-icon {
            position: absolute;
            left: 12px;
            top: 50%;
            transform: translateY(-50%);
            color: rgba(255, 255, 255, 0.7);
            font-size: 16px;
            pointer-events: none;
        }
        
        /* Í≤ÄÏÉâ Í≤∞Í≥º ÎìúÎ°≠Îã§Ïö¥ */
        .search-results {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            background: white;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            z-index: 1000;
            max-height: 400px;
            overflow-y: auto;
            margin-top: 4px;
            display: none;
        }
        
        .search-results.show {
            display: block;
        }
        
        .search-category {
            border-bottom: 1px solid #f0f0f0;
        }
        
        .search-category:last-child {
            border-bottom: none;
        }
        
        .search-category-header {
            padding: 8px 16px;
            background-color: #f8f9fa;
            color: #666;
            font-size: 12px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .search-result-item {
            padding: 12px 16px;
            cursor: pointer;
            transition: background-color 0.1s ease;
            border-bottom: 1px solid #f5f5f5;
            color: #37352f;
        }
        
        .search-result-item:last-child {
            border-bottom: none;
        }
        
        .search-result-item:hover {
            background-color: #f8f9fa;
        }
        
        .search-result-item.selected {
            background-color: #e3f2fd;
        }
        
        .search-result-title {
            font-weight: 500;
            font-size: 14px;
            margin-bottom: 4px;
        }
        
        .search-result-subtitle {
            font-size: 12px;
            color: #666;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }
        
        .search-result-project {
            font-size: 11px;
            color: #999;
            background-color: #f0f0f0;
            padding: 2px 6px;
            border-radius: 10px;
            display: inline-block;
            margin-top: 4px;
        }
        
        .search-highlight {
            background-color: yellow;
            font-weight: bold;
        }
        
        .no-search-results {
            padding: 20px;
            text-align: center;
            color: #666;
            font-style: italic;
        }
        
        /* Í≤ÄÏÉâ Í≤∞Í≥º ÌïòÏù¥ÎùºÏù¥Ìä∏ Ïï†ÎãàÎ©îÏù¥ÏÖò */
        .search-highlight-glow {
            position: relative;
            background: linear-gradient(45deg, #fff9c4, #ffeaa7, #fff9c4) !important;
            border: 2px solid #ffd700 !important;
            border-radius: 8px !important;
            transition: all 0.3s ease !important;
            animation: searchGlow 3s ease-in-out !important;
            z-index: 10 !important;
        }
        
        .search-highlight-glow::before {
            content: '';
            position: absolute;
            top: -4px;
            left: -4px;
            right: -4px;
            bottom: -4px;
            background: linear-gradient(45deg, #ffd700, #ffed4e, #ffd700);
            border-radius: 12px;
            z-index: -1;
            animation: glowPulse 2s ease-in-out infinite;
        }
        
        @keyframes searchGlow {
            0% { 
                box-shadow: 0 0 5px rgba(255, 215, 0, 0.3);
                transform: scale(1);
            }
            15% { 
                box-shadow: 0 0 25px rgba(255, 215, 0, 0.8);
                transform: scale(1.02);
            }
            30% { 
                box-shadow: 0 0 20px rgba(255, 215, 0, 0.6);
                transform: scale(1);
            }
            45% { 
                box-shadow: 0 0 25px rgba(255, 215, 0, 0.8);
                transform: scale(1.01);
            }
            60% { 
                box-shadow: 0 0 15px rgba(255, 215, 0, 0.5);
                transform: scale(1);
            }
            80% { 
                box-shadow: 0 0 10px rgba(255, 215, 0, 0.3);
            }
            100% { 
                box-shadow: 0 0 5px rgba(255, 215, 0, 0.1);
                transform: scale(1);
            }
        }
        
        @keyframes glowPulse {
            0%, 100% { 
                opacity: 0.7;
                filter: blur(2px);
            }
            50% { 
                opacity: 1;
                filter: blur(3px);
            }
        }
        
        /* ÌéòÏù¥Îìú ÏïÑÏõÉ Ïï†ÎãàÎ©îÏù¥ÏÖò */
        .search-highlight-fade-out {
            animation: fadeToNormal 1s ease-out forwards !important;
        }
        
        @keyframes fadeToNormal {
            0% {
                background: linear-gradient(45deg, #fff9c4, #ffeaa7, #fff9c4) !important;
                border: 2px solid #ffd700 !important;
                box-shadow: 0 0 15px rgba(255, 215, 0, 0.5);
            }
            100% {
                background: transparent !important;
                border: none !important;
                box-shadow: none !important;
            }
        }
        
        /* Ïä§ÌååÌÅ¨ Ìö®Í≥º (ÏÑ†ÌÉùÏ†Å) */
        .search-highlight-glow.with-sparkle::after {
            content: '‚ú®';
            position: absolute;
            top: -10px;
            right: -10px;
            font-size: 16px;
            animation: sparkleFloat 2s ease-in-out;
        }
        
        @keyframes sparkleFloat {
            0% { 
                opacity: 0;
                transform: translateY(10px) scale(0.5);
            }
            20% { 
                opacity: 1;
                transform: translateY(0) scale(1);
            }
            80% { 
                opacity: 1;
                transform: translateY(-5px) scale(1.1);
            }
            100% { 
                opacity: 0;
                transform: translateY(-15px) scale(0.8);
            }
        }
        
        /* Í≤ÄÏÉâ Í≤∞Í≥º ÎØ∏Î¶¨Î≥¥Í∏∞ Î™®Îã¨ Ïä§ÌÉÄÏùº */
        .clipboard-preview-text, .template-preview-text {
            background-color: #f8f9fa;
            border: 1px solid #e9ecef;
            border-radius: 8px;
            padding: 16px;
            margin: 16px 0;
            font-family: 'Consolas', 'Monaco', monospace;
            font-size: 14px;
            line-height: 1.5;
            color: #37352f;
            white-space: pre-wrap;
            word-wrap: break-word;
            max-height: 300px;
            overflow-y: auto;
        }
        
        .template-variables {
            margin: 16px 0;
            padding: 16px;
            background-color: #f0f8ff;
            border: 1px solid #cce7ff;
            border-radius: 8px;
        }
        
        .template-variables h4 {
            margin: 0 0 12px 0;
            color: #2c5aa0;
            font-size: 14px;
        }
        
        .variable-input-group {
            margin-bottom: 12px;
        }
        
        .variable-input-group label {
            display: block;
            margin-bottom: 4px;
            font-weight: 500;
            font-size: 13px;
            color: #37352f;
        }
        
        .variable-input-group input {
            width: 100%;
            padding: 8px 12px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 14px;
            box-sizing: border-box;
        }
        
        .variable-input-group input:focus {
            outline: none;
            border-color: #4285f4;
            box-shadow: 0 0 0 2px rgba(66, 133, 244, 0.1);
        }
        
        .modal-actions {
            display: flex;
            gap: 12px;
            justify-content: flex-end;
            margin-top: 20px;
            padding-top: 16px;
            border-top: 1px solid #eee;
        }
        
        .primary-btn {
            background-color: #4285f4;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 6px;
            font-size: 14px;
            cursor: pointer;
            transition: background-color 0.2s ease;
        }
        
        .primary-btn:hover {
            background-color: #3367d6;
        }
        
        .secondary-btn {
            background-color: #f8f9fa;
            color: #37352f;
            border: 1px solid #dadce0;
            padding: 10px 20px;
            border-radius: 6px;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        
        .secondary-btn:hover {
            background-color: #f1f3f4;
            border-color: #c4c7c5;
        }
        
        /* ÌÜ†Ïä§Ìä∏ Î©îÏãúÏßÄ Ïï†ÎãàÎ©îÏù¥ÏÖò */
        @keyframes slideInRight {
            from {
                transform: translateX(100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }
        
        @keyframes slideOutRight {
            from {
                transform: translateX(0);
                opacity: 1;
            }
            to {
                transform: translateX(100%);
                opacity: 0;
            }
        }
        .content-panels {
            display: flex;
            gap: 16px;
            flex: 1;
            margin-top: 0;
            justify-content: flex-start;
            align-items: stretch;
        }
        .content-panel {
            flex: 0 0 400px;
            max-width: 400px;
            background-color: #ffffff;
            padding: 12px;
            border-radius: 6px;
            border: 2px solid #2c2c2c;
            overflow-y: auto;
            box-shadow: rgba(15, 15, 15, 0.1) 0px 2px 4px;
        }
        .content-panel h4 {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin: -12px -12px 12px -12px;
            padding: 12px;
            background-color: #f8f9fa;
            border-bottom: 1px solid #dee2e6;
            border-radius: 4px 4px 0 0;
            font-size: 16px;
            font-weight: 600;
            color: #37352f;
            line-height: 1.3;
        }

        .bookmark-header {
            background-color: #e8d5f2 !important;
            border-bottom: 1px solid #b19cd9 !important;
            color: #6a4c93 !important;
            display: flex !important;
            align-items: center !important;
            margin: -12px -12px 12px -12px !important;
            padding: 12px !important;
            border-radius: 4px 4px 0 0 !important;
            font-size: 16px !important;
            font-weight: 600 !important;
            line-height: 1.3 !important;
        }
        .bookmark-header #add-bookmark-btn {
            margin-left: auto !important;
        }

        .clipboard-header {
            background-color: #d4edda !important;
            border-bottom: 1px solid #a3d5a3 !important;
            color: #28a745 !important;
            display: flex !important;
            align-items: center !important;
            margin: -12px -12px 12px -12px !important;
            padding: 12px !important;
            border-radius: 4px 4px 0 0 !important;
            font-size: 16px !important;
            font-weight: 600 !important;
            line-height: 1.3 !important;
        }
        .clipboard-header #add-clipboard-btn {
            margin-left: auto !important;
            margin-right: 4px !important;
        }
        
        .clipboard-header #add-divider-btn {
            margin-left: 0 !important;
        }
        .practice-header {
            background-color: #fff3cd !important;
            border-bottom: 1px solid #ffc107 !important;
            color: #ff8c00 !important;
            display: flex !important;
            justify-content: space-between !important;
            align-items: center !important;
            margin: -12px -12px 12px -12px !important;
            padding: 12px !important;
            border-radius: 4px 4px 0 0 !important;
            font-size: 16px !important;
            font-weight: 600 !important;
            line-height: 1.3 !important;
        }
        
        /* Ïó∞ÏäµÏû• ÌÉ≠ Ïä§ÌÉÄÏùº */
        .practice-tabs {
            display: flex;
            gap: 4px;
        }
        
        .practice-tab {
            min-width: 40px;
            height: 36px;
            border: 2px solid #ffc107;
            background-color: #fff3cd;
            color: #ff8c00;
            border-radius: 6px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            /* ÌÑ∞Ïπò ÏπúÌôîÏ†Å ÏÑ§Ï†ï */
            touch-action: manipulation;
            user-select: none;
            -webkit-tap-highlight-color: transparent;
        }
        
        .practice-tab:hover {
            background-color: #ffe69c;
            transform: translateY(-1px);
            box-shadow: 0 2px 4px rgba(255, 140, 0, 0.2);
        }
        
        .practice-tab:active {
            transform: translateY(0);
            box-shadow: 0 1px 2px rgba(255, 140, 0, 0.3);
        }
        
        .practice-tab.active {
            background-color: #ff8c00;
            color: white;
            border-color: #e07b00;
            box-shadow: 0 2px 6px rgba(255, 140, 0, 0.3);
        }
        
        .practice-tab.active:hover {
            background-color: #e07b00;
        }
        
        /* Î™®Î∞îÏùº ÌÑ∞Ïπò ÏµúÏ†ÅÌôî */
        @media (hover: none) and (pointer: coarse) {
            .practice-tab {
                min-width: 44px;
                height: 44px;
                font-size: 18px;
            }
            
            .practice-tab:hover {
                transform: none;
                background-color: #fff3cd;
            }
            
            .practice-tab:active {
                background-color: #ffe69c;
                transform: scale(0.95);
            }
        }
        
        .header-spacer {
            width: 33px;
            height: 33px;
            display: inline-block;
        }
        .practice-container {
            display: flex;
            flex-direction: column;
            height: calc(100% - 60px);
        }
        .practice-text {
            width: 100%;
            flex: 1;
            border: 1px solid #ddd;
            border-radius: 4px;
            padding: 12px;
            font-family: inherit;
            font-size: 14px;
            resize: none;
            box-sizing: border-box;
            background-color: #ffffff;
            margin-bottom: 8px;
        }
        .practice-text:focus {
            outline: none;
            border-color: #ff8c00;
            box-shadow: 0 0 0 2px rgba(255, 140, 0, 0.1);
        }
        .practice-buttons {
            display: flex;
            justify-content: flex-end;
            gap: 8px;
        }
        .practice-btn {
            padding: 6px 12px;
            border: 1px solid #ff8c00;
            border-radius: 4px;
            background-color: #ffffff;
            color: #ff8c00;
            cursor: pointer; /* Í∏∞Î≥∏ Ìè¨Ïù∏ÌÑ∞ Ïú†ÏßÄ */
            font-size: 12px;
            transition: all 0.2s;
        }
        .practice-btn:hover {
            background-color: #ff8c00;
            color: #ffffff;
        }
        .add-section-btn {
            background-color: transparent;
            color: rgba(55, 53, 47, 0.8);
            border: 2px solid #000000;
            border-radius: 50%;
            width: 33px;
            height: 33px;
            font-size: 18px;
            display: flex;
            justify-content: center;
            align-items: center;
            cursor: crosshair; /* ÏÉùÏÑ±/Ï∂îÍ∞Ä ÎäêÎÇå */
            flex-shrink: 0;
            margin-left: 6px;
            transition: all 0.2s ease;
        }
        .add-section-btn:hover {
            background-color: rgba(0, 0, 0, 0.1);
            color: #000000;
            border-color: #000000;
            transform: scale(1.05);
        }

        /* ÌîåÎ°úÌåÖ Í≥ÑÏÇ∞Í∏∞ Ïä§ÌÉÄÏùº */
        .floating-calculator {
            position: fixed;
            width: 320px;
            background-color: #ffffff;
            border: 2px solid #37352f;
            border-radius: 12px;
            box-shadow: 0 8px 24px rgba(0, 0, 0, 0.15);
            z-index: 3000;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            cursor: move;
            display: flex;
            flex-direction: column;
        }

        .calculator-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 16px;
            background: linear-gradient(135deg, #37352f 0%, #555 100%);
            color: white;
            border-radius: 10px 10px 0 0;
            cursor: grab;
            user-select: none;
        }

        .calculator-header:active {
            cursor: grabbing;
        }

        .calculator-title {
            font-weight: 600;
            font-size: 14px;
        }

        .calculator-close-btn {
            background: none;
            border: none;
            color: white;
            font-size: 20px;
            cursor: pointer;
            padding: 0;
            width: 24px;
            height: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .calculator-close-btn:hover {
            background-color: rgba(255, 255, 255, 0.2);
            border-radius: 4px;
        }

        .calculator-display {
            padding: 12px;
            background-color: #f5f5f5;
            border-bottom: 1px solid #ddd;
        }

        .calculator-input {
            width: 100%;
            padding: 12px;
            font-size: 24px;
            border: 1px solid #ccc;
            border-radius: 6px;
            text-align: right;
            background-color: #ffffff;
            color: #37352f;
            font-weight: 500;
            box-sizing: border-box;
        }

        .calculator-buttons {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 6px;
            padding: 12px;
            background-color: #fafafa;
        }

        .calc-btn {
            padding: 10px 8px;
            border: 1px solid #ddd;
            border-radius: 6px;
            background-color: #ffffff;
            color: #37352f;
            font-size: 13px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.1s ease;
            min-height: 36px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .calc-btn:hover {
            background-color: #f0f0f0;
            border-color: #999;
        }

        .calc-btn:active {
            background-color: #e0e0e0;
            transform: scale(0.98);
        }

        .calc-btn.quick-btn {
            background-color: #FFE4B5;
            border-color: #D2691E;
            font-weight: 600;
            color: #8B4513;
            font-size: 12px;
            padding: 8px 6px;
        }

        .calc-btn.quick-btn:hover {
            background-color: #FFD699;
        }

        .calculator-history {
            padding: 12px;
            border-top: 1px solid #ddd;
            background-color: #fafafa;
            max-height: 120px;
            overflow-y: auto;
        }

        .history-title {
            font-size: 12px;
            font-weight: 600;
            color: #666;
            margin-bottom: 6px;
        }

        .history-list {
            list-style: none;
            padding: 0;
            margin: 0;
        }

        .history-item {
            padding: 6px 8px;
            background-color: #ffffff;
            border: 1px solid #e0e0e0;
            border-radius: 4px;
            margin-bottom: 4px;
            cursor: pointer;
            font-size: 12px;
            color: #37352f;
            transition: all 0.1s ease;
        }

        .history-item:hover {
            background-color: #e8f4f8;
            border-color: #2ea2dc;
        }

        .calculator-actions {
            display: flex;
            gap: 8px;
            padding: 12px;
            border-top: 1px solid #ddd;
            background-color: #fafafa;
        }

        /* Floating Calendar Styles */
        .floating-calendar {
            position: fixed;
            width: 320px;
            background-color: #ffffff;
            border: 2px solid #37352f;
            border-radius: 12px;
            box-shadow: 0 8px 24px rgba(0, 0, 0, 0.15);
            z-index: 3000;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            cursor: move;
            display: flex;
            flex-direction: column;
        }

        .calendar-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 16px;
            background: linear-gradient(135deg, #37352f 0%, #555 100%);
            color: white;
            border-radius: 10px 10px 0 0;
            cursor: grab;
            user-select: none;
        }

        .calendar-header:active {
            cursor: grabbing;
        }

        .calendar-prev-btn,
        .calendar-next-btn {
            background: none;
            border: none;
            color: white;
            font-size: 18px;
            cursor: pointer;
            padding: 4px 8px;
            width: 32px;
            height: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 4px;
            transition: background-color 0.2s;
        }

        .calendar-prev-btn:hover,
        .calendar-next-btn:hover {
            background-color: rgba(255, 255, 255, 0.2);
        }

        .calendar-title {
            font-weight: 600;
            font-size: 14px;
            flex: 1;
            text-align: center;
        }

        .calendar-close-btn {
            background: none;
            border: none;
            color: white;
            font-size: 20px;
            cursor: pointer;
            padding: 0;
            width: 24px;
            height: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .calendar-close-btn:hover {
            background-color: rgba(255, 255, 255, 0.2);
            border-radius: 4px;
        }

        .calendar-weekdays {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 4px;
            padding: 12px;
            background-color: #f5f5f5;
            border-bottom: 1px solid #ddd;
        }

        .weekday {
            text-align: center;
            font-weight: 600;
            font-size: 12px;
            color: #666;
            padding: 8px 0;
        }

        .calendar-days {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 4px;
            padding: 12px;
            background-color: #fafafa;
            min-height: 240px;
        }

        .calendar-day {
            padding: 8px 4px;
            text-align: center;
            font-size: 12px;
            color: #37352f;
            cursor: pointer;
            border: 1px solid transparent;
            border-radius: 6px;
            background-color: #ffffff;
            transition: all 0.1s ease;
            min-height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .calendar-day:hover {
            background-color: #f0f0f0;
            border-color: #999;
        }

        .calendar-day.other-month {
            color: #ccc;
            background-color: transparent;
        }

        .calendar-day.today {
            background-color: #e8f4f8;
            border-color: #2ea2dc;
            font-weight: 600;
        }

        .calendar-day.selected {
            background-color: #2ea2dc;
            color: white;
            font-weight: 600;
        }

        .calendar-day.weekend {
            color: #e74c3c;
        }

        .calendar-footer {
            display: flex;
            gap: 8px;
            padding: 12px;
            border-top: 1px solid #ddd;
            background-color: #fafafa;
        }

        .calendar-date-input {
            flex: 1;
            padding: 8px 12px;
            border: 1px solid #ddd;
            border-radius: 6px;
            font-size: 12px;
            color: #37352f;
        }

        .calendar-date-input:focus {
            outline: none;
            border-color: #2ea2dc;
            box-shadow: 0 0 0 2px rgba(46, 162, 220, 0.1);
        }

        /* Î™®Î∞îÏùº Î∞òÏùëÌòï */
        @media (max-width: 768px) {
            .floating-calculator,
            .floating-calendar {
                width: calc(100vw - 40px);
                max-width: 300px;
            }

            .calculator-buttons {
                grid-template-columns: repeat(4, 1fr);
            }

            .calendar-days {
                min-height: 200px;
            }
        }

        .icon-button {
            background: none;
            border: none;
            font-size: 16px;
            cursor: pointer;
            color: rgba(55, 53, 47, 0.45);
            padding: 4px;
            border-radius: 3px;
            transition: background-color 0.1s ease-in-out, color 0.1s ease-in-out;
            width: 28px;
            height: 28px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .icon-button:hover {
            background-color: rgba(55, 53, 47, 0.08);
            color: #37352f;
        }
        .item-list {
            display: flex;
            flex-wrap: wrap;
            gap: 6px;
            list-style: none;
            padding: 0;
            margin: 0;
            word-break: break-all; /* Í∏¥ URLÎèÑ Ï§ÑÎ∞îÍøà */
        }
        .item-button {
            flex-shrink: 0;
            min-width: 80px;
            max-width: 200px;
            height: 32px;
            background-color: #f8f9fa;
            padding: 6px 8px;
            border-radius: 3px;
            border: 2px solid #000;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 14px;
            color: #37352f;
            cursor: pointer;
            overflow: hidden;
            white-space: nowrap;
            text-overflow: ellipsis;
            transition: background-color 0.1s ease-in-out;
            box-sizing: border-box;
            font-weight: bold;
            color: #000000;
        }
        .item-button:hover {
            background-color: rgba(55, 53, 47, 0.08);
        }
        .item-button.bookmark-button {
            color: #000000;
            background-color: rgba(46, 170, 220, 0.1);
            cursor: alias; /* ÎßÅÌÅ¨/Î∞îÎ°úÍ∞ÄÍ∏∞ ÎäêÎÇå */
        }
        .item-button.bookmark-button:hover {
            background-color: rgba(46, 170, 220, 0.2);
        }
        .item-button.clipboard-button {
            color: #000000;
            background-color: rgba(100, 71, 58, 0.1);
            cursor: copy; /* Î≥µÏÇ¨ Í∏∞Îä• Í∞ïÏ°∞ */
            position: relative;
            width: calc(33.333% - 3px) !important;
            min-width: unset !important;
            max-width: unset !important;
            flex: 0 0 calc(33.333% - 3px) !important;
        }

        /* ÌÅ¥Î¶ΩÎ≥¥Îìú Î≤ÑÌäº Ìà¥ÌåÅ - Í∞ïÌôîÎêú ÏÑ†ÌÉùÏûê */
        .item-button.clipboard-button .clipboard-tooltip {
            position: absolute !important;
            bottom: 100% !important;
            left: 50% !important;
            transform: translateX(-50%) !important;
            background: linear-gradient(135deg, #ff6b6b 0%, #4ecdc4 100%) !important;
            color: white !important;
            padding: 10px 14px !important;
            border-radius: 8px !important;
            font-size: 12px !important;
            font-weight: bold !important;
            z-index: 1000 !important;
            opacity: 0 !important;
            visibility: hidden !important;
            transition: opacity 0.3s ease, visibility 0.3s ease !important;
            margin-bottom: 8px !important;
            max-width: 220px !important;
            word-wrap: break-word !important;
            white-space: normal !important;
            pointer-events: none !important;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15) !important;
            text-shadow: 0 1px 2px rgba(0, 0, 0, 0.2) !important;
        }

        .item-button.clipboard-button .clipboard-tooltip::after {
            content: '' !important;
            position: absolute !important;
            top: 100% !important;
            left: 50% !important;
            transform: translateX(-50%) !important;
            border: 6px solid transparent !important;
            border-top-color: #764ba2 !important;
        }

        .item-button.clipboard-button:hover .clipboard-tooltip {
            opacity: 1 !important;
            visibility: visible !important;
        }

        /* Íµ¨Î∂ÑÏÑ† Ïä§ÌÉÄÏùº */
        .divider {
            width: 100%;
            height: 6px;
            background-color: rgba(55, 53, 47, 0.3);
            margin: 8px 0;
            border-radius: 3px;
            cursor: move; /* Ïù¥Îèô Í∞ÄÎä• ÎäêÎÇå */
            position: relative;
        }
        
        .divider[data-type="clipboard"] {
            background: linear-gradient(90deg, #a3d5a3, #28a745);
        }
        
        .divider:hover {
            opacity: 0.8;
        }

        .divider[data-type="clipboard"]:hover {
            background: linear-gradient(90deg, #8cc48c, #1e7e34);
        }
        
        .divider.dragging {
            opacity: 0.5;
        }
        

        /* Context Menu Styles */
        .context-menu {
            display: none;
            position: fixed;
            background-color: #ffffff;
            border: 1px solid rgba(55, 53, 47, 0.16);
            box-shadow: rgba(15, 15, 15, 0.05) 0px 0px 0px 1px, rgba(15, 15, 15, 0.1) 0px 3px 6px, rgba(15, 15, 15, 0.2) 0px 9px 24px;
            z-index: 2000;
            border-radius: 6px;
            overflow: hidden;
            min-width: 180px;
        }

        .context-menu ul {
            list-style: none;
            padding: 6px 0;
            margin: 0;
        }

        .context-menu ul li {
            padding: 8px 14px;
            cursor: pointer;
            font-size: 14px;
            color: #37352f;
            border-bottom: none;
            transition: background-color 0.1s ease-in-out;
            line-height: 1.3;
        }

        .context-menu ul li:hover,
        .context-menu ul li:active {
            background-color: rgba(55, 53, 47, 0.08);
        }
        
        /* Î™®Î∞îÏùºÏóêÏÑú ÌÑ∞Ïπò Î∞òÏùëÏÑ± Í∞úÏÑ† */
        @media (hover: none) and (pointer: coarse) {
            .context-menu ul li {
                padding: 14px 16px;
                font-size: 16px;
            }
        }

        /* Modal Styles */
        .modal {
            display: none;
            position: fixed;
            z-index: 1001;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(15, 15, 15, 0.6);
            justify-content: center;
            align-items: center;
        }

        .modal-content {
            background-color: #ffffff;
            margin: auto;
            padding: 60px;
            border: none;
            width: 90%;
            max-width: 720px;
            border-radius: 8px;
            box-shadow: rgba(15, 15, 15, 0.05) 0px 0px 0px 1px, rgba(15, 15, 15, 0.1) 0px 3px 6px, rgba(15, 15, 15, 0.2) 0px 9px 24px;
            position: relative;
        }

        .close-button {
            color: rgba(55, 53, 47, 0.45);
            float: right;
            font-size: 20px;
            font-weight: 400;
            position: absolute;
            right: 20px;
            top: 20px;
            cursor: pointer;
            padding: 4px;
            border-radius: 3px;
            transition: background-color 0.1s ease-in-out, color 0.1s ease-in-out;
        }

        .close-button:hover,
        .close-button:focus {
            background-color: rgba(55, 53, 47, 0.08);
            color: #37352f;
            text-decoration: none;
        }

        .modal-content h2 {
            margin: 0 0 24px 0;
            color: #37352f;
            border-bottom: none;
            padding-bottom: 0;
            font-size: 20px;
            font-weight: 600;
            line-height: 1.3;
        }

        .settings-section {
            margin-bottom: 24px;
            padding-bottom: 20px;
            border-bottom: 1px solid rgba(55, 53, 47, 0.09);
        }

        .settings-section:last-child {
            border-bottom: none;
        }

        .settings-section h3 {
            color: #37352f;
            margin: 0 0 12px 0;
            font-size: 16px;
            font-weight: 600;
        }

        .action-button {
            background-color: #2ea2dc;
            color: white;
            padding: 8px 12px;
            border: none;
            border-radius: 3px;
            cursor: pointer;
            font-size: 14px;
            margin-right: 8px;
            margin-bottom: 8px;
            transition: background-color 0.1s ease-in-out;
            font-weight: 500;
        }

        .action-button:hover {
            background-color: #1e8bb8;
        }

        .settings-section label {
            margin-right: 8px;
            font-size: 14px;
            color: #37352f;
            font-weight: 400;
        }

        .settings-section select,
        .settings-section input[type="checkbox"] {
            margin-top: 4px;
        }

        .settings-section select {
            padding: 6px 8px;
            border: 1px solid rgba(55, 53, 47, 0.25);
            border-radius: 3px;
            background-color: #ffffff;
            color: #37352f;
            font-size: 14px;
        }

        /* Modal Form Specific Styles */
        .modal-form-group {
            margin-bottom: 16px;
        }

        .modal-form-group label {
            display: block;
            margin-bottom: 6px;
            font-weight: 500;
            color: #37352f;
            font-size: 14px;
        }

        .modal-form-group input[type="text"],
        .modal-form-group textarea {
            width: 100%;
            padding: 8px 12px;
            border: 1px solid rgba(55, 53, 47, 0.25);
            border-radius: 3px;
            font-size: 14px;
            box-sizing: border-box;
            color: #37352f;
            background-color: #ffffff;
            transition: border-color 0.1s ease-in-out, box-shadow 0.1s ease-in-out;
        }

        .modal-form-group input[type="text"]:focus,
        .modal-form-group textarea:focus {
            outline: none;
            border-color: #2ea2dc;
            box-shadow: rgba(46, 170, 220, 0.15) 0px 0px 0px 1px;
        }

        .modal-form-group textarea {
            resize: vertical;
            min-height: 360px;
            font-family: inherit;
            line-height: 1.5;
        }

        .modal-actions {
            text-align: right;
            margin-top: 24px;
        }

        .secondary-button {
            background-color: rgba(55, 53, 47, 0.09);
            color: #37352f;
        }

        .secondary-button:hover {
            background-color: rgba(55, 53, 47, 0.16);
        }


        /* Color Palette Styles */
        .color-palette-grid {
            display: grid;
            grid-template-columns: repeat(6, 1fr);
            gap: 8px;
            margin-top: 16px;
        }

        .color-option {
            width: 40px;
            height: 40px;
            border-radius: 6px;
            cursor: pointer;
            border: 2px solid transparent;
            transition: border-color 0.1s ease-in-out, transform 0.1s ease-in-out;
            position: relative;
        }

        .color-option:hover {
            border-color: rgba(55, 53, 47, 0.25);
            transform: scale(1.05);
        }

        .color-option.selected {
            border-color: #2ea2dc;
            box-shadow: 0 0 0 1px #2ea2dc;
        }

        .color-option::after {
            content: attr(title);
            position: absolute;
            bottom: -24px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 11px;
            color: rgba(55, 53, 47, 0.65);
            white-space: nowrap;
            opacity: 0;
            transition: opacity 0.1s ease-in-out;
        }

        .color-option:hover::after {
            opacity: 1;
        }

        /* ÏÉÅÎã® Î∂ÅÎßàÌÅ¨ Ìå®ÎÑê - Ï†ÑÏ≤¥ ÎÑàÎπÑ, Í≥†Ï†ï ÎÜíÏù¥ (Î≤ÑÌäº 2Ï§Ñ) */
        .content-panel.bookmark-panel.top-bookmark {
            flex: 0 0 150px !important;
            width: 100%;
            max-width: none;
            height: 150px;
        }

        /* ÌïòÎã® ÌÅ¥Î¶ΩÎ≥¥ÎìúÏôÄ Ïó∞ÏäµÏû• - 50% + 50% Î∂ÑÌï† */
        .content-panels .content-panel.clipboard-panel {
            flex: 1 !important;
            max-width: none !important;
        }

        .content-panels .content-panel.practice-panel {
            flex: 1 !important;
            max-width: none !important;
        }

        .favorite-item {
            padding: 8px 12px;
            margin-bottom: 6px;
            background-color: #f8f9fa;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.2s ease-in-out;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
            font-size: 13px;
            font-weight: 500;
            text-align: center;
        }

        .favorite-item:hover {
            background-color: rgba(55, 53, 47, 0.08);
            transform: translateY(-1px);
        }

        .favorite-item.bookmark-fav {
            background-color: rgba(46, 170, 220, 0.15);
        }

        .favorite-item.clipboard-fav {
            background-color: rgba(100, 71, 58, 0.15);
        }
        
        /* Î∂ÅÎßàÌÅ¨ Ï¶êÍ≤®Ï∞æÍ∏∞ - 2Ïó¥ Í∑∏Î¶¨Îìú */
        #bookmark-favorites-list {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 6px;
        }
        
        /* ÌÅ¥Î¶ΩÎ≥¥Îìú ÏïÑÏù¥ÌÖú Î¶¨Ïä§Ìä∏ - 4Í∞úÏî© Ìïú Ï§Ñ Î∞∞Ïπò */
        .clipboard-panel .item-list {
            gap: 4px;
        }

        /* ÌÅ¥Î¶ΩÎ≥¥Îìú Ï¶êÍ≤®Ï∞æÍ∏∞ - ÎèôÏ†Å ÌîåÎ†âÏä§Î∞ïÏä§ */
        #clipboard-favorites-list {
            display: flex;
            flex-wrap: wrap;
            gap: 6px;
        }
        
        #clipboard-favorites-list .favorite-item {
            flex: 0 0 auto;
            min-width: 60px;
            max-width: 180px;
        }

        .favorite-icon {
            margin-right: 6px;
            font-size: 12px;
        }

        .stat-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 4px 0;
            font-size: 13px;
        }

        .stat-label {
            color: rgba(55, 53, 47, 0.8);
        }

        .stat-value {
            font-weight: 600;
            color: #37352f;
        }

        .activity-placeholder {
            text-align: center;
            color: rgba(55, 53, 47, 0.5);
            font-size: 12px;
            padding: 20px 0;
        }

        /* Drag and Drop Styles */
        .draggable {
            cursor: move;
            transition: opacity 0.2s ease;
        }

        .dragging {
            opacity: 0.5;
            transform: rotate(2deg);
        }

        .drag-over {
            background-color: rgba(59, 130, 246, 0.1) !important;
            border: 2px dashed #3b82f6 !important;
        }

        .drop-zone {
            min-height: 50px;
            transition: background-color 0.2s ease, border 0.2s ease;
        }

        .project-item.drag-over {
            background-color: rgba(59, 130, 246, 0.1);
            border-left: 4px solid #3b82f6;
        }

        /* Custom Tooltip Styles */
        .custom-tooltip {
            position: absolute;
            background-color: #37352f;
            color: #ffffff;
            padding: 8px 12px;
            border-radius: 6px;
            font-size: 13px;
            white-space: nowrap;
            z-index: 1000;
            pointer-events: none;
            opacity: 0;
            transition: opacity 0.2s ease-in-out;
            box-shadow: rgba(15, 15, 15, 0.1) 0px 3px 6px, rgba(15, 15, 15, 0.2) 0px 9px 24px;
            max-width: 300px;
            white-space: normal;
            word-wrap: break-word;
            line-height: 1.4;
        }

        .custom-tooltip.show {
            opacity: 1;
        }

        .custom-tooltip::before {
            content: '';
            position: absolute;
            top: 100%;
            left: 50%;
            transform: translateX(-50%);
            border: 5px solid transparent;
            border-top-color: #37352f;
        }

        .custom-tooltip.bottom::before {
            top: -10px;
            border-top-color: transparent;
            border-bottom-color: #37352f;
        }

        /* Î™®Î∞îÏùº ÌÉ≠ ÎÑ§ÎπÑÍ≤åÏù¥ÏÖò */
        .mobile-tabs {
            display: none;
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background-color: #ffffff;
            border-top: 1px solid rgba(55, 53, 47, 0.16);
            z-index: 1000;
            height: 60px;
            box-shadow: 0 -2px 10px rgba(0, 0, 0, 0.1);
        }

        .mobile-tab {
            flex: 1;
            background: none;
            border: none;
            padding: 8px 4px;
            font-size: 11px;
            color: rgba(55, 53, 47, 0.6);
            cursor: pointer;
            transition: color 0.2s ease;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            gap: 2px;
        }

        .mobile-tab.active {
            color: #B8860B;
            font-weight: 600;
        }

        .mobile-tab:hover {
            color: #37352f;
        }

        /* Î™®Î∞îÏùº Î∞òÏùëÌòï ÎîîÏûêÏù∏ */
        @media (max-width: 768px) {
            .mobile-tabs {
                display: flex;
            }

            body {
                padding-bottom: 60px; /* ÌÉ≠ ÎÑ§ÎπÑÍ≤åÏù¥ÏÖò Í≥µÍ∞Ñ ÌôïÎ≥¥ */
            }

            .app-container {
                flex-direction: column;
                height: calc(100vh - 60px);
            }

            /* Îç∞Ïä§ÌÅ¨ÌÜ± ÏÇ¨Ïù¥ÎìúÎ∞î Ïà®ÍπÄ */
            #project-sidebar {
                display: none;
            }

            #project-sidebar.mobile-visible {
                display: block;
                width: 100%;
                height: 100%;
                border-right: none;
                border-bottom: 1px solid rgba(55, 53, 47, 0.09);
            }

            .main-area {
                width: 100%;
                height: 100%;
            }

            .main-content {
                height: 100%;
                padding: 0;
                gap: 0;
            }

            /* Î™®Î∞îÏùºÏóêÏÑú ÏÉÅÎã® Î∂ÅÎßàÌÅ¨ Ìå®ÎÑê - Í∏∞Î≥∏ Ïà®ÍπÄ */
            .content-panel.bookmark-panel.top-bookmark {
                display: none;
                width: 100%;
                height: 100%;
                margin-bottom: 0;
                padding: 12px 8px;
                box-sizing: border-box;
                overflow-y: auto;
            }

            /* Î™®Î∞îÏùºÏóêÏÑú Î∂ÅÎßàÌÅ¨ Ìå®ÎÑê ÌëúÏãú (ÌÉ≠ ÌÑ∞ÏπòÏãú) */
            .content-panel.bookmark-panel.top-bookmark.mobile-visible {
                display: block;
            }

            /* Î™®Î∞îÏùºÏóêÏÑú ÌïòÎã® content-panels - Ìï≠ÏÉÅ ÌëúÏãú */
            .content-panels {
                display: flex;
                flex-direction: column;
                gap: 0;
                width: 100%;
                height: 100%;
            }

            /* Î™®Î∞îÏùºÏóêÏÑú Í∞Å Ìå®ÎÑêÎ≥Ñ ÌëúÏãú/Ïà®ÍπÄ */
            .content-panel {
                flex: none;
                max-width: none;
                width: 100%;
                height: 100%;
                padding: 12px 8px;
                box-sizing: border-box;
                display: none;
                overflow-y: auto;
            }

            .content-panel.clipboard-panel {
                display: none;
            }

            .content-panel.clipboard-panel.mobile-visible {
                display: flex !important;
                flex-direction: column;
                height: calc(100% - 12px);
                padding: 12px 8px;
                width: 100%;
                box-sizing: border-box;
                overflow-y: auto;
                margin: 0;
            }

            .content-panel.practice-panel {
                display: none;
            }

            .content-panel.practice-panel.mobile-visible {
                display: flex !important;
                flex-direction: column;
                height: calc(100% - 12px);
                padding: 12px 8px;
                width: 100%;
                box-sizing: border-box;
                overflow-y: auto;
                margin: 0;
            }

            .dashboard-area {
                display: none;
                flex: none;
                max-width: none;
                width: 100%;
                height: calc(100% - 32px);
                padding: 12px 8px; /* Ï¢åÏö∞ Ìå®Îî© Ï§ÑÏûÑ */
                overflow-y: auto;
                box-sizing: border-box;
            }

            .dashboard-area.mobile-visible {
                display: flex;
                flex-direction: column;
                align-items: center; /* Ï§ëÏïô Ï†ïÎ†¨ */
                gap: 16px;
            }
            
            /* Î™®Î∞îÏùºÏóêÏÑú ÎåÄÏãúÎ≥¥Îìú ÏúÑÏ†Ø Ïä§ÌÉÄÏùº Ï°∞Ï†ï */
            .dashboard-area.mobile-visible .dashboard-widget {
                width: 100%;
                max-width: calc(100vw - 32px); /* ÌôîÎ©¥ ÎÑàÎπÑÏóê ÎßûÏ∂§, Ï¢åÏö∞ Ïó¨Î∞± Í≥†Î†§ */
                margin: 0 auto;
                box-sizing: border-box;
            }
            
            .dashboard-area.mobile-visible .dashboard-content {
                padding: 12px;
                word-wrap: break-word;
            }
            
            .dashboard-area.mobile-visible .favorites-item {
                margin-bottom: 8px;
                padding: 8px;
                word-break: break-all; /* Í∏¥ URLÎèÑ Ï§ÑÎ∞îÍøà */
            }

            /* Î™®Î∞îÏùºÏóêÏÑú Î≤ÑÌäº ÌÅ¨Í∏∞ Ï°∞Ï†ï */
            .item-button {
                min-width: 100px;
                max-width: calc(100vw - 40px); /* ÌôîÎ©¥ ÎÑàÎπÑÏóê ÎßûÏ∂§ */
                height: auto; /* ÎÜíÏù¥ ÏûêÎèô Ï°∞Ï†ï */
                min-height: 36px;
                font-size: 13px;
                margin: 4px;
                word-wrap: break-word;
                white-space: normal; /* ÌÖçÏä§Ìä∏ Ï§ÑÎ∞îÍøà ÌóàÏö© */
                padding: 8px;
                line-height: 1.3;
                transition: transform 0.1s ease, background-color 0.3s ease;
            }

            /* Î™®Î∞îÏùºÏóêÏÑú ÌÅ¥Î¶ΩÎ≥¥Îìú Î≤ÑÌäºÏùÄ Ï†ÑÏ≤¥ ÎÑàÎπÑ ÏÇ¨Ïö© */
            .item-button.clipboard-button {
                width: 100% !important;
                flex: 0 0 100% !important;
                min-width: 100px !important;
                max-width: calc(100vw - 40px) !important;
                white-space: normal;
            }
            
            /* Î™®Î∞îÏùºÏóêÏÑú Í∏∏Í≤å ÎàÑÎ•¥Í∏∞ ÌîºÎìúÎ∞± */
            .item-button.long-press-active,
            .project-item.long-press-active {
                transform: scale(0.95);
                background-color: rgba(55, 53, 47, 0.15) !important;
            }
            
            /* Î™®Î∞îÏùº ÌÑ∞Ïπò ÏµúÏ†ÅÌôî */
            .item-button, .project-item {
                -webkit-touch-callout: none;
                -webkit-user-select: none;
                user-select: none;
            }

            /* Î™®Î∞îÏùºÏóêÏÑú Ï∂îÍ∞Ä Î≤ÑÌäº ÌÅ¨Í∏∞ Ï°∞Ï†ï */
            .add-section-btn {
                width: 36px;
                height: 36px;
                font-size: 20px;
            }

            /* Î™®Î∞îÏùºÏóêÏÑú Ìó§Îçî ÌÅ¨Í∏∞ Ï°∞Ï†ï */
            .content-header {
                padding: 12px 16px;
                min-height: 48px;
            }

            .content-header h1 {
                font-size: 20px;
            }
            
            /* Î™®Î∞îÏùºÏóêÏÑú Í≤ÄÏÉâÎ∞î Ï°∞Ï†ï */
            .search-container {
                max-width: 300px;
                margin: 0 8px;
            }
            
            #global-search {
                font-size: 13px;
                padding: 6px 12px 6px 32px;
            }
            
            .search-icon {
                left: 8px;
                font-size: 14px;
            }
            
            .search-results {
                font-size: 13px;
                max-height: 300px;
            }
            
            .search-result-item {
                padding: 8px 12px;
            }
            
            .search-result-title {
                font-size: 13px;
            }
            
            .search-result-subtitle {
                font-size: 11px;
            }
            
            .search-result-project {
                font-size: 10px;
            }

            /* Î™®Î∞îÏùºÏóêÏÑú Î™®Îã¨ ÌÅ¨Í∏∞ Ï°∞Ï†ï */
            .modal-content {
                width: 95%;
                max-width: 600px;
                margin: 20px;
                padding: 40px;
            }

            /* Ìà¥ÌåÅ Î™®Î∞îÏùº ÏµúÏ†ÅÌôî */
            .custom-tooltip {
                max-width: 280px;
                font-size: 12px;
            }


            /* Ïª®ÌÖçÏä§Ìä∏ Î©îÎâ¥ Î™®Î∞îÏùº ÏµúÏ†ÅÌôî */
            .context-menu {
                min-width: 150px;
            }

            .context-menu ul li {
                padding: 12px 16px;
                font-size: 14px;
            }

            /* ÌÅ¥Î¶ΩÎ≥¥Îìú Î™®Îã¨ Î™®Î∞îÏùº ÏµúÏ†ÅÌôî */
            #view-clipboard-modal .modal-content {
                height: 100vh !important;
                max-height: 100vh !important;
                padding: 0 !important;
                border-radius: 0;
            }

            #view-clipboard-header {
                border-radius: 0 !important;
                padding: 10px 12px !important;
            }

            #view-clipboard-header h2 {
                font-size: 18px !important;
            }

            #view-clipboard-modal .modal-content > div:nth-child(2) {
                padding: 8px 8px !important;
            }

            #view-clipboard-content {
                padding: 8px !important;
                min-height: 0 !important;
                border: 1px solid #000000 !important;
            }

            #view-checklist-items {
                padding: 8px !important;
                border: 1px solid #000000 !important;
            }

            .modal-actions {
                padding: 8px 12px !important;
                gap: 8px;
                display: flex;
                justify-content: flex-end;
            }

            .modal-actions button {
                padding: 8px 12px !important;
                font-size: 14px !important;
            }
        }

        /* ÌÉúÎ∏îÎ¶ø ÏÇ¨Ïù¥Ï¶à */
        @media (max-width: 1024px) and (min-width: 769px) {
            #project-sidebar {
                width: 200px;
            }

            .content-panel {
                flex: 0 0 300px;
                max-width: 300px;
            }
        }
    </style>
</head>
<body>
    <!-- Î™®Î∞îÏùº ÌÉ≠ ÎÑ§ÎπÑÍ≤åÏù¥ÏÖò -->
    <div class="mobile-tabs">
        <button class="mobile-tab active" data-tab="projects">üìÅ ÌîÑÎ°úÏ†ùÌä∏</button>
        <button class="mobile-tab" data-tab="clipboard">üìã ÌÅ¥Î¶ΩÎ≥¥Îìú</button>
        <button class="mobile-tab" data-tab="practice">üìù Ïó∞ÏäµÏû•</button>
    </div>

    <div class="app-container">
        <div id="project-sidebar">
            <div class="sidebar-header">
                <h3>ÌîÑÎ°úÏ†ùÌä∏</h3>
                <button id="add-project-btn" class="add-project-btn">+</button>
            </div>
            <ul id="project-list">
            </ul>
        </div>

        <div class="main-area">
            <div class="content-header">
                <h1 id="current-project-title"></h1>
                <div class="search-container">
                    <div class="search-icon">üîç</div>
                    <input type="text" id="global-search" placeholder="ÌîÑÎ°úÏ†ùÌä∏, Î∂ÅÎßàÌÅ¨, ÌÅ¥Î¶ΩÎ≥¥Îìú Í≤ÄÏÉâ...">
                    <div id="search-results" class="search-results"></div>
                </div>
                <button id="settings-btn" class="icon-button">‚öôÔ∏è</button>
            </div>
            
            <div class="main-content">
                <!-- ÏÉÅÎã®: Î∂ÅÎßàÌÅ¨ (Ï†ÑÏ≤¥ ÎÑàÎπÑ, Î≤ÑÌäº 2Ï§Ñ ÎÜíÏù¥) -->
                <div class="content-panel bookmark-panel top-bookmark">
                    <h4 class="bookmark-header">Î∂ÅÎßàÌÅ¨ <button id="add-bookmark-btn" class="add-section-btn">+</button></h4>
                    <ul id="bookmark-list" class="item-list"></ul>
                </div>

                <!-- ÌïòÎã®: ÌÅ¥Î¶ΩÎ≥¥ÎìúÏôÄ Ïó∞ÏäµÏû• (50% + 50%) -->
                <div class="content-panels">
                    <div class="content-panel clipboard-panel">
                        <h4 class="clipboard-header">ÌÅ¥Î¶ΩÎ≥¥Îìú <button id="calculator-btn" class="add-section-btn" title="Í≥ÑÏÇ∞Í∏∞">üßÆ</button> <button id="calendar-btn" class="add-section-btn" title="Îã¨Î†•">üìÖ</button> <button id="add-clipboard-btn" class="add-section-btn">+</button> <button id="add-divider-btn" class="add-section-btn">|</button></h4>
                        <ul id="clipboard-list" class="item-list"></ul>
                    </div>

                    <div class="content-panel practice-panel">
                        <h4 class="practice-header">Ïó∞ÏäµÏû• <div class="practice-tabs">
                            <button class="practice-tab active" data-tab="1">1</button>
                            <button class="practice-tab" data-tab="2">2</button>
                            <button class="practice-tab" data-tab="3">3</button>
                            <button class="practice-tab" data-tab="4">4</button>
                            <button class="practice-tab" data-tab="5">5</button>
                        </div></h4>
                        <div class="practice-container">
                            <textarea id="practice-textarea" class="practice-text" placeholder="ÏûêÏú†Î°≠Í≤å ÌÖçÏä§Ìä∏Î•º ÏûÖÎ†•ÌïòÏÑ∏Ïöî..."></textarea>
                            <div class="practice-buttons">
                                <button id="copy-practice-btn" class="practice-btn">Î≥µÏÇ¨</button>
                                <button id="clear-practice-btn" class="practice-btn">Ï¥àÍ∏∞Ìôî</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        </div>
    </div>


    <!-- Settings Modal -->
    <div id="settings-modal" class="modal">
        <div class="modal-content">
            <span class="close-button">&times;</span>
            <h2>ÏÑ§Ï†ï</h2>
            
            <div class="settings-section">
                <h3>Îç∞Ïù¥ÌÑ∞ Í¥ÄÎ¶¨</h3>
                <button id="export-data-btn" class="action-button">Îç∞Ïù¥ÌÑ∞ ÎÇ¥Î≥¥ÎÇ¥Í∏∞ (JSON)</button>
                <input type="file" id="import-data-input" accept=".json" style="display: none;">
                <button id="import-data-btn" class="action-button">Îç∞Ïù¥ÌÑ∞ Î∂àÎü¨Ïò§Í∏∞ (JSON)</button>
            </div>

            <div class="settings-section">
                <h3>Î∂ÅÎßàÌÅ¨ ÏÑ§Ï†ï</h3>
                <label for="link-target-select">ÎßÅÌÅ¨ Ïó¥Í∏∞ Î∞©Ïãù:</label>
                <select id="link-target-select">
                    <option value="_blank">ÏÉà ÌÉ≠</option>
                    <option value="_self">ÌòÑÏû¨ ÌÉ≠</option>
                </select>
            </div>

            <div class="settings-section">
                <h3>ÌÅ¥Î¶ΩÎ≥¥Îìú ÏÑ§Ï†ï</h3>
                <input type="checkbox" id="copy-alert-checkbox">
                <label for="copy-alert-checkbox">Î≥µÏÇ¨ ÏôÑÎ£å ÏïåÎ¶º ÌëúÏãú</label>
            </div>
        </div>
    </div>

    <!-- Add Bookmark Modal -->
    <div id="add-bookmark-modal" class="modal">
        <div class="modal-content">
            <span class="close-button add-bookmark-close">&times;</span>
            <h2>Î∂ÅÎßàÌÅ¨ Ï∂îÍ∞Ä</h2>
            <div class="modal-form-group">
                <label for="add-bookmark-name">Ïù¥Î¶Ñ (8Í∏ÄÏûê Ïù¥ÎÇ¥):</label>
                <input type="text" id="add-bookmark-name" maxlength="8">
            </div>
            <div class="modal-form-group">
                <label for="add-bookmark-url">URL:</label>
                <input type="text" id="add-bookmark-url">
            </div>
            <div class="modal-actions">
                <button id="add-bookmark-save" class="action-button">Ï†ÄÏû•</button>
                <button id="add-bookmark-cancel" class="action-button secondary-button">Ï∑®ÏÜå</button>
            </div>
        </div>
    </div>

    <!-- Add Clipboard Modal -->
    <div id="add-clipboard-modal" class="modal">
        <div class="modal-content" style="display: flex; flex-direction: column; height: 90vh; max-height: 90vh; padding: 0;">
            <div style="display: flex; justify-content: space-between; align-items: center; padding: 12px 16px; background: linear-gradient(135deg, #2d7c3e 0%, #3da050 50%, #4db860 100%); border-radius: 4px 4px 0 0; border-bottom: 3px solid #1b4a27; flex-shrink: 0;">
                <h2 id="clipboard-edit-title" style="margin: 0; color: white; font-size: 20px;">ÌÅ¥Î¶ΩÎ≥¥Îìú Ï∂îÍ∞Ä</h2>
                <div style="display: flex; gap: 15px; align-items: center;">
                    <label style="display: flex; align-items: center; font-weight: 400; margin: 0; color: white;">
                        <input type="radio" name="clipboard-type" value="normal" checked style="margin-right: 6px;">
                        ÌÖçÏä§Ìä∏
                    </label>
                    <label style="display: flex; align-items: center; font-weight: 400; margin: 0; color: white;">
                        <input type="radio" name="clipboard-type" value="template" style="margin-right: 6px;">
                        ÌÖúÌîåÎ¶ø
                    </label>
                    <label style="display: flex; align-items: center; font-weight: 400; margin: 0; color: white;">
                        <input type="radio" name="clipboard-type" value="checklist" style="margin-right: 6px;">
                        Ï≤¥ÌÅ¨Î¶¨Ïä§Ìä∏
                    </label>
                    <button id="insert-variable-btn" type="button" class="action-button secondary-button" style="padding: 6px 10px; font-size: 12px; display: none;">
                        Î≥ÄÏàò ÏÇΩÏûÖ {}
                    </button>
                </div>
                <span class="close-button add-clipboard-close" style="color: white; font-size: 28px; position: relative; top: 0; right: 0; margin: 0;">&times;</span>
            </div>
            <div id="template-hint" style="font-size: 12px; color: #999; padding: 12px 40px 0; display: none;">
                üí° Î≥∏Î¨∏Ïóê {Î≥ÄÏàòÎ™Ö} ÌòïÏãùÏúºÎ°ú Î≥ÄÏàòÎ•º Î∞∞ÏπòÌïòÎ©¥ ÏÇ¨Ïö©Ìï† Îïå Í∞íÏùÑ ÏûÖÎ†•Î∞õÏäµÎãàÎã§. Î≥ÄÏàò ÏÇΩÏûÖ Î≤ÑÌäºÏùÑ ÌÅ¥Î¶≠Ìï¥ Í¥ÑÌò∏Î•º ÏÇΩÏûÖÌï† Ïàò ÏûàÏäµÎãàÎã§.
            </div>
            <div style="flex: 1; overflow-y: auto; padding: 20px 40px; display: flex; flex-direction: column;">
                <!-- ÏùºÎ∞ò Î™®Îìú (ÌÖçÏä§Ìä∏, ÌÖúÌîåÎ¶ø) -->
                <div id="normal-mode-container" style="flex: 1; display: flex; flex-direction: column;">
                    <div class="modal-form-group">
                        <label for="add-clipboard-title">Ï†úÎ™© (10Í∏ÄÏûê Ïù¥ÎÇ¥):</label>
                        <input type="text" id="add-clipboard-title" maxlength="10">
                    </div>
                    <div class="modal-form-group" style="flex: 1; display: flex; flex-direction: column;">
                        <label for="add-clipboard-content">ÎÇ¥Ïö©:</label>
                        <textarea id="add-clipboard-content" style="flex: 1; border: 2px solid #000000; resize: none;"></textarea>
                    </div>
                </div>

                <!-- Ï≤¥ÌÅ¨Î¶¨Ïä§Ìä∏ Î™®Îìú -->
                <div id="checklist-mode-container" style="flex: 1; display: none; flex-direction: column;">
                    <div class="modal-form-group" style="flex: 1; display: flex; flex-direction: column;">
                        <label>Ï≤¥ÌÅ¨Î¶¨Ïä§Ìä∏ Ìï≠Î™©:</label>
                        <div style="display: flex; gap: 8px; margin-bottom: 12px;">
                            <input type="text" id="checklist-item-input" placeholder="Ìï≠Î™© ÏûÖÎ†• ÌõÑ Ï∂îÍ∞Ä Î≤ÑÌäº ÌÅ¥Î¶≠" style="flex: 1; padding: 8px 12px; border: 1px solid rgba(55, 53, 47, 0.25); border-radius: 3px; font-size: 14px;">
                            <button id="checklist-add-btn" type="button" class="action-button" style="padding: 8px 16px; font-size: 12px;">Ï∂îÍ∞Ä</button>
                        </div>
                        <ul id="checklist-items-list" style="flex: 1; list-style: none; padding: 12px; border: 2px solid #000000; border-radius: 4px; background-color: #fafafa; margin: 0; overflow-y: auto;">
                        </ul>
                    </div>
                </div>
            </div>
            <div class="modal-actions" style="padding: 15px 40px; border-top: 1px solid #e0e0e0; background-color: #fafafa; flex-shrink: 0; display: flex; justify-content: space-between; align-items: center;">
                <div style="display: flex; align-items: center; gap: 8px;">
                    <label for="add-clipboard-file" style="font-size: 12px; color: #666; cursor: pointer;">üìé ÌååÏùº Ï≤®Î∂Ä</label>
                    <input type="file" id="add-clipboard-file" style="display: none;">
                    <div id="file-info" style="font-size: 12px; color: #666;"></div>
                </div>
                <div style="display: flex; gap: 8px;">
                    <button id="add-clipboard-save" class="action-button">Ï†ÄÏû•</button>
                    <button id="add-clipboard-cancel" class="action-button secondary-button">Ï∑®ÏÜå</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Add Project Modal -->
    <div id="add-project-modal" class="modal">
        <div class="modal-content">
            <span class="close-button add-project-close">&times;</span>
            <h2>ÌîÑÎ°úÏ†ùÌä∏ Ï∂îÍ∞Ä</h2>
            <div class="modal-form-group">
                <label for="add-project-name">ÌîÑÎ°úÏ†ùÌä∏ Ïù¥Î¶Ñ:</label>
                <input type="text" id="add-project-name" placeholder="ÏÉà ÌîÑÎ°úÏ†ùÌä∏ Ïù¥Î¶ÑÏùÑ ÏûÖÎ†•ÌïòÏÑ∏Ïöî">
            </div>
            <div class="modal-actions">
                <button id="add-project-save" class="action-button">Ï†ÄÏû•</button>
                <button id="add-project-cancel" class="action-button secondary-button">Ï∑®ÏÜå</button>
            </div>
        </div>
    </div>

    <div id="context-menu" class="context-menu">
        <ul>
            <li id="context-edit">Ìé∏Ïßë</li>
            <li id="context-favorite">Ï¶êÍ≤®Ï∞æÍ∏∞</li>
            <li id="context-color">ÏÉâÏÉÅ Î≥ÄÍ≤Ω</li>
            <li id="context-copy-button">Î≤ÑÌäº Î≥µÏÇ¨</li>
            <li id="context-delete">ÏÇ≠Ï†ú</li>
            <li id="context-cancel">Ï∑®ÏÜå</li>
        </ul>
    </div>

    <div id="project-context-menu" class="context-menu">
        <ul>
            <li id="project-context-rename">Ïù¥Î¶Ñ ÏàòÏ†ï</li>
            <li id="project-context-delete">ÏÇ≠Ï†ú</li>
            <li id="project-context-cancel">Ï∑®ÏÜå</li>
        </ul>
    </div>

    <div id="bookmark-list-context-menu" class="context-menu">
        <ul>
            <li id="list-context-paste">Î∂ôÏó¨ÎÑ£Í∏∞</li>
            <li id="list-context-cancel">Ï∑®ÏÜå</li>
        </ul>
    </div>

    <div id="clipboard-list-context-menu" class="context-menu">
        <ul>
            <li id="clipboard-list-context-paste">Î∂ôÏó¨ÎÑ£Í∏∞</li>
            <li id="clipboard-list-context-cancel">Ï∑®ÏÜå</li>
        </ul>
    </div>

    <!-- Checklist Item Context Menu -->
    <div id="checklist-item-context-menu" class="context-menu">
        <ul>
            <li id="checklist-item-context-edit">ÏàòÏ†ï</li>
            <li id="checklist-item-context-delete">ÏÇ≠Ï†ú</li>
            <li id="checklist-item-context-cancel">Ï∑®ÏÜå</li>
        </ul>
    </div>

    <!-- View Checklist Item Context Menu -->
    <div id="view-checklist-item-context-menu" class="context-menu">
        <ul>
            <li id="view-checklist-item-context-delete">ÏÇ≠Ï†ú</li>
            <li id="view-checklist-item-context-cancel">Ï∑®ÏÜå</li>
        </ul>
    </div>

    <!-- Checklist Detail Item Context Menu -->
    <div id="checklist-detail-item-context-menu" class="context-menu" style="z-index: 10002;">
        <ul>
            <li id="checklist-detail-item-context-delete">ÏÇ≠Ï†ú</li>
            <li id="checklist-detail-item-context-cancel">Ï∑®ÏÜå</li>
        </ul>
    </div>

    <!-- Checklist Detail Modal -->
    <div id="checklist-detail-modal" class="modal" style="z-index: 10000;">
        <div class="modal-content" style="display: flex; flex-direction: column; max-width: 800px; height: 90vh; max-height: 90vh; padding: 0; position: absolute; left: 50%; top: 50%; transform: translate(-50%, -50%); z-index: 10000;">
            <!-- Header (Draggable) -->
            <div class="draggable-header" style="display: flex; justify-content: space-between; align-items: center; padding: 14.4px 19.2px; background: linear-gradient(135deg, #d8c5e8 0%, #e5d9f0 100%); border-radius: 8px 8px 0 0; flex-shrink: 0; box-shadow: 0 2px 4px rgba(0,0,0,0.05); cursor: grab; user-select: none; z-index: 10000;">
                <h2 id="checklist-detail-title" style="margin: 0; color: #5a4a7a; font-size: 24px; font-weight: 700; letter-spacing: 0.3px;"></h2>
                <span class="close-button checklist-detail-close" style="color: #7a6a9a; font-size: 16.8px; position: relative; top: 0; right: 0; margin: 0; cursor: pointer; opacity: 0.7; transition: opacity 0.2s;">&times;</span>
            </div>

            <!-- Content Area - Checklist Edit Mode -->
            <div id="checklist-detail-edit-area" style="flex: 1; padding: 20px; overflow: hidden; display: flex; flex-direction: column; gap: 12px;">
                <!-- Ìï≠Î™© Ï∂îÍ∞Ä ÏòÅÏó≠ -->
                <div style="display: flex; gap: 8px; flex-shrink: 0;">
                    <textarea id="checklist-detail-item-input" placeholder="ÏÉÅÏÑ∏ Ìï≠Î™© ÏûÖÎ†• (Ïó¨Îü¨ Ï§Ñ Í∞ÄÎä•) ÌõÑ Ï∂îÍ∞Ä Î≤ÑÌäº ÌÅ¥Î¶≠" style="flex: 1; padding: 10px 12px; border: 1px solid #ccc; border-radius: 4px; font-size: 14px; font-family: inherit; resize: none; height: 60px; box-sizing: border-box;"></textarea>
                    <button id="checklist-detail-add-item-btn" type="button" class="action-button" style="padding: 10px 16px; font-size: 12px; background-color: #5a4a7a; color: white; border: none; border-radius: 6px; cursor: pointer; flex-shrink: 0; height: fit-content;">Ï∂îÍ∞Ä</button>
                </div>
                <!-- Ìï≠Î™© Î¶¨Ïä§Ìä∏ -->
                <ul id="checklist-detail-items-list" style="flex: 1; list-style: none; padding: 12px; border: 2px solid #000000; border-radius: 4px; background-color: #fafafa; margin: 0; overflow-y: auto; display: flex; flex-direction: column; gap: 4px;"></ul>
            </div>

            <!-- Content Area - Checklist View Mode -->
            <div id="checklist-detail-view-area" style="flex: 1; padding: 20px; overflow: hidden; display: none; flex-direction: column; gap: 12px;">
                <!-- Ìï≠Î™© Ï∂îÍ∞Ä ÏòÅÏó≠ -->
                <div style="display: flex; gap: 8px; flex-shrink: 0;">
                    <textarea id="checklist-detail-view-item-input" placeholder="ÏÉÅÏÑ∏ Ìï≠Î™© ÏûÖÎ†• (Ïó¨Îü¨ Ï§Ñ Í∞ÄÎä•) ÌõÑ Ï∂îÍ∞Ä Î≤ÑÌäº ÌÅ¥Î¶≠" style="flex: 1; padding: 10px 12px; border: 1px solid #ccc; border-radius: 4px; font-size: 14px; font-family: inherit; resize: none; height: 60px; box-sizing: border-box;"></textarea>
                    <button id="checklist-detail-view-add-item-btn" type="button" class="action-button" style="padding: 10px 16px; font-size: 12px; background-color: #5a4a7a; color: white; border: none; border-radius: 6px; cursor: pointer; flex-shrink: 0; height: fit-content;">Ï∂îÍ∞Ä</button>
                </div>
                <!-- Ìï≠Î™© Î¶¨Ïä§Ìä∏ -->
                <ul id="checklist-detail-view-items" style="flex: 1; list-style: none; padding: 12px; border: 2px solid #000000; border-radius: 4px; background-color: #fafafa; margin: 0; overflow-y: auto; display: flex; flex-direction: column; gap: 4px;"></ul>
            </div>

            <!-- Footer - Edit Mode -->
            <div id="checklist-detail-footer-edit" style="padding: 12px 19.2px; background: linear-gradient(135deg, #e8e8e8 0%, #f0f0f0 100%); border-top: 1px solid rgba(0,0,0,0.1); flex-shrink: 0; text-align: right; box-shadow: 0 -2px 4px rgba(0,0,0,0.05);">
                <button id="checklist-detail-save" class="action-button" style="background-color: #5a4a7a; color: white; border: none; padding: 9.9px 21.6px; border-radius: 6px; cursor: pointer; font-weight: 500; font-size: 12.6px; margin-left: 6px; transition: all 0.2s; box-shadow: 0 1px 3px rgba(0,0,0,0.1);">Ï†ÄÏû•</button>
                <button id="checklist-detail-cancel" class="action-button secondary-button" style="background-color: #d0d0d0; color: #666; border: none; padding: 9.9px 21.6px; border-radius: 6px; cursor: pointer; font-weight: 500; font-size: 12.6px; margin-left: 6px; transition: all 0.2s;">Ï∑®ÏÜå</button>
            </div>

            <!-- Footer - View Mode -->
            <div id="checklist-detail-footer-view" style="padding: 12px 19.2px; background: linear-gradient(135deg, #e8e8e8 0%, #f0f0f0 100%); border-top: 1px solid rgba(0,0,0,0.1); flex-shrink: 0; display: none; text-align: right; box-shadow: 0 -2px 4px rgba(0,0,0,0.05);">
                <button id="checklist-detail-view-save" class="action-button" style="background-color: #5a4a7a; color: white; border: none; padding: 9.9px 21.6px; border-radius: 6px; cursor: pointer; font-weight: 500; font-size: 12.6px; margin-left: 6px; transition: all 0.2s; box-shadow: 0 1px 3px rgba(0,0,0,0.1);">Ï†ÄÏû•</button>
                <button id="checklist-detail-view-close" class="action-button secondary-button" style="background-color: #d0d0d0; color: #666; border: none; padding: 9.9px 21.6px; border-radius: 6px; cursor: pointer; font-weight: 500; font-size: 12.6px; margin-left: 6px; transition: all 0.2s;">Îã´Í∏∞</button>
            </div>

        </div>
    </div>

    <!-- Template Variable Input Modal -->
    <div id="template-use-modal" class="modal">
        <div class="modal-content" style="max-width: 600px;">
            <span class="close-button template-use-close">&times;</span>
            <h2 id="template-title-display"></h2>
            <div id="template-variables-form"></div>
            <div style="background-color: #f5f5f5; padding: 12px; border-radius: 6px; margin: 20px 0; border-left: 3px solid #2ea2dc;">
                <label style="display: block; font-size: 12px; color: #666; margin-bottom: 8px; font-weight: 600;">ÎØ∏Î¶¨Î≥¥Í∏∞:</label>
                <div id="template-preview" style="white-space: pre-wrap; word-break: break-word; font-size: 14px; color: #37352f; line-height: 1.6;"></div>
            </div>
            <div class="modal-actions">
                <button id="template-generate-btn" class="action-button">ÏôÑÎ£å</button>
                <button id="template-use-cancel" class="action-button secondary-button">Ï∑®ÏÜå</button>
            </div>
        </div>
    </div>

    <!-- Template Result Selection Modal -->
    <div id="template-result-modal" class="modal">
        <div class="modal-content" style="max-width: 500px;">
            <span class="close-button template-result-close">&times;</span>
            <h2>Í≤∞Í≥º Ï≤òÎ¶¨</h2>
            <div style="background-color: #f9f9f9; padding: 12px; border-radius: 6px; margin: 20px 0; border-left: 3px solid #2ea2dc; max-height: 300px; overflow-y: auto;">
                <div id="template-result-content" style="white-space: pre-wrap; word-break: break-word; font-size: 13px; color: #37352f; line-height: 1.6;"></div>
            </div>
            <div class="modal-actions">
                <button id="template-copy-btn" class="action-button">ÌÅ¥Î¶ΩÎ≥¥ÎìúÏóê Î≥µÏÇ¨</button>
                <button id="template-save-btn" class="action-button" style="background-color: #27ae60;">ÏÉà ÌÅ¥Î¶ΩÎ≥¥ÎìúÎ°ú Ï†ÄÏû•</button>
                <button id="template-result-cancel" class="action-button secondary-button">Îã´Í∏∞</button>
            </div>
        </div>
    </div>

    <!-- Floating Calculator -->
    <div id="floating-calculator" class="floating-calculator" style="display: none;">
        <div class="calculator-header">
            <span class="calculator-title">Í≥ÑÏÇ∞Í∏∞</span>
            <button class="calculator-close-btn">‚úï</button>
        </div>
        <div class="calculator-display">
            <input type="text" id="calculator-input" class="calculator-input" value="0" readonly>
        </div>
        <div class="calculator-buttons">
            <button class="calc-btn quick-btn" data-value="126">126%</button>
            <button class="calc-btn quick-btn" data-value="90">90%</button>
            <button class="calc-btn" data-action="clear">C</button>
            <button class="calc-btn" data-action="delete">CE</button>
            <button class="calc-btn" data-value="1">1</button>
            <button class="calc-btn" data-value="2">2</button>
            <button class="calc-btn" data-value="3">3</button>
            <button class="calc-btn" data-operator="+">+</button>
            <button class="calc-btn" data-value="4">4</button>
            <button class="calc-btn" data-value="5">5</button>
            <button class="calc-btn" data-value="6">6</button>
            <button class="calc-btn" data-operator="-">‚àí</button>
            <button class="calc-btn" data-value="7">7</button>
            <button class="calc-btn" data-value="8">8</button>
            <button class="calc-btn" data-value="9">9</button>
            <button class="calc-btn" data-operator="*">√ó</button>
            <button class="calc-btn" data-value="0">0</button>
            <button class="calc-btn" data-value=".">.</button>
            <button class="calc-btn" data-action="equals" style="background-color: #2ea2dc; color: white;">=</button>
            <button class="calc-btn" data-operator="/">√∑</button>
        </div>
        <div class="calculator-history">
            <div class="history-title">Í≥ÑÏÇ∞ Ïù¥Î†•:</div>
            <ul id="calculator-history-list" class="history-list"></ul>
        </div>
        <div class="calculator-actions">
            <button id="calculator-copy-btn" class="action-button secondary-button" style="flex: 1;">Î≥µÏÇ¨</button>
            <button id="calculator-save-btn" class="action-button" style="flex: 1; background-color: #27ae60;">Ï†ÄÏû•</button>
        </div>
    </div>

    <!-- Floating Calendar -->
    <div id="floating-calendar" class="floating-calendar" style="display: none;">
        <div class="calendar-header">
            <button class="calendar-prev-btn">‚ùÆ</button>
            <span class="calendar-title">2025ÎÖÑ 10Ïõî</span>
            <button class="calendar-next-btn">‚ùØ</button>
            <button class="calendar-close-btn">‚úï</button>
        </div>
        <div class="calendar-weekdays">
            <div class="weekday">Ïùº</div>
            <div class="weekday">Ïõî</div>
            <div class="weekday">Ìôî</div>
            <div class="weekday">Ïàò</div>
            <div class="weekday">Î™©</div>
            <div class="weekday">Í∏à</div>
            <div class="weekday">ÌÜ†</div>
        </div>
        <div id="calendar-days" class="calendar-days"></div>
        <div class="calendar-footer">
            <input type="date" id="calendar-date-input" class="calendar-date-input">
            <button id="calendar-copy-btn" class="action-button secondary-button">Î≥µÏÇ¨</button>
        </div>
    </div>

    <!-- Custom Tooltip -->
    <div id="custom-tooltip" class="custom-tooltip"></div>

    <!-- Color Palette Modal -->
    <div id="color-palette-modal" class="modal">
        <div class="modal-content">
            <span class="close-button color-palette-close">&times;</span>
            <h2>ÏÉâÏÉÅ ÏÑ†ÌÉù</h2>
            <div class="color-palette-grid">
                <!-- Ï≤´ Î≤àÏß∏ Ï§Ñ: Í∏∞Î≥∏ & Î∞ùÏùÄ ÌöåÏÉâ Í≥ÑÏó¥ -->
                <div class="color-option" data-color="#ffffff" style="background-color: #ffffff;" title="ÌôîÏù¥Ìä∏ (Í∏∞Î≥∏)"></div>
                <div class="color-option" data-color="#f8fafc" style="background-color: #f8fafc;" title="Ïä§ÎÖ∏Ïö∞"></div>
                <div class="color-option" data-color="#e2e8f0" style="background-color: #e2e8f0;" title="Ïã§Î≤Ñ"></div>
                <div class="color-option" data-color="#94a3b8" style="background-color: #94a3b8;" title="Í∑∏Î†àÏù¥"></div>
                <div class="color-option" data-color="#64748b" style="background-color: #64748b;" title="Ïä¨Î†àÏù¥Ìä∏"></div>
                <div class="color-option" data-color="#334155" style="background-color: #334155;" title="Ï∞®ÏΩú"></div>

                <!-- Îëê Î≤àÏß∏ Ï§Ñ: üî¥ Î∞ùÏùÄ Îπ®Í∞ï Í≥ÑÏó¥ -->
                <div class="color-option" data-color="#ffe4e6" style="background-color: #ffe4e6;" title="Î°úÏ¶à ÎØ∏Ïä§Ìä∏"></div>
                <div class="color-option" data-color="#fecdd3" style="background-color: #fecdd3;" title="Ï≤¥Î¶¨ Î∏îÎü¨ÏÑ¨"></div>
                <div class="color-option" data-color="#fda4af" style="background-color: #fda4af;" title="ÏΩîÎûÑ ÌïëÌÅ¨"></div>
                <div class="color-option" data-color="#fb7185" style="background-color: #fb7185;" title="ÏõåÌÑ∞Î©úÎ°†"></div>
                <div class="color-option" data-color="#f43f5e" style="background-color: #f43f5e;" title="Ïä§Ìä∏Î°úÎ≤†Î¶¨"></div>
                <div class="color-option" data-color="#e11d48" style="background-color: #e11d48;" title="ÌÅ¨Î¶ºÏä®"></div>

                <!-- ÏÑ∏ Î≤àÏß∏ Ï§Ñ: üü† Î∞ùÏùÄ Ï£ºÌô© Í≥ÑÏó¥ -->
                <div class="color-option" data-color="#fff4ed" style="background-color: #fff4ed;" title="ÌîºÏπò ÌÅ¨Î¶º"></div>
                <div class="color-option" data-color="#fed7aa" style="background-color: #fed7aa;" title="ÌîºÏπò"></div>
                <div class="color-option" data-color="#fdba74" style="background-color: #fdba74;" title="ÏïÑÌîÑÎ¶¨ÏΩîÌä∏"></div>
                <div class="color-option" data-color="#fb923c" style="background-color: #fb923c;" title="Ïπ¥Î°úÌä∏"></div>
                <div class="color-option" data-color="#f97316" style="background-color: #f97316;" title="Ïò§Î†åÏßÄ"></div>
                <div class="color-option" data-color="#ea580c" style="background-color: #ea580c;" title="ÌÉ†Ï†ÄÎ¶∞"></div>

                <!-- ÎÑ§ Î≤àÏß∏ Ï§Ñ: üü° Î∞ùÏùÄ ÎÖ∏Îûë Í≥ÑÏó¥ -->
                <div class="color-option" data-color="#fffbeb" style="background-color: #fffbeb;" title="Î†àÎ™¨ ÎØ∏Ïä§Ìä∏"></div>
                <div class="color-option" data-color="#fef3c7" style="background-color: #fef3c7;" title="Î∞îÎãêÎùº"></div>
                <div class="color-option" data-color="#fde047" style="background-color: #fde047;" title="ÏÑ†ÏÉ§Ïù∏"></div>
                <div class="color-option" data-color="#facc15" style="background-color: #facc15;" title="Í≥®Îì†"></div>
                <div class="color-option" data-color="#eab308" style="background-color: #eab308;" title="Î®∏Ïä§ÌÉÄÎìú"></div>
                <div class="color-option" data-color="#ca8a04" style="background-color: #ca8a04;" title="ÌóàÎãà"></div>

                <!-- Îã§ÏÑØ Î≤àÏß∏ Ï§Ñ: üü¢ Î∞ùÏùÄ Ï¥àÎ°ù Í≥ÑÏó¥ -->
                <div class="color-option" data-color="#f0fdf4" style="background-color: #f0fdf4;" title="ÎØºÌä∏ ÎØ∏Ïä§Ìä∏"></div>
                <div class="color-option" data-color="#dcfce7" style="background-color: #dcfce7;" title="Ïä§ÌîÑÎßÅ"></div>
                <div class="color-option" data-color="#86efac" style="background-color: #86efac;" title="ÎØºÌä∏"></div>
                <div class="color-option" data-color="#4ade80" style="background-color: #4ade80;" title="ÎùºÏûÑ"></div>
                <div class="color-option" data-color="#22c55e" style="background-color: #22c55e;" title="Ìè¨Î†àÏä§Ìä∏"></div>
                <div class="color-option" data-color="#16a34a" style="background-color: #16a34a;" title="ÏóêÎ©îÎûÑÎìú"></div>

                <!-- Ïó¨ÏÑØ Î≤àÏß∏ Ï§Ñ: üîµ Î∞ùÏùÄ ÌååÎûë Í≥ÑÏó¥ -->
                <div class="color-option" data-color="#f0f9ff" style="background-color: #f0f9ff;" title="Ïä§Ïπ¥Ïù¥ ÎØ∏Ïä§Ìä∏"></div>
                <div class="color-option" data-color="#e0f2fe" style="background-color: #e0f2fe;" title="ÏïÑÏù¥Ïä§Î∏îÎ£®"></div>
                <div class="color-option" data-color="#7dd3fc" style="background-color: #7dd3fc;" title="Ïä§Ïπ¥Ïù¥"></div>
                <div class="color-option" data-color="#38bdf8" style="background-color: #38bdf8;" title="ÏÑ∏Î£∞Î¶¨Ïïà"></div>
                <div class="color-option" data-color="#0ea5e9" style="background-color: #0ea5e9;" title="Ïò§ÏÖò"></div>
                <div class="color-option" data-color="#0284c7" style="background-color: #0284c7;" title="Îî•Î∏îÎ£®"></div>

                <!-- ÏùºÍ≥± Î≤àÏß∏ Ï§Ñ: üü£ Î∞ùÏùÄ Î≥¥Îùº Í≥ÑÏó¥ -->
                <div class="color-option" data-color="#faf5ff" style="background-color: #faf5ff;" title="ÎùºÎ≤§Îçî ÎØ∏Ïä§Ìä∏"></div>
                <div class="color-option" data-color="#f3e8ff" style="background-color: #f3e8ff;" title="ÎùºÏùºÎùΩ"></div>
                <div class="color-option" data-color="#d8b4fe" style="background-color: #d8b4fe;" title="ÎùºÎ≤§Îçî"></div>
                <div class="color-option" data-color="#c084fc" style="background-color: #c084fc;" title="ÏïÑÎ©îÏãúÏä§Ìä∏"></div>
                <div class="color-option" data-color="#a855f7" style="background-color: #a855f7;" title="Î∞îÏù¥Ïò¨Î†õ"></div>
                <div class="color-option" data-color="#9333ea" style="background-color: #9333ea;" title="ÌçºÌîå"></div>

                <!-- Ïó¨Îçü Î≤àÏß∏ Ï§Ñ: üíó Î∞ùÏùÄ ÌïëÌÅ¨ & ÌäπÎ≥Ñ ÏÉâÏÉÅ -->
                <div class="color-option" data-color="#fdf2f8" style="background-color: #fdf2f8;" title="Î°úÏ¶à ÎØ∏Ïä§Ìä∏"></div>
                <div class="color-option" data-color="#f9a8d4" style="background-color: #f9a8d4;" title="Î∂ÄÎ∏îÍ≤Ä"></div>
                <div class="color-option" data-color="#ec4899" style="background-color: #ec4899;" title="Ìï´ÌïëÌÅ¨"></div>
                <div class="color-option" data-color="#06b6d4" style="background-color: #06b6d4;" title="ÌÑ∞ÌÇ§ÏÑù"></div>
                <div class="color-option" data-color="#10b981" style="background-color: #10b981;" title="Ï†úÏù¥Îìú"></div>
                <div class="color-option" data-color="#f59e0b" style="background-color: #f59e0b;" title="Í≥®Îìú"></div>
            </div>
        </div>
    </div>

    <!-- View Clipboard Modal -->
    <div id="view-clipboard-modal" class="modal">
        <div class="modal-content" style="display: flex; flex-direction: column; height: 90vh; max-height: 90vh; padding: 0;">
            <div id="view-clipboard-header" style="display: flex; justify-content: space-between; align-items: center; padding: 12px 16px; background: linear-gradient(135deg, #D2691E 0%, #F4A460 50%, #DEB887 100%); border-radius: 4px 4px 0 0; border-bottom: 3px solid #8B4513; flex-shrink: 0;">
                <h2 id="view-clipboard-title" style="margin: 0; color: white; font-size: 20px;"></h2>
                <span class="close-button view-clipboard-close" style="color: white; font-size: 28px; position: relative; top: 0; right: 0;">&times;</span>
            </div>
            <div style="flex: 1; overflow-y: auto; padding: 20px 16px; display: flex; flex-direction: column;">
                <!-- ÏùºÎ∞ò ÌÖçÏä§Ìä∏ Î™®Îìú -->
                <div id="view-content-container" style="flex: 1; display: flex; flex-direction: column;">
                    <div id="view-clipboard-content" style="white-space: pre-wrap; word-wrap: break-word; flex: 1; overflow-y: auto; padding: 12px; border: 2px solid #000000; border-radius: 4px; background-color: #fafafa; min-height: 200px; color: #222; font-weight: 500; line-height: 1.6;"></div>
                    <div id="view-clipboard-file-info" style="display: none; padding: 12px; background-color: #f5f5f5; border-radius: 4px; margin-top: 15px; font-size: 14px; color: #666;">
                        <div style="margin-bottom: 5px;">üìé <strong>Ï≤®Î∂ÄÌååÏùº</strong></div>
                        <div id="view-clipboard-file-name" style="margin-left: 20px; margin-bottom: 3px;"></div>
                        <div id="view-clipboard-file-size" style="margin-left: 20px; font-size: 12px; color: #999;"></div>
                    </div>
                </div>

                <!-- Ï≤¥ÌÅ¨Î¶¨Ïä§Ìä∏ Î™®Îìú -->
                <div id="view-checklist-container" style="flex: 1; display: none; flex-direction: column;">
                    <ul id="view-checklist-items" style="flex: 1; list-style: none; padding: 12px; border: 2px solid #000000; border-radius: 4px; background-color: #fafafa; margin: 0; overflow-y: auto;">
                    </ul>
                </div>
            </div>
            <div class="modal-actions" style="padding: 20px 40px; border-top: 1px solid #e0e0e0; background-color: #fafafa; flex-shrink: 0; text-align: right;">
                <button id="view-clipboard-copy-btn" class="action-button">Î≥µÏÇ¨</button>
                <button id="view-clipboard-download-btn" class="action-button" style="display: none;">Îã§Ïö¥Î°úÎìú</button>
                <button id="view-clipboard-edit-btn" class="action-button secondary-button">ÏàòÏ†ï</button>
            </div>
        </div>
    </div>

    <!-- Copy Confirmation Modal -->
    <div id="copy-confirmation-modal" class="modal">
        <div class="modal-content" style="max-width: 300px; text-align: center;">
            <h2 style="margin-bottom: 20px; font-size: 18px;">‚úÖ Î≥µÏÇ¨ ÏôÑÎ£å</h2>
            <p style="margin-bottom: 20px; color: #37352f;">ÎÇ¥Ïö©Ïù¥ ÌÅ¥Î¶ΩÎ≥¥ÎìúÏóê Î≥µÏÇ¨ÎêòÏóàÏäµÎãàÎã§.</p>
            <button id="copy-confirmation-ok" class="action-button">ÌôïÏù∏</button>
        </div>
    </div>
    
    <script>
        // Ï†ÑÏó≠ ÌÖúÌîåÎ¶ø Í¥ÄÎ†® Î≥ÄÏàòÎì§
        let templates = [];
        let editingTemplateId = null;

        // Î™®Îã¨ Îã´Í∏∞
        function closeTemplateModal() {
            document.getElementById('template-edit-modal').style.display = 'none';
        }

        // ÌÅ¥Î¶ΩÎ≥¥Îìú Î≥µÏÇ¨ Ìï®Ïàò
        function copyToClipboard(text) {
            // Î®ºÏ†Ä modern API ÏãúÎèÑ
            if (navigator.clipboard && navigator.clipboard.writeText) {
                return navigator.clipboard.writeText(text)
                    .then(() => true)
                    .catch(() => false);
            }

            // ÎåÄÏ≤¥ Î∞©Î≤ï: ÏûÑÏãú textarea ÏÉùÏÑ±
            return new Promise((resolve) => {
                const textArea = document.createElement('textarea');
                textArea.value = text;
                textArea.style.position = 'fixed';
                textArea.style.top = '-9999px';
                textArea.style.left = '-9999px';
                textArea.setAttribute('readonly', '');
                textArea.style.contain = 'strict';

                document.body.appendChild(textArea);

                // iOS Safari ÎåÄÏùë
                if (/ipad|iphone/i.test(navigator.userAgent)) {
                    textArea.contentEditable = 'true';
                    textArea.readOnly = false;
                    const range = document.createRange();
                    range.selectNodeContents(textArea);
                    const selection = window.getSelection();
                    selection.removeAllRanges();
                    selection.addRange(range);
                    textArea.setSelectionRange(0, 999999);
                } else {
                    textArea.select();
                }

                try {
                    const successful = document.execCommand('copy');
                    document.body.removeChild(textArea);
                    resolve(successful);
                } catch (err) {
                    document.body.removeChild(textArea);
                    resolve(false);
                }
            });
        }

        // ÌÖúÌîåÎ¶ø ÌåùÏóÖ Ìï®ÏàòÎì§
        let currentPopupTemplate = null;


        // Î≥µÏÇ¨ ÌôïÏù∏ Î™®Îã¨ Ìï®ÏàòÎì§
        function showCopyConfirmation() {
            const copyConfirmationModal = document.getElementById('copy-confirmation-modal');
            if (copyConfirmationModal) {
                copyConfirmationModal.style.display = 'flex';
                setTimeout(() => {
                    copyConfirmationModal.style.display = 'none';
                }, 1500);
            }
        }

        // ÎÇ¥Ïö©Î≥¥Í∏∞ Ìï®Ïàò
        function showTemplateContent() {
            if (!currentPopupTemplate) return;
            
            // Ï†ÄÏû•Îêú Î≥ÄÏàòÍ∞í Î°úÎìú
            const savedValues = loadVariableHistory(currentPopupTemplate.id);
            
            // Î≥ÄÏàò ÏπòÌôòÌïòÏó¨ ÎÇ¥Ïö© ÌëúÏãú (Îπà Î≥ÄÏàòÎäî Í¥ÑÌò∏Î°ú ÌëúÏãú)
            const processedContent = replaceVariables(currentPopupTemplate.content, savedValues, true);
            document.getElementById('template-popup-content').innerHTML = `
                <div style="background-color: #f8f9fa; border: 1px solid #e9ecef; border-radius: 6px; padding: 16px; white-space: pre-wrap; font-family: monospace; font-size: 14px; line-height: 1.5;">
                    ${processedContent}
                </div>
            `;
            
            // Î≥ÄÏàò ÏûÖÎ†• ÏÑπÏÖò Ïà®Í∏∞Í∏∞
            document.getElementById('template-variables-section').style.display = 'none';
        }

        function showTemplatePopup(template) {
            if (!template) {
                console.error('showTemplatePopup: template is null or undefined');
                return;
            }
            
            console.log('showTemplatePopup: Setting currentPopupTemplate to:', template);
            currentPopupTemplate = template;
            
            document.getElementById('template-popup-title').textContent = template.title || 'Ï†úÎ™© ÏóÜÏùå';
            
            // Ï¥àÍ∏∞ÏóêÎäî ÏõêÎ≥∏ ÎÇ¥Ïö© ÌëúÏãú
            document.getElementById('template-popup-content').textContent = template.content || 'ÎÇ¥Ïö© ÏóÜÏùå';
            
            // Î≥ÄÏàò ÏûÖÎ†• UI Ï¥àÍ∏∞Ìôî
            document.getElementById('template-variables-section').style.display = 'none';
            
            // ÌÖúÌîåÎ¶øÏóê Î≥ÄÏàòÍ∞Ä ÏûàÎäîÏßÄ ÌôïÏù∏ÌïòÏó¨ Î≤ÑÌäº ÏÉÅÌÉú ÏÑ§Ï†ï
            const variables = extractVariables(template.content);
            const variablesToggleBtn = document.getElementById('template-variables-toggle-btn');
            if (variables.length > 0) {
                variablesToggleBtn.style.display = 'block';
            } else {
                variablesToggleBtn.style.display = 'none';
            }
            
            document.getElementById('template-popup-modal').style.display = 'flex';
        }

        function closeTemplatePopup() {
            document.getElementById('template-popup-modal').style.display = 'none';
            document.getElementById('template-variables-section').style.display = 'none';
            currentPopupTemplate = null;
        }

        async function copyTemplateFromPopup() {
            try {
                console.log('copyTemplateFromPopup Ìï®Ïàò ÏãúÏûë');

                if (!currentPopupTemplate) {
                    console.error('currentPopupTemplate is null');
                    alert('ÌÖúÌîåÎ¶ø Ï†ïÎ≥¥Î•º Ï∞æÏùÑ Ïàò ÏóÜÏäµÎãàÎã§.');
                    return;
                }

                console.log('ÌòÑÏû¨ ÌåùÏóÖ ÌÖúÌîåÎ¶ø:', currentPopupTemplate);

                // Î≥ÄÏàòÍ∞í ÏàòÏßë (ÏûÖÎ†•ÎêòÏñ¥ ÏûàÎäî Í≤ΩÏö∞)
                const variables = extractVariables(currentPopupTemplate.content);
                const customValues = {};

                variables.forEach(variable => {
                    const input = document.getElementById(`var-${variable}`);
                    if (input && input.value.trim()) {
                        customValues[variable] = input.value.trim();
                        console.log(`Î≥ÄÏàò ${variable}: ${input.value.trim()}`);
                    }
                });

                console.log('ÏàòÏßëÎêú Î≥ÄÏàòÍ∞íÎì§:', customValues);

                // Î≥ÄÏàòÍ∞íÏù¥ ÏûàÏúºÎ©¥ ÏπòÌôòÌïòÏó¨ Î≥µÏÇ¨, ÏóÜÏúºÎ©¥ ÏõêÎ≥∏ Î≥µÏÇ¨
                const processedContent = Object.keys(customValues).length > 0
                    ? replaceVariables(currentPopupTemplate.content, customValues)
                    : replaceVariables(currentPopupTemplate.content);

                console.log('Ï≤òÎ¶¨Îêú ÎÇ¥Ïö©:', processedContent);

                const success = await copyToClipboard(processedContent);
                console.log('Î≥µÏÇ¨ Í≤∞Í≥º:', success);

                if (success) {
                    // Î≥ÄÏàòÍ∞í ÌûàÏä§ÌÜ†Î¶¨ Ï†ÄÏû• (Í∞íÏù¥ ÏûàÎäî Í≤ΩÏö∞)
                    if (Object.keys(customValues).length > 0) {
                        saveVariableHistory(currentPopupTemplate.id, customValues);
                    }

                    currentPopupTemplate.usageCount = (currentPopupTemplate.usageCount || 0) + 1;
                    await saveTemplates();
                    renderTemplates();
                    showCopyConfirmation();
                    closeTemplatePopup();
                    console.log('Î≥µÏÇ¨ ÏôÑÎ£å');
                } else {
                    alert('ÌÅ¥Î¶ΩÎ≥¥Îìú Î≥µÏÇ¨Ïóê Ïã§Ìå®ÌñàÏäµÎãàÎã§.');
                }
            } catch (error) {
                console.error('ÌÖúÌîåÎ¶ø Î≥µÏÇ¨ Ïã§Ìå®:', error);
                alert('ÌÖúÌîåÎ¶ø Î≥µÏÇ¨Ïóê Ïã§Ìå®ÌñàÏäµÎãàÎã§: ' + error.message);
            }
        }

        function editTemplateFromPopup() {
            if (!currentPopupTemplate) {
                console.error('currentPopupTemplate is null');
                return;
            }
            console.log('Editing template:', currentPopupTemplate);
            
            // ÌÖúÌîåÎ¶ø Í∞ùÏ≤¥Î•º ÏûÑÏãú Ï†ÄÏû•
            const templateToEdit = currentPopupTemplate;
            closeTemplatePopup();
            editTemplate(templateToEdit);
        }

        async function deleteTemplateFromPopup() {
            if (!currentPopupTemplate) return;

            // Î∂ÄÎ™® ÌÖúÌîåÎ¶ø ÏÇ≠Ï†ú Î≥¥Ìò∏
            if (currentPopupTemplate.isParent !== false) {
                const children = templates.filter(t => t.parentId === currentPopupTemplate.id);
                if (children.length > 0) {
                    alert(`Ïù¥ ÌÖúÌîåÎ¶øÏóêÎäî ${children.length}Í∞úÏùò ÌååÏÉù ÌÖúÌîåÎ¶øÏù¥ ÏûàÏäµÎãàÎã§.\nÎ®ºÏ†Ä ÌååÏÉù ÌÖúÌîåÎ¶øÎì§ÏùÑ ÏÇ≠Ï†úÌï¥Ï£ºÏÑ∏Ïöî.`);
                    return;
                }
            }

            const confirmDelete = confirm(`"${currentPopupTemplate.title}" ÌÖúÌîåÎ¶øÏùÑ ÏÇ≠Ï†úÌïòÏãúÍ≤†ÏäµÎãàÍπå?\n\nÏù¥ ÏûëÏóÖÏùÄ ÎêòÎèåÎ¶¥ Ïàò ÏóÜÏäµÎãàÎã§.`);

            if (confirmDelete) {
                const templateIndex = templates.findIndex(t => t.id === currentPopupTemplate.id);
                if (templateIndex !== -1) {
                    templates.splice(templateIndex, 1);
                    await saveTemplates();
                    renderTemplates();
                    closeTemplatePopup();
                }
            }
        }

        // Î≥ÄÏàò ÏûÖÎ†• UI ÌëúÏãú Ìï®Ïàò (Í∞úÏÑ†)
        function showVariableInputs() {
            if (!currentPopupTemplate) return;

            const variables = extractVariables(currentPopupTemplate.content);
            const variablesSection = document.getElementById('template-variables-section');
            const variablesContainer = document.getElementById('template-variables-inputs');
            const childTitleSection = document.getElementById('child-template-title-section');
            const childTitleInput = document.getElementById('child-template-title');

            if (variables.length === 0) {
                alert('Ïù¥ ÌÖúÌîåÎ¶øÏóêÎäî ÏûÖÎ†•Ìï† Î≥ÄÏàòÍ∞Ä ÏóÜÏäµÎãàÎã§.');
                return;
            }

            // ÏÉÅÏúÑ ÌÖúÌîåÎ¶øÏù∏ÏßÄ ÌôïÏù∏ÌïòÏó¨ Ï†úÎ™© ÏûÖÎ†•ÎûÄ ÌëúÏãú Ïó¨Î∂Ä Í≤∞Ï†ï
            if (currentPopupTemplate.isParent !== false) {
                // ÏÉÅÏúÑ ÌÖúÌîåÎ¶ø: Ï†úÎ™© ÏûÖÎ†•ÎûÄ ÌëúÏãú
                childTitleSection.style.display = 'block';
                childTitleInput.value = ''; // Ï¥àÍ∏∞Ìôî
            } else {
                // ÌïòÏúÑ ÌÖúÌîåÎ¶ø: Ï†úÎ™© ÏûÖÎ†•ÎûÄ Ïà®ÍπÄ
                childTitleSection.style.display = 'none';
            }

            // Ï†ÄÏû•Îêú Î≥ÄÏàòÍ∞í Î°úÎìú
            const savedValues = loadVariableHistory(currentPopupTemplate.id);

            // Î≥ÄÏàò ÏûÖÎ†• ÌïÑÎìú ÏÉùÏÑ± (Ïù¥Ï†Ñ Í∞í ÏûêÎèô ÏûÖÎ†•)
            variablesContainer.innerHTML = '';
            variables.forEach(variable => {
                const div = document.createElement('div');
                div.style.marginBottom = '8px';
                div.innerHTML = `
                    <label style="display: block; margin-bottom: 4px; font-size: 12px; color: #37352f;">${variable}:</label>
                    <input type="text" id="var-${variable}" placeholder="${variable} Í∞íÏùÑ ÏûÖÎ†•ÌïòÏÑ∏Ïöî"
                           value="${savedValues[variable] || ''}"
                           style="width: 100%; padding: 6px 8px; border: 1px solid #ccc; border-radius: 3px; font-size: 12px;">
                `;
                variablesContainer.appendChild(div);
            });

            variablesSection.style.display = 'block';
            
            // ÏõêÎ≥∏ ÎÇ¥Ïö© ÌëúÏãúÎ°ú ÎêòÎèåÎ¶¨Í∏∞
            document.getElementById('template-popup-content').textContent = currentPopupTemplate.content;
        }

        // Î≥ÄÏàò Ï¥àÍ∏∞Ìôî
        function resetVariables() {
            const variablesContainer = document.getElementById('template-variables-inputs');
            const inputs = variablesContainer.querySelectorAll('input');
            inputs.forEach(input => input.value = '');

            // ÌïòÏúÑ ÌÖúÌîåÎ¶ø Ï†úÎ™© ÏûÖÎ†•ÎûÄÎèÑ Ï¥àÍ∏∞Ìôî
            const childTitleInput = document.getElementById('child-template-title');
            if (childTitleInput) {
                childTitleInput.value = '';
            }

            // Î≥ÄÏàòÍ∞í ÌûàÏä§ÌÜ†Î¶¨ÎèÑ ÏÇ≠Ï†ú
            if (currentPopupTemplate) {
                const historyKey = `template_variables_${currentPopupTemplate.id}`;
                localStorage.removeItem(historyKey);
                console.log('Î≥ÄÏàò ÌûàÏä§ÌÜ†Î¶¨ ÏÇ≠Ï†ú:', historyKey);
            }

            // ÏõêÎûò ÎÇ¥Ïö©ÏúºÎ°ú Î≥µÏõê
            if (currentPopupTemplate) {
                document.getElementById('template-popup-content').textContent = currentPopupTemplate.content;
            }
        }

        // ÏñëÏãù Ï†ÄÏû• (Î≥ÄÏàòÍ∞íÏù¥ Ï†ÅÏö©Îêú ÌÖúÌîåÎ¶øÏùÑ ÏÉàÎ°úÏö¥ ÌÖúÌîåÎ¶øÏúºÎ°ú Ï†ÄÏû•)
        async function saveFormTemplate() {
            try {
                console.log('saveFormTemplate Ìï®Ïàò ÏãúÏûë');

                if (!currentPopupTemplate) {
                    console.error('currentPopupTemplateÏù¥ ÏóÜÏäµÎãàÎã§');
                    alert('ÌÖúÌîåÎ¶ø Ï†ïÎ≥¥Î•º Ï∞æÏùÑ Ïàò ÏóÜÏäµÎãàÎã§.');
                    return;
                }

                console.log('ÌòÑÏû¨ ÌÖúÌîåÎ¶ø:', currentPopupTemplate);

                const variables = extractVariables(currentPopupTemplate.content);
                const customValues = {};

                console.log('Ï∂îÏ∂úÎêú Î≥ÄÏàòÎì§:', variables);

                // ÏûÖÎ†•Îêú Î≥ÄÏàòÍ∞í ÏàòÏßë
                variables.forEach(variable => {
                    const input = document.getElementById(`var-${variable}`);
                    if (input) {
                        customValues[variable] = input.value.trim();
                        console.log(`Î≥ÄÏàò ${variable}: ${input.value.trim()}`);
                    }
                });

                console.log('ÏàòÏßëÎêú Î≥ÄÏàòÍ∞íÎì§:', customValues);

                // Î≥ÄÏàòÍ∞í ÌûàÏä§ÌÜ†Î¶¨ Ï†ÄÏû•
                saveVariableHistory(currentPopupTemplate.id, customValues);

                // Î≥ÄÏàòÍ∞Ä ÏπòÌôòÎêú ÎÇ¥Ïö© ÏÉùÏÑ±
                const processedContent = replaceVariables(currentPopupTemplate.content, customValues);
                console.log('Ï≤òÎ¶¨Îêú ÎÇ¥Ïö©:', processedContent);

                // ÏÉÅÏúÑ ÌÖúÌîåÎ¶øÍ≥º ÌïòÏúÑ ÌÖúÌîåÎ¶ø Íµ¨Î∂ÑÌïòÏó¨ Ï≤òÎ¶¨
                if (currentPopupTemplate.isParent !== false) {
                    // ÏÉÅÏúÑ ÌÖúÌîåÎ¶ø: ÏÉà ÌïòÏúÑ ÌÖúÌîåÎ¶ø ÏÉùÏÑ±

                    // ÏÇ¨Ïö©ÏûêÍ∞Ä ÏûÖÎ†•Ìïú Ï†úÎ™© ÌôïÏù∏
                    const customTitleInput = document.getElementById('child-template-title');
                    let newTemplateTitle;

                    if (customTitleInput && customTitleInput.value.trim()) {
                        // ÏÇ¨Ïö©ÏûêÍ∞Ä Ï†úÎ™©ÏùÑ ÏûÖÎ†•Ìïú Í≤ΩÏö∞
                        newTemplateTitle = customTitleInput.value.trim();
                    } else {
                        // Ï†úÎ™©ÏùÑ ÏûÖÎ†•ÌïòÏßÄ ÏïäÏùÄ Í≤ΩÏö∞ Í∏∞Î≥∏ ÌòïÏãù ÏÇ¨Ïö©
                        const now = new Date();
                        const timestamp = now.toLocaleString('ko-KR', {
                            month: '2-digit',
                            day: '2-digit',
                            hour: '2-digit',
                            minute: '2-digit'
                        }).replace(/\./g, '').replace(/\s/g, '_');
                        newTemplateTitle = `${currentPopupTemplate.title}_${timestamp}`;
                    }

                    console.log('ÏÉà ÌïòÏúÑ ÌÖúÌîåÎ¶ø Ï†úÎ™©:', newTemplateTitle);

                    // ÏÉà ÌïòÏúÑ ÌÖúÌîåÎ¶ø Í∞ùÏ≤¥ ÏÉùÏÑ±
                    const newTemplate = {
                        id: Date.now().toString(),
                        title: newTemplateTitle,
                        content: processedContent,
                        createdAt: new Date().toISOString(),
                        usageCount: 0,
                        isParent: false,
                        parentId: currentPopupTemplate.id
                    };

                    templates.push(newTemplate);
                    console.log('ÏÉà ÌïòÏúÑ ÌÖúÌîåÎ¶ø ÏÉùÏÑ± ÏôÑÎ£å');
                    alert(`"${newTemplateTitle}" ÌïòÏúÑ ÌÖúÌîåÎ¶øÏù¥ ÏÉùÏÑ±ÎêòÏóàÏäµÎãàÎã§.`);

                } else {
                    // ÌïòÏúÑ ÌÖúÌîåÎ¶ø: Í∏∞Ï°¥ ÌÖúÌîåÎ¶ø ÎÇ¥Ïö© ÏóÖÎç∞Ïù¥Ìä∏
                    const templateIndex = templates.findIndex(t => t.id === currentPopupTemplate.id);
                    if (templateIndex !== -1) {
                        templates[templateIndex] = {
                            ...templates[templateIndex],
                            content: processedContent,
                            updatedAt: new Date()
                        };

                        // ÌòÑÏû¨ ÌåùÏóÖ ÌÖúÌîåÎ¶øÎèÑ ÏóÖÎç∞Ïù¥Ìä∏
                        currentPopupTemplate.content = processedContent;

                        console.log('ÌïòÏúÑ ÌÖúÌîåÎ¶ø ÏóÖÎç∞Ïù¥Ìä∏ ÏôÑÎ£å');
                        alert(`"${currentPopupTemplate.title}" ÌÖúÌîåÎ¶øÏù¥ ÏóÖÎç∞Ïù¥Ìä∏ÎêòÏóàÏäµÎãàÎã§.`);
                    }
                }

                await saveTemplates();
                console.log('saveTemplates ÏôÑÎ£å');

                renderTemplates();
                console.log('renderTemplates ÏôÑÎ£å');

                // UI ÏóÖÎç∞Ïù¥Ìä∏ - Ï≤òÎ¶¨Îêú ÎÇ¥Ïö©ÏùÑ Ïä§ÌÉÄÏùºÍ≥º Ìï®Íªò ÌëúÏãú
                document.getElementById('template-popup-content').innerHTML = `
                    <div style="background-color: #f8f9fa; border: 1px solid #e9ecef; border-radius: 6px; padding: 16px; white-space: pre-wrap; font-family: monospace; font-size: 14px; line-height: 1.5;">
                        ${processedContent}
                    </div>
                `;
                document.getElementById('template-variables-section').style.display = 'none';
                console.log('saveFormTemplate Ìï®Ïàò ÏôÑÎ£å');

            } catch (error) {
                console.error('saveFormTemplate ÏóêÎü¨:', error);
                alert('ÏñëÏãù Ï†ÄÏû• Ï§ë Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§: ' + error.message);
            }
        }

        // Î≥ÄÏàò ÏÇΩÏûÖ Í∏∞Îä•
        function insertVariable(variable) {
            const textarea = document.getElementById('template-content-input');
            const startPos = textarea.selectionStart;
            const endPos = textarea.selectionEnd;
            const textBefore = textarea.value.substring(0, startPos);
            const textAfter = textarea.value.substring(endPos);
            
            textarea.value = textBefore + variable + textAfter;
            
            // Ïª§ÏÑú ÏúÑÏπòÎ•º ÏÇΩÏûÖÎêú Î≥ÄÏàò Îí§Î°ú Ïù¥Îèô
            const newPos = startPos + variable.length;
            textarea.setSelectionRange(newPos, newPos);
            textarea.focus();
            
        }

        // Îπà Î≥ÄÏàò ÏÇΩÏûÖ Í∏∞Îä•
        function insertEmptyVariable() {
            const textarea = document.getElementById('template-content-input');
            const startPos = textarea.selectionStart;
            const endPos = textarea.selectionEnd;
            const textBefore = textarea.value.substring(0, startPos);
            const textAfter = textarea.value.substring(endPos);
            
            textarea.value = textBefore + '{}' + textAfter;
            
            // Ïª§ÏÑúÎ•º Ï§ëÍ¥ÑÌò∏ ÏÇ¨Ïù¥Î°ú Ïù¥Îèô
            const newPos = startPos + 1;
            textarea.setSelectionRange(newPos, newPos);
            textarea.focus();
            
        }

        // Î≥ÄÏàòÍ∞í ÌûàÏä§ÌÜ†Î¶¨ Í¥ÄÎ¶¨
        function saveVariableHistory(templateId, variables) {
            const historyKey = `template_variables_${templateId}`;
            localStorage.setItem(historyKey, JSON.stringify(variables));
        }

        function loadVariableHistory(templateId) {
            const historyKey = `template_variables_${templateId}`;
            const saved = localStorage.getItem(historyKey);
            return saved ? JSON.parse(saved) : {};
        }

        // Î≥ÄÏàò ÏπòÌôò Ìï®Ïàò (Îπà Î≥ÄÏàò Ï≤òÎ¶¨ Ìè¨Ìï®)
        function replaceVariables(content, customValues = {}, showEmptyAsPlaceholder = false) {
            const now = new Date();
            const today = now.toLocaleDateString('ko-KR');
            const currentTime = now.toLocaleTimeString('ko-KR', { hour: '2-digit', minute: '2-digit' });
            const projectName = window.currentProject || 'ÏÑ†ÌÉùÎêú ÌîÑÎ°úÏ†ùÌä∏ ÏóÜÏùå';
            
            let result = content
                .replace(/\{Ïò§ÎäòÎÇ†Ïßú\}/g, today)
                .replace(/\{ÌòÑÏû¨ÏãúÍ∞Ñ\}/g, currentTime)
                .replace(/\{ÌîÑÎ°úÏ†ùÌä∏Î™Ö\}/g, projectName);
            
            // ÏÇ¨Ïö©Ïûê Ï†ïÏùò Î≥ÄÏàò ÏπòÌôò
            for (const [key, value] of Object.entries(customValues)) {
                if (value && value.trim()) {
                    const regex = new RegExp(`\\{${key}\\}`, 'g');
                    result = result.replace(regex, value);
                }
            }
            
            // Îπà Î≥ÄÏàò Ï≤òÎ¶¨
            if (showEmptyAsPlaceholder) {
                result = result.replace(/\{([^}]+)\}/g, '($1)');
            }
                
            return result;
        }

        // ÌÖúÌîåÎ¶øÏóêÏÑú Î≥ÄÏàò Ï∂îÏ∂ú Ìï®Ïàò
        function extractVariables(content) {
            const variableRegex = /\{([^}]+)\}/g;
            const variables = new Set();
            let match;
            
            while ((match = variableRegex.exec(content)) !== null) {
                const varName = match[1];
                // ÏãúÏä§ÌÖú Î≥ÄÏàòÎäî Ï†úÏô∏
                if (!['Ïò§ÎäòÎÇ†Ïßú', 'ÌòÑÏû¨ÏãúÍ∞Ñ', 'ÌîÑÎ°úÏ†ùÌä∏Î™Ö'].includes(varName)) {
                    variables.add(varName);
                }
            }
            
            return Array.from(variables);
        }


        // ÏÉà ÌÖúÌîåÎ¶ø Ï∂îÍ∞Ä
        function addNewTemplate() {
            editingTemplateId = null;
            document.getElementById('template-title-input').value = '';
            document.getElementById('template-content-input').value = '';
            document.getElementById('template-edit-modal').style.display = 'flex';
        }

        // ÌÖúÌîåÎ¶ø Ìé∏Ïßë
        function editTemplate(template) {
            if (!template || !template.id) {
                console.error('Invalid template object:', template);
                alert('ÌÖúÌîåÎ¶ø Îç∞Ïù¥ÌÑ∞Ïóê Ïò§Î•òÍ∞Ä ÏûàÏäµÎãàÎã§.');
                return;
            }
            
            console.log('Editing template with ID:', template.id);
            editingTemplateId = template.id;
            document.getElementById('template-title-input').value = template.title || '';
            document.getElementById('template-content-input').value = template.content || '';
            document.getElementById('template-edit-modal').style.display = 'flex';
        }

        // ÌÖúÌîåÎ¶ø ÏÇ≠Ï†ú
        async function deleteTemplate(template) {
            // Î∂ÄÎ™® ÌÖúÌîåÎ¶ø ÏÇ≠Ï†ú Î≥¥Ìò∏
            if (template.isParent !== false) {
                const children = templates.filter(t => t.parentId === template.id);
                if (children.length > 0) {
                    alert(`Ïù¥ ÌÖúÌîåÎ¶øÏóêÎäî ${children.length}Í∞úÏùò ÌååÏÉù ÌÖúÌîåÎ¶øÏù¥ ÏûàÏäµÎãàÎã§.\nÎ®ºÏ†Ä ÌååÏÉù ÌÖúÌîåÎ¶øÎì§ÏùÑ ÏÇ≠Ï†úÌï¥Ï£ºÏÑ∏Ïöî.`);
                    return;
                }
            }

            const confirmDelete = confirm(`"${template.title}" ÌÖúÌîåÎ¶øÏùÑ ÏÇ≠Ï†úÌïòÏãúÍ≤†ÏäµÎãàÍπå?\n\nÏù¥ ÏûëÏóÖÏùÄ ÎêòÎèåÎ¶¥ Ïàò ÏóÜÏäµÎãàÎã§.`);

            if (confirmDelete) {
                try {
                    const templateIndex = templates.findIndex(t => t.id === template.id);
                    if (templateIndex !== -1) {
                        templates.splice(templateIndex, 1);
                        await saveTemplates();
                        renderTemplates();
                        console.log(`ÌÖúÌîåÎ¶ø "${template.title}" ÏÇ≠Ï†ú ÏôÑÎ£å`);
                    }
                } catch (error) {
                    console.error('ÌÖúÌîåÎ¶ø ÏÇ≠Ï†ú Ïã§Ìå®:', error);
                    alert('ÌÖúÌîåÎ¶ø ÏÇ≠Ï†úÏóê Ïã§Ìå®ÌñàÏäµÎãàÎã§.');
                }
            }
        }

        // Ï†ÑÏó≠ Firebase Î≥ÄÏàòÎì§ (Ï†ÑÏó≠ÏúºÎ°ú Ï†ëÍ∑º Í∞ÄÎä•ÌïòÎèÑÎ°ù)
        let globalDb = null;
        let globalFirebaseInitialized = false;

        // ÌÖúÌîåÎ¶ø Îç∞Ïù¥ÌÑ∞ Ï†ÄÏû•
        async function saveTemplates() {
            // Í≤ÄÏÉâ Ïù∏Îç±Ïä§ ÏóÖÎç∞Ïù¥Ìä∏ (Ìï®ÏàòÍ∞Ä Ï†ïÏùòÎêú Í≤ΩÏö∞ÏóêÎßå)
            if (typeof updateSearchIndex === 'function') {
                updateSearchIndex();
            }
            try {
                // Î°úÏª¨Ïä§ÌÜ†Î¶¨ÏßÄÏóê Ï†ÄÏû• (Ìï≠ÏÉÅ)
                localStorage.setItem('templates', JSON.stringify(templates));
                
                // FirebaseÏóêÎèÑ Ï†ÄÏû• (Í∞ÄÎä•Ìïú Í≤ΩÏö∞)
                if (globalFirebaseInitialized && globalDb) {
                    await globalDb.collection('templates').doc('userTemplates').set({
                        templates: templates,
                        lastModified: new Date()
                    });
                }
                console.log('ÌÖúÌîåÎ¶ø Ï†ÄÏû• ÏôÑÎ£å');
            } catch (error) {
                console.error('ÌÖúÌîåÎ¶ø Ï†ÄÏû• Ïã§Ìå®:', error);
                // Î°úÏª¨Ïä§ÌÜ†Î¶¨ÏßÄÎùºÎèÑ Ï†ÄÏû•ÎêòÏóàÏúºÎ©¥ ÏÑ±Í≥µÏúºÎ°ú Í∞ÑÏ£º
                if (localStorage.getItem('templates')) {
                    console.log('Î°úÏª¨Ïä§ÌÜ†Î¶¨ÏßÄÏóê ÌÖúÌîåÎ¶ø Ï†ÄÏû• ÏôÑÎ£å');
                } else {
                    alert('ÌÖúÌîåÎ¶ø Ï†ÄÏû•Ïóê Ïã§Ìå®ÌñàÏäµÎãàÎã§.');
                }
            }
        }

        // ÌÖúÌîåÎ¶ø Îç∞Ïù¥ÌÑ∞ Î°úÎìú
        async function loadTemplates() {
            try {
                if (globalFirebaseInitialized && globalDb) {
                    const doc = await globalDb.collection('templates').doc('userTemplates').get();
                    if (doc.exists) {
                        templates = doc.data().templates || [];
                    } else {
                        templates = [];
                    }
                } else {
                    // Î°úÏª¨Ïä§ÌÜ†Î¶¨ÏßÄÏóêÏÑú Î°úÎìú
                    const savedTemplates = localStorage.getItem('templates');
                    if (savedTemplates) {
                        templates = JSON.parse(savedTemplates);
                    } else {
                        templates = [];
                    }
                }
                renderTemplates();
            } catch (error) {
                console.error('ÌÖúÌîåÎ¶ø Î°úÎìú Ïã§Ìå®:', error);
                // Î°úÏª¨Ïä§ÌÜ†Î¶¨ÏßÄ fallback
                const savedTemplates = localStorage.getItem('templates');
                if (savedTemplates) {
                    templates = JSON.parse(savedTemplates);
                } else {
                    templates = [];
                }
                renderTemplates();
            }
        }

        // ÌÖúÌîåÎ¶ø Î™©Î°ù Î†åÎçîÎßÅ (Í≥ÑÏ∏µ Íµ¨Ï°∞)
        function renderTemplates() {
            const templateList = document.getElementById('template-list');

            if (!templateList) return; // ÏöîÏÜåÍ∞Ä ÏóÜÏúºÎ©¥ Ï¢ÖÎ£å

            if (templates.length === 0) {
                templateList.innerHTML = '<div class="activity-placeholder">ÌÖúÌîåÎ¶øÏù¥ ÏóÜÏäµÎãàÎã§. ÏÉà ÌÖúÌîåÎ¶øÏùÑ Ï∂îÍ∞ÄÌï¥Î≥¥ÏÑ∏Ïöî.</div>';
                return;
            }

            // Î∂ÄÎ™® ÌÖúÌîåÎ¶øÍ≥º ÏûêÏãù ÌÖúÌîåÎ¶ø Î∂ÑÎ¶¨ Î∞è Ï†ïÎ†¨
            const parentTemplates = templates.filter(t => t.isParent !== false)
                .sort((a, b) => a.title.localeCompare(b.title));
            const childTemplates = templates.filter(t => t.isParent === false)
                .sort((a, b) => a.title.localeCompare(b.title));

            templateList.innerHTML = '';

            parentTemplates.forEach(parentTemplate => {
                // Î∂ÄÎ™® ÌÖúÌîåÎ¶øÏùò ÏûêÏãùÎì§ Ï∞æÍ∏∞
                const children = childTemplates.filter(child => child.parentId === parentTemplate.id);

                // Î∂ÄÎ™® ÌÖúÌîåÎ¶ø Ïπ¥Îìú ÏÉùÏÑ±
                const parentCard = createParentTemplateCard(parentTemplate, children.length);
                templateList.appendChild(parentCard);

                // ÏûêÏãù ÌÖúÌîåÎ¶øÎì§ÏùÑ Îã¥ÏùÑ Ïª®ÌÖåÏù¥ÎÑà ÏÉùÏÑ±
                if (children.length > 0) {
                    const childrenContainer = document.createElement('div');
                    childrenContainer.className = 'template-children';
                    childrenContainer.id = `children-${parentTemplate.id}`;
                    childrenContainer.style.display = 'none'; // Í∏∞Î≥∏Ï†ÅÏúºÎ°ú Ïà®ÍπÄ

                    children.forEach(child => {
                        const childCard = createChildTemplateCard(child);
                        childrenContainer.appendChild(childCard);
                    });

                    templateList.appendChild(childrenContainer);
                }
            });
        }

        // Î∂ÄÎ™® ÌÖúÌîåÎ¶ø Ïπ¥Îìú ÏÉùÏÑ±
        function createParentTemplateCard(template, childCount) {
            const card = document.createElement('div');
            card.className = 'template-card parent-template';

            const header = document.createElement('div');
            header.className = 'template-card-header';

            const leftArea = document.createElement('div');
            leftArea.style.display = 'flex';
            leftArea.style.alignItems = 'center';
            leftArea.style.gap = '8px';

            // ÏïÑÏΩîÎîîÏñ∏ ÌÜ†Í∏Ä Î≤ÑÌäº (ÏûêÏãùÏù¥ ÏûàÏùÑ ÎïåÎßå)
            if (childCount > 0) {
                const toggleBtn = document.createElement('button');
                toggleBtn.className = 'accordion-toggle';
                toggleBtn.id = `toggle-${template.id}`;
                toggleBtn.innerHTML = '‚ñ∂';
                toggleBtn.onclick = (e) => {
                    e.stopPropagation();
                    toggleChildren(template.id);
                };
                leftArea.appendChild(toggleBtn);
            }

            // Í≥†Ï†ïÌïÄ ÏïÑÏù¥ÏΩò
            const pinIcon = document.createElement('span');
            pinIcon.className = 'pin-icon';
            pinIcon.innerHTML = 'üìå';
            pinIcon.title = 'ÏõêÎ≥∏ ÌÖúÌîåÎ¶ø';
            leftArea.appendChild(pinIcon);

            const title = document.createElement('h5');
            title.className = 'template-title';
            title.textContent = template.title;
            title.onclick = () => showTemplatePopup(template);
            leftArea.appendChild(title);

            header.appendChild(leftArea);

            // ÏûêÏãù Í∞úÏàò ÌëúÏãú
            if (childCount > 0) {
                const childCountBadge = document.createElement('span');
                childCountBadge.className = 'child-count-badge';
                childCountBadge.textContent = childCount;
                header.appendChild(childCountBadge);
            }

            card.appendChild(header);
            return card;
        }

        // ÏûêÏãù ÌÖúÌîåÎ¶ø Ïπ¥Îìú ÏÉùÏÑ±
        function createChildTemplateCard(template) {
            const card = document.createElement('div');
            card.className = 'template-card child-template';

            const header = document.createElement('div');
            header.className = 'template-card-header';

            const title = document.createElement('h5');
            title.className = 'template-title';
            title.textContent = template.title;
            title.onclick = () => showTemplatePopup(template);

            header.appendChild(title);
            card.appendChild(header);

            return card;
        }

        // ÏïÑÏΩîÎîîÏñ∏ ÌÜ†Í∏Ä Í∏∞Îä•
        function toggleChildren(parentId) {
            const childrenContainer = document.getElementById(`children-${parentId}`);
            const toggleBtn = document.getElementById(`toggle-${parentId}`);

            if (childrenContainer && toggleBtn) {
                const isVisible = childrenContainer.style.display !== 'none';
                childrenContainer.style.display = isVisible ? 'none' : 'block';
                toggleBtn.innerHTML = isVisible ? '‚ñ∂' : '‚ñº';
            }
        }

        // ÌÖúÌîåÎ¶ø Î≥µÏÇ¨
        async function copyTemplate(template) {
            const processedContent = replaceVariables(template.content);
            
            try {
                await copyToClipboard(processedContent);
                template.usageCount = (template.usageCount || 0) + 1;
                await saveTemplates();
                renderTemplates();
                // showCopyConfirmation(); // Ìï®ÏàòÍ∞Ä ÏûàÎã§Î©¥ Ìò∏Ï∂ú
            } catch (error) {
                console.error('ÌÖúÌîåÎ¶ø Î≥µÏÇ¨ Ïã§Ìå®:', error);
                alert('ÌÖúÌîåÎ¶ø Î≥µÏÇ¨Ïóê Ïã§Ìå®ÌñàÏäµÎãàÎã§.');
            }
        }

        // ÌÖúÌîåÎ¶ø Ï†ÄÏû•
        async function saveTemplate(formData) {
            const title = formData.get('title') || document.getElementById('template-title-input').value;
            const content = formData.get('content') || document.getElementById('template-content-input').value;

            if (!title.trim() || !content.trim()) {
                alert('Ï†úÎ™©Í≥º ÎÇ¥Ïö©ÏùÄ ÌïÑÏàòÏûÖÎãàÎã§.');
                return;
            }

            if (editingTemplateId) {
                // Í∏∞Ï°¥ ÌÖúÌîåÎ¶ø Ìé∏Ïßë
                const index = templates.findIndex(t => t.id === editingTemplateId);
                if (index !== -1) {
                    const existingTemplate = templates[index];
                    // Í∏∞Ï°¥ ÌÖúÌîåÎ¶øÏùò Î™®Îì† ÏÜçÏÑ±ÏùÑ Ïú†ÏßÄÌïòÎ©¥ÏÑú Ï†úÎ™©Í≥º ÎÇ¥Ïö©Îßå ÏóÖÎç∞Ïù¥Ìä∏
                    templates[index] = {
                        ...existingTemplate,
                        title: title.trim(),
                        content: content.trim(),
                        updatedAt: new Date()
                    };
                }
            } else {
                // ÏÉà ÌÖúÌîåÎ¶ø ÏÉùÏÑ±
                const templateData = {
                    id: Date.now().toString(),
                    title: title.trim(),
                    content: content.trim(),
                    usageCount: 0,
                    createdAt: new Date(),
                    updatedAt: new Date(),
                    isParent: true,
                    parentId: null
                };
                templates.push(templateData);
            }

            await saveTemplates();
            renderTemplates();
            closeTemplateModal();
        }

        document.addEventListener('DOMContentLoaded', function() {
        
        // Firebase ÏÑ§Ï†ï - ÌôòÍ≤ΩÎ≥ÄÏàò ÎòêÎäî ÏÑ§Ï†ï Í∞ùÏ≤¥ÏóêÏÑú Î°úÎìú
        // SECURITY: Firebase API ÌÇ§Îäî Ï†àÎåÄ ÏÜåÏä§ÏΩîÎìúÏóê ÌïòÎìúÏΩîÎî©ÌïòÎ©¥ Ïïà Îê©ÎãàÎã§.
        // .env ÌååÏùºÏùÑ ÏÇ¨Ïö©ÌïòÍ±∞ÎÇò ÌôòÍ≤ΩÎ≥ÄÏàòÏóêÏÑú Î°úÎìúÌï¥Ïïº Ìï©ÎãàÎã§.
        // See .env.example for configuration template

        // Í∞úÎ∞ú Ï§ë ÌÖåÏä§Ìä∏Ïö© Í∏∞Î≥∏Í∞í (Ïã§Ï†ú ÌîÑÎ°úÎçïÏÖòÏóêÏÑúÎäî .env ÌååÏùº ÏÇ¨Ïö©)
        const firebaseConfig = {
            apiKey: window.FIREBASE_CONFIG?.apiKey || "AIzaSyDKjKvRCw-j4b-1W4MhRc-uZ21zbAnTFM8",
            authDomain: window.FIREBASE_CONFIG?.authDomain || "bookmarkclipboard.firebaseapp.com",
            projectId: window.FIREBASE_CONFIG?.projectId || "bookmarkclipboard",
            storageBucket: window.FIREBASE_CONFIG?.storageBucket || "bookmarkclipboard.firebasestorage.app",
            messagingSenderId: window.FIREBASE_CONFIG?.messagingSenderId || "969969481293",
            appId: window.FIREBASE_CONFIG?.appId || "1:969969481293:web:08ae0008ac1b590c43ce04"
        };
        
        // Firebase Ï¥àÍ∏∞Ìôî
        let db = null;
        let firebaseInitialized = false;
        
        try {
            firebase.initializeApp(firebaseConfig);
            db = firebase.firestore();
            firebaseInitialized = true;

            // Ï†ÑÏó≠ Î≥ÄÏàòÏóê Ìï†Îãπ
            globalDb = db;
            globalFirebaseInitialized = firebaseInitialized;
        } catch (error) {
            // Firebase Ï¥àÍ∏∞Ìôî Ïã§Ìå® Ïãú Î°úÏª¨Ïä§ÌÜ†Î¶¨ÏßÄÎ°ú Ìè¥Î∞±
            firebaseInitialized = false;
            globalFirebaseInitialized = false;
        }

        
        // Îç∞Ïù¥ÌÑ∞ Ï†ÄÏû• Ìï®ÏàòÎì§ (Firebase + Î°úÏª¨Ïä§ÌÜ†Î¶¨ÏßÄ Î∞±ÏóÖ)
        const STORAGE_KEY = 'bookmark-clipboard-app-data';
        
        // FirebaseÏóê Îç∞Ïù¥ÌÑ∞ Ï†ÄÏû• (Í∞úÏù∏Ïö© Îã®Ïùº Î¨∏ÏÑú)
        async function saveToFirebase(retryCount = 0) {
            // Í≤ÄÏÉâ Ïù∏Îç±Ïä§ ÏóÖÎç∞Ïù¥Ìä∏ (Ìï®ÏàòÍ∞Ä Ï†ïÏùòÎêú Í≤ΩÏö∞ÏóêÎßå)
            if (typeof updateSearchIndex === 'function') {
                updateSearchIndex();
            }
            if (!firebaseInitialized || !db) {
                return saveToLocalStorage();
            }

            try {
                const dataToSave = {
                    projects: allProjectsData,
                    currentProject: currentProject,
                    projectOrder: projectOrder || Object.keys(allProjectsData),
                    lastUpdated: new Date().toISOString()
                };

                await db.collection('userdata').doc('bookmark-app').set(dataToSave);
                
                // Î°úÏª¨Ïä§ÌÜ†Î¶¨ÏßÄÏóêÎèÑ Î∞±ÏóÖ Ï†ÄÏû•
                saveToLocalStorage();
                
                // Ï†ÄÏû• ÏÑ±Í≥µ Ïãú ÏãúÍ∞ÅÏ†Å ÌîºÎìúÎ∞±
                showSaveStatus('success');
                
            } catch (error) {
                console.error('‚ùå Firebase Ï†ÄÏû• Ïã§Ìå®:', error);
                
                // Ïû¨ÏãúÎèÑ Î°úÏßÅ (ÏµúÎåÄ 3Ìöå)
                if (retryCount < 3) {
                    console.log(`Firebase Ï†ÄÏû• Ïû¨ÏãúÎèÑ ${retryCount + 1}/3...`);
                    setTimeout(() => saveToFirebase(retryCount + 1), 1000 * (retryCount + 1));
                    return;
                }
                
                // ÏµúÏ¢Ö Ïã§Ìå®Ïãú Î°úÏª¨Ïä§ÌÜ†Î¶¨ÏßÄÏóêÎßå Ï†ÄÏû•
                saveToLocalStorage();
                showSaveStatus('error');
                
                // ÏÇ¨Ïö©ÏûêÏóêÍ≤å Í≤ΩÍ≥† ÌëúÏãú
                console.warn('‚ö†Ô∏è ÌÅ¥ÎùºÏö∞Îìú ÎèôÍ∏∞Ìôî Ïã§Ìå® - Î°úÏª¨ Ï†ÄÏû•Îßå ÏôÑÎ£åÎê®');
            }
        }
        
        // Ï†ÄÏû• ÏÉÅÌÉú ÌëúÏãú Ìï®Ïàò
        function showSaveStatus(status) {
            const existingStatus = document.getElementById('save-status');
            if (existingStatus) existingStatus.remove();
            
            const statusDiv = document.createElement('div');
            statusDiv.id = 'save-status';
            statusDiv.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                padding: 10px 15px;
                border-radius: 6px;
                font-size: 14px;
                font-weight: 600;
                z-index: 3000;
                opacity: 0;
                transition: opacity 0.3s ease;
            `;
            
            if (status === 'success') {
                statusDiv.textContent = '‚úÖ Ï†ÄÏû• ÏôÑÎ£å';
                statusDiv.style.backgroundColor = '#d4edda';
                statusDiv.style.color = '#155724';
                statusDiv.style.border = '1px solid #c3e6cb';
            } else {
                statusDiv.textContent = '‚ö†Ô∏è ÎèôÍ∏∞Ìôî Ïã§Ìå®';
                statusDiv.style.backgroundColor = '#f8d7da';
                statusDiv.style.color = '#721c24';
                statusDiv.style.border = '1px solid #f5c6cb';
            }
            
            document.body.appendChild(statusDiv);
            
            // Ïï†ÎãàÎ©îÏù¥ÏÖòÏúºÎ°ú ÌëúÏãú
            setTimeout(() => statusDiv.style.opacity = '1', 100);
            
            // 3Ï¥à ÌõÑ ÏûêÎèô ÏÇ¨ÎùºÏßê
            setTimeout(() => {
                statusDiv.style.opacity = '0';
                setTimeout(() => statusDiv.remove(), 300);
            }, 3000);
        }

        // FirebaseÏóê Ïó∞ÏäµÏû• ÎÇ¥Ïö© Ï†ÄÏû• (ÎîîÎ∞îÏö¥Ïã± Ï†ÅÏö©) - Ï†ÑÏó≠ ÎèÖÎ¶Ω
        let practicesSaveTimeout;
        let isSaving = false;
        function savePracticeContent(content, immediate = false) {
            if (isSaving) {
                return;
            }
            
            // ÎÇ¥Ïö©Ïù¥ Ïã§Ï†úÎ°ú Î≥ÄÍ≤ΩÎêú Í≤ΩÏö∞ÏóêÎßå Ï†ÄÏû•
            const currentContent = globalPractices[currentPracticeTab] || '';
            if (currentContent === content) {
                return;
            }
            
            globalPractices[currentPracticeTab] = content;
            
            // Ï¶âÏãú Ï†ÄÏû•Ïù¥ ÏïÑÎãå Í≤ΩÏö∞ ÎîîÎ∞îÏö¥Ïã± Ï†ÅÏö©
            if (immediate) {
                clearTimeout(practicesSaveTimeout);
                isSaving = true;
                savePracticeToFirebase().finally(() => {
                    isSaving = false;
                });
            } else {
                clearTimeout(practicesSaveTimeout);
                practicesSaveTimeout = setTimeout(() => {
                    isSaving = true;
                    savePracticeToFirebase().finally(() => {
                        isSaving = false;
                    });
                }, 500); // 500ms ÏßÄÏó∞
            }
        }
        
        // Ï†ÑÏó≠ Ïó∞ÏäµÏû• Firebase Ï†ÄÏû•
        async function savePracticeToFirebase() {
            if (!firebaseInitialized || !db) {
                console.log('Firebase ÎØ∏Ï¥àÍ∏∞Ìôî, Î°úÏª¨Ïä§ÌÜ†Î¶¨ÏßÄÏóê Ïó∞ÏäµÏû• Ï†ÄÏû•');
                localStorage.setItem('global-practices', JSON.stringify(globalPractices));
                return;
            }
            
            try {
                await db.collection('userdata').doc('global-practices').set({
                    practices: globalPractices,
                    lastUpdated: new Date().toISOString()
                });
                console.log('Ï†ÑÏó≠ Ïó∞ÏäµÏû•ÏùÑ FirebaseÏóê Ï†ÄÏû•ÌñàÏäµÎãàÎã§.');
                
                // Î°úÏª¨Ïä§ÌÜ†Î¶¨ÏßÄÏóêÎèÑ Î∞±ÏóÖ Ï†ÄÏû•
                localStorage.setItem('global-practices', JSON.stringify(globalPractices));
                
            } catch (error) {
                console.error('Firebase Ïó∞ÏäµÏû• Ï†ÄÏû• Ïã§Ìå®, Î°úÏª¨Ïä§ÌÜ†Î¶¨ÏßÄ ÏÇ¨Ïö©:', error);
                localStorage.setItem('global-practices', JSON.stringify(globalPractices));
            }
        }

        // Ï†ÑÏó≠ Ïó∞ÏäµÏû• ÎÇ¥Ïö© Î°úÎìú
        function loadPracticeContent() {
            const practiceTextarea = document.getElementById('practice-textarea');
            
            // DOMÏù¥ Ï§ÄÎπÑÎêòÏßÄ ÏïäÏùÄ Í≤ΩÏö∞ ÎåÄÍ∏∞
            if (!practiceTextarea) {
                setTimeout(loadPracticeContent, 100);
                return;
            }
            
            const content = globalPractices[currentPracticeTab] || '';
            practiceTextarea.value = content;
        }
        
        // FirebaseÏóêÏÑú Ï†ÑÏó≠ Ïó∞ÏäµÏû• Îç∞Ïù¥ÌÑ∞ Î°úÎìú
        async function loadPracticeFromFirebase() {
            if (!firebaseInitialized || !db) {
                console.log('Firebase ÎØ∏Ï¥àÍ∏∞Ìôî, Î°úÏª¨Ïä§ÌÜ†Î¶¨ÏßÄÏóêÏÑú Ïó∞ÏäµÏû• Î°úÎìú');
                const localPractices = localStorage.getItem('global-practices');
                if (localPractices) {
                    globalPractices = JSON.parse(localPractices);
                }
                return;
            }
            
            try {
                const doc = await db.collection('userdata').doc('global-practices').get();
                if (doc.exists) {
                    const data = doc.data();
                    if (data.practices) {
                        globalPractices = data.practices;
                    }
                    console.log('FirebaseÏóêÏÑú Ï†ÑÏó≠ Ïó∞ÏäµÏû•ÏùÑ Î°úÎìúÌñàÏäµÎãàÎã§.');
                } else {
                    // FirebaseÏóê Î¨∏ÏÑúÍ∞Ä ÏóÜÏúºÎ©¥ Î°úÏª¨Ïä§ÌÜ†Î¶¨ÏßÄÏóêÏÑú Î°úÎìú
                    const localPractices = localStorage.getItem('global-practices');
                    if (localPractices) {
                        globalPractices = JSON.parse(localPractices);
                    }
                }
            } catch (error) {
                console.error('Firebase Ïó∞ÏäµÏû• Î°úÎìú Ïã§Ìå®, Î°úÏª¨Ïä§ÌÜ†Î¶¨ÏßÄ ÏÇ¨Ïö©:', error);
                const localPractices = localStorage.getItem('global-practices');
                if (localPractices) {
                    globalPractices = JSON.parse(localPractices);
                }
            }
        }
        
        // ÌÉ≠ Ï†ÑÌôò Ìï®Ïàò
        function switchPracticeTab(tabNumber) {
            // ÌòÑÏû¨ ÌÉ≠Ïùò ÎÇ¥Ïö©ÏùÑ Ï¶âÏãú Ï†ÄÏû•
            const practiceTextarea = document.getElementById('practice-textarea');
            savePracticeContent(practiceTextarea.value, true); // Ï¶âÏãú Ï†ÄÏû•
            
            // ÌÉ≠ Î≥ÄÍ≤Ω
            currentPracticeTab = tabNumber;
            
            // ÏÉà ÌÉ≠Ïùò ÎÇ¥Ïö© Î°úÎìú
            loadPracticeContent();
            
            // UI ÏóÖÎç∞Ïù¥Ìä∏
            updatePracticeTabUI();
        }
        
        // ÌÉ≠ UI ÏóÖÎç∞Ïù¥Ìä∏
        function updatePracticeTabUI() {
            const tabs = document.querySelectorAll('.practice-tab');
            
            // DOMÏù¥ Ï§ÄÎπÑÎêòÏßÄ ÏïäÏùÄ Í≤ΩÏö∞ ÎåÄÍ∏∞
            if (tabs.length === 0) {
                setTimeout(updatePracticeTabUI, 100);
                return;
            }
            
            tabs.forEach(tab => {
                const tabNumber = parseInt(tab.dataset.tab);
                if (tabNumber === currentPracticeTab) {
                    tab.classList.add('active');
                } else {
                    tab.classList.remove('active');
                }
            });
        }
        
        function saveToLocalStorage() {
            try {
                const dataToSave = {
                    projects: allProjectsData,
                    currentProject: currentProject,
                    projectOrder: projectOrder || Object.keys(allProjectsData)
                };
                localStorage.setItem(STORAGE_KEY, JSON.stringify(dataToSave));
                console.log('Îç∞Ïù¥ÌÑ∞Î•º Î°úÏª¨Ïä§ÌÜ†Î¶¨ÏßÄÏóê Ï†ÄÏû•ÌñàÏäµÎãàÎã§.');
            } catch (error) {
                console.error('Î°úÏª¨Ïä§ÌÜ†Î¶¨ÏßÄ Ï†ÄÏû• Ïã§Ìå®:', error);
            }
        }
        
        // FirebaseÏóêÏÑú Îç∞Ïù¥ÌÑ∞ Î∂àÎü¨Ïò§Í∏∞
        async function loadFromFirebase() {
            if (!firebaseInitialized || !db) {
                console.log('Firebase ÎØ∏Ï¥àÍ∏∞Ìôî, Î°úÏª¨Ïä§ÌÜ†Î¶¨ÏßÄ ÏÇ¨Ïö©');
                return loadFromLocalStorage();
            }
            
            try {
                const doc = await db.collection('userdata').doc('bookmark-app').get();
                if (doc.exists) {
                    const data = doc.data();
                    console.log('FirebaseÏóêÏÑú Îç∞Ïù¥ÌÑ∞Î•º Î∂àÎü¨ÏôîÏäµÎãàÎã§.');
                    
                    // Î°úÏª¨Ïä§ÌÜ†Î¶¨ÏßÄÏóêÎèÑ ÎèôÍ∏∞Ìôî
                    if (data.projects && data.currentProject) {
                        const localData = { projects: data.projects, currentProject: data.currentProject };
                        localStorage.setItem(STORAGE_KEY, JSON.stringify(localData));
                    }
                    
                    return data;
                } else {
                    console.log('FirebaseÏóê Îç∞Ïù¥ÌÑ∞ ÏóÜÏùå, Î°úÏª¨Ïä§ÌÜ†Î¶¨ÏßÄ ÌôïÏù∏');
                    return loadFromLocalStorage();
                }
            } catch (error) {
                console.error('Firebase Î∂àÎü¨Ïò§Í∏∞ Ïã§Ìå®, Î°úÏª¨Ïä§ÌÜ†Î¶¨ÏßÄ ÏÇ¨Ïö©:', error);
                return loadFromLocalStorage();
            }
        }
        
        function loadFromLocalStorage() {
            try {
                const savedData = localStorage.getItem(STORAGE_KEY);
                if (savedData) {
                    const parsedData = JSON.parse(savedData);
                    if (parsedData.projects && Object.keys(parsedData.projects).length > 0) {
                        console.log('Î°úÏª¨Ïä§ÌÜ†Î¶¨ÏßÄÏóêÏÑú Îç∞Ïù¥ÌÑ∞Î•º Î∂àÎü¨ÏôîÏäµÎãàÎã§.');
                        return parsedData;
                    }
                }
            } catch (error) {
                console.error('Î°úÏª¨Ïä§ÌÜ†Î¶¨ÏßÄ Î∂àÎü¨Ïò§Í∏∞ Ïã§Ìå®:', error);
            }
            return null;
        }
        
        function getDefaultData() {
            return {
                "Í∞ÄÍ≥ÑÏïΩ": {
                    bookmarks: [
                        { name: "Í∞ÄÍ≥ÑÏïΩÍ∏à Î∞òÌôò Î≤ïÎ•†", url: "https://www.example.com/law-deposit", color: "#f8f9fa", favorite: true },
                        { name: "Ï£ºÌÉùÎèÑÏãúÍ∏∞Í∏à ÏïàÎÇ¥", url: "https://www.example.com/fund", color: "#f8f9fa", favorite: false }
                    ],
                    clipboard: [
                        { title: "Ïù∏Ï†ÅÏÇ¨Ìï≠ ÏöîÏ≤≠", text: "Ïù∏Ï†ÅÏÇ¨Ìï≠ ÏöîÏ≤≠: ÏÑ±Ìï®, Ïó∞ÎùΩÏ≤ò, Ï£ºÎØºÎ≤àÌò∏ ÏïûÏûêÎ¶¨", color: "#f8f9fa", favorite: true },
                        { title: "ÌäπÏïΩÏÇ¨Ìï≠", text: "Í≥ÑÏïΩÏÑúÏóê Ìè¨Ìï®Ìï† ÌäπÏïΩÏÇ¨Ìï≠", color: "#f8f9fa", favorite: false },
                    ]
                },
                "ÏûîÍ∏à": {
                    bookmarks: [
                        { name: "ÏûîÍ∏à Ï§ÄÎπÑÏÑúÎ•ò Î™©Î°ù", url: "https://www.example.com/final-docs", color: "#f8f9fa", favorite: false }
                    ],
                    clipboard: [
                        { title: "ÏûîÍ∏à Í≥ÑÏ¢åÎ≤àÌò∏", text: "ÏûîÍ∏à Í≥ÑÏ¢åÎ≤àÌò∏: 000-00000-000 (ÏòàÍ∏àÏ£º: „Öá„Öá„Öá)", color: "#f8f9fa", favorite: false },
                        { title: "ÏûîÍ∏à Ï≤òÎ¶¨ ÏôÑÎ£å", text: "Ïò§Îäò ÏûîÍ∏à Ï≤òÎ¶¨ ÏôÑÎ£å. Îì±Í∏∞ Ï†ëÏàò ÏòàÏ†ï.", color: "#f8f9fa", favorite: false }
                    ]
                },
                "ÏûÑÎåÄÏ∞®": {
                    bookmarks: [
                        { name: "ÏûÑÎåÄÏ∞® Í≥ÑÏïΩ Î≤ïÎ•†", url: "https://www.example.com/rental-law", color: "#f8f9fa", favorite: false }
                    ],
                    clipboard: [
                        { title: "Í≥ÑÏïΩ Ïó∞Ïû• ÏïàÎÇ¥", text: "Í≥ÑÏïΩ Ïó∞Ïû• Í¥ÄÎ†® ÏïàÎÇ¥ Î¨∏Íµ¨", color: "#f8f9fa", favorite: false },
                    ]
                },
                "Îß§Îß§": {
                    bookmarks: [
                        { name: "Îß§Îß§ Ï†àÏ∞® ÏïàÎÇ¥", url: "https://www.example.com/sale-process", color: "#f8f9fa", favorite: true }
                    ],
                    clipboard: [
                        { title: "Îß§Îß§ Í≥ÑÏïΩ Ïú†ÏùòÏÇ¨Ìï≠", text: "Îß§Îß§ Í≥ÑÏïΩ Ïãú Ïú†ÏùòÏÇ¨Ìï≠", color: "#f8f9fa", favorite: false },
                    ]
                }
            };
        }
        
        // Î°úÏª¨ Îç∞Ïù¥ÌÑ∞Î•º FirebaseÎ°ú ÎßàÏù¥Í∑∏Î†àÏù¥ÏÖò
        async function migrateLocalToFirebase() {
            const localData = loadFromLocalStorage();
            if (localData && localData.projects) {
                console.log('Î°úÏª¨ Îç∞Ïù¥ÌÑ∞Î•º FirebaseÎ°ú ÎßàÏù¥Í∑∏Î†àÏù¥ÏÖò Ï§ë...');
                allProjectsData = localData.projects;
                currentProject = localData.currentProject;
                projectOrder = localData.projectOrder || Object.keys(localData.projects);
                saveToFirebase();
                console.log('ÎßàÏù¥Í∑∏Î†àÏù¥ÏÖò ÏôÑÎ£å');
                return localData;
            }
            return null;
        }

        // Ïï± Ï¥àÍ∏∞Ìôî - Firebase Ïö∞ÏÑ†, Î°úÏª¨Ïä§ÌÜ†Î¶¨ÏßÄ Î∞±ÏóÖ
        let allProjectsData, currentProject, projectOrder;
        let currentPracticeTab = 1; // ÌòÑÏû¨ ÌôúÏÑ± Ïó∞ÏäµÏû• ÌÉ≠
        let globalPractices = { // Ï†ÑÏó≠ ÎèÖÎ¶Ω Ïó∞ÏäµÏû•
            1: '',
            2: '',
            3: '',
            4: '',
            5: ''
        };


        async function initializeApp() {
            try {
                const savedData = await loadFromFirebase();

                if (savedData && savedData.projects) {
                    allProjectsData = savedData.projects;

                    // ÌïòÏúÑ Ìò∏ÌôòÏÑ±: Í∏∞Ï°¥ ÌÅ¥Î¶ΩÎ≥¥Îìú Ìï≠Î™©Ïóê type ÌïÑÎìú Ï∂îÍ∞Ä
                    for (const projectName in allProjectsData) {
                        if (allProjectsData[projectName].clipboard) {
                            allProjectsData[projectName].clipboard.forEach(item => {
                                if (item.type !== 'divider' && !item.type) {
                                    item.type = 'normal'; // Í∏∞Ï°¥ Ìï≠Î™©ÏùÄ 'normal'Î°ú ÏÑ§Ï†ï
                                }
                            });
                        }
                    }

                    currentProject = savedData.currentProject || Object.keys(savedData.projects)[0];
                    projectOrder = savedData.projectOrder || Object.keys(savedData.projects);
                    console.log('Firebase Îç∞Ïù¥ÌÑ∞Î°ú Ïï± Ï¥àÍ∏∞Ìôî');
                } else {
                    // FirebaseÏóê Îç∞Ïù¥ÌÑ∞Í∞Ä ÏóÜÏúºÎ©¥ Î°úÏª¨ Îç∞Ïù¥ÌÑ∞ ÎßàÏù¥Í∑∏Î†àÏù¥ÏÖò ÏãúÎèÑ
                    const migratedData = await migrateLocalToFirebase();
                    if (!migratedData) {
                        allProjectsData = getDefaultData();
                        currentProject = 'Í∞ÄÍ≥ÑÏïΩ';
                        console.log('Í∏∞Î≥∏ Îç∞Ïù¥ÌÑ∞Î°ú Ïï± Ï¥àÍ∏∞Ìôî');
                        // Ï≤´ Ïã§ÌñâÏãú Firebase Î∞è Î°úÏª¨Ïä§ÌÜ†Î¶¨ÏßÄÏóê Ï†ÄÏû•
                        saveToFirebase();
                    }
                }

                // Ï†ÑÏó≠ Ïó∞ÏäµÏû• Îç∞Ïù¥ÌÑ∞ Î°úÎìú
                await loadPracticeFromFirebase();

                // UI Î†åÎçîÎßÅ
                renderProjectList();
                renderProject(currentProject);
                
            } catch (error) {
                console.error('Ïï± Ï¥àÍ∏∞Ìôî Ïã§Ìå®:', error);
                // ÏóêÎü¨ Î∞úÏÉùÏãú Î°úÏª¨Ïä§ÌÜ†Î¶¨ÏßÄ Î∞±ÏóÖÏúºÎ°ú ÏãúÎèÑ
                const localData = loadFromLocalStorage();
                if (localData) {
                    allProjectsData = localData.projects;

                    // ÌïòÏúÑ Ìò∏ÌôòÏÑ±: Í∏∞Ï°¥ ÌÅ¥Î¶ΩÎ≥¥Îìú Ìï≠Î™©Ïóê type ÌïÑÎìú Ï∂îÍ∞Ä
                    for (const projectName in allProjectsData) {
                        if (allProjectsData[projectName].clipboard) {
                            allProjectsData[projectName].clipboard.forEach(item => {
                                if (item.type !== 'divider' && !item.type) {
                                    item.type = 'normal'; // Í∏∞Ï°¥ Ìï≠Î™©ÏùÄ 'normal'Î°ú ÏÑ§Ï†ï
                                }
                            });
                        }
                    }

                    currentProject = localData.currentProject || Object.keys(localData.projects)[0];
                    projectOrder = localData.projectOrder || Object.keys(localData.projects);
                } else {
                    allProjectsData = getDefaultData();
                    currentProject = 'Í∞ÄÍ≥ÑÏïΩ';
                    projectOrder = Object.keys(allProjectsData);
                }

                renderProjectList();
                renderProject(currentProject);
                
                // Í≤ÄÏÉâ Ïù∏Îç±Ïä§ Ï¥àÍ∏∞Ìôî (Ìï®ÏàòÍ∞Ä Ï†ïÏùòÎêú Í≤ΩÏö∞ÏóêÎßå)
                if (typeof updateSearchIndex === 'function') {
                    updateSearchIndex();
                }
            }
        }

        // ÌååÏùº ÎØ∏Î¶¨Î≥¥Í∏∞ Î†åÎçîÎßÅ Ìï®Ïàò
        function generateFilePreview(base64Data, fileType, fileName) {
            const sizeKB = (fileName ? 0 : 0); // ÌÅ¨Í∏∞Îäî Î≥ÑÎèÑÎ°ú Í≥ÑÏÇ∞Îê®

            // Ïù¥ÎØ∏ÏßÄ ÌååÏùº
            if (fileType && fileType.startsWith('image/')) {
                return `
                    <div style="padding: 10px; text-align: center; background: #f5f5f5; border-radius: 8px;">
                        <img src="data:${fileType};base64,${base64Data}"
                             style="max-width: 100%; max-height: 400px; border-radius: 4px; margin-bottom: 10px;"
                             alt="Ïù¥ÎØ∏ÏßÄ ÎØ∏Î¶¨Î≥¥Í∏∞">
                        <div style="font-size: 12px; color: #666;">ÌååÏùºÎ™Ö: ${fileName}</div>
                    </div>
                `;
            }

            // ÌÖçÏä§Ìä∏ ÌååÏùº
            if (fileType && (fileType.startsWith('text/') || fileType === 'application/json')) {
                try {
                    const byteCharacters = atob(base64Data);
                    let textContent = byteCharacters;

                    // UTF-8 ÎîîÏΩîÎî© ÏãúÎèÑ
                    try {
                        const binaryString = String.fromCharCode.apply(null,
                            new Uint8Array(byteCharacters.split('').map(c => c.charCodeAt(0))));
                        textContent = decodeURIComponent(escape(binaryString));
                    } catch (e) {
                        // ÎîîÏΩîÎî© Ïã§Ìå®Ïãú ÏõêÎ≥∏ ÏÇ¨Ïö©
                    }

                    // Ï≤òÏùå 500ÏûêÍπåÏßÄÎßå ÌëúÏãú
                    const previewText = textContent.substring(0, 500);
                    const isLonger = textContent.length > 500;

                    return `
                        <div style="padding: 10px; background: #f5f5f5; border-radius: 8px;">
                            <pre style="margin: 0; font-size: 12px; max-height: 300px; overflow-y: auto; white-space: pre-wrap; word-wrap: break-word;">${previewText}${isLonger ? '\n\n... (Îçî ÎßéÏùÄ ÎÇ¥Ïö©Ïù¥ ÏûàÏäµÎãàÎã§)' : ''}</pre>
                            <div style="font-size: 12px; color: #666; margin-top: 10px;">ÌååÏùºÎ™Ö: ${fileName}</div>
                        </div>
                    `;
                } catch (e) {
                    return `
                        <div style="padding: 20px; text-align: center; background: #f5f5f5; border-radius: 8px;">
                            <div style="font-size: 32px; margin-bottom: 10px;">üìÑ</div>
                            <div style="font-size: 12px; color: #666;">ÌååÏùºÎ™Ö: ${fileName}</div>
                        </div>
                    `;
                }
            }

            // Í∏∞ÌÉÄ ÌååÏùº
            return `
                <div style="padding: 20px; text-align: center; background: #f5f5f5; border-radius: 8px;">
                    <div style="font-size: 32px; margin-bottom: 10px;">üìé</div>
                    <div style="font-size: 12px; color: #666;">ÌååÏùºÎ™Ö: ${fileName}</div>
                </div>
            `;
        }

        // UI ÏöîÏÜå Í∞ÄÏ†∏Ïò§Í∏∞
        const projectList = document.getElementById('project-list');
        const bookmarkList = document.getElementById('bookmark-list');
        const clipboardList = document.getElementById('clipboard-list');
        const currentProjectTitle = document.getElementById('current-project-title');
        
        const addBookmarkBtn = document.getElementById('add-bookmark-btn');
        const addClipboardBtn = document.getElementById('add-clipboard-btn');
        const addDividerBtn = document.getElementById('add-divider-btn');

        const contextMenu = document.getElementById('context-menu');
        const contextEdit = document.getElementById('context-edit');
        const contextFavorite = document.getElementById('context-favorite');
        const contextColor = document.getElementById('context-color');
        const contextCopyButton = document.getElementById('context-copy-button');
        const contextDelete = document.getElementById('context-delete');
        const contextCancel = document.getElementById('context-cancel');

        const projectContextMenu = document.getElementById('project-context-menu');
        const projectContextRename = document.getElementById('project-context-rename');
        const projectContextDelete = document.getElementById('project-context-delete');
        const projectContextCancel = document.getElementById('project-context-cancel');

        const bookmarkListContextMenu = document.getElementById('bookmark-list-context-menu');
        const listContextPaste = document.getElementById('list-context-paste');
        const listContextCancel = document.getElementById('list-context-cancel');
        const clipboardListContextMenu = document.getElementById('clipboard-list-context-menu');
        const clipboardListContextPaste = document.getElementById('clipboard-list-context-paste');
        const clipboardListContextCancel = document.getElementById('clipboard-list-context-cancel');

        let activeItem = null;
        let activeProject = null;
        let colorChangeItem = null;
        let copiedBookmark = null; // Î≥µÏÇ¨Îêú Î∂ÅÎßàÌÅ¨ Ï†ÄÏû•
        let copiedClipboard = null; // Î≥µÏÇ¨Îêú ÌÅ¥Î¶ΩÎ≥¥Îìú Ìï≠Î™© Ï†ÄÏû•

        // URLÏùÑ ÌïòÏù¥ÌçºÎßÅÌÅ¨Î°ú Î≥ÄÌôòÌïòÎäî Ìï®Ïàò
        // HTML Ïù¥Ïä§ÏºÄÏù¥ÌîÑ - XSS Î∞©ÏßÄ
        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        function convertUrlsToLinks(text) {
            if (!text) return '';

            // 1. Î®ºÏ†Ä ÌÖçÏä§Ìä∏Î•º Ïù¥Ïä§ÏºÄÏù¥ÌîÑÌïòÏó¨ XSS Î∞©ÏßÄ
            const escapedText = escapeHtml(text);

            // 2. Í∑∏ Îã§Ïùå URLÏùÑ ÏïàÏ†ÑÌïòÍ≤å ÎßÅÌÅ¨Î°ú Î≥ÄÌôò
            const urlRegex = /(https?:\/\/[^\s<>]+)/g;
            return escapedText.replace(urlRegex, (url) => {
                // URL ÏûêÏ≤¥ÎèÑ Ïù¥Ïä§ÏºÄÏù¥ÌîÑ
                const escapedUrl = escapeHtml(url);
                return `<a href="${escapedUrl}" target="_blank" rel="noopener noreferrer" style="color: #0066cc; text-decoration: underline;">${escapedUrl}</a>`;
            });
        }

        // TODAY ÌîÑÎ°úÏ†ùÌä∏Ïö© Ï¶êÍ≤®Ï∞æÍ∏∞ Î∂ÅÎßàÌÅ¨ ÏàòÏßë Ìï®Ïàò
        function getTodayBookmarks() {
            const favoriteBookmarks = [];
            
            // Î™®Îì† ÌîÑÎ°úÏ†ùÌä∏ÏóêÏÑú Ï¶êÍ≤®Ï∞æÍ∏∞ Î∂ÅÎßàÌÅ¨ ÏàòÏßë (TODAY Ï†úÏô∏)
            Object.keys(allProjectsData).forEach(projectName => {
                if (projectName !== 'TODAY') {
                    const project = allProjectsData[projectName];
                    if (project.bookmarks) {
                        project.bookmarks.forEach((bookmark, index) => {
                            if (bookmark.favorite && bookmark.type !== 'divider') {
                                favoriteBookmarks.push({
                                    ...bookmark,
                                    sourceProject: projectName,
                                    originalIndex: index
                                });
                            }
                        });
                    }
                }
            });
            
            return favoriteBookmarks;
        }

        async function renderProject(projectName) {
            currentProject = projectName;

            const projectData = allProjectsData[projectName];
            
            currentProjectTitle.textContent = projectName;
            bookmarkList.innerHTML = '';
            clipboardList.innerHTML = '';

            projectData.bookmarks.forEach((item, index) => {
                if (item.type !== 'divider') {
                    const button = document.createElement('button');
                    button.className = 'item-button bookmark-button draggable';
                    
                    const favoriteIcon = item.favorite ? '‚≠ê ' : '';
                    button.textContent = favoriteIcon + item.name.substring(0, 8 - favoriteIcon.length);
                    
                    button.style.backgroundColor = item.color || '#f8f9fa';
                    button.dataset.index = index;
                    button.dataset.type = 'bookmark';
                    button.dataset.fullName = item.name;
                    button.dataset.url = item.url;
                    button.draggable = true;
                    
                    let isDragging = false;
                    button.addEventListener('mousedown', () => { isDragging = false; });
                    button.addEventListener('dragstart', (e) => { 
                        isDragging = true; 
                                        handleItemDragStart(e);
                    });
                    button.addEventListener('mouseup', (e) => {
                        setTimeout(() => {
                            if (!isDragging && e.button === 0) {
                                window.open(item.url, '_blank');
                            }
                        }, 50);
                    });
                    bookmarkList.appendChild(button);
                }
            });

            projectData.clipboard.forEach((item, index) => {
                if (item.type === 'divider') {
                    // Íµ¨Î∂ÑÏÑ† ÏÉùÏÑ±
                    const divider = document.createElement('div');
                    divider.className = 'divider draggable';
                    divider.dataset.index = index;
                    divider.dataset.type = 'clipboard';
                    divider.draggable = true;
                    
                    divider.addEventListener('dragstart', handleItemDragStart);
                    
                    clipboardList.appendChild(divider);
                } else {
                    // ÏùºÎ∞ò ÌÅ¥Î¶ΩÎ≥¥Îìú Î≤ÑÌäº ÏÉùÏÑ±
                    const button = document.createElement('button');
                    button.className = 'item-button clipboard-button draggable';

                    const favoriteIcon = item.favorite ? '‚≠ê ' : '';
                    const fileIcon = item.isFile ? 'üìé ' : '';
                    const templateIcon = item.type === 'template' ? 'üìã ' : '';
                    const checklistIcon = item.type === 'checklist' ? '‚òëÔ∏è ' : '';
                    const displayTitle = item.title || (item.isFile ? item.fileInfo?.name : item.text) || '';
                    let buttonText = checklistIcon + templateIcon + fileIcon + displayTitle;

                    // ÌååÏùºÏù∏ Í≤ΩÏö∞ ÌååÏùº ÌÅ¨Í∏∞ ÌëúÏãú
                    if (item.isFile && item.fileInfo) {
                        const sizeKB = (item.fileInfo.size / 1024).toFixed(1);
                        buttonText = `${templateIcon}${fileIcon}${item.title} (${sizeKB}KB)`;
                    }

                    const fullButtonText = favoriteIcon + buttonText.substring(0, 12 - favoriteIcon.length);

                    button.style.backgroundColor = item.color || '#f8f9fa';
                    button.dataset.index = index;
                    button.dataset.type = 'clipboard';
                    button.dataset.fullText = item.text;
                    button.dataset.title = item.title || '';
                    button.dataset.isFile = item.isFile || false;
                    button.dataset.clipboardType = item.type || 'normal';
                    if (item.isFile && item.fileInfo) {
                        button.dataset.fileName = item.fileInfo.name;
                        button.dataset.fileType = item.fileInfo.type;
                    }
                    button.draggable = true;

                    // Î≤ÑÌäº ÌÖçÏä§Ìä∏Î•º ÌÖçÏä§Ìä∏ ÎÖ∏ÎìúÎ°ú Ï∂îÍ∞Ä
                    const textNode = document.createTextNode(fullButtonText);
                    button.appendChild(textNode);


                    let isDragging = false;
                    button.addEventListener('mousedown', () => { isDragging = false; });
                    button.addEventListener('dragstart', (e) => {
                        isDragging = true;
                        handleItemDragStart(e);
                    });
                    button.addEventListener('mouseup', (e) => {
                        setTimeout(() => {
                            if (!isDragging && e.button === 0) {
                                // ÌÖúÌîåÎ¶øÏù∏ Í≤ΩÏö∞ ÌÖúÌîåÎ¶ø ÏÇ¨Ïö© Î™®Îã¨ Ïó¥Í∏∞
                                if (item.type === 'template') {
                                    openTemplateUseModal(item);
                                } else if (item.type === 'checklist') {
                                    // Ï≤¥ÌÅ¨Î¶¨Ïä§Ìä∏ ÌëúÏãú
                                    openChecklistModal(item, index);
                                } else {
                                    // ÏùºÎ∞ò ÌÅ¥Î¶ΩÎ≥¥ÎìúÎäî ÏÉÅÏÑ∏ Î™®Îã¨Î°ú ÌëúÏãú
                                    const modal = document.getElementById('view-clipboard-modal');
                                    const titleEl = document.getElementById('view-clipboard-title');
                                    const contentEl = document.getElementById('view-clipboard-content');
                                    const copyBtn = document.getElementById('view-clipboard-copy-btn');
                                    const downloadBtn = document.getElementById('view-clipboard-download-btn');
                                    const editBtn = document.getElementById('view-clipboard-edit-btn');

                                    titleEl.textContent = item.title || '';

                                    // ÌÖçÏä§Ìä∏ ÎÇ¥Ïö© ÌëúÏãú
                                    const textToDisplay = item.textContent || item.text || '';
                                    if (item.isFile && item.fileInfo && !item.textContent) {
                                        // ÌååÏùºÏù¥ ÏûàÍ≥† ÌÖçÏä§Ìä∏Í∞Ä ÏóÜÎäî Í≤ΩÏö∞ - Í≥µÎ∞±
                                        contentEl.innerHTML = '';
                                    } else {
                                        // ÌÖçÏä§Ìä∏Í∞Ä ÏûàÏúºÎ©¥ ÌëúÏãú
                                        contentEl.innerHTML = convertUrlsToLinks(textToDisplay);
                                    }
                                    copyBtn.dataset.clipboardText = textToDisplay;

                                    // ÌååÏùºÏù¥ Ï≤®Î∂ÄÎêú Í≤ΩÏö∞
                                    const fileInfoDiv = document.getElementById('view-clipboard-file-info');
                                    if (item.isFile && item.fileInfo) {
                                        const fileInfo = item.fileInfo;
                                        const sizeKB = (fileInfo.size / 1024).toFixed(1);

                                        document.getElementById('view-clipboard-file-name').textContent = fileInfo.name;
                                        document.getElementById('view-clipboard-file-size').textContent = `ÌÅ¨Í∏∞: ${sizeKB}KB`;
                                        fileInfoDiv.style.display = 'block';

                                        copyBtn.style.display = 'inline-block';
                                        downloadBtn.style.display = 'inline-block';
                                        downloadBtn.dataset.fileData = item.fileData;
                                        downloadBtn.dataset.fileName = fileInfo.name;
                                        downloadBtn.dataset.fileType = fileInfo.type;
                                    } else {
                                        // ÌååÏùºÏù¥ ÏóÜÎäî Í≤ΩÏö∞
                                        fileInfoDiv.style.display = 'none';
                                        copyBtn.style.display = 'inline-block';
                                        downloadBtn.style.display = 'none';
                                    }

                                    editBtn.dataset.clipboardIndex = index;
                                    modal.style.display = 'flex';
                                }
                            }
                        }, 50);
                    });
                    clipboardList.appendChild(button);
                }
            });

            addTooltipEvents();
            setupDropZones();

            document.querySelectorAll('#project-list li').forEach(li => {
                li.classList.remove('active');
            });
            document.getElementById(`project-${projectName}`).classList.add('active');
            
            renderTemplates();
            
            // Ïó∞ÏäµÏû• ÎÇ¥Ïö© Î°úÎìú Î∞è ÌÉ≠ UI ÏóÖÎç∞Ïù¥Ìä∏
            loadPracticeContent();
            updatePracticeTabUI();
            
            saveToFirebase();
        }

        function addTooltipEvents() {
            const tooltip = document.getElementById('custom-tooltip');
            
            document.querySelectorAll('.item-button').forEach(button => {
                button.addEventListener('mouseenter', (e) => {
                    const target = e.target;
                    let tooltipText = '';
                    
                    // Î∂ÅÎßàÌÅ¨ Î≤ÑÌäº Ìò∏Î≤ÑÎßÅ Í∏∞Îä• Ï†úÍ±∞
                    // if (target.classList.contains('bookmark-button')) {
                    //     tooltipText = `${target.dataset.fullName}\n${target.dataset.url}`;
                    // }
                    
                    if (tooltipText) {
                        tooltip.innerHTML = tooltipText.replace(/\n/g, '<br>');
                        showTooltip(tooltip, target);
                    }
                });
                
                button.addEventListener('mouseleave', () => {
                    hideTooltip(tooltip);
                });
            });
        }

        function showTooltip(tooltip, target) {
            const rect = target.getBoundingClientRect();
            const tooltipRect = tooltip.getBoundingClientRect();
            
            let left = rect.left + (rect.width / 2) - (tooltipRect.width / 2);
            let top = rect.top - tooltipRect.height - 10;
            
            const padding = 10;
            if (left < padding) {
                left = padding;
            } else if (left + tooltipRect.width > window.innerWidth - padding) {
                left = window.innerWidth - tooltipRect.width - padding;
            }
            
            if (top < padding) {
                top = rect.bottom + 10;
                tooltip.classList.add('bottom');
            } else {
                tooltip.classList.remove('bottom');
            }
            
            tooltip.style.left = left + 'px';
            tooltip.style.top = top + 'px';
            tooltip.classList.add('show');
        }

        function hideTooltip(tooltip) {
            tooltip.classList.remove('show');
        }
        
        function addBookmark() {
            const modal = document.getElementById('add-bookmark-modal');
            document.querySelector('#add-bookmark-modal h2').textContent = 'Î∂ÅÎßàÌÅ¨ Ï∂îÍ∞Ä';
            modal.style.display = 'flex';
            
            document.getElementById('add-bookmark-name').value = '';
            document.getElementById('add-bookmark-url').value = '';
            
            delete modal.dataset.editMode;
            delete modal.dataset.editIndex;
        }

        // ÌÖúÌîåÎ¶ø Î≥ÄÏàò Ï∂îÏ∂ú Ìï®Ïàò
        // Î≥ÄÏàò ÌååÏã±: {Ïù¥Î¶Ñ}, {Ïù¥Î¶Ñ=Í∏∞Î≥∏Í∞í}, {Ïù¥Î¶Ñ:type}, {Ïù¥Î¶Ñ:type=Í∏∞Î≥∏Í∞í}, {ÏÑ†ÌÉù:select=ÏòµÏÖò1|ÏòµÏÖò2} ÏßÄÏõê
        function parseVariable(varStr) {
            // varStr Ïòà: "Ïù¥Î¶Ñ", "Ïù¥Î¶Ñ=ÌôçÍ∏∏Îèô", "ÎÇ†Ïßú:date", "ÎÇ†Ïßú:date=2025-10-23", "ÏÑ†ÌÉù:select=ÏòµÏÖò1|ÏòµÏÖò2"
            let name = '';
            let type = 'text';
            let defaultValue = '';
            let options = [];

            // Í∏∞Î≥∏Í∞í Ï∂îÏ∂ú (= Í∏∞Ï§Ä)
            if (varStr.includes('=')) {
                const [beforeEqual, afterEqual] = varStr.split('=');
                const defaultVal = afterEqual.trim();

                // select ÌÉÄÏûÖÏù∏ Í≤ΩÏö∞ ÏòµÏÖò ÌååÏã±
                if (beforeEqual.includes(':select')) {
                    const namePart = beforeEqual.split(':')[0].trim();
                    name = namePart;
                    type = 'select';
                    options = defaultVal.split('|').map(opt => opt.trim());
                    // Ï≤´ Î≤àÏß∏ ÏòµÏÖòÏùÑ Í∏∞Î≥∏Í∞íÏúºÎ°ú (ÎòêÎäî ÏßÄÏ†ïÎêú Í∏∞Î≥∏Í∞í)
                    defaultValue = options[0];
                } else {
                    const [namePart, typePart] = beforeEqual.split(':');
                    name = namePart.trim();
                    type = typePart ? typePart.trim() : 'text';
                    defaultValue = defaultVal;
                }
            } else {
                // ÌÉÄÏûÖÎßå ÏûàÎäî Í≤ΩÏö∞
                if (varStr.includes(':')) {
                    const [namePart, typePart] = varStr.split(':');
                    name = namePart.trim();
                    type = typePart.trim();

                    // select ÌÉÄÏûÖ ÏòµÏÖò ÌååÏã±
                    if (type.includes('=')) {
                        const [typeOnly, opts] = type.split('=');
                        type = typeOnly.trim();
                        if (type === 'select') {
                            options = opts.split('|').map(opt => opt.trim());
                            defaultValue = options[0];
                        }
                    }
                } else {
                    name = varStr.trim();
                    type = 'text';
                }
            }

            return { name, type, defaultValue, options };
        }

        function extractVariables(text) {
            const regex = /\{([^}]+)\}/g;
            const variables = [];
            const variableMap = {};
            let match;

            while ((match = regex.exec(text)) !== null) {
                const varStr = match[1];
                const parsed = parseVariable(varStr);

                // Ï§ëÎ≥µ Ï≤¥ÌÅ¨ (name Í∏∞Ï§Ä)
                if (!variableMap[parsed.name]) {
                    variables.push(parsed);
                    variableMap[parsed.name] = true;
                }
            }

            return variables;
        }

        // Î≥ÄÏàò ÌûàÏä§ÌÜ†Î¶¨ Í¥ÄÎ¶¨ Ìï®Ïàò
        function getVariableHistory(varName) {
            const history = localStorage.getItem(`template-history-${varName}`);
            return history ? JSON.parse(history) : [];
        }

        function saveVariableHistory(varName, value) {
            if (!value) return;

            let history = getVariableHistory(varName);
            // Ï§ëÎ≥µ Ï†úÍ±∞ÌïòÍ≥† ÏïûÏóê Ï∂îÍ∞Ä
            history = history.filter(h => h !== value);
            history.unshift(value);
            // ÏµúÍ∑º 10Í∞úÎßå Ï†ÄÏû•
            history = history.slice(0, 10);

            localStorage.setItem(`template-history-${varName}`, JSON.stringify(history));
        }

        // ÌÖúÌîåÎ¶ø Î≥ÄÏàò ÏπòÌôò Ìï®Ïàò (Í∞úÏÑ†)
        function replaceVariables(template, values) {
            let result = template;
            for (const [key, value] of Object.entries(values)) {
                // Îã§ÏñëÌïú ÌòïÏãùÏùò Î≥ÄÏàò ÏπòÌôò: {key}, {key=...}, {key:type}, {key:type=...}
                result = result.replace(new RegExp(`\\{${key}[^}]*\\}`, 'g'), value);
            }
            return result;
        }

        // Ï≤¥ÌÅ¨Î¶¨Ïä§Ìä∏ ÏÉÅÏÑ∏ÎÇ¥Ïö© Î™®Îã¨ Ïó¥Í∏∞
        let currentDetailItemIndex = null;
        let currentDetailClipboardIndex = null;
        let detailChecklistItems = []; // ÏÉÅÏÑ∏ÎÇ¥Ïö© Ï≤¥ÌÅ¨Î¶¨Ïä§Ìä∏ Ìï≠Î™©Îì§

        // ÏÉÅÏÑ∏ Ï≤¥ÌÅ¨Î¶¨Ïä§Ìä∏ Ìï≠Î™© Î†åÎçîÎßÅ
        function renderDetailChecklistItems() {
            const list = document.getElementById('checklist-detail-items-list');
            list.innerHTML = '';

            detailChecklistItems.forEach((item, index) => {
                const li = document.createElement('li');
                li.style.cssText = 'padding: 8px; background-color: white; border-radius: 3px; display: flex; align-items: flex-start; border: 1px solid #ddd; gap: 8px;';
                li.dataset.index = index;

                const checkbox = document.createElement('input');
                checkbox.type = 'checkbox';
                checkbox.checked = item.checked || false;
                checkbox.style.cssText = 'width: 18px; height: 18px; cursor: pointer; flex-shrink: 0; margin-top: 2px;';
                checkbox.dataset.index = index;

                const textContainer = document.createElement('div');
                textContainer.style.cssText = 'flex: 1; display: flex; align-items: flex-start; cursor: pointer; min-height: 40px;';

                const textSpan = document.createElement('div');
                textSpan.style.cssText = 'flex: 1; white-space: pre-wrap; word-break: break-word; line-height: 1.5; color: #333; ' + (item.checked ? 'text-decoration: line-through; color: #999;' : '');
                textSpan.textContent = item.text;

                // 3Ï†ê Î©îÎâ¥ Î≤ÑÌäº
                const menuBtn = document.createElement('button');
                menuBtn.textContent = '‚ãÆ';
                menuBtn.style.cssText = 'background: none; border: none; font-size: 27px; cursor: pointer; padding: 0; flex-shrink: 0; color: #333;';
                menuBtn.dataset.index = index;

                li.appendChild(checkbox);
                li.appendChild(textContainer);
                textContainer.appendChild(textSpan);
                li.appendChild(menuBtn);
                list.appendChild(li);

                // 3Ï†ê Î©îÎâ¥ Î≤ÑÌäº ÌÅ¥Î¶≠ Ïù¥Î≤§Ìä∏
                menuBtn.addEventListener('click', (e) => {
                    e.stopPropagation();
                    const menu = document.getElementById('checklist-detail-item-context-menu');
                    if (!menu) return;

                    menu.style.display = 'block';
                    menu.style.position = 'fixed';
                    menu.style.zIndex = '10002';

                    const rect = menuBtn.getBoundingClientRect();
                    menu.style.left = (rect.left - 100) + 'px';
                    menu.style.top = (rect.bottom + 5) + 'px';
                    menu.dataset.itemIndex = index;
                });

                // Ïù∏ÎùºÏù∏ Ìé∏Ïßë Ìï®Ïàò
                function enableInlineEdit() {
                    if (textContainer.querySelector('textarea')) return; // Ïù¥ÎØ∏ Ìé∏Ïßë Ï§ëÏù¥Î©¥ Î¨¥Ïãú

                    const currentText = detailChecklistItems[index].text;
                    textSpan.style.display = 'none';

                    const textarea = document.createElement('textarea');
                    textarea.value = currentText;
                    textarea.style.cssText = 'flex: 1; padding: 6px; border: 2px solid #5a4a7a; border-radius: 3px; font-size: 14px; font-family: inherit; resize: vertical; min-height: 200px; box-sizing: border-box;';
                    textarea.dataset.index = index;

                    function saveEdit() {
                        const newText = textarea.value.trim();
                        if (newText && newText !== currentText) {
                            detailChecklistItems[index].text = newText;
                        }
                        textarea.remove();
                        textSpan.style.display = '';
                        renderDetailChecklistItems();
                    }

                    function cancelEdit() {
                        textarea.remove();
                        textSpan.style.display = '';
                    }

                    textContainer.insertBefore(textarea, textSpan);
                    textarea.focus();
                    textarea.select();

                    // EscapeÎ°ú Ï∑®ÏÜå
                    textarea.addEventListener('keydown', (e) => {
                        if (e.key === 'Escape') {
                            e.preventDefault();
                            cancelEdit();
                        }
                    });

                    // Blur (Ïô∏Î∂Ä ÌÅ¥Î¶≠)Î°ú Ï†ÄÏû•
                    textarea.addEventListener('blur', () => {
                        saveEdit();
                    });
                }

                // ÌÖçÏä§Ìä∏ ÎçîÎ∏îÌÅ¥Î¶≠ Ïãú Ìé∏Ïßë Î™®Îìú
                textContainer.addEventListener('dblclick', (e) => {
                    if (!e.target.closest('textarea')) {
                        enableInlineEdit();
                    }
                });

                // Ï≤¥ÌÅ¨Î∞ïÏä§ Î≥ÄÍ≤Ω Ïù¥Î≤§Ìä∏
                checkbox.addEventListener('change', (e) => {
                    detailChecklistItems[index].checked = e.target.checked;

                    if (e.target.checked) {
                        // Ï≤¥ÌÅ¨ Ïãú: Ï∑®ÏÜåÏÑ† ÌëúÏãú + Î¶¨Ïä§Ìä∏ Îß® ÏïÑÎûòÎ°ú Ïù¥Îèô
                        const checkedItem = detailChecklistItems.splice(index, 1)[0];
                        detailChecklistItems.push(checkedItem);
                        renderDetailChecklistItems();
                    } else {
                        // Ïñ∏Ï≤¥ÌÅ¨ Ïãú: Ï∑®ÏÜåÏÑ† Ï†úÍ±∞ (ÏúÑÏπòÎäî Ïú†ÏßÄ)
                        textSpan.style.textDecoration = 'none';
                        textSpan.style.color = '';
                    }
                });
            });
        }

        // ÏÉÅÏÑ∏ Î∑∞Î™®Îìú Ìï≠Î™© Î†åÎçîÎßÅ (Ìé∏Ïßë Í∞ÄÎä•)
        function renderDetailChecklistViewItems() {
            const list = document.getElementById('checklist-detail-view-items');
            list.innerHTML = '';

            detailChecklistItems.forEach((item, index) => {
                const li = document.createElement('li');
                li.style.cssText = 'padding: 8px; background-color: white; border-radius: 3px; display: flex; align-items: flex-start; border: 1px solid #ddd; gap: 8px;';
                li.dataset.index = index;

                const checkbox = document.createElement('input');
                checkbox.type = 'checkbox';
                checkbox.checked = item.checked || false;
                checkbox.style.cssText = 'width: 18px; height: 18px; cursor: pointer; flex-shrink: 0; margin-top: 2px;';
                checkbox.dataset.index = index;

                const textContainer = document.createElement('div');
                textContainer.style.cssText = 'flex: 1; display: flex; align-items: flex-start; cursor: pointer; min-height: 40px;';

                const textSpan = document.createElement('div');
                textSpan.style.cssText = 'flex: 1; white-space: pre-wrap; word-break: break-word; line-height: 1.5; color: #333; ' + (item.checked ? 'text-decoration: line-through; color: #999;' : '');
                textSpan.textContent = item.text;

                const menuBtn = document.createElement('button');
                menuBtn.textContent = '‚ãÆ';
                menuBtn.style.cssText = 'background: none; border: none; font-size: 27px; cursor: pointer; padding: 0; flex-shrink: 0; color: #333;';
                menuBtn.dataset.index = index;

                li.appendChild(checkbox);
                li.appendChild(textContainer);
                textContainer.appendChild(textSpan);
                li.appendChild(menuBtn);
                list.appendChild(li);

                menuBtn.addEventListener('click', (e) => {
                    e.stopPropagation();
                    const menu = document.getElementById('checklist-detail-item-context-menu');
                    if (!menu) return;

                    menu.style.display = 'block';
                    menu.style.position = 'fixed';
                    menu.style.zIndex = '10002';

                    const rect = menuBtn.getBoundingClientRect();
                    menu.style.left = (rect.left - 100) + 'px';
                    menu.style.top = (rect.bottom + 5) + 'px';
                    menu.dataset.itemIndex = index;
                });

                // Ïù∏ÎùºÏù∏ Ìé∏Ïßë Ìï®Ïàò
                function enableInlineEdit() {
                    if (textContainer.querySelector('textarea')) return;

                    const currentText = detailChecklistItems[index].text;
                    textSpan.style.display = 'none';

                    const textarea = document.createElement('textarea');
                    textarea.value = currentText;
                    textarea.style.cssText = 'flex: 1; padding: 6px; border: 2px solid #5a4a7a; border-radius: 3px; font-size: 14px; font-family: inherit; resize: vertical; min-height: 200px; box-sizing: border-box;';
                    textarea.dataset.index = index;

                    function saveEdit() {
                        const newText = textarea.value.trim();
                        if (newText && newText !== currentText) {
                            detailChecklistItems[index].text = newText;
                        }
                        textarea.remove();
                        textSpan.style.display = '';
                        renderDetailChecklistViewItems();
                    }

                    function cancelEdit() {
                        textarea.remove();
                        textSpan.style.display = '';
                    }

                    textContainer.insertBefore(textarea, textSpan);
                    textarea.focus();
                    textarea.select();

                    // EscapeÎ°ú Ï∑®ÏÜå
                    textarea.addEventListener('keydown', (e) => {
                        if (e.key === 'Escape') {
                            e.preventDefault();
                            cancelEdit();
                        }
                    });

                    // Blur (Ïô∏Î∂Ä ÌÅ¥Î¶≠)Î°ú Ï†ÄÏû•
                    textarea.addEventListener('blur', () => {
                        saveEdit();
                    });
                }

                // ÌÖçÏä§Ìä∏ ÎçîÎ∏îÌÅ¥Î¶≠ Ïãú Ìé∏Ïßë Î™®Îìú
                textContainer.addEventListener('dblclick', (e) => {
                    if (!e.target.closest('textarea')) {
                        enableInlineEdit();
                    }
                });

                // Ï≤¥ÌÅ¨Î∞ïÏä§ Î≥ÄÍ≤Ω Ïù¥Î≤§Ìä∏
                checkbox.addEventListener('change', (e) => {
                    detailChecklistItems[index].checked = e.target.checked;

                    if (e.target.checked) {
                        // Ï≤¥ÌÅ¨ Ïãú: Ï∑®ÏÜåÏÑ† ÌëúÏãú + Î¶¨Ïä§Ìä∏ Îß® ÏïÑÎûòÎ°ú Ïù¥Îèô
                        const checkedItem = detailChecklistItems.splice(index, 1)[0];
                        detailChecklistItems.push(checkedItem);
                        renderDetailChecklistViewItems();
                    } else {
                        // Ïñ∏Ï≤¥ÌÅ¨ Ïãú: Ï∑®ÏÜåÏÑ† Ï†úÍ±∞ (ÏúÑÏπòÎäî Ïú†ÏßÄ)
                        textSpan.style.textDecoration = 'none';
                        textSpan.style.color = '';
                    }
                });

            });
        }

        function openChecklistDetailModal(itemIndex) {
            const item = checklistItems[itemIndex];
            const modal = document.getElementById('checklist-detail-modal');
            const titleEl = document.getElementById('checklist-detail-title');
            const inputField = document.getElementById('checklist-detail-item-input');

            titleEl.textContent = `"${item.text}" ÏÉÅÏÑ∏ÎÇ¥Ïö©`;

            // detailÏù¥ Î∞∞Ïó¥Ïù¥Î©¥ ÏÇ¨Ïö©, Î¨∏ÏûêÏó¥Ïù¥Î©¥ Î∞∞Ïó¥Î°ú Î≥ÄÌôò
            if (Array.isArray(item.detail)) {
                detailChecklistItems = JSON.parse(JSON.stringify(item.detail));
            } else if (typeof item.detail === 'string' && item.detail) {
                // Í∏∞Ï°¥ ÌÖçÏä§Ìä∏ ÌòïÏãùÏùÑ Î∞∞Ïó¥Î°ú Î≥ÄÌôò
                detailChecklistItems = item.detail.split('\n').map(text => ({
                    id: Math.random().toString(36).substr(2, 9),
                    text: text.trim(),
                    checked: false
                })).filter(item => item.text);
            } else {
                detailChecklistItems = [];
            }

            currentDetailItemIndex = itemIndex;
            currentDetailClipboardIndex = null;

            inputField.value = '';
            renderDetailChecklistItems();

            // ÏóêÎîîÌä∏ Î™®ÎìúÎ°ú Ïó¥Í∏∞
            setChecklistDetailModalMode(true);
            modal.style.display = 'flex';
        }

        // Ï†ÄÏû•Îêú Ï≤¥ÌÅ¨Î¶¨Ïä§Ìä∏Ïùò ÏÉÅÏÑ∏ÎÇ¥Ïö© Î™®Îã¨ Ïó¥Í∏∞
        let currentEditingChecklistItem = null;

        // Î™®Îã¨ Î™®Îìú Ï†ÑÌôò Ìï®Ïàò
        function setChecklistDetailModalMode(isEditMode) {
            const editArea = document.getElementById('checklist-detail-edit-area');
            const viewArea = document.getElementById('checklist-detail-view-area');
            const footerEdit = document.getElementById('checklist-detail-footer-edit');
            const footerView = document.getElementById('checklist-detail-footer-view');

            if (isEditMode) {
                editArea.style.display = 'flex';
                viewArea.style.display = 'none';
                footerEdit.style.display = 'block';
                footerView.style.display = 'none';
            } else {
                editArea.style.display = 'none';
                viewArea.style.display = 'flex';
                footerEdit.style.display = 'none';
                footerView.style.display = 'block';
                renderDetailChecklistViewItems();
            }
        }

        function openSavedChecklistDetailModal(clipboardIndex, itemIndex) {
            const modal = document.getElementById('checklist-detail-modal');
            const titleEl = document.getElementById('checklist-detail-title');
            const inputField = document.getElementById('checklist-detail-item-input');

            // ÌòÑÏû¨ Î≥¥Ïó¨ÏßÄÎäî view-checklist-containerÏùò Ìï≠Î™©ÏóêÏÑú Îç∞Ïù¥ÌÑ∞ Í∞ÄÏ†∏Ïò§Í∏∞
            const viewChecklistItems = document.getElementById('view-checklist-items');
            const items = viewChecklistItems.querySelectorAll('li');

            if (items[itemIndex]) {
                const liElement = items[itemIndex];
                const textLabel = liElement.querySelector('label');
                const itemText = textLabel ? textLabel.textContent : '';

                // ÌòÑÏû¨ ÏàòÏ†ï Ï§ëÏù∏ Ìï≠Î™© Ï†ïÎ≥¥ Ï†ÄÏû•
                currentEditingChecklistItem = {
                    text: itemText,
                    itemIndex: itemIndex,
                    clipboardIndex: clipboardIndex,
                    liElement: liElement
                };
                currentDetailItemIndex = itemIndex;
                currentDetailClipboardIndex = clipboardIndex;

                titleEl.textContent = `"${itemText}" ÏÉÅÏÑ∏ÎÇ¥Ïö©`;

                // detailÏù¥ Î∞∞Ïó¥Ïù¥Î©¥ ÏÇ¨Ïö©, Î¨∏ÏûêÏó¥Ïù¥Î©¥ Î∞∞Ïó¥Î°ú Î≥ÄÌôò
                const detailData = liElement.dataset.detail;
                if (typeof detailData === 'string' && detailData.startsWith('[')) {
                    try {
                        detailChecklistItems = JSON.parse(detailData);
                    } catch (e) {
                        detailChecklistItems = [];
                    }
                } else if (typeof detailData === 'string' && detailData) {
                    // Í∏∞Ï°¥ ÌÖçÏä§Ìä∏ ÌòïÏãùÏùÑ Î∞∞Ïó¥Î°ú Î≥ÄÌôò
                    detailChecklistItems = detailData.split('\n').map(text => ({
                        id: Math.random().toString(36).substr(2, 9),
                        text: text.trim(),
                        checked: false
                    })).filter(item => item.text);
                } else {
                    detailChecklistItems = [];
                }

                inputField.value = '';

                // Î∑∞ Î™®ÎìúÎ°ú Ïó¥Í∏∞
                setChecklistDetailModalMode(false);
                modal.style.display = 'flex';
            }
        }

        // ÌÖúÌîåÎ¶ø ÏÇ¨Ïö© Î™®Îã¨ Ïó¥Í∏∞ (ÌÉÄÏûÖÎ≥Ñ ÏûÖÎ†• ÌïÑÎìú ÏßÄÏõê)
        function openChecklistModal(item, index) {
            const modal = document.getElementById('view-clipboard-modal');
            const titleEl = document.getElementById('view-clipboard-title');
            const viewContentContainer = document.getElementById('view-content-container');
            const viewChecklistContainer = document.getElementById('view-checklist-container');
            const viewChecklistItems = document.getElementById('view-checklist-items');
            const editBtn = document.getElementById('view-clipboard-edit-btn');

            titleEl.textContent = item.title || '';
            viewContentContainer.style.display = 'none';
            viewChecklistContainer.style.display = 'flex';

            // Ï≤¥ÌÅ¨Î¶¨Ïä§Ìä∏ Ìï≠Î™© Î†åÎçîÎßÅ
            viewChecklistItems.innerHTML = '';
            if (item.items && item.items.length > 0) {
                item.items.forEach((checkItem, itemIndex) => {
                    const li = document.createElement('li');
                    li.style.cssText = 'padding: 12px; margin-bottom: 8px; background-color: white; border-radius: 3px; display: flex; align-items: center; border: 1px solid #ddd; gap: 12px; position: relative;';
                    li.dataset.itemIndex = itemIndex;
                    // ÏÉÅÏÑ∏ÎÇ¥Ïö© Ï†ÄÏû• (Î∞∞Ïó¥ÏùÄ JSON ÏßÅÎ†¨Ìôî, Î¨∏ÏûêÏó¥ÏùÄ Í∑∏ÎåÄÎ°ú, ÏóÜÏúºÎ©¥ Îπà Î∞∞Ïó¥)
                    if (Array.isArray(checkItem.detail)) {
                        li.dataset.detail = JSON.stringify(checkItem.detail);
                    } else if (typeof checkItem.detail === 'string' && checkItem.detail) {
                        li.dataset.detail = checkItem.detail;
                    } else {
                        li.dataset.detail = JSON.stringify([]);
                    }

                    const checkbox = document.createElement('input');
                    checkbox.type = 'checkbox';
                    checkbox.checked = checkItem.checked || false;
                    checkbox.style.cssText = 'width: 18px; height: 18px; cursor: pointer; flex-shrink: 0;';
                    checkbox.dataset.itemIndex = itemIndex;

                    // ÌÖçÏä§Ìä∏ÏôÄ Î≤ÑÌäºÏùÑ Í∞êÏã∏Îäî Ïª®ÌÖåÏù¥ÎÑà
                    const textContainer = document.createElement('div');
                    textContainer.style.cssText = 'flex: 1; display: flex; align-items: center; gap: 8px; cursor: pointer;';

                    const label = document.createElement('label');
                    label.textContent = checkItem.text;
                    label.style.cssText = 'flex: 1; cursor: pointer; ' + (checkbox.checked ? 'text-decoration: line-through; color: #999;' : '');

                    // Ïù∏ÎùºÏù∏ Ìé∏Ïßë Ìï®Ïàò
                    function enableInlineEdit() {
                        if (textContainer.querySelector('input')) return; // Ïù¥ÎØ∏ Ìé∏Ïßë Ï§ëÏù¥Î©¥ Î¨¥Ïãú

                        const currentText = item.items[itemIndex].text;
                        label.style.display = 'none';

                        const input = document.createElement('input');
                        input.type = 'text';
                        input.value = currentText;
                        input.style.cssText = 'flex: 1; padding: 6px; border: 2px solid #5a4a7a; border-radius: 3px; font-size: 14px; font-family: inherit; box-sizing: border-box;';

                        function saveEdit() {
                            const newText = input.value.trim();
                            if (newText && newText !== currentText) {
                                item.items[itemIndex].text = newText;
                                label.textContent = newText;
                                saveToFirebase();
                            }
                            input.remove();
                            label.style.display = '';
                        }

                        function cancelEdit() {
                            input.remove();
                            label.style.display = '';
                        }

                        textContainer.insertBefore(input, label);
                        input.focus();
                        input.select();

                        // EscapeÎ°ú Ï∑®ÏÜå
                        input.addEventListener('keydown', (e) => {
                            if (e.key === 'Escape') {
                                e.preventDefault();
                                cancelEdit();
                            }
                        });

                        // Blur (Ïô∏Î∂Ä ÌÅ¥Î¶≠)Î°ú Ï†ÄÏû•
                        input.addEventListener('blur', () => {
                            saveEdit();
                        });
                    }

                    // ÎçîÎ∏îÌÅ¥Î¶≠ÏúºÎ°ú Ìé∏Ïßë Î™®Îìú ÏßÑÏûÖ, Ïã±Í∏ÄÌÅ¥Î¶≠ÏúºÎ°ú ÏÉÅÏÑ∏ÎÇ¥Ïö© Î™®Îã¨ Ïó¥Í∏∞
                    let clickTimeout = null;
                    let clickCount = 0;

                    textContainer.addEventListener('click', (e) => {
                        if (e.target.closest('button') || e.target.closest('input')) return;

                        e.preventDefault();
                        e.stopPropagation();

                        clickCount++;
                        if (clickCount === 1) {
                            clickTimeout = setTimeout(() => {
                                // Ïã±Í∏ÄÌÅ¥Î¶≠: ÏÉÅÏÑ∏ÎÇ¥Ïö© Î™®Îã¨ Ïó¥Í∏∞
                                openSavedChecklistDetailModal(index, itemIndex);
                                clickCount = 0;
                            }, 300);
                        } else if (clickCount === 2) {
                            clearTimeout(clickTimeout);
                            // ÎçîÎ∏îÌÅ¥Î¶≠: Ïù∏ÎùºÏù∏ Ìé∏Ïßë
                            enableInlineEdit();
                            clickCount = 0;
                        }
                    });

                    checkbox.addEventListener('change', (e) => {
                        item.items[itemIndex].checked = e.target.checked;

                        if (e.target.checked) {
                            // Ï≤¥ÌÅ¨ Ïãú: Ï∑®ÏÜåÏÑ† ÌëúÏãú + Î¶¨Ïä§Ìä∏ Îß® ÏïÑÎûòÎ°ú Ïù¥Îèô
                            const checkedItem = item.items.splice(itemIndex, 1)[0];
                            item.items.push(checkedItem);
                            saveToFirebase();
                            // Î†åÎçîÎßÅ ÏÉàÎ°úÍ≥†Ïπ® (ÌòÑÏû¨ Î™®Îã¨ Ïú†ÏßÄ)
                            const savedItems = item.items;
                            viewChecklistItems.innerHTML = '';
                            savedItems.forEach((savedItem, newIndex) => {
                                const newLi = document.createElement('li');
                                newLi.style.cssText = 'padding: 12px; margin-bottom: 8px; background-color: white; border-radius: 3px; display: flex; align-items: center; border: 1px solid #ddd; gap: 12px; position: relative;';
                                newLi.dataset.itemIndex = newIndex;

                                const newCheckbox = document.createElement('input');
                                newCheckbox.type = 'checkbox';
                                newCheckbox.checked = savedItem.checked || false;
                                newCheckbox.style.cssText = 'width: 18px; height: 18px; cursor: pointer; flex-shrink: 0;';

                                const newLabel = document.createElement('label');
                                newLabel.textContent = savedItem.text;
                                newLabel.style.cssText = 'flex: 1; cursor: pointer; ' + (savedItem.checked ? 'text-decoration: line-through; color: #999;' : '');

                                const newDocBtn = document.createElement('button');
                                newDocBtn.textContent = 'üìÑ';
                                newDocBtn.style.cssText = 'background: none; border: none; font-size: 16px; cursor: pointer; padding: 0; flex-shrink: 0;';

                                newLi.appendChild(newCheckbox);
                                const newTextContainer = document.createElement('div');
                                newTextContainer.style.cssText = 'flex: 1; display: flex; align-items: center; gap: 8px; cursor: pointer;';
                                newTextContainer.appendChild(newLabel);
                                newTextContainer.appendChild(newDocBtn);
                                newLi.appendChild(newTextContainer);
                                viewChecklistItems.appendChild(newLi);

                                newCheckbox.addEventListener('change', (ce) => {
                                    item.items[newIndex].checked = ce.target.checked;
                                    newLabel.style.textDecoration = ce.target.checked ? 'line-through' : 'none';
                                    newLabel.style.color = ce.target.checked ? '#999' : '#222';
                                    saveToFirebase();
                                });

                                newDocBtn.addEventListener('click', () => {
                                    openSavedChecklistDetailModal(index, newIndex);
                                });
                            });
                        } else {
                            // Ïñ∏Ï≤¥ÌÅ¨ Ïãú: Ï∑®ÏÜåÏÑ† Ï†úÍ±∞ (ÏúÑÏπòÎäî Ïú†ÏßÄ)
                            label.style.textDecoration = 'none';
                            label.style.color = '#222';
                            saveToFirebase();
                        }
                    });

                    // Î¨∏ÏÑú Ïù¥Î™®ÏßÄ Î≤ÑÌäº
                    const docBtn = document.createElement('button');
                    docBtn.textContent = 'üìÑ';
                    docBtn.style.cssText = 'background: none; border: none; font-size: 16px; cursor: pointer; padding: 0; flex-shrink: 0;';
                    docBtn.dataset.itemIndex = itemIndex;
                    docBtn.addEventListener('click', (e) => {
                        e.stopPropagation();
                        openSavedChecklistDetailModal(index, itemIndex);
                    });

                    textContainer.appendChild(label);
                    textContainer.appendChild(docBtn);

                    li.appendChild(checkbox);
                    li.appendChild(textContainer);

                    // Ïö∞ÌÅ¥Î¶≠ Ïª®ÌÖçÏä§Ìä∏ Î©îÎâ¥
                    li.addEventListener('contextmenu', (e) => {
                        e.preventDefault();
                        const menu = document.getElementById('view-checklist-item-context-menu');
                        if (!menu) return;

                        menu.style.display = 'block';
                        menu.style.left = e.clientX + 'px';
                        menu.style.top = e.clientY + 'px';
                        menu.dataset.clipboardIndex = index;
                        menu.dataset.itemIndex = itemIndex;
                    });

                    viewChecklistItems.appendChild(li);
                });
            } else {
                viewChecklistItems.innerHTML = '<li style="padding: 12px; color: #999;">Ìï≠Î™©Ïù¥ ÏóÜÏäµÎãàÎã§.</li>';
            }

            editBtn.dataset.clipboardIndex = index;
            modal.style.display = 'flex';
        }

        function openTemplateUseModal(item) {
            const modal = document.getElementById('template-use-modal');
            const variables = extractVariables(item.textContent || item.text || '');

            document.getElementById('template-title-display').textContent = `"${item.title}" ÌÖúÌîåÎ¶ø ÏÇ¨Ïö©`;

            // Î≥ÄÏàò ÏûÖÎ†• Ìèº ÏÉùÏÑ±
            const formDiv = document.getElementById('template-variables-form');
            formDiv.innerHTML = '';

            const variableValues = {};
            const inputElements = {};

            variables.forEach(varData => {
                const varName = varData.name;
                const varType = varData.type;
                const defaultValue = varData.defaultValue;
                const options = varData.options;

                const formGroup = document.createElement('div');
                formGroup.className = 'modal-form-group';

                const label = document.createElement('label');
                label.htmlFor = `template-var-${varName}`;
                label.textContent = `${varName}:`;
                formGroup.appendChild(label);

                let inputElement;
                const history = getVariableHistory(varName);

                // Î≥ÄÏàò ÌÉÄÏûÖÏóê Îî∞Î•∏ ÏûÖÎ†• ÌïÑÎìú ÏÉùÏÑ±
                if (varType === 'date') {
                    inputElement = document.createElement('input');
                    inputElement.type = 'date';
                    inputElement.id = `template-var-${varName}`;
                    inputElement.className = 'template-input';
                    inputElement.value = defaultValue || new Date().toISOString().split('T')[0];
                } else if (varType === 'time') {
                    inputElement = document.createElement('input');
                    inputElement.type = 'time';
                    inputElement.id = `template-var-${varName}`;
                    inputElement.className = 'template-input';
                    inputElement.value = defaultValue || '00:00';
                } else if (varType === 'select' && options.length > 0) {
                    inputElement = document.createElement('select');
                    inputElement.id = `template-var-${varName}`;
                    inputElement.className = 'template-input';

                    options.forEach(opt => {
                        const optionEl = document.createElement('option');
                        optionEl.value = opt;
                        optionEl.textContent = opt;
                        optionEl.selected = (opt === defaultValue);
                        inputElement.appendChild(optionEl);
                    });
                } else {
                    // Í∏∞Î≥∏ text ÌÉÄÏûÖ
                    inputElement = document.createElement('input');
                    inputElement.type = 'text';
                    inputElement.id = `template-var-${varName}`;
                    inputElement.className = 'template-input';
                    inputElement.value = defaultValue || '';
                    inputElement.placeholder = history.length > 0 ? `ÏµúÍ∑º: ${history[0]}` : '';

                    // ÌûàÏä§ÌÜ†Î¶¨ ÎìúÎ°≠Îã§Ïö¥ Ï∂îÍ∞Ä
                    if (history.length > 0) {
                        const historyDiv = document.createElement('div');
                        historyDiv.style.cssText = 'font-size: 11px; color: #999; margin-top: 4px; max-height: 100px; overflow-y: auto;';
                        historyDiv.innerHTML = '<strong>ÏµúÍ∑º ÏûÖÎ†•:</strong><br>' +
                            history.map((h, i) => `<span style="display: inline-block; background: #f0f0f0; padding: 2px 6px; margin: 2px 2px 2px 0; border-radius: 3px; cursor: pointer;" data-history-index="${i}" class="history-item">${h}</span>`).join('');

                        formGroup.appendChild(inputElement);
                        formGroup.appendChild(historyDiv);

                        // ÌûàÏä§ÌÜ†Î¶¨ ÏïÑÏù¥ÌÖú ÌÅ¥Î¶≠ Ïù¥Î≤§Ìä∏
                        historyDiv.querySelectorAll('.history-item').forEach(item => {
                            item.addEventListener('click', () => {
                                const idx = parseInt(item.dataset.historyIndex);
                                inputElement.value = history[idx];
                                updatePreview();
                            });
                        });

                        inputElements[varName] = inputElement;
                        formDiv.appendChild(formGroup);
                        variableValues[varName] = defaultValue || '';
                        return;
                    }
                }

                formGroup.appendChild(inputElement);
                formDiv.appendChild(formGroup);
                inputElements[varName] = inputElement;
                variableValues[varName] = inputElement.value;
            });

            // ÎØ∏Î¶¨Î≥¥Í∏∞ ÏóÖÎç∞Ïù¥Ìä∏ Ìï®Ïàò
            const updatePreview = () => {
                variables.forEach(varData => {
                    const varName = varData.name;
                    const input = inputElements[varName];
                    if (input) {
                        variableValues[varName] = input.value;
                    }
                });

                const preview = replaceVariables(item.textContent || item.text || '', variableValues);
                document.getElementById('template-preview').textContent = preview;
            };

            // ÏûÖÎ†• ÌïÑÎìúÏóê Ïù¥Î≤§Ìä∏ Î¶¨Ïä§ÎÑà Ï∂îÍ∞Ä
            Object.values(inputElements).forEach(input => {
                input.addEventListener('input', updatePreview);
                input.addEventListener('change', updatePreview);
            });

            // Ï¥àÍ∏∞ ÎØ∏Î¶¨Î≥¥Í∏∞ ÌëúÏãú
            updatePreview();

            // ÏôÑÎ£å Î≤ÑÌäº ÌÅ¥Î¶≠ Ïãú
            document.getElementById('template-generate-btn').onclick = () => {
                // Î≥ÄÏàòÍ∞íÏùÑ ÌûàÏä§ÌÜ†Î¶¨Ïóê Ï†ÄÏû•
                variables.forEach(varData => {
                    const varName = varData.name;
                    const value = variableValues[varName];
                    if (varData.type === 'text' && value) {
                        saveVariableHistory(varName, value);
                    }
                });

                const result = replaceVariables(item.textContent || item.text || '', variableValues);
                showTemplateResultModal(result);
                modal.style.display = 'none';
            };

            // ÌòÑÏû¨ Î≥ÄÏàòÍ∞í Ï†ÄÏû•
            modal.dataset.templateData = JSON.stringify(variableValues);

            modal.style.display = 'flex';
        }

        // ÌÖúÌîåÎ¶ø Í≤∞Í≥º Î™®Îã¨ ÌëúÏãú
        let currentTemplateResult = '';
        function showTemplateResultModal(result) {
            currentTemplateResult = result;
            document.getElementById('template-result-content').textContent = result;
            document.getElementById('template-result-modal').style.display = 'flex';
        }

        function addClipboard() {
            const modal = document.getElementById('add-clipboard-modal');
            document.getElementById('clipboard-edit-title').textContent = 'ÌÅ¥Î¶ΩÎ≥¥Îìú Ï∂îÍ∞Ä';
            modal.style.display = 'flex';

            document.getElementById('add-clipboard-title').value = '';
            document.getElementById('add-clipboard-content').value = '';
            document.getElementById('add-clipboard-file').value = '';
            document.getElementById('file-info').textContent = '';

            // ÌÉÄÏûÖ ÏÑ†ÌÉù Ï¥àÍ∏∞Ìôî
            document.querySelector('input[name="clipboard-type"][value="normal"]').checked = true;
            document.getElementById('template-hint').style.display = 'none';

            // Ï≤¥ÌÅ¨Î¶¨Ïä§Ìä∏ Ï¥àÍ∏∞Ìôî
            checklistItems = [];
            renderChecklistItems();
            normalModeContainer.style.display = 'flex';
            checklistModeContainer.style.display = 'none';

            delete modal.dataset.editMode;
            delete modal.dataset.editIndex;
        }

        function addDivider() {
            if (!currentProject) {
                alert('ÌîÑÎ°úÏ†ùÌä∏Î•º Î®ºÏ†Ä ÏÑ†ÌÉùÌï¥Ï£ºÏÑ∏Ïöî.');
                return;
            }
            
            const projectData = allProjectsData[currentProject];
            const divider = {
                type: 'divider',
                id: 'divider_' + Date.now()
            };
            
            projectData.clipboard.push(divider);
            saveToFirebase();
            renderProject(currentProject);
        }

        function addProject() {
            const modal = document.getElementById('add-project-modal');
            modal.style.display = 'flex';
            
            document.getElementById('add-project-name').value = '';
        }

        function renderProjectList() {
            const projectList = document.getElementById('project-list');
            projectList.innerHTML = '';

            // Î™®Îì† ÌîÑÎ°úÏ†ùÌä∏ Î†åÎçîÎßÅ
            const orderedProjects = (projectOrder || Object.keys(allProjectsData));
            orderedProjects.forEach((projectName, index) => {
                // Ï°¥Ïû¨ÌïòÏßÄ ÏïäÎäî ÌîÑÎ°úÏ†ùÌä∏Îäî Í±¥ÎÑàÎõ∞Í∏∞
                if (!allProjectsData[projectName]) return;
                const li = document.createElement('li');
                li.id = `project-${projectName}`;
                li.textContent = projectName;
                li.classList.add('draggable', 'project-item');
                li.draggable = true;
                li.dataset.projectName = projectName;
                li.dataset.index = index;
                
                if (projectName === currentProject) {
                    li.classList.add('active');
                }
                
                li.addEventListener('dragstart', handleProjectDragStart);
                li.addEventListener('dragover', handleProjectDragOver);
                li.addEventListener('drop', handleProjectDrop);
                li.addEventListener('dragend', handleProjectDragEnd);
                li.addEventListener('dragenter', handleProjectDragEnter);
                li.addEventListener('dragleave', handleProjectDragLeave);
                
                projectList.appendChild(li);
            });
        }

        function showContextMenu(e, itemType, itemIndex) {
            e.preventDefault();
            contextMenu.style.display = 'block';
            
            // ÌôîÎ©¥ Í≤ΩÍ≥ÑÎ•º Í≥†Î†§Ìïú ÏúÑÏπò Í≥ÑÏÇ∞
            const menuWidth = 180; // ÏµúÏÜå ÎÑàÎπÑ
            const menuHeight = 160; // ÏòàÏÉÅ ÎÜíÏù¥ (4Í∞ú Ìï≠Î™© Í∏∞Ï§Ä)
            const screenWidth = window.innerWidth;
            const screenHeight = window.innerHeight;
            
            let x = e.clientX;
            let y = e.clientY;
            
            // Ïö∞Ï∏° Í≤ΩÍ≥Ñ ÌôïÏù∏
            if (x + menuWidth > screenWidth) {
                x = screenWidth - menuWidth - 10;
            }
            
            // ÌïòÎã® Í≤ΩÍ≥Ñ ÌôïÏù∏
            if (y + menuHeight > screenHeight) {
                y = screenHeight - menuHeight - 10;
            }
            
            // ÏµúÏÜå Ïó¨Î∞± ÌôïÎ≥¥
            if (x < 10) x = 10;
            if (y < 10) y = 10;
            
            contextMenu.style.left = x + 'px';
            contextMenu.style.top = y + 'px';
            activeItem = { type: itemType, index: itemIndex };
            
            // Íµ¨Î∂ÑÏÑ†Ïù∏ Í≤ΩÏö∞ Ìé∏Ïßë/Ï¶êÍ≤®Ï∞æÍ∏∞/ÏÉâÏÉÅ ÏòµÏÖò Ïà®Í∏∞Í∏∞
            if (itemType === 'divider') {
                contextEdit.style.display = 'none';
                contextFavorite.style.display = 'none';
                contextColor.style.display = 'none';
            } else {
                contextEdit.style.display = 'block';
                contextFavorite.style.display = 'block';
                contextColor.style.display = 'block';
            }
        }

        function showProjectContextMenu(e, projectName) {
            e.preventDefault();
            projectContextMenu.style.display = 'block';
            
            // ÌôîÎ©¥ Í≤ΩÍ≥ÑÎ•º Í≥†Î†§Ìïú ÏúÑÏπò Í≥ÑÏÇ∞
            const menuWidth = 150; // ÌîÑÎ°úÏ†ùÌä∏ Î©îÎâ¥ ÎÑàÎπÑ
            const menuHeight = 120; // ÏòàÏÉÅ ÎÜíÏù¥ (3Í∞ú Ìï≠Î™© Í∏∞Ï§Ä)
            const screenWidth = window.innerWidth;
            const screenHeight = window.innerHeight;
            
            let x = e.clientX;
            let y = e.clientY;
            
            // Ïö∞Ï∏° Í≤ΩÍ≥Ñ ÌôïÏù∏
            if (x + menuWidth > screenWidth) {
                x = screenWidth - menuWidth - 10;
            }
            
            // ÌïòÎã® Í≤ΩÍ≥Ñ ÌôïÏù∏
            if (y + menuHeight > screenHeight) {
                y = screenHeight - menuHeight - 10;
            }
            
            // ÏµúÏÜå Ïó¨Î∞± ÌôïÎ≥¥
            if (x < 10) x = 10;
            if (y < 10) y = 10;
            
            projectContextMenu.style.left = x + 'px';
            projectContextMenu.style.top = y + 'px';
            activeProject = projectName;
        }

        let projectDragStarted = false;
        projectList.addEventListener('mousedown', (e) => {
            projectDragStarted = false;
        });
        projectList.addEventListener('dragstart', () => {
            projectDragStarted = true;
        });
        projectList.addEventListener('mouseup', (e) => {
            setTimeout(() => {
                if (!projectDragStarted && e.target.tagName === 'LI') {
                    const projectName = e.target.id.replace('project-', '');
                    renderProject(projectName);
                }
            }, 50);
        });

        // Î™®Î∞îÏùº/Îç∞Ïä§ÌÅ¨ÌÜ± Ìò∏Ìôò Ïª®ÌÖçÏä§Ìä∏ Î©îÎâ¥ ÏãúÏä§ÌÖú
        let touchTimer = null;
        let touchTarget = null;
        let touchStartTime = 0;
        
        // ÌîÑÎ°úÏ†ùÌä∏ Î¶¨Ïä§Ìä∏ Ïª®ÌÖçÏä§Ìä∏ Î©îÎâ¥
        function addContextMenuListeners(element, contextType) {
            // Îç∞Ïä§ÌÅ¨ÌÜ± Ïö∞ÌÅ¥Î¶≠
            element.addEventListener('contextmenu', (e) => {
                e.preventDefault();
                handleContextMenu(e, contextType);
            });
            
            // Î™®Î∞îÏùº Í∏∏Í≤å ÎàÑÎ•¥Í∏∞
            element.addEventListener('touchstart', (e) => {
                touchTarget = e.target;
                touchStartTime = Date.now();
                
                // Ï¶âÏãú ÎπÑÏ£ºÏñº ÌîºÎìúÎ∞± ÏãúÏûë
                const targetElement = e.target.closest('.item-button') || e.target.closest('li') || e.target;
                targetElement.classList.add('long-press-active');
                
                touchTimer = setTimeout(() => {
                    // 1.2Ï¥à ÌõÑ Ïª®ÌÖçÏä§Ìä∏ Î©îÎâ¥ ÌëúÏãú
                    if (touchTarget === e.target) {
                        // ÌñÖÌã± ÌîºÎìúÎ∞± (ÏßÄÏõêÌïòÎäî Í≤ΩÏö∞)
                        if (navigator.vibrate) {
                            navigator.vibrate(50);
                        }
                        targetElement.classList.remove('long-press-active');
                        
                        // ÌÑ∞Ïπò Ïù¥Î≤§Ìä∏Î•º ÏúÑÌïú Ï¢åÌëú Î≥ÄÌôò
                        const touch = e.touches[0] || e.changedTouches[0];
                        const touchEvent = {
                            clientX: touch ? touch.clientX : e.clientX,
                            clientY: touch ? touch.clientY : e.clientY,
                            target: e.target,
                            preventDefault: e.preventDefault.bind(e)
                        };
                        
                        handleContextMenu(touchEvent, contextType);
                    }
                }, 1200);
            });
            
            element.addEventListener('touchend', (e) => {
                // ÎπÑÏ£ºÏñº ÌîºÎìúÎ∞± Ï†úÍ±∞
                const targetElement = e.target.closest('.item-button') || e.target.closest('li') || e.target;
                targetElement.classList.remove('long-press-active');
                
                if (touchTimer) {
                    clearTimeout(touchTimer);
                    touchTimer = null;
                }
                
                // ÏßßÏùÄ ÌÑ∞ÏπòÎäî ÏùºÎ∞ò ÌÅ¥Î¶≠ÏúºÎ°ú Ï≤òÎ¶¨
                const touchDuration = Date.now() - touchStartTime;
                if (touchDuration < 1200 && touchTarget === e.target) {
                    // ÏùºÎ∞ò ÌÅ¥Î¶≠ ÎèôÏûë
                    if (contextType === 'project' && e.target.tagName === 'LI') {
                        const projectName = e.target.textContent;
                        renderProject(projectName);
                    }
                }
                
                touchTarget = null;
            });
            
            element.addEventListener('touchmove', (e) => {
                // ÌÑ∞ÏπòÍ∞Ä Ïù¥ÎèôÌïòÎ©¥ Í∏∏Í≤å ÎàÑÎ•¥Í∏∞ Ï∑®ÏÜå
                const targetElement = e.target.closest('.item-button') || e.target.closest('li') || e.target;
                targetElement.classList.remove('long-press-active');
                
                if (touchTimer) {
                    clearTimeout(touchTimer);
                    touchTimer = null;
                }
                touchTarget = null;
            });
        }
        
        function handleContextMenu(e, contextType) {
            e.preventDefault();
            
            if (contextType === 'project' && e.target.tagName === 'LI') {
                const projectName = e.target.id.replace('project-', '');
                showProjectContextMenu(e, projectName);
            } else if (contextType === 'bookmark') {
                const button = e.target.closest('.item-button.bookmark-button');
                if (button) {
                    const index = parseInt(button.dataset.index);
                    showContextMenu(e, 'bookmark', index);
                }
            } else if (contextType === 'clipboard') {
                const button = e.target.closest('.item-button.clipboard-button');
                const divider = e.target.closest('.divider');
                if (button) {
                    const index = parseInt(button.dataset.index);
                    showContextMenu(e, 'clipboard', index);
                } else if (divider) {
                    const index = parseInt(divider.dataset.index);
                    showContextMenu(e, 'divider', index);
                }
            }
        }
        
        // Ïª®ÌÖçÏä§Ìä∏ Î©îÎâ¥ Î¶¨Ïä§ÎÑà Îì±Î°ù
        addContextMenuListeners(projectList, 'project');
        addContextMenuListeners(bookmarkList, 'bookmark');
        addContextMenuListeners(clipboardList, 'clipboard');

        document.addEventListener('click', (e) => {
            if (!contextMenu.contains(e.target)) {
                contextMenu.style.display = 'none';
                activeItem = null;
            }
            if (!projectContextMenu.contains(e.target)) {
                projectContextMenu.style.display = 'none';
                activeProject = null;
            }
        });

        contextEdit.addEventListener('click', () => {
            if (activeItem) {
                const { type, index } = activeItem;
                const projectData = allProjectsData[currentProject];
                
                if (type === 'bookmark') {
                    const item = projectData.bookmarks[index];
                    const modal = document.getElementById('add-bookmark-modal');
                    document.querySelector('#add-bookmark-modal h2').textContent = 'Î∂ÅÎßàÌÅ¨ Ìé∏Ïßë';
                    document.getElementById('add-bookmark-name').value = item.name;
                    document.getElementById('add-bookmark-url').value = item.url;
                    modal.style.display = 'flex';
                    modal.dataset.editMode = 'true';
                    modal.dataset.editIndex = index;
                } else if (type === 'clipboard') {
                    const item = projectData.clipboard[index];
                    const modal = document.getElementById('add-clipboard-modal');
                    document.getElementById('clipboard-edit-title').textContent = 'ÌÅ¥Î¶ΩÎ≥¥Îìú Ìé∏Ïßë';
                    document.getElementById('add-clipboard-title').value = item.title || '';

                    // ÌÉÄÏûÖÏóê Îî∞Îùº UI ÏÑ§Ï†ï
                    const itemType = item.type || 'normal';
                    document.querySelector(`input[name="clipboard-type"][value="${itemType}"]`).checked = true;

                    if (itemType === 'checklist') {
                        // Ï≤¥ÌÅ¨Î¶¨Ïä§Ìä∏ Î™®Îìú
                        checklistItems = (item.items || []).map(it => ({
                            id: it.id,
                            text: it.text,
                            checked: it.checked || false,
                            detail: it.detail || ''
                        }));
                        renderChecklistItems();
                        normalModeContainer.style.display = 'none';
                        checklistModeContainer.style.display = 'flex';
                    } else {
                        // ÏùºÎ∞ò ÎòêÎäî ÌÖúÌîåÎ¶ø Î™®Îìú
                        document.getElementById('add-clipboard-content').value = item.textContent || item.text || '';
                        checklistItems = [];
                        renderChecklistItems();
                        normalModeContainer.style.display = 'flex';
                        checklistModeContainer.style.display = 'none';
                    }

                    modal.style.display = 'flex';
                    modal.dataset.editMode = 'true';
                    modal.dataset.editIndex = index;
                }
                contextMenu.style.display = 'none';
                activeItem = null;
            }
        });

        contextFavorite.addEventListener('click', () => {
            if (activeItem) {
                const { type, index } = activeItem;
                const projectData = allProjectsData[currentProject];
                
                if (type === 'bookmark') {
                    projectData.bookmarks[index].favorite = !projectData.bookmarks[index].favorite;
                } else if (type === 'clipboard') {
                    projectData.clipboard[index].favorite = !projectData.clipboard[index].favorite;
                }
                
                renderProject(currentProject);
                
                // TODAY ÌîÑÎ°úÏ†ùÌä∏Í∞Ä ÌòÑÏû¨ ÌôúÏÑ±ÌôîÎêòÏñ¥ ÏûàÎã§Î©¥ ÏûêÎèô ÏóÖÎç∞Ïù¥Ìä∏
                // ÎòêÎäî Îã§Î•∏ ÌîÑÎ°úÏ†ùÌä∏ÏóêÏÑú Ï¶êÍ≤®Ï∞æÍ∏∞Î•º Î≥ÄÍ≤ΩÌñàÎã§Î©¥ TODAYÎèÑ ÏóÖÎç∞Ïù¥Ìä∏ ÌïÑÏöîÏãú Î∞òÏòÅ
                if (currentProject !== 'TODAY') {
                    // ÌòÑÏû¨ ÌîÑÎ°úÏ†ùÌä∏Í∞Ä TODAYÍ∞Ä ÏïÑÎãàÎùºÎ©¥, ÎÇòÏ§ëÏóê TODAY Ï†ëÏÜçÏãú ÏµúÏã† Ï¶êÍ≤®Ï∞æÍ∏∞Í∞Ä Î∞òÏòÅÎê®
                } else {
                    // ÌòÑÏû¨ TODAYÎùºÎ©¥ Ï¶âÏãú ÏóÖÎç∞Ïù¥Ìä∏ (Ïù¥ÎØ∏ renderProjectÏóêÏÑú Ï≤òÎ¶¨Îê®)
                }
                
                contextMenu.style.display = 'none';
                activeItem = null;
                saveToFirebase();
            }
        });

        contextColor.addEventListener('click', () => {
            if (activeItem) {
                colorChangeItem = activeItem;
                const colorPaletteModal = document.getElementById('color-palette-modal');
                colorPaletteModal.style.display = 'flex';
                
                const { type, index } = activeItem;
                const projectData = allProjectsData[currentProject];
                let currentColor = '';
                if (type === 'bookmark') {
                    currentColor = projectData.bookmarks[index].color || '#f8f9fa';
                } else if (type === 'clipboard') {
                    currentColor = projectData.clipboard[index].color || '#f8f9fa';
                }
                
                document.querySelectorAll('.color-option').forEach(option => {
                    option.classList.remove('selected');
                    if (option.dataset.color === currentColor) {
                        option.classList.add('selected');
                    }
                });
                
                contextMenu.style.display = 'none';
                activeItem = null;
            }
        });

        // Î≤ÑÌäº Î≥µÏÇ¨ Ïù¥Î≤§Ìä∏
        contextCopyButton.addEventListener('click', () => {
            if (activeItem && activeItem.type === 'bookmark') {
                const bookmark = allProjectsData[currentProject].bookmarks[activeItem.index];
                if (bookmark && bookmark.type !== 'divider') {
                    // Î∂ÅÎßàÌÅ¨ Îç∞Ïù¥ÌÑ∞ Î≥µÏÇ¨
                    copiedBookmark = {
                        name: bookmark.name,
                        url: bookmark.url,
                        color: bookmark.color || '#f8f9fa',
                        favorite: bookmark.favorite || false
                    };
                    showSaveStatus('success', 'Î∂ÅÎßàÌÅ¨ Î≥µÏÇ¨ ÏôÑÎ£å! Î∂ôÏó¨ÎÑ£Í∏∞ Î©îÎâ¥Î•º ÏÇ¨Ïö©ÌïòÏÑ∏Ïöî.');
                }
                contextMenu.style.display = 'none';
                activeItem = null;
            } else if (activeItem && activeItem.type === 'clipboard') {
                const clipboardItem = allProjectsData[currentProject].clipboard[activeItem.index];
                if (clipboardItem && clipboardItem.type !== 'divider') {
                    // ÌÅ¥Î¶ΩÎ≥¥Îìú Ìï≠Î™© Î≥µÏÇ¨
                    copiedClipboard = {
                        title: clipboardItem.title || '',
                        text: clipboardItem.text || '',
                        color: clipboardItem.color || '#f8f9fa',
                        favorite: clipboardItem.favorite || false,
                        summary: clipboardItem.summary || ''
                    };
                    showSaveStatus('success', 'ÌÅ¥Î¶ΩÎ≥¥Îìú Ìï≠Î™© Î≥µÏÇ¨ ÏôÑÎ£å! Î∂ôÏó¨ÎÑ£Í∏∞ Î©îÎâ¥Î•º ÏÇ¨Ïö©ÌïòÏÑ∏Ïöî.');
                }
                contextMenu.style.display = 'none';
                activeItem = null;
            }
        });

        contextDelete.addEventListener('click', () => {
            if (activeItem) {
                const { type, index } = activeItem;
                if (type === 'bookmark') {
                    allProjectsData[currentProject].bookmarks.splice(index, 1);
                } else if (type === 'clipboard') {
                    allProjectsData[currentProject].clipboard.splice(index, 1);
                } else if (type === 'divider') {
                    // Íµ¨Î∂ÑÏÑ†Ïùò Í≤ΩÏö∞ Ïñ¥Îäê Î™©Î°ùÏóêÏÑú Ïò® Í≤ÉÏù∏ÏßÄ ÌôïÏù∏
                    const dividerElement = document.querySelector(`[data-index="${index}"][data-type="clipboard"], [data-index="${index}"][data-type="bookmark"]`);
                    if (dividerElement) {
                        const dividerType = dividerElement.dataset.type;
                        if (dividerType === 'bookmark') {
                            allProjectsData[currentProject].bookmarks.splice(index, 1);
                        } else {
                            allProjectsData[currentProject].clipboard.splice(index, 1);
                        }
                    }
                }
                renderProject(currentProject);
                contextMenu.style.display = 'none';
                activeItem = null;
                saveToFirebase();
            }
        });

        contextCancel.addEventListener('click', () => {
            contextMenu.style.display = 'none';
            activeItem = null;
        });

        // Î∂ÅÎßàÌÅ¨ Î¶¨Ïä§Ìä∏ Ïª®ÌÖçÏä§Ìä∏ Î©îÎâ¥ Ïù¥Î≤§Ìä∏
        listContextPaste.addEventListener('click', () => {
            if (copiedBookmark) {
                // Î≥µÏÇ¨Îêú Î∂ÅÎßàÌÅ¨Î•º ÌòÑÏû¨ ÌîÑÎ°úÏ†ùÌä∏Ïùò Î∂ÅÎßàÌÅ¨ Î¶¨Ïä§Ìä∏Ïóê Ï∂îÍ∞Ä
                const newBookmark = {
                    name: copiedBookmark.name,
                    url: copiedBookmark.url,
                    color: copiedBookmark.color,
                    favorite: copiedBookmark.favorite
                };
                allProjectsData[currentProject].bookmarks.push(newBookmark);
                renderProject(currentProject);
                bookmarkListContextMenu.style.display = 'none';
                showSaveStatus('success', 'Î∂ÅÎßàÌÅ¨ Î∂ôÏó¨ÎÑ£Í∏∞ ÏôÑÎ£å!');
                saveToFirebase();
            }
        });

        listContextCancel.addEventListener('click', () => {
            bookmarkListContextMenu.style.display = 'none';
        });

        // ÌÅ¥Î¶ΩÎ≥¥Îìú Î¶¨Ïä§Ìä∏ Ïª®ÌÖçÏä§Ìä∏ Î©îÎâ¥ Ïù¥Î≤§Ìä∏
        clipboardListContextPaste.addEventListener('click', () => {
            if (copiedClipboard) {
                // Î≥µÏÇ¨Îêú ÌÅ¥Î¶ΩÎ≥¥Îìú Ìï≠Î™©ÏùÑ ÌòÑÏû¨ ÌîÑÎ°úÏ†ùÌä∏Ïùò ÌÅ¥Î¶ΩÎ≥¥Îìú Î¶¨Ïä§Ìä∏Ïóê Ï∂îÍ∞Ä
                const newClipboardItem = {
                    title: copiedClipboard.title,
                    text: copiedClipboard.text,
                    color: copiedClipboard.color,
                    favorite: copiedClipboard.favorite,
                    createdAt: new Date().toISOString()
                };
                allProjectsData[currentProject].clipboard.push(newClipboardItem);
                renderProject(currentProject);
                clipboardListContextMenu.style.display = 'none';
                showSaveStatus('success', 'ÌÅ¥Î¶ΩÎ≥¥Îìú Ìï≠Î™© Î∂ôÏó¨ÎÑ£Í∏∞ ÏôÑÎ£å!');
                saveToFirebase();
            }
        });

        clipboardListContextCancel.addEventListener('click', () => {
            clipboardListContextMenu.style.display = 'none';
        });

        // Î∂ÅÎßàÌÅ¨ Î¶¨Ïä§Ìä∏ Ïö∞ÌÅ¥Î¶≠ Ïù¥Î≤§Ìä∏
        bookmarkList.addEventListener('contextmenu', (e) => {
            e.preventDefault();

            // ÌÅ¥Î¶≠Îêú ÏöîÏÜåÍ∞Ä Î∂ÅÎßàÌÅ¨ Î≤ÑÌäºÏù¥ ÏïÑÎãå Í≤ΩÏö∞Îßå Ï≤òÎ¶¨
            if (!e.target.closest('.item-button')) {
                // Î∂ôÏó¨ÎÑ£Í∏∞ Î©îÎâ¥ ÌôúÏÑ±Ìôî Ïó¨Î∂Ä Í≤∞Ï†ï
                listContextPaste.style.opacity = copiedBookmark ? '1' : '0.5';
                listContextPaste.style.pointerEvents = copiedBookmark ? 'auto' : 'none';

                bookmarkListContextMenu.style.display = 'block';

                // ÌôîÎ©¥ Í≤ΩÍ≥ÑÎ•º Í≥†Î†§Ìïú ÏúÑÏπò Í≥ÑÏÇ∞
                const menuWidth = 150;
                const menuHeight = 100;
                const screenWidth = window.innerWidth;
                const screenHeight = window.innerHeight;

                let x = e.clientX;
                let y = e.clientY;

                if (x + menuWidth > screenWidth) {
                    x = screenWidth - menuWidth - 10;
                }

                if (y + menuHeight > screenHeight) {
                    y = screenHeight - menuHeight - 10;
                }

                if (x < 10) x = 10;
                if (y < 10) y = 10;

                bookmarkListContextMenu.style.left = x + 'px';
                bookmarkListContextMenu.style.top = y + 'px';
            }
        });

        // ÌÅ¥Î¶ΩÎ≥¥Îìú Î¶¨Ïä§Ìä∏ Ïö∞ÌÅ¥Î¶≠ Ïù¥Î≤§Ìä∏
        clipboardList.addEventListener('contextmenu', (e) => {
            e.preventDefault();

            // ÌÅ¥Î¶≠Îêú ÏöîÏÜåÍ∞Ä ÌÅ¥Î¶ΩÎ≥¥Îìú Î≤ÑÌäºÏù¥ ÏïÑÎãå Í≤ΩÏö∞Îßå Ï≤òÎ¶¨
            if (!e.target.closest('.item-button')) {
                // Î∂ôÏó¨ÎÑ£Í∏∞ Î©îÎâ¥ ÌôúÏÑ±Ìôî Ïó¨Î∂Ä Í≤∞Ï†ï
                clipboardListContextPaste.style.opacity = copiedClipboard ? '1' : '0.5';
                clipboardListContextPaste.style.pointerEvents = copiedClipboard ? 'auto' : 'none';

                clipboardListContextMenu.style.display = 'block';

                // ÌôîÎ©¥ Í≤ΩÍ≥ÑÎ•º Í≥†Î†§Ìïú ÏúÑÏπò Í≥ÑÏÇ∞
                const menuWidth = 150;
                const menuHeight = 100;
                const screenWidth = window.innerWidth;
                const screenHeight = window.innerHeight;

                let x = e.clientX;
                let y = e.clientY;

                if (x + menuWidth > screenWidth) {
                    x = screenWidth - menuWidth - 10;
                }

                if (y + menuHeight > screenHeight) {
                    y = screenHeight - menuHeight - 10;
                }

                if (x < 10) x = 10;
                if (y < 10) y = 10;

                clipboardListContextMenu.style.left = x + 'px';
                clipboardListContextMenu.style.top = y + 'px';
            }
        });

        // Î∂ÅÎßàÌÅ¨ Î¶¨Ïä§Ìä∏ ÌÅ¥Î¶≠ÏúºÎ°ú Ïª®ÌÖçÏä§Ìä∏ Î©îÎâ¥ Îã´Í∏∞
        document.addEventListener('click', (e) => {
            if (!e.target.closest('#bookmark-list-context-menu')) {
                bookmarkListContextMenu.style.display = 'none';
            }
            if (!e.target.closest('#clipboard-list-context-menu')) {
                clipboardListContextMenu.style.display = 'none';
            }
        });

        addBookmarkBtn.addEventListener('click', addBookmark);
        addClipboardBtn.addEventListener('click', addClipboard);
        addDividerBtn.addEventListener('click', addDivider);
        
        // Ïó∞ÏäµÏû• ÌÉ≠ ÌÅ¥Î¶≠ Ïù¥Î≤§Ìä∏
        document.querySelectorAll('.practice-tab').forEach(tab => {
            tab.addEventListener('click', (e) => {
                e.preventDefault();
                const tabNumber = parseInt(e.target.dataset.tab);
                if (tabNumber !== currentPracticeTab) {
                    switchPracticeTab(tabNumber);
                }
            });
        });
        
        const addProjectBtn = document.getElementById('add-project-btn');
        addProjectBtn.addEventListener('click', addProject);

        const addBookmarkModal = document.getElementById('add-bookmark-modal');
        const addBookmarkSave = document.getElementById('add-bookmark-save');
        const addBookmarkCancel = document.getElementById('add-bookmark-cancel');
        const addBookmarkClose = document.querySelector('.add-bookmark-close');
        
        addBookmarkSave.addEventListener('click', () => {
            const name = document.getElementById('add-bookmark-name').value.trim();
            const url = document.getElementById('add-bookmark-url').value.trim();
            
            if (!name || !url) {
                alert('Ïù¥Î¶ÑÍ≥º URLÏùÑ Î™®Îëê ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî.');
                return;
            }
            
            if (addBookmarkModal.dataset.editMode === 'true') {
                const index = parseInt(addBookmarkModal.dataset.editIndex);
                allProjectsData[currentProject].bookmarks[index].name = name;
                allProjectsData[currentProject].bookmarks[index].url = url;
            } else {
                allProjectsData[currentProject].bookmarks.push({ 
                    name: name, 
                    url: url, 
                    color: '#f8f9fa',
                    favorite: false
                });
            }
            renderProject(currentProject);
            addBookmarkModal.style.display = 'none';
            saveToFirebase();
        });
        
        addBookmarkCancel.addEventListener('click', () => {
            addBookmarkModal.style.display = 'none';
        });
        
        addBookmarkClose.addEventListener('click', () => {
            addBookmarkModal.style.display = 'none';
        });

        const addClipboardModal = document.getElementById('add-clipboard-modal');
        const addClipboardSave = document.getElementById('add-clipboard-save');
        const addClipboardCancel = document.getElementById('add-clipboard-cancel');
        const addClipboardClose = document.querySelector('.add-clipboard-close');
        const addClipboardFileInput = document.getElementById('add-clipboard-file');
        const fileInfoDiv = document.getElementById('file-info');

        // Ï≤¥ÌÅ¨Î¶¨Ïä§Ìä∏ Í¥ÄÎ†® ÏöîÏÜå
        let checklistItems = [];
        const normalModeContainer = document.getElementById('normal-mode-container');
        const checklistModeContainer = document.getElementById('checklist-mode-container');
        const checklistItemInput = document.getElementById('checklist-item-input');
        const checklistAddBtn = document.getElementById('checklist-add-btn');
        const checklistItemsList = document.getElementById('checklist-items-list');

        // ÌÅ¥Î¶ΩÎ≥¥Îìú ÌÉÄÏûÖ Î≥ÄÍ≤Ω Ïù¥Î≤§Ìä∏
        document.querySelectorAll('input[name="clipboard-type"]').forEach(radio => {
            radio.addEventListener('change', (e) => {
                const type = e.target.value;
                if (type === 'checklist') {
                    normalModeContainer.style.display = 'none';
                    checklistModeContainer.style.display = 'flex';
                    checklistItems = [];
                    renderChecklistItems();
                } else {
                    normalModeContainer.style.display = 'flex';
                    checklistModeContainer.style.display = 'none';
                }
            });
        });

        // Ï≤¥ÌÅ¨Î¶¨Ïä§Ìä∏ Ìï≠Î™© Î†åÎçîÎßÅ Ìï®Ïàò
        function renderChecklistItems() {
            checklistItemsList.innerHTML = '';
            checklistItems.forEach((item, index) => {
                const li = document.createElement('li');
                li.style.cssText = 'padding: 8px; margin-bottom: 4px; background-color: white; border-radius: 3px; display: flex; align-items: center; border: 1px solid #ddd; gap: 8px;';
                li.dataset.index = index;

                const checkbox = document.createElement('input');
                checkbox.type = 'checkbox';
                checkbox.checked = item.checked || false;
                checkbox.style.cssText = 'width: 18px; height: 18px; cursor: pointer; flex-shrink: 0;';
                checkbox.dataset.index = index;

                const textContainer = document.createElement('div');
                textContainer.style.cssText = 'flex: 1; display: flex; align-items: center; cursor: pointer;';

                const textSpan = document.createElement('span');
                textSpan.textContent = item.text;
                textSpan.style.cssText = 'flex: 1; ' + (item.checked ? 'text-decoration: line-through; color: #999;' : '');

                const detailBtn = document.createElement('button');
                detailBtn.type = 'button';
                detailBtn.textContent = 'üìÑ';
                detailBtn.dataset.index = index;
                detailBtn.className = 'checklist-detail-btn';
                detailBtn.style.cssText = 'background-color: transparent; border: none; cursor: pointer; font-size: 18px; padding: 0; flex-shrink: 0;';

                li.appendChild(checkbox);
                li.appendChild(textContainer);
                textContainer.appendChild(textSpan);
                li.appendChild(detailBtn);
                checklistItemsList.appendChild(li);

                // Ïù∏ÎùºÏù∏ Ìé∏Ïßë Ìï®Ïàò
                function enableInlineEdit() {
                    if (textContainer.querySelector('input')) return; // Ïù¥ÎØ∏ Ìé∏Ïßë Ï§ëÏù¥Î©¥ Î¨¥Ïãú

                    const currentText = checklistItems[index].text;
                    textSpan.style.display = 'none';

                    const input = document.createElement('input');
                    input.type = 'text';
                    input.value = currentText;
                    input.style.cssText = 'flex: 1; padding: 6px; border: 2px solid #5a4a7a; border-radius: 3px; font-size: 14px; font-family: inherit; box-sizing: border-box;';
                    input.dataset.index = index;

                    function saveEdit() {
                        const newText = input.value.trim();
                        if (newText && newText !== currentText) {
                            checklistItems[index].text = newText;
                        }
                        input.remove();
                        textSpan.style.display = '';
                        renderChecklistItems();
                    }

                    function cancelEdit() {
                        input.remove();
                        textSpan.style.display = '';
                    }

                    textContainer.insertBefore(input, textSpan);
                    input.focus();
                    input.select();

                    // EscapeÎ°ú Ï∑®ÏÜå
                    input.addEventListener('keydown', (e) => {
                        if (e.key === 'Escape') {
                            e.preventDefault();
                            cancelEdit();
                        }
                    });

                    // Blur (Ïô∏Î∂Ä ÌÅ¥Î¶≠)Î°ú Ï†ÄÏû•
                    input.addEventListener('blur', () => {
                        saveEdit();
                    });
                }

                // ÌÖçÏä§Ìä∏ ÎçîÎ∏îÌÅ¥Î¶≠ Ïãú Ìé∏Ïßë Î™®Îìú
                textContainer.addEventListener('dblclick', (e) => {
                    if (!e.target.closest('input')) {
                        enableInlineEdit();
                    }
                });

                // Ï≤¥ÌÅ¨Î∞ïÏä§ Î≥ÄÍ≤Ω Ïù¥Î≤§Ìä∏
                checkbox.addEventListener('change', (e) => {
                    checklistItems[index].checked = e.target.checked;

                    if (e.target.checked) {
                        // Ï≤¥ÌÅ¨ Ïãú: Ï∑®ÏÜåÏÑ† ÌëúÏãú + Î¶¨Ïä§Ìä∏ Îß® ÏïÑÎûòÎ°ú Ïù¥Îèô
                        const checkedItem = checklistItems.splice(index, 1)[0];
                        checklistItems.push(checkedItem);
                        renderChecklistItems();
                    } else {
                        // Ïñ∏Ï≤¥ÌÅ¨ Ïãú: Ï∑®ÏÜåÏÑ† Ï†úÍ±∞ (ÏúÑÏπòÎäî Ïú†ÏßÄ)
                        textSpan.style.textDecoration = 'none';
                        textSpan.style.color = '#222';
                    }
                });

                // ÏÉÅÏÑ∏ÎÇ¥Ïö© Î≤ÑÌäº Ïù¥Î≤§Ìä∏
                detailBtn.addEventListener('click', () => {
                    openChecklistDetailModal(index);
                });

                // Ïö∞ÌÅ¥Î¶≠ Ïù¥Î≤§Ìä∏
                li.addEventListener('contextmenu', (e) => {
                    e.preventDefault();
                    const contextMenu = document.getElementById('checklist-item-context-menu');
                    contextMenu.style.display = 'block';
                    contextMenu.style.position = 'fixed';
                    contextMenu.style.left = e.clientX + 'px';
                    contextMenu.style.top = e.clientY + 'px';
                    contextMenu.dataset.itemIndex = index;
                });
            });
        }

        // Ï≤¥ÌÅ¨Î¶¨Ïä§Ìä∏ Ìï≠Î™© Ï∂îÍ∞Ä
        checklistAddBtn.addEventListener('click', () => {
            const text = checklistItemInput.value.trim();
            if (!text) {
                alert('Ìï≠Î™©ÏùÑ ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî.');
                return;
            }
            checklistItems.push({ id: Date.now(), text: text, checked: false });
            checklistItemInput.value = '';
            renderChecklistItems();
        });

        // ÏóîÌÑ∞ ÌÇ§Î°úÎèÑ Ìï≠Î™© Ï∂îÍ∞Ä
        checklistItemInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                checklistAddBtn.click();
            }
        });

        // ÌååÏùº ÏÑ†ÌÉù Ïù¥Î≤§Ìä∏ Ï≤òÎ¶¨
        let selectedFileData = null;

        addClipboardFileInput.addEventListener('change', (e) => {
            const file = e.target.files[0];
            selectedFileData = null;
            fileInfoDiv.textContent = '';

            if (file) {
                const maxSize = 1024 * 1024; // 1MB

                if (file.size > maxSize) {
                    fileInfoDiv.textContent = '‚ùå ÌååÏùºÏù¥ ÎÑàÎ¨¥ ÌÅΩÎãàÎã§. 1MB ÎØ∏ÎßåÏùò ÌååÏùºÏùÑ ÏÑ†ÌÉùÌï¥Ï£ºÏÑ∏Ïöî.';
                    fileInfoDiv.style.color = '#d32f2f';
                    e.target.value = '';
                    return;
                }

                const reader = new FileReader();
                reader.onload = (event) => {
                    selectedFileData = {
                        name: file.name,
                        type: file.type,
                        size: file.size,
                        data: event.target.result
                    };
                    fileInfoDiv.textContent = `‚úì ${file.name} (${(file.size / 1024).toFixed(1)}KB)`;
                    fileInfoDiv.style.color = '#4caf50';
                };
                reader.readAsArrayBuffer(file);
            }
        });

        addClipboardSave.addEventListener('click', () => {
            const title = document.getElementById('add-clipboard-title').value.trim();
            const selectedType = document.querySelector('input[name="clipboard-type"]:checked').value;
            const content = document.getElementById('add-clipboard-content').value.trim();

            // Ï†úÎ™© ÌôïÏù∏
            if (!title) {
                alert('Ï†úÎ™©ÏùÑ ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî.');
                return;
            }

            // Ï≤¥ÌÅ¨Î¶¨Ïä§Ìä∏ Î™®ÎìúÏùº ÎïåÎäî Ìï≠Î™© ÌôïÏù∏
            if (selectedType === 'checklist') {
                if (checklistItems.length === 0) {
                    alert('Ï≤¥ÌÅ¨Î¶¨Ïä§Ìä∏Ïóê Ìï≠Î™©ÏùÑ Ï∂îÍ∞ÄÌï¥Ï£ºÏÑ∏Ïöî.');
                    return;
                }
            } else if (!selectedFileData && !content) {
                // ÏùºÎ∞ò Î™®ÎìúÏùº ÎïåÎäî ÌååÏùº ÎòêÎäî ÌÖçÏä§Ìä∏ ÌôïÏù∏
                alert('ÌååÏùºÏùÑ ÏÑ†ÌÉùÌïòÍ±∞ÎÇò ÎÇ¥Ïö©ÏùÑ ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî.');
                return;
            }

            // clipboard Î∞∞Ïó¥Ïù¥ Ï°¥Ïû¨ÌïòÎäîÏßÄ ÌôïÏù∏
            if (!allProjectsData[currentProject].clipboard) {
                allProjectsData[currentProject].clipboard = [];
            }

            if (addClipboardModal.dataset.editMode === 'true') {
                const index = parseInt(addClipboardModal.dataset.editIndex);

                allProjectsData[currentProject].clipboard[index].title = title;
                allProjectsData[currentProject].clipboard[index].type = selectedType;

                if (selectedType === 'checklist') {
                    // Ï≤¥ÌÅ¨Î¶¨Ïä§Ìä∏ Î™®Îìú
                    allProjectsData[currentProject].clipboard[index].items = checklistItems.map(item => ({
                        id: item.id,
                        text: item.text,
                        checked: item.checked || false,
                        detail: item.detail || ''
                    }));
                } else if (selectedFileData) {
                    // ÌååÏùºÏù¥ ÏÑ†ÌÉùÎêú Í≤ΩÏö∞
                    const binaryString = String.fromCharCode.apply(null, new Uint8Array(selectedFileData.data));
                    const base64 = btoa(binaryString);
                    allProjectsData[currentProject].clipboard[index].fileData = base64;
                    allProjectsData[currentProject].clipboard[index].textContent = content; // ÌÖçÏä§Ìä∏Îäî Î≥ÑÎèÑÎ°ú Ï†ÄÏû•
                    allProjectsData[currentProject].clipboard[index].isFile = true;
                    allProjectsData[currentProject].clipboard[index].fileInfo = {
                        name: selectedFileData.name,
                        type: selectedFileData.type,
                        size: selectedFileData.size
                    };
                } else if (content) {
                    // ÌÖçÏä§Ìä∏Îßå ÏûÖÎ†•Îêú Í≤ΩÏö∞
                    allProjectsData[currentProject].clipboard[index].textContent = content;
                    allProjectsData[currentProject].clipboard[index].isFile = false;
                    delete allProjectsData[currentProject].clipboard[index].fileData;
                    delete allProjectsData[currentProject].clipboard[index].fileInfo;
                }
            } else {
                const clipboardItem = {
                    title: title,
                    color: '#f8f9fa',
                    favorite: false,
                    type: selectedType
                };

                if (selectedType === 'checklist') {
                    // Ï≤¥ÌÅ¨Î¶¨Ïä§Ìä∏ Î™®Îìú
                    clipboardItem.items = checklistItems.map(item => ({
                        id: item.id,
                        text: item.text,
                        checked: item.checked || false,
                        detail: item.detail || ''
                    }));
                } else if (selectedFileData) {
                    // ÌååÏùºÏù¥ ÏÑ†ÌÉùÎêú Í≤ΩÏö∞
                    const binaryString = String.fromCharCode.apply(null, new Uint8Array(selectedFileData.data));
                    const base64 = btoa(binaryString);
                    clipboardItem.fileData = base64;
                    clipboardItem.textContent = content;
                    clipboardItem.isFile = true;
                    clipboardItem.fileInfo = {
                        name: selectedFileData.name,
                        type: selectedFileData.type,
                        size: selectedFileData.size
                    };
                } else {
                    // ÏùºÎ∞ò ÌÖçÏä§Ìä∏ Î™®Îìú
                    clipboardItem.textContent = content;
                    clipboardItem.isFile = false;
                }

                allProjectsData[currentProject].clipboard.push(clipboardItem);
            }

            renderProject(currentProject);
            addClipboardModal.style.display = 'none';
            // Ï≤¥ÌÅ¨Î¶¨Ïä§Ìä∏ Ï¥àÍ∏∞Ìôî
            checklistItems = [];
            renderChecklistItems();
            saveToFirebase();
        });
        
        addClipboardCancel.addEventListener('click', () => {
            addClipboardModal.style.display = 'none';
            // Î™®Îã¨ Îã´ÏùÑ Îïå Ï¥àÍ∏∞Ìôî
            checklistItems = [];
            renderChecklistItems();
        });

        addClipboardClose.addEventListener('click', () => {
            addClipboardModal.style.display = 'none';
            // Î™®Îã¨ Îã´ÏùÑ Îïå Ï¥àÍ∏∞Ìôî
            checklistItems = [];
            renderChecklistItems();
        });

        // Ï≤¥ÌÅ¨Î¶¨Ïä§Ìä∏ Ìï≠Î™© Ïª®ÌÖçÏä§Ìä∏ Î©îÎâ¥ Ïù¥Î≤§Ìä∏
        const checklistContextMenu = document.getElementById('checklist-item-context-menu');
        const checklistContextEdit = document.getElementById('checklist-item-context-edit');
        const checklistContextDelete = document.getElementById('checklist-item-context-delete');
        const checklistContextCancel = document.getElementById('checklist-item-context-cancel');

        checklistContextEdit.addEventListener('click', () => {
            const itemIndex = parseInt(checklistContextMenu.dataset.itemIndex);
            checklistContextMenu.style.display = 'none';

            // ÌÅ¥Î¶≠Ìïú Ìï≠Î™©ÏùÑ Ï∞æÏïÑÏÑú Ïù∏ÎùºÏù∏ Ìé∏Ïßë ÌôúÏÑ±Ìôî
            const list = document.getElementById('checklist-items-list');
            const liElement = list.querySelector(`li[data-index="${itemIndex}"]`);
            if (liElement) {
                const textContainer = liElement.querySelector('div');
                if (textContainer) {
                    // textContainerÏóê ÎçîÎ∏îÌÅ¥Î¶≠ Ïù¥Î≤§Ìä∏ Î∞úÏÉù
                    textContainer.dispatchEvent(new MouseEvent('dblclick', { bubbles: true }));
                }
            }
        });

        checklistContextDelete.addEventListener('click', () => {
            const itemIndex = parseInt(checklistContextMenu.dataset.itemIndex);
            checklistItems.splice(itemIndex, 1);
            renderChecklistItems();
            checklistContextMenu.style.display = 'none';
        });

        checklistContextCancel.addEventListener('click', () => {
            checklistContextMenu.style.display = 'none';
        });

        // Îã§Î•∏ Í≥≥ ÌÅ¥Î¶≠ Ïãú Ïª®ÌÖçÏä§Ìä∏ Î©îÎâ¥ Îã´Í∏∞
        document.addEventListener('click', (e) => {
            if (!e.target.closest('#checklist-item-context-menu') &&
                !e.target.closest('#checklist-items-list li')) {
                checklistContextMenu.style.display = 'none';
            }
        });

        // ÏÉÅÏÑ∏ÎÇ¥Ïö© Ï≤¥ÌÅ¨Î¶¨Ïä§Ìä∏ Ìï≠Î™© Ïª®ÌÖçÏä§Ìä∏ Î©îÎâ¥ Ïù¥Î≤§Ìä∏
        const detailChecklistContextMenu = document.getElementById('checklist-detail-item-context-menu');
        const detailChecklistContextDelete = document.getElementById('checklist-detail-item-context-delete');
        const detailChecklistContextCancel = document.getElementById('checklist-detail-item-context-cancel');

        detailChecklistContextDelete.addEventListener('click', () => {
            const itemIndex = parseInt(detailChecklistContextMenu.dataset.itemIndex);
            detailChecklistItems.splice(itemIndex, 1);

            // ÌòÑÏû¨ ÌëúÏãúÎêú Î™®ÎìúÏóê Îî∞Îùº Îã§Î•∏ Î†åÎçîÎßÅ Ìï®Ïàò Ìò∏Ï∂ú
            const editArea = document.getElementById('checklist-detail-edit-area');
            if (editArea.style.display === 'flex') {
                // Edit Î™®Îìú
                renderDetailChecklistItems();
            } else {
                // View Î™®Îìú
                renderDetailChecklistViewItems();

                // View Î™®ÎìúÏóêÏÑú ÏûêÎèô Ï†ÄÏû•
                if (currentEditingChecklistItem && currentEditingChecklistItem.liElement) {
                    currentEditingChecklistItem.liElement.dataset.detail = JSON.stringify(detailChecklistItems);
                    const clipboardIndex = currentEditingChecklistItem.clipboardIndex;
                    const itemIndex = currentEditingChecklistItem.itemIndex;

                    if (currentProject && allProjectsData && allProjectsData[currentProject]) {
                        const projectData = allProjectsData[currentProject];
                        const clipboardArray = projectData.clipboard || projectData.clipboards;

                        if (clipboardArray && clipboardArray[clipboardIndex]) {
                            const clipboard = clipboardArray[clipboardIndex];
                            if (clipboard.items && clipboard.items[itemIndex]) {
                                clipboard.items[itemIndex].detail = JSON.parse(JSON.stringify(detailChecklistItems));
                            }
                        }
                    }

                    saveToFirebase();
                }
            }

            detailChecklistContextMenu.style.display = 'none';
        });

        detailChecklistContextCancel.addEventListener('click', () => {
            detailChecklistContextMenu.style.display = 'none';
        });

        // ÏÉÅÏÑ∏ÎÇ¥Ïö© Ïª®ÌÖçÏä§Ìä∏ Î©îÎâ¥ - Îã§Î•∏ Í≥≥ ÌÅ¥Î¶≠ Ïãú Îã´Í∏∞
        document.addEventListener('click', (e) => {
            if (!e.target.closest('#checklist-detail-item-context-menu') &&
                !e.target.closest('#checklist-detail-items-list li') &&
                !e.target.closest('#checklist-detail-view-items li')) {
                detailChecklistContextMenu.style.display = 'none';
            }
        });

        // Ï≤¥ÌÅ¨Î¶¨Ïä§Ìä∏ ÏÉÅÏÑ∏ÎÇ¥Ïö© Î™®Îã¨ Î≤ÑÌäº Ïù¥Î≤§Ìä∏
        const checklistDetailModal = document.getElementById('checklist-detail-modal');
        const checklistDetailSave = document.getElementById('checklist-detail-save');
        const checklistDetailCancel = document.getElementById('checklist-detail-cancel');
        const checklistDetailClose = document.querySelector('.checklist-detail-close');

        checklistDetailSave.addEventListener('click', () => {
            if (currentDetailItemIndex !== null) {
                // Ï†ÄÏû•Îêú ÌÅ¥Î¶ΩÎ≥¥ÎìúÏùò Ï≤¥ÌÅ¨Î¶¨Ïä§Ìä∏Ïù∏ÏßÄ ÌôïÏù∏
                if (currentEditingChecklistItem && currentEditingChecklistItem.liElement) {
                    // li ÏöîÏÜåÏùò datasetÏóê ÏÉÅÏÑ∏ÎÇ¥Ïö© ÏóÖÎç∞Ïù¥Ìä∏
                    currentEditingChecklistItem.liElement.dataset.detail = JSON.stringify(detailChecklistItems);

                    // Ïã§Ï†ú Firebase Îç∞Ïù¥ÌÑ∞ÎèÑ ÏóÖÎç∞Ïù¥Ìä∏
                    const clipboardIndex = currentEditingChecklistItem.clipboardIndex;
                    const itemIndex = currentEditingChecklistItem.itemIndex;

                    if (currentProject && allProjectsData && allProjectsData[currentProject]) {
                        const projectData = allProjectsData[currentProject];
                        const clipboardArray = projectData.clipboard || projectData.clipboards;

                        if (clipboardArray && clipboardArray[clipboardIndex]) {
                            const clipboard = clipboardArray[clipboardIndex];

                            if (clipboard.items && clipboard.items[itemIndex]) {
                                // Firebase Îç∞Ïù¥ÌÑ∞Ïóê Î∞∞Ïó¥Î°ú Ï†ÄÏû•
                                clipboard.items[itemIndex].detail = JSON.parse(JSON.stringify(detailChecklistItems));
                            }
                        }
                    }

                    saveToFirebase();
                } else {
                    // Ï∂îÍ∞Ä Ï§ëÏù∏ Ï≤¥ÌÅ¨Î¶¨Ïä§Ìä∏
                    checklistItems[currentDetailItemIndex].detail = JSON.parse(JSON.stringify(detailChecklistItems));
                }

                currentDetailItemIndex = null;
                currentDetailClipboardIndex = null;
                currentEditingChecklistItem = null;
                detailChecklistItems = [];
                checklistDetailModal.style.display = 'none';
            }
        });

        checklistDetailCancel.addEventListener('click', () => {
            currentDetailItemIndex = null;
            currentDetailClipboardIndex = null;
            detailChecklistItems = [];
            checklistDetailModal.style.display = 'none';
        });

        checklistDetailClose.addEventListener('click', () => {
            currentDetailItemIndex = null;
            currentDetailClipboardIndex = null;
            detailChecklistItems = [];
            checklistDetailModal.style.display = 'none';
        });

        // View Î™®Îìú Î≤ÑÌäº Ïù¥Î≤§Ìä∏
        const checklistDetailViewSave = document.getElementById('checklist-detail-view-save');
        const checklistDetailViewClose = document.getElementById('checklist-detail-view-close');

        checklistDetailViewSave.addEventListener('click', () => {
            // View Î™®ÎìúÏóêÏÑú Ï†ÄÏû•
            if (currentEditingChecklistItem && currentEditingChecklistItem.liElement) {
                // li ÏöîÏÜåÏùò datasetÏóê ÏÉÅÏÑ∏ÎÇ¥Ïö© ÏóÖÎç∞Ïù¥Ìä∏
                currentEditingChecklistItem.liElement.dataset.detail = JSON.stringify(detailChecklistItems);

                // Ïã§Ï†ú Firebase Îç∞Ïù¥ÌÑ∞ÎèÑ ÏóÖÎç∞Ïù¥Ìä∏
                const clipboardIndex = currentEditingChecklistItem.clipboardIndex;
                const itemIndex = currentEditingChecklistItem.itemIndex;

                if (currentProject && allProjectsData && allProjectsData[currentProject]) {
                    const projectData = allProjectsData[currentProject];
                    const clipboardArray = projectData.clipboard || projectData.clipboards;

                    if (clipboardArray && clipboardArray[clipboardIndex]) {
                        const clipboard = clipboardArray[clipboardIndex];

                        if (clipboard.items && clipboard.items[itemIndex]) {
                            // Firebase Îç∞Ïù¥ÌÑ∞Ïóê Î∞∞Ïó¥Î°ú Ï†ÄÏû•
                            clipboard.items[itemIndex].detail = JSON.parse(JSON.stringify(detailChecklistItems));
                        }
                    }
                }

                saveToFirebase();
            }

            currentDetailItemIndex = null;
            currentDetailClipboardIndex = null;
            currentEditingChecklistItem = null;
            detailChecklistItems = [];
            checklistDetailModal.style.display = 'none';
        });

        checklistDetailViewClose.addEventListener('click', () => {
            // Î™®Îã¨ Îã´Í∏∞ (Î≥ÄÍ≤ΩÏÇ¨Ìï≠ ÌèêÍ∏∞)
            currentDetailItemIndex = null;
            currentDetailClipboardIndex = null;
            detailChecklistItems = [];
            checklistDetailModal.style.display = 'none';
        });

        // View Î™®Îìú Ìï≠Î™© Ï∂îÍ∞Ä Ïù¥Î≤§Ìä∏
        const checklistDetailViewAddItemBtn = document.getElementById('checklist-detail-view-add-item-btn');
        const checklistDetailViewItemInput = document.getElementById('checklist-detail-view-item-input');

        checklistDetailViewAddItemBtn.addEventListener('click', () => {
            const text = checklistDetailViewItemInput.value.trim();
            if (text) {
                detailChecklistItems.push({
                    id: Math.random().toString(36).substr(2, 9),
                    text: text,
                    checked: false
                });
                checklistDetailViewItemInput.value = '';
                renderDetailChecklistViewItems();

                // ÏûêÎèô Ï†ÄÏû• (Firebase)
                if (currentEditingChecklistItem && currentEditingChecklistItem.liElement) {
                    currentEditingChecklistItem.liElement.dataset.detail = JSON.stringify(detailChecklistItems);
                    const clipboardIndex = currentEditingChecklistItem.clipboardIndex;
                    const itemIndex = currentEditingChecklistItem.itemIndex;

                    if (currentProject && allProjectsData && allProjectsData[currentProject]) {
                        const projectData = allProjectsData[currentProject];
                        const clipboardArray = projectData.clipboard || projectData.clipboards;

                        if (clipboardArray && clipboardArray[clipboardIndex]) {
                            const clipboard = clipboardArray[clipboardIndex];
                            if (clipboard.items && clipboard.items[itemIndex]) {
                                clipboard.items[itemIndex].detail = JSON.parse(JSON.stringify(detailChecklistItems));
                            }
                        }
                    }

                    saveToFirebase();
                }

                // ÏûêÎèô Ïä§ÌÅ¨Î°§ (ÌïòÎã®ÏúºÎ°ú)
                setTimeout(() => {
                    const list = document.getElementById('checklist-detail-view-items');
                    list.scrollTop = list.scrollHeight;
                }, 0);
            }
        });

        // EnterÎ°ú Ï∂îÍ∞Ä (Shift+EnterÎäî Ï§ÑÎ∞îÍøà)
        checklistDetailViewItemInput.addEventListener('keydown', (e) => {
            if (e.key === 'Enter' && !e.shiftKey && !e.ctrlKey && !e.altKey && !e.metaKey) {
                e.preventDefault();
                checklistDetailViewAddItemBtn.click();
            }
        });

        // ÏÉÅÏÑ∏ÎÇ¥Ïö© Ï≤¥ÌÅ¨Î¶¨Ïä§Ìä∏ Ï∂îÍ∞Ä Î≤ÑÌäº Ïù¥Î≤§Ìä∏
        const checklistDetailAddItemBtn = document.getElementById('checklist-detail-add-item-btn');
        const checklistDetailItemInput = document.getElementById('checklist-detail-item-input');

        checklistDetailAddItemBtn.addEventListener('click', () => {
            const text = checklistDetailItemInput.value.trim();
            if (text) {
                detailChecklistItems.push({
                    id: Math.random().toString(36).substr(2, 9),
                    text: text,
                    checked: false
                });
                checklistDetailItemInput.value = '';
                renderDetailChecklistItems();

                // ÏûêÎèô Ï†ÄÏû• (Firebase)
                if (currentEditingChecklistItem && currentEditingChecklistItem.liElement) {
                    currentEditingChecklistItem.liElement.dataset.detail = JSON.stringify(detailChecklistItems);
                    const clipboardIndex = currentEditingChecklistItem.clipboardIndex;
                    const itemIndex = currentEditingChecklistItem.itemIndex;

                    if (currentProject && allProjectsData && allProjectsData[currentProject]) {
                        const projectData = allProjectsData[currentProject];
                        const clipboardArray = projectData.clipboard || projectData.clipboards;

                        if (clipboardArray && clipboardArray[clipboardIndex]) {
                            const clipboard = clipboardArray[clipboardIndex];
                            if (clipboard.items && clipboard.items[itemIndex]) {
                                clipboard.items[itemIndex].detail = JSON.parse(JSON.stringify(detailChecklistItems));
                            }
                        }
                    }

                    saveToFirebase();
                }

                // ÏûêÎèô Ïä§ÌÅ¨Î°§ (ÌïòÎã®ÏúºÎ°ú)
                setTimeout(() => {
                    const list = document.getElementById('checklist-detail-items-list');
                    list.scrollTop = list.scrollHeight;
                }, 0);
            }
        });

        // EnterÎ°ú Ï∂îÍ∞Ä (Shift+EnterÎäî Ï§ÑÎ∞îÍøà)
        checklistDetailItemInput.addEventListener('keydown', (e) => {
            if (e.key === 'Enter' && !e.shiftKey && !e.ctrlKey && !e.altKey && !e.metaKey) {
                e.preventDefault();
                checklistDetailAddItemBtn.click();
            }
            // Shift+EnterÎäî ÏûêÎèô Ï§ÑÎ∞îÍøà (Í∏∞Î≥∏ ÎèôÏûë)
        });

        // Ï≤¥ÌÅ¨Î¶¨Ïä§Ìä∏ ÏÉÅÏÑ∏ÎÇ¥Ïö© Î™®Îã¨ ÎìúÎûòÍ∑∏ Í∏∞Îä•
        const checklistDetailHeader = checklistDetailModal.querySelector('.draggable-header');
        const modalContent = checklistDetailModal.querySelector('.modal-content');
        let isDragging = false;
        let startX, startY, startLeft, startTop;

        checklistDetailHeader.addEventListener('mousedown', (e) => {
            // Îã´Í∏∞ Î≤ÑÌäºÏù¥ÎÇò Îã§Î•∏ ÏöîÏÜåÎ•º ÎìúÎûòÍ∑∏ÌïòÏßÄ ÏïäÎèÑÎ°ù
            if (e.target.closest('.close-button')) return;

            isDragging = true;
            startX = e.clientX;
            startY = e.clientY;

            // ÌòÑÏû¨ ÏúÑÏπò Í≥ÑÏÇ∞ (transform Í∞í Î¨¥ÏãúÌïòÍ≥† left, top ÏÇ¨Ïö©)
            const rect = modalContent.getBoundingClientRect();
            startLeft = parseFloat(modalContent.style.left) || 0;
            startTop = parseFloat(modalContent.style.top) || 0;

            checklistDetailHeader.style.cursor = 'grabbing';
            document.body.style.userSelect = 'none';
        });

        document.addEventListener('mousemove', (e) => {
            if (!isDragging) return;

            const deltaX = e.clientX - startX;
            const deltaY = e.clientY - startY;

            const newLeft = startLeft + deltaX;
            const newTop = startTop + deltaY;

            modalContent.style.left = newLeft + 'px';
            modalContent.style.top = newTop + 'px';
            modalContent.style.transform = 'none'; // transform Ï†úÍ±∞
        });

        document.addEventListener('mouseup', () => {
            if (isDragging) {
                isDragging = false;
                checklistDetailHeader.style.cursor = 'grab';
                document.body.style.userSelect = 'auto';
            }
        });

        // Î™®Îì† Î™®Îã¨Ïóê ÎìúÎûòÍ∑∏ Í∏∞Îä• Ï∂îÍ∞Ä
        function initializeModalDrag() {
            const modals = document.querySelectorAll('.modal');

            modals.forEach(modal => {
                const modalContent = modal.querySelector('.modal-content');
                if (!modalContent) return;

                // Ïù¥ÎØ∏ ÎìúÎûòÍ∑∏ Í∞ÄÎä•Ìïú Ìó§ÎçîÍ∞Ä ÏûàÏúºÎ©¥ Ïä§ÌÇµ (Ï≤¥ÌÅ¨Î¶¨Ïä§Ìä∏ ÏÉÅÏÑ∏ Î™®Îã¨)
                if (modalContent.style.position === 'absolute') return;

                // Î™®Îã¨ Ïª®ÌÖêÏ∏†Î•º absolute ÏúÑÏπòÎ°ú ÏÑ§Ï†ï
                modalContent.style.position = 'absolute';
                modalContent.style.left = '50%';
                modalContent.style.top = '50%';
                modalContent.style.transform = 'translate(-50%, -50%)';

                let isDraggingModal = false;
                let startX, startY, startLeft, startTop;

                // h2 ÎòêÎäî Ìó§Îçî Ï∞æÍ∏∞
                let header = modalContent.querySelector('h2');
                if (!header) {
                    header = modalContent.querySelector('[style*="h2"]');
                }
                if (!header) {
                    // Ìó§ÎçîÍ∞Ä ÏóÜÏúºÎ©¥ Ï≤´ Î≤àÏß∏ ÏûêÏãùÏùÑ Ìó§ÎçîÎ°ú ÏÇ¨Ïö©
                    header = modalContent.firstElementChild;
                }

                if (header) {
                    header.style.cursor = 'grab';
                    header.style.userSelect = 'none';

                    header.addEventListener('mousedown', (e) => {
                        // Îã´Í∏∞ Î≤ÑÌäºÏù¥ÎÇò input/button ÌÅ¥Î¶≠ÏùÄ Ï†úÏô∏
                        if (e.target.closest('.close-button, button, input, label')) return;

                        isDraggingModal = true;
                        startX = e.clientX;
                        startY = e.clientY;
                        startLeft = parseFloat(modalContent.style.left) || 50;
                        startTop = parseFloat(modalContent.style.top) || 50;
                        header.style.cursor = 'grabbing';
                    });

                    document.addEventListener('mousemove', (e) => {
                        if (!isDraggingModal) return;

                        const deltaX = e.clientX - startX;
                        const deltaY = e.clientY - startY;

                        const newLeft = startLeft + (deltaX / window.innerWidth * 100);
                        const newTop = startTop + (deltaY / window.innerHeight * 100);

                        modalContent.style.left = newLeft + '%';
                        modalContent.style.top = newTop + '%';
                        modalContent.style.transform = 'translate(-50%, -50%)';
                    });

                    document.addEventListener('mouseup', () => {
                        if (isDraggingModal) {
                            isDraggingModal = false;
                            header.style.cursor = 'grab';
                        }
                    });
                }
            });
        }

        // DOMÏù¥ Î™®Îëê Î°úÎìúÎêú ÌõÑ Ïã§Ìñâ
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', initializeModalDrag);
        } else {
            initializeModalDrag();
        }

        // ÌÉÄÏûÖ ÎùºÎîîÏò§ Î≤ÑÌäº Ïù¥Î≤§Ìä∏ (ÌÖúÌîåÎ¶ø ÏÑ†ÌÉù Ïãú ÌûåÌä∏ ÌëúÏãú)
        document.querySelectorAll('input[name="clipboard-type"]').forEach(radio => {
            radio.addEventListener('change', () => {
                const templateHint = document.getElementById('template-hint');
                const insertVariableBtn = document.getElementById('insert-variable-btn');
                if (radio.value === 'template') {
                    templateHint.style.display = 'block';
                    insertVariableBtn.style.display = 'block';
                } else {
                    templateHint.style.display = 'none';
                    insertVariableBtn.style.display = 'none';
                }
            });
        });

        // Î≥ÄÏàò ÏÇΩÏûÖ Î≤ÑÌäº Ïù¥Î≤§Ìä∏
        document.getElementById('insert-variable-btn').addEventListener('click', () => {
            const textarea = document.getElementById('add-clipboard-content');
            const start = textarea.selectionStart;
            const end = textarea.selectionEnd;
            const beforeText = textarea.value.substring(0, start);
            const afterText = textarea.value.substring(end);

            // {} Í¥ÑÌò∏ ÏÇΩÏûÖ (Ïª§ÏÑúÍ∞Ä Í¥ÑÌò∏ ÏÇ¨Ïù¥Ïóê ÏúÑÏπòÌïòÎèÑÎ°ù)
            textarea.value = beforeText + '{}' + afterText;

            // Ïª§ÏÑúÎ•º Í¥ÑÌò∏ ÏïàÏóê ÏúÑÏπò
            textarea.focus();
            textarea.setSelectionRange(start + 1, start + 1);
        });

        // ÌÖúÌîåÎ¶ø ÏÇ¨Ïö© Î™®Îã¨ Ïù¥Î≤§Ìä∏
        const templateUseClose = document.querySelector('.template-use-close');
        const templateResultClose = document.querySelector('.template-result-close');
        const templateUseCancelBtn = document.getElementById('template-use-cancel');
        const templateResultCancelBtn = document.getElementById('template-result-cancel');

        templateUseClose.addEventListener('click', () => {
            document.getElementById('template-use-modal').style.display = 'none';
        });

        templateUseCancelBtn.addEventListener('click', () => {
            document.getElementById('template-use-modal').style.display = 'none';
        });

        templateResultClose.addEventListener('click', () => {
            document.getElementById('template-result-modal').style.display = 'none';
        });

        templateResultCancelBtn.addEventListener('click', () => {
            document.getElementById('template-result-modal').style.display = 'none';
        });

        // Í≤∞Í≥º Ï≤òÎ¶¨ Î≤ÑÌäº Ïù¥Î≤§Ìä∏
        document.getElementById('template-copy-btn').addEventListener('click', async () => {
            try {
                await navigator.clipboard.writeText(currentTemplateResult);
                alert('ÌÅ¥Î¶ΩÎ≥¥ÎìúÏóê Î≥µÏÇ¨ÎêòÏóàÏäµÎãàÎã§.');
                document.getElementById('template-result-modal').style.display = 'none';
            } catch (err) {
                alert('Î≥µÏÇ¨ Ïã§Ìå®ÌñàÏäµÎãàÎã§. Îã§Ïãú ÏãúÎèÑÌï¥Ï£ºÏÑ∏Ïöî.');
            }
        });

        document.getElementById('template-save-btn').addEventListener('click', () => {
            if (!currentProject) {
                alert('ÌîÑÎ°úÏ†ùÌä∏Î•º Î®ºÏ†Ä ÏÑ†ÌÉùÌï¥Ï£ºÏÑ∏Ïöî.');
                return;
            }

            const clipboardItem = {
                title: `[Í≤∞Í≥º] ${document.getElementById('template-title-display').textContent.replace(' ÌÖúÌîåÎ¶ø ÏÇ¨Ïö©', '')}`,
                textContent: currentTemplateResult,
                color: '#f8f9fa',
                favorite: false,
                type: 'normal',
                isFile: false
            };

            allProjectsData[currentProject].clipboard.push(clipboardItem);
            renderProject(currentProject);
            saveToFirebase();
            document.getElementById('template-result-modal').style.display = 'none';
            alert('ÏÉà ÌÅ¥Î¶ΩÎ≥¥Îìú Ìï≠Î™©ÏúºÎ°ú Ï†ÄÏû•ÎêòÏóàÏäµÎãàÎã§.');
        });

        // Ìé∏ÏßëÏö© Î™®Îã¨ÏùÄ ÏòÅÏó≠ Î∞îÍπ• ÌÅ¥Î¶≠ÏúºÎ°ú Îã´ÌûàÏßÄ ÏïäÎèÑÎ°ù Ïù¥Î≤§Ìä∏ Ï†úÍ±∞
        // addBookmarkModal.addEventListener('click', (e) => {
        //     if (e.target === addBookmarkModal) {
        //         addBookmarkModal.style.display = 'none';
        //     }
        // });
        
        // addClipboardModal.addEventListener('click', (e) => {
        //     if (e.target === addClipboardModal) {
        //         addClipboardModal.style.display = 'none';
        //     }
        // });

        const addProjectModal = document.getElementById('add-project-modal');
        const addProjectSave = document.getElementById('add-project-save');
        const addProjectCancel = document.getElementById('add-project-cancel');
        const addProjectClose = document.querySelector('.add-project-close');
        
        addProjectSave.addEventListener('click', () => {
            const name = document.getElementById('add-project-name').value.trim();
            
            if (!name) {
                alert('ÌîÑÎ°úÏ†ùÌä∏ Ïù¥Î¶ÑÏùÑ ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî.');
                return;
            }
            
            if (allProjectsData[name]) {
                alert('Ïù¥ÎØ∏ Ï°¥Ïû¨ÌïòÎäî ÌîÑÎ°úÏ†ùÌä∏ Ïù¥Î¶ÑÏûÖÎãàÎã§.');
                return;
            }
            
            allProjectsData[name] = {
                bookmarks: [],
                clipboard: []
            };
            
            // ÏÉà ÌîÑÎ°úÏ†ùÌä∏Î•º projectOrder Î∞∞Ïó¥Ïóê Ï∂îÍ∞Ä
            if (!projectOrder) {
                projectOrder = Object.keys(allProjectsData);
            } else {
                projectOrder.push(name);
            }
            
            renderProjectList();
            renderProject(name);
            
            addProjectModal.style.display = 'none';
            saveToFirebase();
        });
        
        addProjectCancel.addEventListener('click', () => {
            addProjectModal.style.display = 'none';
        });
        
        addProjectClose.addEventListener('click', () => {
            addProjectModal.style.display = 'none';
        });
        
        // ÌîÑÎ°úÏ†ùÌä∏ Ï∂îÍ∞Ä Î™®Îã¨ÎèÑ Ìé∏ÏßëÏö©Ïù¥ÎØÄÎ°ú ÏòÅÏó≠ Î∞îÍπ• ÌÅ¥Î¶≠ÏúºÎ°ú Îã´ÌûàÏßÄ ÏïäÎèÑÎ°ù Ïù¥Î≤§Ìä∏ Ï†úÍ±∞
        // addProjectModal.addEventListener('click', (e) => {
        //     if (e.target === addProjectModal) {
        //         addProjectModal.style.display = 'none';
        //     }
        // });

        // Í∏ÄÎ°úÎ≤å Í≤ÄÏÉâ Í∏∞Îä•
        const globalSearchInput = document.getElementById('global-search');
        const searchResults = document.getElementById('search-results');
        let searchTimeout;
        let selectedResultIndex = -1;
        let searchIndex = [];

        // Í≤ÄÏÉâ Ïù∏Îç±Ïä§ ÏÉùÏÑ±
        function createSearchIndex() {
            searchIndex = [];
            
            // ÌîÑÎ°úÏ†ùÌä∏ Í≤ÄÏÉâ Ïù∏Îç±Ïä§
            Object.keys(allProjectsData).forEach(projectName => {
                if (projectName !== 'TODAY') {
                    searchIndex.push({
                        type: 'project',
                        title: projectName,
                        subtitle: `ÌîÑÎ°úÏ†ùÌä∏ - ${allProjectsData[projectName].bookmarks?.length || 0}Í∞ú Î∂ÅÎßàÌÅ¨, ${allProjectsData[projectName].clipboard?.length || 0}Í∞ú ÌÅ¥Î¶ΩÎ≥¥Îìú`,
                        project: projectName,
                        searchText: projectName.toLowerCase()
                    });
                }
            });

            // Î∂ÅÎßàÌÅ¨ Í≤ÄÏÉâ Ïù∏Îç±Ïä§
            Object.keys(allProjectsData).forEach(projectName => {
                const project = allProjectsData[projectName];
                if (project.bookmarks) {
                    project.bookmarks.forEach((bookmark, index) => {
                        if (bookmark.type !== 'divider') {
                            searchIndex.push({
                                type: 'bookmark',
                                title: bookmark.name || bookmark.url,
                                subtitle: bookmark.url,
                                project: projectName,
                                index: index,
                                data: bookmark,
                                searchText: `${bookmark.name || ''} ${bookmark.url || ''}`.toLowerCase()
                            });
                        }
                    });
                }
            });

            // ÌÅ¥Î¶ΩÎ≥¥Îìú Í≤ÄÏÉâ Ïù∏Îç±Ïä§
            Object.keys(allProjectsData).forEach(projectName => {
                const project = allProjectsData[projectName];
                if (project.clipboard) {
                    project.clipboard.forEach((item, index) => {
                        if (item.type !== 'divider') {
                            searchIndex.push({
                                type: 'clipboard',
                                title: item.title || 'Ï†úÎ™© ÏóÜÏùå',
                                subtitle: item.text ? item.text.substring(0, 100) + (item.text.length > 100 ? '...' : '') : '',
                                project: projectName,
                                index: index,
                                data: item,
                                searchText: `${item.title || ''} ${item.text || ''}`.toLowerCase()
                            });
                        }
                    });
                }
            });

            // ÌÖúÌîåÎ¶ø Í≤ÄÏÉâ Ïù∏Îç±Ïä§
            if (templates && Array.isArray(templates)) {
                templates.forEach((template, index) => {
                    searchIndex.push({
                        type: 'template',
                        title: template.title || 'Ï†úÎ™© ÏóÜÏùå',
                        subtitle: template.content ? template.content.substring(0, 100) + (template.content.length > 100 ? '...' : '') : '',
                        project: 'ÌÖúÌîåÎ¶ø',
                        index: index,
                        data: template,
                        searchText: `${template.title || ''} ${template.content || ''}`.toLowerCase()
                    });
                });
            }
        }

        // Í≤ÄÏÉâ Ïã§Ìñâ
        function performSearch(query) {
            if (!query.trim()) {
                hideSearchResults();
                return;
            }

            const searchTerm = query.toLowerCase();
            const results = searchIndex.filter(item => 
                item.searchText.includes(searchTerm)
            );

            displaySearchResults(results, searchTerm);
        }

        // Í≤ÄÏÉâ Í≤∞Í≥º ÌëúÏãú
        function displaySearchResults(results, searchTerm) {
            if (results.length === 0) {
                searchResults.innerHTML = '<div class="no-search-results">Í≤ÄÏÉâ Í≤∞Í≥ºÍ∞Ä ÏóÜÏäµÎãàÎã§.</div>';
                searchResults.classList.add('show');
                return;
            }

            // Ïπ¥ÌÖåÍ≥†Î¶¨Î≥ÑÎ°ú Í∑∏Î£πÌôî
            const categories = {
                project: { title: 'üìÅ ÌîÑÎ°úÏ†ùÌä∏', items: [] },
                bookmark: { title: 'üîó Î∂ÅÎßàÌÅ¨', items: [] },
                clipboard: { title: 'üìã ÌÅ¥Î¶ΩÎ≥¥Îìú', items: [] },
                template: { title: 'üìÑ ÌÖúÌîåÎ¶ø', items: [] }
            };

            results.forEach(result => {
                if (categories[result.type]) {
                    categories[result.type].items.push(result);
                }
            });

            let html = '';
            Object.values(categories).forEach(category => {
                if (category.items.length > 0) {
                    html += `<div class="search-category">
                        <div class="search-category-header">${category.title} (${category.items.length})</div>`;
                    
                    category.items.forEach((item, index) => {
                        const highlightedTitle = highlightSearchTerm(item.title, searchTerm);
                        const highlightedSubtitle = highlightSearchTerm(item.subtitle, searchTerm);
                        
                        html += `<div class="search-result-item" data-type="${item.type}" data-project="${item.project}" data-index="${item.index}">
                            <div class="search-result-title">${highlightedTitle}</div>
                            <div class="search-result-subtitle">${highlightedSubtitle}</div>
                            ${item.project !== 'ÌÖúÌîåÎ¶ø' ? `<div class="search-result-project">${item.project}</div>` : ''}
                        </div>`;
                    });
                    
                    html += '</div>';
                }
            });

            searchResults.innerHTML = html;
            searchResults.classList.add('show');
            selectedResultIndex = -1;

            // Í≤ÄÏÉâ Í≤∞Í≥º ÌÅ¥Î¶≠ Ïù¥Î≤§Ìä∏
            searchResults.querySelectorAll('.search-result-item').forEach(item => {
                item.addEventListener('click', handleSearchResultClick);
            });
        }

        // Í≤ÄÏÉâÏñ¥ ÌïòÏù¥ÎùºÏù¥Ìä∏
        function highlightSearchTerm(text, term) {
            if (!text || !term) return text;
            const regex = new RegExp(`(${term.replace(/[.*+?^${}()|[\]\\]/g, '\\$&')})`, 'gi');
            return text.replace(regex, '<span class="search-highlight">$1</span>');
        }

        // Í≤ÄÏÉâ Í≤∞Í≥º ÌÅ¥Î¶≠ Ï≤òÎ¶¨ (Ïª®ÌÖçÏä§Ìä∏ Ïö∞ÏÑ† Î∞©Ïãù: Ïù¥Îèô + ÌïòÏù¥ÎùºÏù¥Ìä∏)
        function handleSearchResultClick(event) {
            const resultItem = event.currentTarget;
            const type = resultItem.getAttribute('data-type');
            const project = resultItem.getAttribute('data-project');
            const index = parseInt(resultItem.getAttribute('data-index'));

            hideSearchResults();
            globalSearchInput.value = '';

            // Î™®Îì† ÌÉÄÏûÖ: Ìï¥Îãπ ÏúÑÏπòÎ°ú Ïù¥Îèô + ÌïòÏù¥ÎùºÏù¥Ìä∏
            if (type === 'project') {
                // ÌîÑÎ°úÏ†ùÌä∏: Ìï¥Îãπ ÌîÑÎ°úÏ†ùÌä∏Î°ú Ïù¥Îèô
                switchProject(project);
                // ÌîÑÎ°úÏ†ùÌä∏ ÏÇ¨Ïù¥ÎìúÎ∞îÏóêÏÑú ÌïòÏù¥ÎùºÏù¥Ìä∏
                setTimeout(() => {
                    const projectItems = document.querySelectorAll('#project-list li');
                    projectItems.forEach(item => {
                        if (item.textContent.trim() === project) {
                            applySearchHighlight(item, 'project');
                        }
                    });
                }, 200);
            } else if (type === 'bookmark') {
                // Î∂ÅÎßàÌÅ¨: Ìï¥Îãπ ÌîÑÎ°úÏ†ùÌä∏Î°ú Ïù¥Îèô + Î∂ÅÎßàÌÅ¨ ÌïòÏù¥ÎùºÏù¥Ìä∏
                switchProject(project);
                setTimeout(() => {
                    const listElement = document.getElementById('bookmark-list');
                    const targetItem = listElement.children[index];
                    if (targetItem) {
                        // Î∂ÄÎìúÎü¨Ïö¥ Ïä§ÌÅ¨Î°§
                        targetItem.scrollIntoView({ 
                            behavior: 'smooth', 
                            block: 'center',
                            inline: 'nearest'
                        });
                        
                        // Ìô©Í∏àÎπõ Í∏ÄÎ°úÏö∞ Ìö®Í≥º Ï†ÅÏö©
                        setTimeout(() => {
                            applySearchHighlight(targetItem, 'bookmark');
                        }, 500); // Ïä§ÌÅ¨Î°§ ÏôÑÎ£å ÌõÑ ÌïòÏù¥ÎùºÏù¥Ìä∏
                    }
                }, 300);
            } else if (type === 'clipboard') {
                // ÌÅ¥Î¶ΩÎ≥¥Îìú: Ìï¥Îãπ ÌîÑÎ°úÏ†ùÌä∏Î°ú Ïù¥Îèô + ÌÅ¥Î¶ΩÎ≥¥Îìú ÌïòÏù¥ÎùºÏù¥Ìä∏
                switchProject(project);
                setTimeout(() => {
                    const listElement = document.getElementById('clipboard-list');
                    const targetItem = listElement.children[index];
                    if (targetItem) {
                        // Î∂ÄÎìúÎü¨Ïö¥ Ïä§ÌÅ¨Î°§
                        targetItem.scrollIntoView({ 
                            behavior: 'smooth', 
                            block: 'center',
                            inline: 'nearest'
                        });
                        
                        // Ìô©Í∏àÎπõ Í∏ÄÎ°úÏö∞ Ìö®Í≥º Ï†ÅÏö©
                        setTimeout(() => {
                            applySearchHighlight(targetItem, 'clipboard');
                        }, 500); // Ïä§ÌÅ¨Î°§ ÏôÑÎ£å ÌõÑ ÌïòÏù¥ÎùºÏù¥Ìä∏
                    }
                }, 300);
            } else if (type === 'template') {
                // ÌÖúÌîåÎ¶ø: ÎåÄÏãúÎ≥¥ÎìúÎ°ú Ïù¥Îèô + ÌÖúÌîåÎ¶ø Ïπ¥Îìú ÌïòÏù¥ÎùºÏù¥Ìä∏
                switchToDashboard();
                setTimeout(() => {
                    const templateCards = document.querySelectorAll('.template-card');
                    templateCards.forEach((card, cardIndex) => {
                        if (cardIndex === index) {
                            // Î∂ÄÎìúÎü¨Ïö¥ Ïä§ÌÅ¨Î°§
                            card.scrollIntoView({ 
                                behavior: 'smooth', 
                                block: 'center',
                                inline: 'nearest'
                            });
                            
                            // Ìô©Í∏àÎπõ Í∏ÄÎ°úÏö∞ Ìö®Í≥º Ï†ÅÏö©
                            setTimeout(() => {
                                applySearchHighlight(card, 'template');
                            }, 500);
                        }
                    });
                }, 300);
            }
        }

        // ÌîÑÎ°úÏ†ùÌä∏ Ï†ÑÌôò Ìï®Ïàò (Í≤ÄÏÉâÏóêÏÑú ÏÇ¨Ïö©)
        function switchProject(projectName) {
            renderProject(projectName);
        }



        // Í≤ÄÏÉâ ÌïòÏù¥ÎùºÏù¥Ìä∏ Ìö®Í≥º Ï†ÅÏö©
        function applySearchHighlight(element, type) {
            if (!element) return;
            
            // Í∏∞Ï°¥ ÌïòÏù¥ÎùºÏù¥Ìä∏ Ìö®Í≥º Ï†úÍ±∞
            clearSearchHighlight(element);
            
            // Ìô©Í∏àÎπõ Í∏ÄÎ°úÏö∞ Ìö®Í≥º Ï†ÅÏö©
            element.classList.add('search-highlight-glow');
            
            // ÌäπÎ≥ÑÌïú Ìö®Í≥º: Ïä§ÌååÌÅ¨ Ï∂îÍ∞Ä (Î∂ÅÎßàÌÅ¨ÏôÄ ÌÅ¥Î¶ΩÎ≥¥ÎìúÎßå)
            if (type === 'bookmark' || type === 'clipboard') {
                element.classList.add('with-sparkle');
            }
            
            // 3Ï¥à ÌõÑ ÌéòÏù¥Îìú ÏïÑÏõÉ ÏãúÏûë
            setTimeout(() => {
                element.classList.add('search-highlight-fade-out');
                element.classList.remove('search-highlight-glow', 'with-sparkle');
                
                // ÌéòÏù¥Îìú ÏïÑÏõÉ ÏôÑÎ£å ÌõÑ ÌÅ¥ÎûòÏä§ Ï†úÍ±∞
                setTimeout(() => {
                    element.classList.remove('search-highlight-fade-out');
                    // Ïù∏ÎùºÏù∏ Ïä§ÌÉÄÏùºÎèÑ ÏôÑÏ†ÑÌûà Ï†úÍ±∞
                    element.style.background = '';
                    element.style.border = '';
                    element.style.boxShadow = '';
                }, 1000);
            }, 3000);
        }

        // Í∏∞Ï°¥ ÌïòÏù¥ÎùºÏù¥Ìä∏ Ìö®Í≥º Ï†úÍ±∞
        function clearSearchHighlight(element) {
            element.classList.remove('search-highlight-glow', 'search-highlight-fade-out', 'with-sparkle');
            element.style.background = '';
            element.style.border = '';
            element.style.boxShadow = '';
        }

        // Ï†ÑÏ≤¥ ÌïòÏù¥ÎùºÏù¥Ìä∏ Ìö®Í≥º Ï¥àÍ∏∞Ìôî (ÌïÑÏöîÏãú ÏÇ¨Ïö©)
        function clearAllSearchHighlights() {
            document.querySelectorAll('.search-highlight-glow, .search-highlight-fade-out').forEach(element => {
                clearSearchHighlight(element);
            });
        }

        // Í≤ÄÏÉâ Í≤∞Í≥º Ïà®Í∏∞Í∏∞
        function hideSearchResults() {
            searchResults.classList.remove('show');
            selectedResultIndex = -1;
        }

        // Í≤ÄÏÉâ ÏûÖÎ†• Ïù¥Î≤§Ìä∏
        globalSearchInput.addEventListener('input', (e) => {
            clearTimeout(searchTimeout);
            searchTimeout = setTimeout(() => {
                performSearch(e.target.value);
            }, 300);
        });

        // Í≤ÄÏÉâÏ∞Ω Ìè¨Ïª§Ïä§ Ïù¥Î≤§Ìä∏
        globalSearchInput.addEventListener('focus', () => {
            if (globalSearchInput.value.trim() && searchResults.innerHTML) {
                searchResults.classList.add('show');
            }
        });

        // Í≤ÄÏÉâÏ∞Ω Î∏îÎü¨ Ïù¥Î≤§Ìä∏ (ÏßÄÏó∞ Ï≤òÎ¶¨Î°ú ÌÅ¥Î¶≠ Ïù¥Î≤§Ìä∏ Î≥¥Ïû•)
        globalSearchInput.addEventListener('blur', () => {
            setTimeout(() => {
                hideSearchResults();
            }, 200);
        });

        // ÌÇ§Î≥¥Îìú ÎÑ§ÎπÑÍ≤åÏù¥ÏÖò
        globalSearchInput.addEventListener('keydown', (e) => {
            const resultItems = searchResults.querySelectorAll('.search-result-item');
            
            if (e.key === 'ArrowDown') {
                e.preventDefault();
                if (selectedResultIndex < resultItems.length - 1) {
                    if (selectedResultIndex >= 0) {
                        resultItems[selectedResultIndex].classList.remove('selected');
                    }
                    selectedResultIndex++;
                    resultItems[selectedResultIndex].classList.add('selected');
                    resultItems[selectedResultIndex].scrollIntoView({ block: 'nearest' });
                }
            } else if (e.key === 'ArrowUp') {
                e.preventDefault();
                if (selectedResultIndex > 0) {
                    resultItems[selectedResultIndex].classList.remove('selected');
                    selectedResultIndex--;
                    resultItems[selectedResultIndex].classList.add('selected');
                    resultItems[selectedResultIndex].scrollIntoView({ block: 'nearest' });
                }
            } else if (e.key === 'Enter') {
                e.preventDefault();
                if (selectedResultIndex >= 0 && selectedResultIndex < resultItems.length) {
                    resultItems[selectedResultIndex].click();
                }
            } else if (e.key === 'Escape') {
                hideSearchResults();
                globalSearchInput.blur();
            }
        });

        // Í≤ÄÏÉâ Ïù∏Îç±Ïä§ ÏóÖÎç∞Ïù¥Ìä∏ (Îç∞Ïù¥ÌÑ∞ Î≥ÄÍ≤Ω Ïãú Ìò∏Ï∂ú)
        function updateSearchIndex() {
            createSearchIndex();
        }

        const settingsBtn = document.getElementById('settings-btn');
        const settingsModal = document.getElementById('settings-modal');
        const settingsCloseBtn = settingsModal.querySelector('.close-button');
        const exportDataBtn = document.getElementById('export-data-btn');
        const importDataBtn = document.getElementById('import-data-btn');
        const importDataInput = document.getElementById('import-data-input');
        
        settingsBtn.addEventListener('click', () => {
            settingsModal.style.display = 'flex';
        });
        
        settingsCloseBtn.addEventListener('click', () => {
            settingsModal.style.display = 'none';
        });
        
        settingsModal.addEventListener('click', (e) => {
            if (e.target === settingsModal) {
                settingsModal.style.display = 'none';
            }
        });

        // Îç∞Ïù¥ÌÑ∞ ÎÇ¥Î≥¥ÎÇ¥Í∏∞ (Î∞±ÏóÖ)
        exportDataBtn.addEventListener('click', () => {
            try {
                const dataToExport = {
                    projects: allProjectsData,
                    currentProject: currentProject,
                    exportDate: new Date().toISOString(),
                    version: '1.0'
                };
                
                const jsonString = JSON.stringify(dataToExport, null, 2);
                const blob = new Blob([jsonString], { type: 'application/json' });
                
                // ÌååÏùºÎ™Ö ÏÉùÏÑ± (ÌòÑÏû¨ ÎÇ†ÏßúÏôÄ ÏãúÍ∞Ñ Ìè¨Ìï®)
                const now = new Date();
                const dateString = now.getFullYear() + 
                    String(now.getMonth() + 1).padStart(2, '0') + 
                    String(now.getDate()).padStart(2, '0') + '_' +
                    String(now.getHours()).padStart(2, '0') + 
                    String(now.getMinutes()).padStart(2, '0');
                const filename = `Î∂ÅÎßàÌÅ¨ÌÅ¥Î¶ΩÎ≥¥Îìú_Î∞±ÏóÖ_${dateString}.json`;
                
                // Îã§Ïö¥Î°úÎìú ÎßÅÌÅ¨ ÏÉùÏÑ± Î∞è Ïã§Ìñâ
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = filename;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
                
                alert(`Îç∞Ïù¥ÌÑ∞Í∞Ä ÏÑ±Í≥µÏ†ÅÏúºÎ°ú ÎÇ¥Î≥¥ÎÇ¥Ï°åÏäµÎãàÎã§.\nÌååÏùºÎ™Ö: ${filename}`);
            } catch (error) {
                console.error('Îç∞Ïù¥ÌÑ∞ ÎÇ¥Î≥¥ÎÇ¥Í∏∞ Ïã§Ìå®:', error);
                alert('Îç∞Ïù¥ÌÑ∞ ÎÇ¥Î≥¥ÎÇ¥Í∏∞Ïóê Ïã§Ìå®ÌñàÏäµÎãàÎã§.');
            }
        });

        // Îç∞Ïù¥ÌÑ∞ Î∂àÎü¨Ïò§Í∏∞ Î≤ÑÌäº ÌÅ¥Î¶≠ Ïãú ÌååÏùº ÏÑ†ÌÉù Ï∞Ω Ïó¥Í∏∞
        importDataBtn.addEventListener('click', () => {
            importDataInput.click();
        });

        // ÌååÏùº ÏÑ†ÌÉù Ïãú Îç∞Ïù¥ÌÑ∞ Î∂àÎü¨Ïò§Í∏∞
        importDataInput.addEventListener('change', (e) => {
            const file = e.target.files[0];
            if (!file) return;

            if (file.type !== 'application/json') {
                alert('JSON ÌååÏùºÎßå ÏßÄÏõêÎê©ÎãàÎã§.');
                return;
            }

            const reader = new FileReader();
            reader.onload = (event) => {
                try {
                    const importedData = JSON.parse(event.target.result);
                    
                    // Îç∞Ïù¥ÌÑ∞ Ïú†Ìö®ÏÑ± Í≤ÄÏÇ¨
                    if (!importedData.projects || typeof importedData.projects !== 'object') {
                        throw new Error('Ïò¨Î∞îÎ•¥ÏßÄ ÏïäÏùÄ Î∞±ÏóÖ ÌååÏùº ÌòïÏãùÏûÖÎãàÎã§.');
                    }

                    // Îç∞Ïù¥ÌÑ∞ Íµ¨Ï°∞ Í≤ÄÏ¶ù
                    for (const [projectName, projectData] of Object.entries(importedData.projects)) {
                        if (!projectData.bookmarks || !projectData.clipboard || 
                            !Array.isArray(projectData.bookmarks) || !Array.isArray(projectData.clipboard)) {
                            throw new Error(`ÌîÑÎ°úÏ†ùÌä∏ '${projectName}'Ïùò Îç∞Ïù¥ÌÑ∞ Íµ¨Ï°∞Í∞Ä Ïò¨Î∞îÎ•¥ÏßÄ ÏïäÏäµÎãàÎã§.`);
                        }
                    }

                    // Î≥µÏõê Î∞©Ïãù ÏÑ†ÌÉù
                    const choice = confirm('Îç∞Ïù¥ÌÑ∞ Î≥µÏõê Î∞©ÏãùÏùÑ ÏÑ†ÌÉùÌï¥Ï£ºÏÑ∏Ïöî.\n\n' +
                                         'ÌôïÏù∏: Î≥ëÌï© Î™®Îìú (Í∏∞Ï°¥ Îç∞Ïù¥ÌÑ∞ Î≥¥Ï°¥ + Î∞±ÏóÖ Îç∞Ïù¥ÌÑ∞ Ï∂îÍ∞Ä)\n' +
                                         'Ï∑®ÏÜå: ÏôÑÏ†Ñ ÍµêÏ≤¥ (Í∏∞Ï°¥ Îç∞Ïù¥ÌÑ∞ ÏÇ≠Ï†ú + Î∞±ÏóÖ Îç∞Ïù¥ÌÑ∞Î°ú ÍµêÏ≤¥)');
                    
                    if (choice) {
                        // Î≥ëÌï© Î™®Îìú
                        performDataMerge(importedData);
                    } else {
                        // ÏôÑÏ†Ñ ÍµêÏ≤¥ Î™®Îìú
                        if (confirm('‚ö†Ô∏è ÏôÑÏ†Ñ ÍµêÏ≤¥ Î™®ÎìúÏûÖÎãàÎã§.\nÌòÑÏû¨ Î™®Îì† Îç∞Ïù¥ÌÑ∞Í∞Ä ÏÇ≠Ï†úÎêòÍ≥† Î∞±ÏóÖ Îç∞Ïù¥ÌÑ∞Î°ú ÍµêÏ≤¥Îê©ÎãàÎã§.\nÏ†ïÎßê ÏßÑÌñâÌïòÏãúÍ≤†ÏäµÎãàÍπå?')) {
                            performDataReplace(importedData);
                        }
                    }
                } catch (error) {
                    console.error('Îç∞Ïù¥ÌÑ∞ Î∂àÎü¨Ïò§Í∏∞ Ïã§Ìå®:', error);
                    alert(`Îç∞Ïù¥ÌÑ∞ Î∂àÎü¨Ïò§Í∏∞Ïóê Ïã§Ìå®ÌñàÏäµÎãàÎã§.\nÏò§Î•ò: ${error.message}`);
                }
            };
            
            reader.onerror = () => {
                alert('ÌååÏùº ÏùΩÍ∏∞Ïóê Ïã§Ìå®ÌñàÏäµÎãàÎã§.');
            };
            
            reader.readAsText(file);
            
            // ÌååÏùº ÏûÖÎ†• Ï¥àÍ∏∞Ìôî (Í∞ôÏùÄ ÌååÏùº Ïû¨ÏÑ†ÌÉù Í∞ÄÎä•ÌïòÎèÑÎ°ù)
            e.target.value = '';
        });

        // Îç∞Ïù¥ÌÑ∞ Î≥ëÌï© Ï≤òÎ¶¨ Ìï®Ïàò
        function performDataMerge(importedData) {
            const conflictProjects = [];
            const newProjects = [];
            
            // Ï∂©Îèå ÌîÑÎ°úÏ†ùÌä∏ÏôÄ ÏÉà ÌîÑÎ°úÏ†ùÌä∏ Î∂ÑÎ•ò
            for (const [projectName, projectData] of Object.entries(importedData.projects)) {
                if (allProjectsData[projectName]) {
                    conflictProjects.push(projectName);
                } else {
                    newProjects.push(projectName);
                }
            }
            
            // Ï∂©ÎèåÏù¥ ÏûàÎäî Í≤ΩÏö∞ ÏùºÍ¥Ñ Ï≤òÎ¶¨ ÏòµÏÖò Ï†úÍ≥µ
            if (conflictProjects.length > 0) {
                const conflictMessage = `${conflictProjects.length}Í∞úÏùò Í∏∞Ï°¥ ÌîÑÎ°úÏ†ùÌä∏ÏôÄ Ïù¥Î¶ÑÏù¥ Ï§ëÎ≥µÎê©ÎãàÎã§:\n` +
                                      `${conflictProjects.map(name => `‚Ä¢ ${name}`).join('\n')}\n\n` +
                                      `Ïñ¥ÎñªÍ≤å Ï≤òÎ¶¨ÌïòÏãúÍ≤†ÏäµÎãàÍπå?`;
                
                const choice = confirm(conflictMessage + '\n\n' +
                                     'ÌôïÏù∏: Î™®Îì† Ï∂©Îèå ÌîÑÎ°úÏ†ùÌä∏Î•º Î≥ëÌï© (Í∏∞Ï°¥ + Î∞±ÏóÖ Îç∞Ïù¥ÌÑ∞)\n' +
                                     'Ï∑®ÏÜå: Í∞úÎ≥Ñ ÏÑ†ÌÉù (ÌîÑÎ°úÏ†ùÌä∏Î≥ÑÎ°ú ÌôïÏù∏)');
                
                if (choice) {
                    // ÏùºÍ¥Ñ Î≥ëÌï©
                    performBatchMerge(importedData, conflictProjects, newProjects);
                } else {
                    // Í∞úÎ≥Ñ ÏÑ†ÌÉù
                    performIndividualMerge(importedData, conflictProjects, newProjects);
                }
            } else {
                // Ï∂©ÎèåÏù¥ ÏóÜÏúºÎ©¥ Î∞îÎ°ú Î≥ëÌï©
                performBatchMerge(importedData, [], newProjects);
            }
        }

        // ÏùºÍ¥Ñ Î≥ëÌï© Ï≤òÎ¶¨
        function performBatchMerge(importedData, conflictProjects, newProjects) {
            const mergeResults = {
                newProjects: [],
                conflictProjects: [],
                addedBookmarks: 0,
                addedClipboard: 0
            };

            // ÏÉà ÌîÑÎ°úÏ†ùÌä∏ Ï∂îÍ∞Ä
            newProjects.forEach(projectName => {
                const projectData = importedData.projects[projectName];
                allProjectsData[projectName] = {
                    bookmarks: [...projectData.bookmarks],
                    clipboard: [...projectData.clipboard]
                };
                mergeResults.newProjects.push(projectName);
                mergeResults.addedBookmarks += projectData.bookmarks.length;
                mergeResults.addedClipboard += projectData.clipboard.length;
            });

            // Ï∂©Îèå ÌîÑÎ°úÏ†ùÌä∏ ÏùºÍ¥Ñ Î≥ëÌï©
            conflictProjects.forEach(projectName => {
                const projectData = importedData.projects[projectName];
                
                // Î∂ÅÎßàÌÅ¨ Î≥ëÌï© (Ï§ëÎ≥µ Ï†úÍ±∞)
                const existingBookmarks = allProjectsData[projectName].bookmarks;
                const newBookmarks = projectData.bookmarks.filter(newBookmark => {
                    return !existingBookmarks.some(existing => 
                        existing.name === newBookmark.name && existing.url === newBookmark.url
                    );
                });
                existingBookmarks.push(...newBookmarks);
                mergeResults.addedBookmarks += newBookmarks.length;

                // ÌÅ¥Î¶ΩÎ≥¥Îìú Î≥ëÌï© (Ï§ëÎ≥µ Ï†úÍ±∞)
                const existingClipboard = allProjectsData[projectName].clipboard;
                const newClipboard = projectData.clipboard.filter(newClip => {
                    return !existingClipboard.some(existing => 
                        existing.text === newClip.text
                    );
                });
                existingClipboard.push(...newClipboard);
                mergeResults.addedClipboard += newClipboard.length;

                mergeResults.conflictProjects.push(projectName);
            });

            // Î≥ëÌï© ÏôÑÎ£å Ï≤òÎ¶¨
            finalizeMerge(importedData, mergeResults);
        }

        // Í∞úÎ≥Ñ ÏÑ†ÌÉù Î≥ëÌï© Ï≤òÎ¶¨
        function performIndividualMerge(importedData, conflictProjects, newProjects) {
            const mergeResults = {
                newProjects: [],
                conflictProjects: [],
                addedBookmarks: 0,
                addedClipboard: 0
            };

            // ÏÉà ÌîÑÎ°úÏ†ùÌä∏ Î®ºÏ†Ä Ï∂îÍ∞Ä
            newProjects.forEach(projectName => {
                const projectData = importedData.projects[projectName];
                allProjectsData[projectName] = {
                    bookmarks: [...projectData.bookmarks],
                    clipboard: [...projectData.clipboard]
                };
                mergeResults.newProjects.push(projectName);
                mergeResults.addedBookmarks += projectData.bookmarks.length;
                mergeResults.addedClipboard += projectData.clipboard.length;
            });

            // Ï∂©Îèå ÌîÑÎ°úÏ†ùÌä∏ Í∞úÎ≥Ñ Ï≤òÎ¶¨
            for (const projectName of conflictProjects) {
                const projectData = importedData.projects[projectName];
                const bookmarkCount = projectData.bookmarks.length;
                const clipboardCount = projectData.clipboard.length;
                
                const userChoice = confirm(`ÌîÑÎ°úÏ†ùÌä∏: ${projectName}\n` +
                                         `Î∞±ÏóÖ Îç∞Ïù¥ÌÑ∞: Î∂ÅÎßàÌÅ¨ ${bookmarkCount}Í∞ú, ÌÅ¥Î¶ΩÎ≥¥Îìú ${clipboardCount}Í∞ú\n\n` +
                                         `ÌôïÏù∏: Ïù¥ ÌîÑÎ°úÏ†ùÌä∏Î•º Î≥ëÌï© (Í∏∞Ï°¥ Îç∞Ïù¥ÌÑ∞ Ïú†ÏßÄ + Î∞±ÏóÖ Îç∞Ïù¥ÌÑ∞ Ï∂îÍ∞Ä)\n` +
                                         `Ï∑®ÏÜå: Ïù¥ ÌîÑÎ°úÏ†ùÌä∏Îäî Í±¥ÎÑàÎõ∞Í∏∞`);
                
                if (userChoice) {
                    // Î∂ÅÎßàÌÅ¨ Î≥ëÌï©
                    const existingBookmarks = allProjectsData[projectName].bookmarks;
                    const newBookmarks = projectData.bookmarks.filter(newBookmark => {
                        return !existingBookmarks.some(existing => 
                            existing.name === newBookmark.name && existing.url === newBookmark.url
                        );
                    });
                    existingBookmarks.push(...newBookmarks);
                    mergeResults.addedBookmarks += newBookmarks.length;

                    // ÌÅ¥Î¶ΩÎ≥¥Îìú Î≥ëÌï©
                    const existingClipboard = allProjectsData[projectName].clipboard;
                    const newClipboard = projectData.clipboard.filter(newClip => {
                        return !existingClipboard.some(existing => 
                            existing.text === newClip.text
                        );
                    });
                    existingClipboard.push(...newClipboard);
                    mergeResults.addedClipboard += newClipboard.length;

                    mergeResults.conflictProjects.push(projectName);
                }
            }

            // Î≥ëÌï© ÏôÑÎ£å Ï≤òÎ¶¨
            finalizeMerge(importedData, mergeResults);
        }

        // Îç∞Ïù¥ÌÑ∞ ÏôÑÏ†Ñ ÍµêÏ≤¥ Ï≤òÎ¶¨ Ìï®Ïàò
        function performDataReplace(importedData) {
            // Í∏∞Ï°¥ Îç∞Ïù¥ÌÑ∞ ÏôÑÏ†Ñ ÏÇ≠Ï†ú
            Object.keys(allProjectsData).forEach(key => delete allProjectsData[key]);
            
            // Î∞±ÏóÖ Îç∞Ïù¥ÌÑ∞Î°ú ÍµêÏ≤¥
            Object.assign(allProjectsData, importedData.projects);
            
            const availableProjects = Object.keys(allProjectsData);
            if (availableProjects.length > 0) {
                currentProject = importedData.currentProject && 
                               allProjectsData[importedData.currentProject] ? 
                               importedData.currentProject : availableProjects[0];
            }

            // ÏôÑÎ£å Ï≤òÎ¶¨
            finalizeRestore(availableProjects.length, 'ÏôÑÏ†Ñ ÍµêÏ≤¥');
        }

        // Î≥ëÌï© ÏôÑÎ£å Ï≤òÎ¶¨
        function finalizeMerge(importedData, results) {
            // ÌòÑÏû¨ ÌîÑÎ°úÏ†ùÌä∏ ÏÑ§Ï†ï (Í∏∞Ï°¥ ÌîÑÎ°úÏ†ùÌä∏ Ïú†ÏßÄ ÎòêÎäî ÏÉà ÌîÑÎ°úÏ†ùÌä∏Î°ú ÏÑ§Ï†ï)
            if (importedData.currentProject && allProjectsData[importedData.currentProject]) {
                currentProject = importedData.currentProject;
            }

            // ÏôÑÎ£å Ï≤òÎ¶¨
            const totalProjects = Object.keys(allProjectsData).length;
            const message = `‚úÖ Î≥ëÌï©Ïù¥ ÏôÑÎ£åÎêòÏóàÏäµÎãàÎã§!\n\n` +
                          `üìä Î≥ëÌï© Í≤∞Í≥º:\n` +
                          `‚Ä¢ ÏÉà ÌîÑÎ°úÏ†ùÌä∏: ${results.newProjects.length}Í∞ú\n` +
                          `‚Ä¢ Î≥ëÌï©Îêú ÌîÑÎ°úÏ†ùÌä∏: ${results.conflictProjects.length}Í∞ú\n` +
                          `‚Ä¢ Ï∂îÍ∞ÄÎêú Î∂ÅÎßàÌÅ¨: ${results.addedBookmarks}Í∞ú\n` +
                          `‚Ä¢ Ï∂îÍ∞ÄÎêú ÌÅ¥Î¶ΩÎ≥¥Îìú: ${results.addedClipboard}Í∞ú\n` +
                          `‚Ä¢ Ï†ÑÏ≤¥ ÌîÑÎ°úÏ†ùÌä∏: ${totalProjects}Í∞ú`;
            
            finalizeRestore(totalProjects, 'Î≥ëÌï©', message);
        }

        // Î≥µÏõê ÏôÑÎ£å Í≥µÌÜµ Ï≤òÎ¶¨
        function finalizeRestore(projectCount, mode, customMessage = null) {
            // Î°úÏª¨Ïä§ÌÜ†Î¶¨ÏßÄÏóê Ï†ÄÏû•
            saveToFirebase();
            
            // ÌôîÎ©¥ ÏóÖÎç∞Ïù¥Ìä∏
            renderProjectList();
            renderProject(currentProject);
            
            // Î™®Îã¨ Îã´Í∏∞
            settingsModal.style.display = 'none';
            
            // ÏôÑÎ£å Î©îÏãúÏßÄ
            const defaultMessage = `Îç∞Ïù¥ÌÑ∞ ${mode}Ïù¥ ÏôÑÎ£åÎêòÏóàÏäµÎãàÎã§!\nÌîÑÎ°úÏ†ùÌä∏ ${projectCount}Í∞úÍ∞Ä Ï≤òÎ¶¨ÎêòÏóàÏäµÎãàÎã§.`;
            alert(customMessage || defaultMessage);
        }

        projectContextRename.addEventListener('click', () => {
            if (activeProject) {
                const newName = prompt('ÏÉà ÌîÑÎ°úÏ†ùÌä∏ Ïù¥Î¶ÑÏùÑ ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî:', activeProject);
                if (newName && newName.trim() !== '' && newName.trim() !== activeProject) {
                    const trimmedName = newName.trim();
                    
                    if (allProjectsData[trimmedName]) {
                        alert('Ïù¥ÎØ∏ Ï°¥Ïû¨ÌïòÎäî ÌîÑÎ°úÏ†ùÌä∏ Ïù¥Î¶ÑÏûÖÎãàÎã§.');
                        return;
                    }
                    
                    allProjectsData[trimmedName] = allProjectsData[activeProject];
                    delete allProjectsData[activeProject];
                    
                    // projectOrderÏóêÏÑú ÌîÑÎ°úÏ†ùÌä∏Î™Ö Î≥ÄÍ≤Ω
                    if (projectOrder) {
                        const index = projectOrder.indexOf(activeProject);
                        if (index !== -1) {
                            projectOrder[index] = trimmedName;
                        }
                    }
                    
                    if (currentProject === activeProject) {
                        currentProject = trimmedName;
                    }
                    
                    renderProjectList();
                    renderProject(trimmedName);
                    saveToFirebase();
                }
                projectContextMenu.style.display = 'none';
                activeProject = null;
            }
        });

        projectContextDelete.addEventListener('click', () => {
            if (activeProject) {
                if (Object.keys(allProjectsData).length <= 1) {
                    alert('ÏµúÏÜå ÌïòÎÇòÏùò ÌîÑÎ°úÏ†ùÌä∏Îäî ÌïÑÏöîÌï©ÎãàÎã§.');
                    return;
                }
                
                if (confirm(`'${activeProject}' ÌîÑÎ°úÏ†ùÌä∏Î•º ÏÇ≠Ï†úÌïòÏãúÍ≤†ÏäµÎãàÍπå?`)) {
                    delete allProjectsData[activeProject];
                    
                    // projectOrderÏóêÏÑú ÏÇ≠Ï†úÎêú ÌîÑÎ°úÏ†ùÌä∏ Ï†úÍ±∞
                    if (projectOrder) {
                        const index = projectOrder.indexOf(activeProject);
                        if (index !== -1) {
                            projectOrder.splice(index, 1);
                        }
                    }
                    
                    if (currentProject === activeProject) {
                        const remainingProjects = projectOrder && projectOrder.length > 0 
                            ? projectOrder 
                            : Object.keys(allProjectsData);
                        currentProject = remainingProjects[0];
                    }
                    
                    renderProjectList();
                    renderProject(currentProject);
                    saveToFirebase();
                }
                projectContextMenu.style.display = 'none';
                activeProject = null;
            }
        });

        projectContextCancel.addEventListener('click', () => {
            projectContextMenu.style.display = 'none';
            activeProject = null;
        });

        const colorPaletteModal = document.getElementById('color-palette-modal');
        const colorPaletteClose = document.querySelector('.color-palette-close');
        
        colorPaletteClose.addEventListener('click', () => {
            colorPaletteModal.style.display = 'none';
            colorChangeItem = null;
        });
        
        colorPaletteModal.addEventListener('click', (e) => {
            if (e.target === colorPaletteModal) {
                colorPaletteModal.style.display = 'none';
                colorChangeItem = null;
            }
        });
        
        document.querySelectorAll('.color-option').forEach(option => {
            option.addEventListener('click', () => {
                if (colorChangeItem) {
                    const selectedColor = option.dataset.color;
                    const { type, index } = colorChangeItem;
                    const projectData = allProjectsData[currentProject];
                    
                    if (type === 'bookmark') {
                        projectData.bookmarks[index].color = selectedColor;
                    } else if (type === 'clipboard') {
                        projectData.clipboard[index].color = selectedColor;
                    }
                    
                    renderProject(currentProject);
                    
                    colorPaletteModal.style.display = 'none';
                    colorChangeItem = null;
                }
            });
        });

        // ÌÖúÌîåÎ¶ø Îç∞Ïù¥ÌÑ∞ Î°úÎìú
        async function loadTemplates() {
            try {
                if (firebaseInitialized && db) {
                    const doc = await db.collection('templates').doc('userTemplates').get();
                    if (doc.exists) {
                        templates = doc.data().templates || [];
                    } else {
                        templates = [];
                    }
                } else {
                    // Î°úÏª¨Ïä§ÌÜ†Î¶¨ÏßÄÏóêÏÑú Î°úÎìú
                    const savedTemplates = localStorage.getItem('templates');
                    if (savedTemplates) {
                        templates = JSON.parse(savedTemplates);
                    } else {
                        templates = [];
                    }
                }
                renderTemplates();
            } catch (error) {
                console.error('ÌÖúÌîåÎ¶ø Î°úÎìú Ïã§Ìå®:', error);
                // Î°úÏª¨Ïä§ÌÜ†Î¶¨ÏßÄ fallback
                const savedTemplates = localStorage.getItem('templates');
                if (savedTemplates) {
                    templates = JSON.parse(savedTemplates);
                } else {
                    templates = [];
                }
                renderTemplates();
            }
        }

        // ÌÖúÌîåÎ¶ø Îç∞Ïù¥ÌÑ∞ Ï†ÄÏû•
        

        let draggedProject = null;

        function handleProjectDragStart(e) {
            draggedProject = e.target;
            e.target.classList.add('dragging');
            e.dataTransfer.effectAllowed = 'move';
            e.dataTransfer.setData('text/html', e.target.outerHTML);
        }

        function handleProjectDragOver(e) {
            e.preventDefault();
            e.dataTransfer.dropEffect = 'move';
        }

        function handleProjectDragEnter(e) {
            e.target.classList.add('drag-over');
        }

        function handleProjectDragLeave(e) {
            e.target.classList.remove('drag-over');
        }

        function handleProjectDrop(e) {
            e.preventDefault();
            e.target.classList.remove('drag-over');
            
            if (draggedProject && draggedProject !== e.target && e.target.tagName === 'LI') {
                const draggedProjectName = draggedProject.dataset.projectName;
                const targetProjectName = e.target.dataset.projectName;
                
                // projectOrder Î∞∞Ïó¥ÏùÑ ÏÇ¨Ïö©ÌïòÏó¨ ÏàúÏÑú Î≥ÄÍ≤Ω
                const currentOrder = projectOrder || Object.keys(allProjectsData);
                const draggedIndex = currentOrder.indexOf(draggedProjectName);
                const targetIndex = currentOrder.indexOf(targetProjectName);
                
                if (draggedIndex !== -1 && targetIndex !== -1 && draggedIndex !== targetIndex) {
                    // ÏàúÏÑú Î∞∞Ïó¥ÏóêÏÑú Ïù¥Îèô
                    currentOrder.splice(draggedIndex, 1);
                    currentOrder.splice(targetIndex, 0, draggedProjectName);
                    
                    // projectOrder ÏóÖÎç∞Ïù¥Ìä∏
                    projectOrder = [...currentOrder];
                    
                    renderProjectList();
                    saveToFirebase();
                }
            }
        }

        function handleProjectDragEnd(e) {
            e.target.classList.remove('dragging');
            document.querySelectorAll('.project-item').forEach(item => {
                item.classList.remove('drag-over');
            });
            draggedProject = null;
        }

        function setupDropZones() {
            const bookmarkList = document.getElementById('bookmark-list');
            const clipboardList = document.getElementById('clipboard-list');
            
            [bookmarkList, clipboardList].forEach(list => {
                list.classList.add('drop-zone');
                list.addEventListener('dragover', handleItemDragOver);
                list.addEventListener('drop', handleItemDrop);
                list.addEventListener('dragenter', handleItemDragEnter);
                list.addEventListener('dragleave', handleItemDragLeave);
            });
        }

        let draggedItem = null;
        let draggedItemType = null;
        let draggedItemIndex = null;

        function handleItemDragStart(e) {
            draggedItem = e.target;
            draggedItemType = e.target.dataset.type;
            draggedItemIndex = parseInt(e.target.dataset.index);
            e.target.classList.add('dragging');
            e.dataTransfer.effectAllowed = 'move';
            e.dataTransfer.setData('text/html', e.target.outerHTML);
        }

        function handleItemDragOver(e) {
            e.preventDefault();
            e.dataTransfer.dropEffect = 'move';
            
            if (e.target.classList.contains('item-button')) {
                const targetType = e.target.dataset.type;
                if (draggedItemType === targetType) {
                    const rect = e.target.getBoundingClientRect();
                    const midY = rect.top + rect.height / 2;
                    
                    document.querySelectorAll('.drop-indicator').forEach(el => el.remove());
                    
                    const indicator = document.createElement('div');
                    indicator.className = 'drop-indicator';
                    indicator.style.cssText = `
                        position: absolute;
                        left: ${rect.left - 5}px;
                        width: ${rect.width + 10}px;
                        height: 2px;
                        background-color: #3b82f6;
                        z-index: 1000;
                        pointer-events: none;
                    `;
                    
                    if (e.clientY < midY) {
                        indicator.style.top = `${rect.top - 1}px`;
                        e.target.dataset.insertBefore = 'true';
                    } else {
                        indicator.style.top = `${rect.bottom - 1}px`;
                        e.target.dataset.insertBefore = 'false';
                    }
                    
                    document.body.appendChild(indicator);
                }
            }
        }

        function handleItemDragEnter(e) {
            if (e.target.classList.contains('item-list')) {
                e.target.classList.add('drag-over');
            } else if (e.target.closest('.item-list')) {
                e.target.closest('.item-list').classList.add('drag-over');
            }
        }

        function handleItemDragLeave(e) {
            if (e.target.classList.contains('item-list')) {
                e.target.classList.remove('drag-over');
            } else if (e.target.closest('.item-list')) {
                e.target.closest('.item-list').classList.remove('drag-over');
            }
        }

        function handleItemDrop(e) {
            e.preventDefault();
            
            document.querySelectorAll('.drop-indicator').forEach(el => el.remove());
            
            document.querySelectorAll('.drag-over').forEach(el => {
                el.classList.remove('drag-over');
            });
            
            if (draggedItem && draggedItemType && draggedItemIndex !== null) {
                const targetButton = e.target.closest('.item-button');
                const targetList = e.target.closest('.item-list');
                
                if (targetButton && targetButton !== draggedItem) {
                    const targetType = targetButton.dataset.type;
                    const targetIndex = parseInt(targetButton.dataset.index);
                    
                    if (draggedItemType === targetType) {
                        const data = allProjectsData[currentProject][draggedItemType === 'bookmark' ? 'bookmarks' : 'clipboard'];
                        const itemToMove = data[draggedItemIndex];
                        
                        data.splice(draggedItemIndex, 1);
                        
                        let newIndex = targetIndex;
                        if (draggedItemIndex < targetIndex) {
                            newIndex = targetIndex - 1;
                        }
                        
                        const insertBefore = targetButton.dataset.insertBefore === 'true';
                        if (!insertBefore) {
                            newIndex += 1;
                        }
                        
                        data.splice(newIndex, 0, itemToMove);
                        
                        renderProject(currentProject);
                        saveToFirebase();
                        
                        delete targetButton.dataset.insertBefore;
                    }
                } else if (targetList && !targetButton) {
                    const targetType = targetList.id === 'bookmark-list' ? 'bookmark' : 'clipboard';
                    
                    if (draggedItemType === targetType) {
                        const data = allProjectsData[currentProject][draggedItemType === 'bookmark' ? 'bookmarks' : 'clipboard'];
                        const itemToMove = data[draggedItemIndex];
                        
                        data.splice(draggedItemIndex, 1);
                        data.push(itemToMove);
                        
                        renderProject(currentProject);
                        saveToFirebase();
                    }
                }
            }
        }

        function handleItemDragEnd(e) {
            e.target.classList.remove('dragging');
            
            document.querySelectorAll('.item-list, .content-panel').forEach(element => {
                element.classList.remove('drag-over');
            });
            document.querySelectorAll('.drop-indicator').forEach(el => el.remove());
            document.querySelectorAll('.item-button').forEach(button => {
                delete button.dataset.insertBefore;
            });
            
            draggedItem = null;
            draggedItemType = null;
            draggedItemIndex = null;
        }

        // View Clipboard Modal
        const viewClipboardModal = document.getElementById('view-clipboard-modal');
        const viewClipboardCloseBtn = viewClipboardModal.querySelector('.view-clipboard-close');
        const viewClipboardCopyBtn = document.getElementById('view-clipboard-copy-btn');
        const viewClipboardEditBtn = document.getElementById('view-clipboard-edit-btn');

        // Copy Confirmation Modal
        const copyConfirmationModal = document.getElementById('copy-confirmation-modal');
        const copyConfirmationOkBtn = document.getElementById('copy-confirmation-ok');
        
        // Î≥µÏÇ¨ ÌôïÏù∏ Î™®Îã¨ ÌëúÏãú Ìï®Ïàò
        function showCopyConfirmation() {
            copyConfirmationModal.style.display = 'flex';
        }
        
        // Î≥µÏÇ¨ ÌôïÏù∏ Î™®Îã¨ Ïà®ÍπÄ Ìï®Ïàò
        function hideCopyConfirmation() {
            copyConfirmationModal.style.display = 'none';
        }

        viewClipboardCloseBtn.addEventListener('click', () => {
            viewClipboardModal.style.display = 'none';
        });

        // Copy Confirmation Modal Ïù¥Î≤§Ìä∏
        copyConfirmationOkBtn.addEventListener('click', hideCopyConfirmation);
        
        // Î™®Îã¨ Ïô∏Î∂Ä ÌÅ¥Î¶≠ Ïãú Îã´Í∏∞
        copyConfirmationModal.addEventListener('click', (e) => {
            if (e.target === copyConfirmationModal) {
                hideCopyConfirmation();
            }
        });

        viewClipboardModal.addEventListener('click', (e) => {
            if (e.target === viewClipboardModal) {
                viewClipboardModal.style.display = 'none';
            }
        });


        viewClipboardCopyBtn.addEventListener('click', (e) => {
            const textToCopy = e.target.dataset.clipboardText;
            copyToClipboard(textToCopy).then(success => {
                if (success) {
                    showCopyConfirmation();
                    viewClipboardModal.style.display = 'none';
                } else {
                    alert('Î≥µÏÇ¨Ïóê Ïã§Ìå®ÌñàÏäµÎãàÎã§. ÏàòÎèôÏúºÎ°ú Î≥µÏÇ¨Ìï¥ Ï£ºÏÑ∏Ïöî.');
                }
            });
        });

        // Ï†ÄÏû•Îêú Ï≤¥ÌÅ¨Î¶¨Ïä§Ìä∏ ÏïÑÏù¥ÌÖú Ïª®ÌÖçÏä§Ìä∏ Î©îÎâ¥ Ïù¥Î≤§Ìä∏
        const viewChecklistItemContextMenu = document.getElementById('view-checklist-item-context-menu');
        const viewChecklistItemContextDelete = document.getElementById('view-checklist-item-context-delete');
        const viewChecklistItemContextCancel = document.getElementById('view-checklist-item-context-cancel');

        viewChecklistItemContextDelete.addEventListener('click', () => {
            try {
                const clipboardIndex = parseInt(viewChecklistItemContextMenu.dataset.clipboardIndex);
                const itemIndex = parseInt(viewChecklistItemContextMenu.dataset.itemIndex);

                console.log('Ïª®ÌÖçÏä§Ìä∏ Î©îÎâ¥ ÏÇ≠Ï†ú ÌÅ¥Î¶≠');
                console.log('clipboardIndex:', clipboardIndex, 'itemIndex:', itemIndex);
                console.log('currentProject:', currentProject);
                console.log('allProjectsData:', allProjectsData);

                if (confirm('Ïù¥ Ìï≠Î™©ÏùÑ ÏÇ≠Ï†úÌïòÏãúÍ≤†ÏäµÎãàÍπå?')) {
                    console.log('ÏÇ≠Ï†ú ÌôïÏù∏Îê®');

                    // allProjectsDataÏóêÏÑú Ìï≠Î™© ÏÇ≠Ï†ú
                    if (currentProject && allProjectsData && allProjectsData[currentProject]) {
                        const projectData = allProjectsData[currentProject];
                        console.log('projectData:', projectData);

                        // clipboard (Îã®Ïàò) ÌÇ§ ÌôïÏù∏
                        const clipboardArray = projectData.clipboard || projectData.clipboards;
                        console.log('clipboardArray:', clipboardArray);

                        if (clipboardArray && clipboardArray[clipboardIndex]) {
                            const clipboard = clipboardArray[clipboardIndex];
                            console.log('clipboard:', clipboard);
                            console.log('ÏÇ≠Ï†ú Ï†Ñ items:', clipboard.items);

                            if (clipboard.items && clipboard.items[itemIndex]) {
                                console.log('Ìï≠Î™© ÏÇ≠Ï†ú ÏãúÏûë');
                                clipboard.items.splice(itemIndex, 1);
                                console.log('ÏÇ≠Ï†ú ÌõÑ items:', clipboard.items);

                                saveToFirebase();

                                // Ï≤¥ÌÅ¨Î¶¨Ïä§Ìä∏ Îã§Ïãú Î†åÎçîÎßÅ
                                openChecklistModal(clipboard, clipboardIndex);
                                alert('Ìï≠Î™©Ïù¥ ÏÇ≠Ï†úÎêòÏóàÏäµÎãàÎã§.');
                            } else {
                                console.log('Ìï≠Î™©ÏùÑ Ï∞æÏùÑ Ïàò ÏóÜÏùå');
                                alert('ÏÇ≠Ï†úÌï† Ìï≠Î™©ÏùÑ Ï∞æÏùÑ Ïàò ÏóÜÏäµÎãàÎã§.');
                            }
                        } else {
                            console.log('ÌÅ¥Î¶ΩÎ≥¥ÎìúÎ•º Ï∞æÏùÑ Ïàò ÏóÜÏùå');
                            alert('ÌÅ¥Î¶ΩÎ≥¥ÎìúÎ•º Ï∞æÏùÑ Ïàò ÏóÜÏäµÎãàÎã§.');
                        }
                    } else {
                        console.log('ÌîÑÎ°úÏ†ùÌä∏ Îç∞Ïù¥ÌÑ∞Î•º Ï∞æÏùÑ Ïàò ÏóÜÏùå');
                        alert('ÌîÑÎ°úÏ†ùÌä∏ Îç∞Ïù¥ÌÑ∞Î•º Ï∞æÏùÑ Ïàò ÏóÜÏäµÎãàÎã§.');
                    }
                }

                viewChecklistItemContextMenu.style.display = 'none';
            } catch (error) {
                console.error('ÏÇ≠Ï†ú Ï§ë ÏóêÎü¨ Î∞úÏÉù:', error);
                alert('ÏÇ≠Ï†ú Ï§ë Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§: ' + error.message);
                viewChecklistItemContextMenu.style.display = 'none';
            }
        });

        viewChecklistItemContextCancel.addEventListener('click', () => {
            viewChecklistItemContextMenu.style.display = 'none';
        });

        // Îã§Î•∏ Í≥≥ ÌÅ¥Î¶≠ Ïãú Ïª®ÌÖçÏä§Ìä∏ Î©îÎâ¥ Îã´Í∏∞
        document.addEventListener('click', () => {
            if (viewChecklistItemContextMenu) {
                viewChecklistItemContextMenu.style.display = 'none';
            }
        });

        // View Clipboard Download Button
        const viewClipboardDownloadBtn = document.getElementById('view-clipboard-download-btn');
        viewClipboardDownloadBtn.addEventListener('click', (e) => {
            const base64Data = e.target.dataset.fileData;
            const fileName = e.target.dataset.fileName;
            const fileType = e.target.dataset.fileType;

            try {
                const byteCharacters = atob(base64Data);
                const byteNumbers = new Array(byteCharacters.length);
                for (let i = 0; i < byteCharacters.length; i++) {
                    byteNumbers[i] = byteCharacters.charCodeAt(i);
                }
                const byteArray = new Uint8Array(byteNumbers);
                const blob = new Blob([byteArray], { type: fileType || 'application/octet-stream' });

                const link = document.createElement('a');
                link.href = URL.createObjectURL(blob);
                link.download = fileName;
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
                URL.revokeObjectURL(link.href);

                viewClipboardModal.style.display = 'none';
            } catch (error) {
                console.error('ÌååÏùº Îã§Ïö¥Î°úÎìú Ïã§Ìå®:', error);
                alert('ÌååÏùº Îã§Ïö¥Î°úÎìúÏóê Ïã§Ìå®ÌñàÏäµÎãàÎã§.');
            }
        });

        viewClipboardEditBtn.addEventListener('click', (e) => {
            const index = parseInt(e.target.dataset.clipboardIndex);
            const projectData = allProjectsData[currentProject];
            const item = projectData.clipboard[index];

            // Î≥¥Í∏∞ Î™®Îã¨ Îã´Í∏∞
            viewClipboardModal.style.display = 'none';

            // Ìé∏Ïßë Î™®Îã¨ Ïó¥Í∏∞
            const addClipboardModal = document.getElementById('add-clipboard-modal');
            document.getElementById('clipboard-edit-title').textContent = 'ÌÅ¥Î¶ΩÎ≥¥Îìú Ìé∏Ïßë';
            document.getElementById('add-clipboard-title').value = item.title || '';

            // ÌÉÄÏûÖ ÏÑ§Ï†ï (Í∏∞Ï°¥ Ìï≠Î™©ÏùÄ 'normal', Ïã†Í∑ú ÌÖúÌîåÎ¶øÏùÄ 'template')
            const itemType = item.type || 'normal';
            document.querySelector(`input[name="clipboard-type"][value="${itemType}"]`).checked = true;

            if (itemType === 'checklist') {
                // Ï≤¥ÌÅ¨Î¶¨Ïä§Ìä∏ Î™®Îìú
                checklistItems = (item.items || []).map(it => ({
                    id: it.id,
                    text: it.text,
                    checked: it.checked || false,
                    detail: it.detail || ''
                }));
                renderChecklistItems();
                normalModeContainer.style.display = 'none';
                checklistModeContainer.style.display = 'flex';
                document.getElementById('template-hint').style.display = 'none';
            } else {
                // ÏùºÎ∞ò ÎòêÎäî ÌÖúÌîåÎ¶ø Î™®Îìú
                document.getElementById('add-clipboard-content').value = item.textContent || item.text || '';
                checklistItems = [];
                renderChecklistItems();
                normalModeContainer.style.display = 'flex';
                checklistModeContainer.style.display = 'none';

                // ÌÖúÌîåÎ¶ø ÌûåÌä∏ ÌëúÏãú/Ïà®ÍπÄ
                const templateHint = document.getElementById('template-hint');
                if (itemType === 'template') {
                    templateHint.style.display = 'block';
                } else {
                    templateHint.style.display = 'none';
                }
            }

            // Ìé∏Ïßë Î™®Îìú ÏÑ§Ï†ï
            addClipboardModal.dataset.editMode = 'true';
            addClipboardModal.dataset.editIndex = index;

            addClipboardModal.style.display = 'flex';
        });

        // ÌîåÎ°úÌåÖ Í≥ÑÏÇ∞Í∏∞ Í∏∞Îä•
        class Calculator {
            constructor() {
                this.display = document.getElementById('calculator-input');
                this.currentValue = '0';
                this.previousValue = '';
                this.operation = null;
                this.history = this.loadHistory();
                this.init();
            }

            init() {
                document.getElementById('calculator-btn').addEventListener('click', () => this.toggle());
                document.querySelector('.calculator-close-btn').addEventListener('click', () => this.toggle());

                // Î≤ÑÌäº Ïù¥Î≤§Ìä∏
                document.querySelectorAll('.calc-btn').forEach(btn => {
                    btn.addEventListener('click', (e) => this.handleButtonClick(e.target));
                });

                // ÎìúÎûòÍ∑∏ Í∏∞Îä•
                this.setupDragable();

                // ÌÅ¥Î¶ΩÎ≥¥Îìú Ïó∞Îèô
                document.getElementById('calculator-copy-btn').addEventListener('click', () => this.copy());
                document.getElementById('calculator-save-btn').addEventListener('click', () => this.save());

                // ÌÇ§Î≥¥Îìú ÏûÖÎ†•
                document.addEventListener('keydown', (e) => this.handleKeyboard(e));

                this.updateHistory();
            }

            handleButtonClick(btn) {
                const value = btn.dataset.value;
                const action = btn.dataset.action;
                const operator = btn.dataset.operator;

                if (value !== undefined) {
                    this.inputNumber(value);
                } else if (operator) {
                    this.setOperation(operator);
                } else if (action === 'clear') {
                    this.clear();
                } else if (action === 'delete') {
                    this.deleteEntry();
                } else if (action === 'backspace') {
                    this.backspace();
                } else if (action === 'equals') {
                    this.equals();
                }
            }

            inputNumber(num) {
                if (this.currentValue === '0' && num !== '.') {
                    this.currentValue = num;
                } else if (!(num === '.' && this.currentValue.includes('.'))) {
                    this.currentValue += num;
                }
                this.updateDisplay();
            }

            setOperation(op) {
                if (this.currentValue === '') return;

                if (this.previousValue !== '' && this.operation) {
                    this.equals();
                }

                this.previousValue = this.currentValue;
                this.operation = op;
                this.currentValue = '';
            }

            equals() {
                if (this.operation === null || this.previousValue === '') return;

                const prev = parseFloat(this.previousValue);
                const curr = parseFloat(this.currentValue);
                let result;

                switch (this.operation) {
                    case '+': result = prev + curr; break;
                    case '-': result = prev - curr; break;
                    case '*': result = prev * curr; break;
                    case '/': result = prev / curr; break;
                    case '%': result = prev % curr; break;
                    default: return;
                }

                const expression = `${prev} ${this.operation} ${curr}`;
                this.addToHistory(expression, result);
                this.currentValue = result.toString();
                this.previousValue = '';
                this.operation = null;
                this.updateDisplay();
            }

            clear() {
                this.currentValue = '0';
                this.previousValue = '';
                this.operation = null;
                this.updateDisplay();
            }

            deleteEntry() {
                this.currentValue = '0';
                this.updateDisplay();
            }

            backspace() {
                if (this.currentValue.length > 1) {
                    this.currentValue = this.currentValue.slice(0, -1);
                } else {
                    this.currentValue = '0';
                }
                this.updateDisplay();
            }

            updateDisplay() {
                this.display.value = this.currentValue;
            }

            loadHistory() {
                const saved = localStorage.getItem('calculator-history');
                return saved ? JSON.parse(saved) : [];
            }

            saveHistory() {
                const toSave = this.history.slice(0, 5);
                localStorage.setItem('calculator-history', JSON.stringify(toSave));
            }

            addToHistory(expression, result) {
                this.history.unshift({ expression, result });
                this.saveHistory();
                this.updateHistory();
            }

            updateHistory() {
                const list = document.getElementById('calculator-history-list');
                list.innerHTML = this.history.slice(0, 5).map((item, i) =>
                    `<li class="history-item" data-index="${i}">${item.expression} = ${item.result}</li>`
                ).join('');

                list.querySelectorAll('.history-item').forEach(item => {
                    item.addEventListener('click', (e) => {
                        const idx = parseInt(e.target.dataset.index);
                        this.currentValue = this.history[idx].result.toString();
                        this.updateDisplay();
                    });
                });
            }

            toggle() {
                const calc = document.getElementById('floating-calculator');
                calc.style.display = calc.style.display === 'none' ? 'flex' : 'none';
            }

            setupDragable() {
                const calc = document.getElementById('floating-calculator');
                const header = document.querySelector('.calculator-header');
                let isDragging = false;
                let offsetX = 0;
                let offsetY = 0;

                header.addEventListener('mousedown', (e) => {
                    isDragging = true;
                    const rect = calc.getBoundingClientRect();
                    offsetX = e.clientX - rect.left;
                    offsetY = e.clientY - rect.top;
                });

                document.addEventListener('mousemove', (e) => {
                    if (!isDragging) return;
                    calc.style.top = (e.clientY - offsetY) + 'px';
                    calc.style.left = (e.clientX - offsetX) + 'px';
                    calc.style.transform = 'none';
                });

                document.addEventListener('mouseup', () => {
                    isDragging = false;
                });
            }

            copy() {
                navigator.clipboard.writeText(this.currentValue).then(() => {
                    alert('Î≥µÏÇ¨ÎêòÏóàÏäµÎãàÎã§!');
                });
            }

            save() {
                if (!currentProject) {
                    alert('ÌîÑÎ°úÏ†ùÌä∏Î•º Î®ºÏ†Ä ÏÑ†ÌÉùÌï¥Ï£ºÏÑ∏Ïöî.');
                    return;
                }

                const clipboardItem = {
                    title: `Í≥ÑÏÇ∞: ${this.currentValue}`,
                    textContent: this.currentValue,
                    color: '#f8f9fa',
                    favorite: false,
                    type: 'normal',
                    isFile: false
                };

                allProjectsData[currentProject].clipboard.push(clipboardItem);
                renderProject(currentProject);
                saveToFirebase();
                alert('ÌÅ¥Î¶ΩÎ≥¥ÎìúÏóê Ï†ÄÏû•ÎêòÏóàÏäµÎãàÎã§!');
                this.toggle();
            }

            handleKeyboard(e) {
                if (document.getElementById('floating-calculator').style.display === 'none') return;

                if (e.key >= '0' && e.key <= '9' || e.key === '.') {
                    this.inputNumber(e.key);
                } else if (['+', '-', '*', '/'].includes(e.key)) {
                    this.setOperation(e.key === '*' ? '*' : e.key === '/' ? '/' : e.key);
                } else if (e.key === 'Enter') {
                    e.preventDefault();
                    this.equals();
                } else if (e.key === 'Backspace') {
                    e.preventDefault();
                    this.backspace();
                }
            }
        }

        const calculator = new Calculator();

        // Calendar Class
        class Calendar {
            constructor() {
                this.currentDate = new Date();
                this.selectedDate = null;
                this.init();
            }

            init() {
                const calendarBtn = document.getElementById('calendar-btn');
                if (calendarBtn) {
                    calendarBtn.addEventListener('click', () => this.toggle());
                }

                document.querySelector('.calendar-close-btn').addEventListener('click', () => this.toggle());
                document.querySelector('.calendar-prev-btn').addEventListener('click', () => this.previousMonth());
                document.querySelector('.calendar-next-btn').addEventListener('click', () => this.nextMonth());

                document.getElementById('calendar-date-input').addEventListener('change', (e) => {
                    if (e.target.value) {
                        this.currentDate = new Date(e.target.value);
                        this.render();
                    }
                });

                document.getElementById('calendar-copy-btn').addEventListener('click', () => this.copySelectedDate());

                // ÎìúÎûòÍ∑∏ Í∏∞Îä•
                this.setupDragable();

                this.render();
            }

            render() {
                const year = this.currentDate.getFullYear();
                const month = this.currentDate.getMonth();

                // Ìó§Îçî ÏóÖÎç∞Ïù¥Ìä∏
                const title = document.querySelector('.calendar-title');
                title.textContent = `${year}ÎÖÑ ${month + 1}Ïõî`;

                // ÎÇ†Ïßú Î†åÎçîÎßÅ
                const daysContainer = document.getElementById('calendar-days');
                daysContainer.innerHTML = '';

                const firstDay = new Date(year, month, 1);
                const lastDay = new Date(year, month + 1, 0);
                const prevLastDay = new Date(year, month, 0);

                const prevMonthDays = firstDay.getDay();
                const currentMonthDays = lastDay.getDate();
                const nextMonthDays = 42 - prevMonthDays - currentMonthDays;

                // Ïù¥Ï†Ñ Îã¨Ïùò ÎÇ†Ïßú
                for (let i = prevMonthDays - 1; i >= 0; i--) {
                    const day = prevLastDay.getDate() - i;
                    const dayEl = this.createDayElement(day, true);
                    daysContainer.appendChild(dayEl);
                }

                // ÌòÑÏû¨ Îã¨Ïùò ÎÇ†Ïßú
                const today = new Date();
                for (let i = 1; i <= currentMonthDays; i++) {
                    const dayEl = this.createDayElement(i, false);

                    // Ïò§Îäò ÌëúÏãú
                    if (year === today.getFullYear() && month === today.getMonth() && i === today.getDate()) {
                        dayEl.classList.add('today');
                    }

                    // Ï£ºÎßê ÌëúÏãú (ÌÜ†, Ïùº)
                    const dayOfWeek = new Date(year, month, i).getDay();
                    if (dayOfWeek === 0 || dayOfWeek === 6) {
                        dayEl.classList.add('weekend');
                    }

                    // ÏÑ†ÌÉùÎêú ÎÇ†Ïßú ÌëúÏãú
                    if (this.selectedDate &&
                        year === this.selectedDate.getFullYear() &&
                        month === this.selectedDate.getMonth() &&
                        i === this.selectedDate.getDate()) {
                        dayEl.classList.add('selected');
                    }

                    dayEl.addEventListener('click', () => this.selectDate(new Date(year, month, i)));
                    daysContainer.appendChild(dayEl);
                }

                // Îã§Ïùå Îã¨Ïùò ÎÇ†Ïßú
                for (let i = 1; i <= nextMonthDays; i++) {
                    const dayEl = this.createDayElement(i, true);
                    daysContainer.appendChild(dayEl);
                }
            }

            createDayElement(day, isOtherMonth) {
                const dayEl = document.createElement('div');
                dayEl.classList.add('calendar-day');
                dayEl.textContent = day;
                if (isOtherMonth) {
                    dayEl.classList.add('other-month');
                }
                return dayEl;
            }

            selectDate(date) {
                this.selectedDate = date;
                document.getElementById('calendar-date-input').value =
                    date.toISOString().split('T')[0];
                this.render();
            }

            previousMonth() {
                this.currentDate.setMonth(this.currentDate.getMonth() - 1);
                this.render();
            }

            nextMonth() {
                this.currentDate.setMonth(this.currentDate.getMonth() + 1);
                this.render();
            }

            copySelectedDate() {
                if (!this.selectedDate) {
                    alert('Î®ºÏ†Ä ÎÇ†ÏßúÎ•º ÏÑ†ÌÉùÌï¥Ï£ºÏÑ∏Ïöî.');
                    return;
                }

                const dateStr = this.selectedDate.toLocaleDateString('ko-KR');
                navigator.clipboard.writeText(dateStr).then(() => {
                    alert('Î≥µÏÇ¨ÎêòÏóàÏäµÎãàÎã§!');
                });
            }

            toggle() {
                const calendar = document.getElementById('floating-calendar');
                calendar.style.display = calendar.style.display === 'none' ? 'flex' : 'none';
            }

            setupDragable() {
                const calendar = document.getElementById('floating-calendar');
                const header = document.querySelector('.calendar-header');
                let isDragging = false;
                let offsetX = 0;
                let offsetY = 0;

                header.addEventListener('mousedown', (e) => {
                    isDragging = true;
                    const rect = calendar.getBoundingClientRect();
                    offsetX = e.clientX - rect.left;
                    offsetY = e.clientY - rect.top;
                });

                document.addEventListener('mousemove', (e) => {
                    if (!isDragging) return;
                    calendar.style.top = (e.clientY - offsetY) + 'px';
                    calendar.style.left = (e.clientX - offsetX) + 'px';
                    calendar.style.transform = 'none';
                });

                document.addEventListener('mouseup', () => {
                    isDragging = false;
                });
            }
        }

        const calendar = new Calendar();

        // Î™®Î∞îÏùº ÌÉ≠ ÎÑ§ÎπÑÍ≤åÏù¥ÏÖò Ï≤òÎ¶¨
        function initMobileTabs() {
            const mobileTabs = document.querySelectorAll('.mobile-tab');
            const projectSidebar = document.getElementById('project-sidebar');
            const bookmarkPanel = document.querySelector('.bookmark-panel');
            const clipboardPanel = document.querySelector('.clipboard-panel');
            const practicePanel = document.querySelector('.practice-panel');

            mobileTabs.forEach(tab => {
                tab.addEventListener('click', () => {
                    // Î™®Îì† ÌÉ≠ ÎπÑÌôúÏÑ±Ìôî
                    mobileTabs.forEach(t => t.classList.remove('active'));

                    // ÌÅ¥Î¶≠Îêú ÌÉ≠ ÌôúÏÑ±Ìôî
                    tab.classList.add('active');

                    // Î™®Îì† Ìå®ÎÑê Ïà®ÍπÄ
                    projectSidebar.classList.remove('mobile-visible');
                    bookmarkPanel.classList.remove('mobile-visible');
                    clipboardPanel.classList.remove('mobile-visible');
                    practicePanel.classList.remove('mobile-visible');

                    // ÏÑ†ÌÉùÎêú ÌÉ≠Ïóê Îî∞Îùº Ìå®ÎÑê ÌëúÏãú
                    const tabType = tab.dataset.tab;
                    switch(tabType) {
                        case 'projects':
                            projectSidebar.classList.add('mobile-visible');
                            break;
                        case 'clipboard':
                            clipboardPanel.classList.add('mobile-visible');
                            break;
                        case 'practice':
                            practicePanel.classList.add('mobile-visible');
                            break;
                    }
                });
            });
            
            // Ï¥àÍ∏∞ ÏÉÅÌÉú: ÌîÑÎ°úÏ†ùÌä∏ ÌÉ≠ ÌôúÏÑ±Ìôî
            if (window.innerWidth <= 768) {
                projectSidebar.classList.add('mobile-visible');
            }
        }

        // Ïó∞ÏäµÏû• ÏòÅÏó≠ Ï¥àÍ∏∞Ìôî
        function initPracticeArea() {
            const practiceTextarea = document.getElementById('practice-textarea');
            const copyBtn = document.getElementById('copy-practice-btn');
            const clearBtn = document.getElementById('clear-practice-btn');
            
            // Î≥µÏÇ¨ Î≤ÑÌäº Ïù¥Î≤§Ìä∏
            copyBtn.addEventListener('click', async () => {
                const text = practiceTextarea.value;
                if (!text.trim()) {
                    alert('Î≥µÏÇ¨Ìï† ÎÇ¥Ïö©Ïù¥ ÏóÜÏäµÎãàÎã§.');
                    return;
                }
                
                try {
                    if (navigator.clipboard && navigator.clipboard.writeText) {
                        await navigator.clipboard.writeText(text);
                        showCopyConfirmation();
                    } else {
                        // Ìè¥Î∞± Î∞©Ïãù
                        practiceTextarea.select();
                        document.execCommand('copy');
                        showCopyConfirmation();
                    }
                } catch (err) {
                    console.error('Î≥µÏÇ¨ Ïã§Ìå®:', err);
                    alert('Î≥µÏÇ¨Ïóê Ïã§Ìå®ÌñàÏäµÎãàÎã§.');
                }
            });
            
            // Ï¥àÍ∏∞Ìôî Î≤ÑÌäº Ïù¥Î≤§Ìä∏
            clearBtn.addEventListener('click', () => {
                if (practiceTextarea.value.trim() && confirm('Ïó∞ÏäµÏû•Ïùò Î™®Îì† ÎÇ¥Ïö©ÏùÑ Ï¥àÍ∏∞ÌôîÌïòÏãúÍ≤†ÏäµÎãàÍπå?')) {
                    practiceTextarea.value = '';
                    savePracticeContent('', true); // Ï¶âÏãú Ï†ÄÏû•
                    practiceTextarea.focus();
                }
            });
            
            // Ïã§ÏãúÍ∞Ñ Ï†ÄÏû• (ÎîîÎ∞îÏö¥Ïã± Ï†ÅÏö©)
            let saveTimeout;
            practiceTextarea.addEventListener('input', () => {
                clearTimeout(saveTimeout);
                saveTimeout = setTimeout(() => {
                    savePracticeContent(practiceTextarea.value);
                }, 1000); // 1Ï¥à ÏßÄÏó∞
            });
            
            // Ïó∞ÏäµÏû• ÎÇ¥Ïö© Î°úÎìú
            loadPracticeContent();
            
            // Ïã§ÏãúÍ∞Ñ ÎèôÍ∏∞Ìôî Î¶¨Ïä§ÎÑà ÏÑ§Ï†ï (Firebase Ï¥àÍ∏∞Ìôî ÌõÑ)
            setTimeout(() => {
                if (firebaseInitialized && db) {
                    db.collection('userdata').doc('global-practices').onSnapshot((doc) => {
                        if (doc.exists && document.activeElement !== practiceTextarea) {
                            // ÏÇ¨Ïö©ÏûêÍ∞Ä ÌòÑÏû¨ ÌÖçÏä§Ìä∏ÏÉÅÏûêÎ•º Ìé∏Ïßë Ï§ëÏù¥ ÏïÑÎãê ÎïåÎßå ÏóÖÎç∞Ïù¥Ìä∏
                            const data = doc.data();
                            if (data.practices) {
                                const remoteContent = data.practices[currentPracticeTab] || '';
                                if (remoteContent !== practiceTextarea.value) {
                                    // ÏõêÍ≤© Îç∞Ïù¥ÌÑ∞Î°ú Î°úÏª¨ Îç∞Ïù¥ÌÑ∞ ÏóÖÎç∞Ïù¥Ìä∏
                                    globalPractices = data.practices;
                                    practiceTextarea.value = remoteContent;
                                    console.log('Îã§Î•∏ Í∏∞Í∏∞ÏóêÏÑú Ïó∞ÏäµÏû• ÎÇ¥Ïö©Ïù¥ ÏóÖÎç∞Ïù¥Ìä∏ÎêòÏóàÏäµÎãàÎã§.');
                                }
                            }
                        }
                    });
                }
            }, 2000); // Firebase Ï¥àÍ∏∞Ìôî ÏôÑÎ£å ÌõÑ 2Ï¥à Îí§Ïóê Î¶¨Ïä§ÎÑà ÏÑ§Ï†ï
        }

        // ÌôîÎ©¥ ÌÅ¨Í∏∞ Î≥ÄÍ≤Ω Í∞êÏßÄ
        function handleResize() {
            if (window.innerWidth <= 768) {
                // Î™®Î∞îÏùº Î™®Îìú
                const activeTab = document.querySelector('.mobile-tab.active');
                if (activeTab) {
                    const event = new Event('click');
                    activeTab.dispatchEvent(event);
                }
            } else {
                // Îç∞Ïä§ÌÅ¨ÌÜ± Î™®Îìú: Î™®Îì† mobile-visible ÌÅ¥ÎûòÏä§ Ï†úÍ±∞
                document.getElementById('project-sidebar').classList.remove('mobile-visible');
                document.querySelector('.bookmark-panel').classList.remove('mobile-visible');
                document.querySelector('.clipboard-panel').classList.remove('mobile-visible');
                document.querySelector('.practice-panel').classList.remove('mobile-visible');
            }
        }

        // ÌÑ∞Ïπò Ïä§ÏôÄÏù¥ÌîÑ ÏßÄÏõê (ÏòµÏÖò)
        let touchStartX = 0;
        let touchEndX = 0;
        
        function handleSwipe() {
            if (window.innerWidth > 768) return; // Î™®Î∞îÏùºÏóêÏÑúÎßå ÏûëÎèô
            
            const swipeThreshold = 100;
            const difference = touchStartX - touchEndX;
            
            if (Math.abs(difference) > swipeThreshold) {
                const currentActiveTab = document.querySelector('.mobile-tab.active');
                const allTabs = Array.from(document.querySelectorAll('.mobile-tab'));
                const currentIndex = allTabs.indexOf(currentActiveTab);
                
                let nextIndex;
                if (difference > 0) {
                    // ÏôºÏ™ΩÏúºÎ°ú Ïä§ÏôÄÏù¥ÌîÑ (Îã§Ïùå ÌÉ≠)
                    nextIndex = currentIndex + 1 < allTabs.length ? currentIndex + 1 : 0;
                } else {
                    // Ïò§Î•∏Ï™ΩÏúºÎ°ú Ïä§ÏôÄÏù¥ÌîÑ (Ïù¥Ï†Ñ ÌÉ≠)
                    nextIndex = currentIndex - 1 >= 0 ? currentIndex - 1 : allTabs.length - 1;
                }
                
                allTabs[nextIndex].click();
            }
        }

        // ÌÑ∞Ïπò Ïù¥Î≤§Ìä∏ Î¶¨Ïä§ÎÑà
        document.addEventListener('touchstart', e => {
            touchStartX = e.changedTouches[0].screenX;
        });

        document.addEventListener('touchend', e => {
            touchEndX = e.changedTouches[0].screenX;
            handleSwipe();
        });

        // Î¶¨ÏÇ¨Ïù¥Ï¶à Ïù¥Î≤§Ìä∏ Î¶¨Ïä§ÎÑà
        window.addEventListener('resize', handleResize);

        // PWA Service Worker Îì±Î°ù
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('sw.js')
                    .then(registration => {
                        console.log('PWA: Service Worker Îì±Î°ù ÏÑ±Í≥µ', registration.scope);
                        
                        // Service Worker ÏóÖÎç∞Ïù¥Ìä∏ ÌôïÏù∏
                        registration.addEventListener('updatefound', () => {
                            const newWorker = registration.installing;
                            newWorker.addEventListener('statechange', () => {
                                if (newWorker.state === 'installed' && navigator.serviceWorker.controller) {
                                    // ÏÉà Î≤ÑÏ†Ñ ÏÇ¨Ïö© Í∞ÄÎä• ÏïåÎ¶º
                                    if (confirm('ÏÉàÎ°úÏö¥ Î≤ÑÏ†ÑÏù¥ ÏÇ¨Ïö© Í∞ÄÎä•Ìï©ÎãàÎã§. ÏßÄÍ∏à ÏÉàÎ°úÍ≥†Ïπ®ÌïòÏãúÍ≤†ÏäµÎãàÍπå?')) {
                                        window.location.reload();
                                    }
                                }
                            });
                        });
                    })
                    .catch(error => {
                        console.log('PWA: Service Worker Îì±Î°ù Ïã§Ìå®', error);
                    });
            });
        }

        // PWA ÏÑ§Ïπò Í¥ÄÎ¶¨
        let deferredPrompt;
        let installButton = null;

        // PWA ÏÑ§Ïπò Í∞ÄÎä• Ïó¨Î∂Ä ÌôïÏù∏ Î∞è Î≤ÑÌäº ÌëúÏãú
        function checkPWAInstallability() {
            console.log('PWA: ÏÑ§Ïπò Í∞ÄÎä•ÏÑ± ÌôïÏù∏ Ï§ë...');
            
            // Ïù¥ÎØ∏ ÏÑ§ÏπòÎêú Ïï±Ïù∏ÏßÄ ÌôïÏù∏
            if (window.matchMedia('(display-mode: standalone)').matches) {
                console.log('PWA: Ïù¥ÎØ∏ ÏÑ§ÏπòÎêú Ïï±ÏóêÏÑú Ïã§Ìñâ Ï§ë');
                return false;
            }
            
            // iOS Safari ÌôïÏù∏
            const isIOS = /iPad|iPhone|iPod/.test(navigator.userAgent);
            const isInStandaloneMode = ('standalone' in window.navigator) && window.navigator.standalone;
            
            if (isIOS && !isInStandaloneMode) {
                console.log('PWA: iOS SafariÏóêÏÑú Ïã§Ìñâ Ï§ë - ÏàòÎèô ÏÑ§Ïπò Í∞ÄÏù¥Îìú ÌëúÏãú');
                showIOSInstallGuide();
                return false;
            }
            
            // ÏùºÎ∞òÏ†ÅÏù∏ Í≤ΩÏö∞ - beforeinstallprompt Ïù¥Î≤§Ìä∏ ÎåÄÍ∏∞ Ï§ë
            // 5Ï¥à ÌõÑÏóêÎèÑ Ïù¥Î≤§Ìä∏Í∞Ä ÏóÜÏúºÎ©¥ ÏàòÎèôÏúºÎ°ú Î≤ÑÌäº ÌëúÏãú
            setTimeout(() => {
                if (!deferredPrompt && !installButton) {
                    console.log('PWA: beforeinstallprompt Ïù¥Î≤§Ìä∏ ÏóÜÏùå - ÏàòÎèô Î≤ÑÌäº ÌëúÏãú');
                    showManualInstallButton();
                }
            }, 5000);
            
            return true;
        }

        // beforeinstallprompt Ïù¥Î≤§Ìä∏ Ï≤òÎ¶¨
        window.addEventListener('beforeinstallprompt', (e) => {
            console.log('PWA: beforeinstallprompt Ïù¥Î≤§Ìä∏ Î∞úÏÉù');
            e.preventDefault();
            deferredPrompt = e;
            showInstallButton();
        });

        // iOS SafariÏö© ÏÑ§Ïπò Í∞ÄÏù¥Îìú
        function showIOSInstallGuide() {
            const iosGuide = document.createElement('div');
            iosGuide.id = 'ios-install-guide';
            iosGuide.innerHTML = `
                <div style="
                    position: fixed;
                    top: 0;
                    left: 0;
                    right: 0;
                    background: #007acc;
                    color: white;
                    padding: 12px;
                    text-align: center;
                    font-size: 14px;
                    z-index: 9999;
                ">
                    üì± iOS ÏÑ§Ïπò: Safari Î©îÎâ¥ ‚Üí "Ìôà ÌôîÎ©¥Ïóê Ï∂îÍ∞Ä" 
                    <button onclick="this.parentElement.parentElement.remove()" style="
                        background: none;
                        border: none;
                        color: white;
                        font-size: 16px;
                        float: right;
                        cursor: pointer;
                    ">√ó</button>
                </div>
            `;
            document.body.appendChild(iosGuide);
        }

        // ÏûêÎèô ÏÑ§Ïπò Î≤ÑÌäº (beforeinstallprompt Ïù¥Î≤§Ìä∏ ÏûàÏùÑ Îïå)
        function showInstallButton() {
            createInstallButton('üì± Ïï± ÏÑ§Ïπò', async () => {
                if (deferredPrompt) {
                    try {
                        deferredPrompt.prompt();
                        const result = await deferredPrompt.userChoice;
                        
                        if (result.outcome === 'accepted') {
                            console.log('PWA: ÏÇ¨Ïö©ÏûêÍ∞Ä Ïï±ÏùÑ ÏÑ§ÏπòÌñàÏäµÎãàÎã§');
                        } else {
                            console.log('PWA: ÏÇ¨Ïö©ÏûêÍ∞Ä Ïï± ÏÑ§ÏπòÎ•º Í±∞Î∂ÄÌñàÏäµÎãàÎã§');
                        }
                        
                        deferredPrompt = null;
                        if (installButton) {
                            installButton.remove();
                            installButton = null;
                        }
                    } catch (error) {
                        console.error('PWA: ÏÑ§Ïπò Ï§ë Ïò§Î•ò:', error);
                    }
                }
            });
        }

        // ÏàòÎèô ÏÑ§Ïπò Î≤ÑÌäº (beforeinstallprompt Ïù¥Î≤§Ìä∏ ÏóÜÏùÑ Îïå)
        function showManualInstallButton() {
            createInstallButton('üì± ÏÑ§Ïπò Î∞©Î≤ï', () => {
                const isChrome = /Chrome/.test(navigator.userAgent);
                const isEdge = /Edge/.test(navigator.userAgent);
                
                let message = 'Ïù¥ Ïï±ÏùÑ ÏÑ§ÏπòÌïòÎ†§Î©¥:\\n\\n';
                
                if (isChrome) {
                    message += 'Chrome: Ï£ºÏÜåÏ∞Ω Ïò§Î•∏Ï™Ω "Ïï± ÏÑ§Ïπò" ÏïÑÏù¥ÏΩò ÌÅ¥Î¶≠';
                } else if (isEdge) {
                    message += 'Edge: Ï£ºÏÜåÏ∞Ω Ïò§Î•∏Ï™Ω "Ïï± ÏÑ§Ïπò" ÏïÑÏù¥ÏΩò ÌÅ¥Î¶≠';
                } else {
                    message += '1. Chrome ÎòêÎäî Edge Î∏åÎùºÏö∞Ï†Ä ÏÇ¨Ïö©\\n2. Ï£ºÏÜåÏ∞ΩÏóêÏÑú ÏÑ§Ïπò ÏòµÏÖò Ï∞æÍ∏∞\\n3. ÎòêÎäî Î∏åÎùºÏö∞Ï†Ä Î©îÎâ¥ÏóêÏÑú "Ïï± ÏÑ§Ïπò" ÏÑ†ÌÉù';
                }
                
                alert(message);
            });
        }

        // ÏÑ§Ïπò Î≤ÑÌäº ÏÉùÏÑ± Í≥µÌÜµ Ìï®Ïàò
        function createInstallButton(text, clickHandler) {
            if (installButton) return; // Ïù¥ÎØ∏ Ï°¥Ïû¨ÌïòÎ©¥ Ï§ëÎã®
            
            // Îç∞Ïä§ÌÅ¨ÌÜ±: Ìó§ÎçîÏóê Ï∂îÍ∞Ä
            const header = document.querySelector('.main-header') || document.querySelector('.sidebar-header');
            // Î™®Î∞îÏùº: ÌÉ≠ ÏòÅÏó≠Ïóê Ï∂îÍ∞Ä  
            const mobileTabs = document.querySelector('.mobile-tabs');
            const targetContainer = window.innerWidth <= 768 ? mobileTabs : header;
            
            if (targetContainer) {
                installButton = document.createElement('button');
                installButton.id = 'install-btn';
                installButton.innerHTML = text;
                installButton.style.cssText = `
                    background: #007acc;
                    color: white;
                    border: none;
                    padding: 8px 12px;
                    border-radius: 4px;
                    font-size: 12px;
                    cursor: pointer;
                    margin: 4px;
                    z-index: 1000;
                `;
                
                installButton.addEventListener('click', clickHandler);
                targetContainer.appendChild(installButton);
                
                console.log('PWA: ÏÑ§Ïπò Î≤ÑÌäº ÏÉùÏÑ±Îê®');
            }
        }

        // Ïï±Ïù¥ ÏÑ§ÏπòÎêòÎ©¥ ÏÑ§Ïπò Î≤ÑÌäº Ï†úÍ±∞
        window.addEventListener('appinstalled', () => {
            console.log('PWA: Ïï±Ïù¥ ÏÑ±Í≥µÏ†ÅÏúºÎ°ú ÏÑ§ÏπòÎêòÏóàÏäµÎãàÎã§');
            const installBtn = document.getElementById('install-btn');
            if (installBtn) {
                installBtn.remove();
            }
            deferredPrompt = null;
        });

        // Ï¥àÍ∏∞ ÌôîÎ©¥ Î†åÎçîÎßÅ - Firebase Ï¥àÍ∏∞Ìôî ÌõÑ Ïã§Ìñâ
        initializeApp().then(() => {
            initMobileTabs();
            initPracticeArea();
            handleResize(); // Ï¥àÍ∏∞ ÌôîÎ©¥ ÌÅ¨Í∏∞Ïóê Îî∞Î•∏ ÏÑ§Ï†ï
            
            // PWA ÏÑ§Ïπò Í∞ÄÎä•ÏÑ± ÌôïÏù∏
            setTimeout(() => {
                checkPWAInstallability();
            }, 2000); // 2Ï¥à ÌõÑ ÌôïÏù∏ (UI Î°úÎî© ÏôÑÎ£å ÌõÑ)

        });
    });
    </script>

</body>
</html>